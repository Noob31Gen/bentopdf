import{c as X,i as Y}from"./lucide-C31GBTWo.js";import"./mobileMenu-BZ6_9HLx.js";import"./simple-mode-footer-CDVnObzA.js";import{G as ce,z as a,l as de,F as D,r as ee,P,g as le,n as pe,H as b,I as x,J as R,i as C,_ as me,k as fe}from"./ui-BS-bvShi.js";ce.workerSrc=new URL("/assets/pdf.worker.min-qwK7q_zL.mjs",import.meta.url).toString();document.addEventListener("DOMContentLoaded",()=>{let y=!1;const S=document.getElementById("file-input"),v=document.getElementById("drop-zone"),$=document.getElementById("process-btn"),k=document.getElementById("file-display-area"),N=document.getElementById("split-options"),q=document.getElementById("back-to-tools"),w=document.getElementById("split-mode"),W=document.getElementById("range-panel"),H=document.getElementById("visual-select-panel"),O=document.getElementById("even-odd-panel"),B=document.getElementById("zip-option-wrapper"),U=document.getElementById("all-pages-panel"),V=document.getElementById("bookmarks-panel"),G=document.getElementById("n-times-panel"),E=document.getElementById("n-times-warning");q&&q.addEventListener("click",()=>{window.location.href="/"});const z=async()=>{if(a.files.length>0){const t=a.files[0];if(k){k.innerHTML="";const i=document.createElement("div");i.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const n=document.createElement("div");n.className="flex flex-col overflow-hidden";const s=document.createElement("div");s.className="flex items-center gap-2";const c=document.createElement("span");c.className="truncate font-medium text-gray-200",c.textContent=t.name;const r=document.createElement("span");r.className="flex-shrink-0 text-gray-400 text-xs",r.textContent=`(${fe(t.size)})`,s.append(c,r);const o=document.createElement("span");o.className="text-xs text-gray-500 mt-0.5",o.textContent="Loading pages...",n.append(s,o);const l=document.createElement("button");l.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",l.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',l.onclick=()=>{a.files=[],a.pdfDoc=null,z()},i.append(n,l),k.appendChild(i),X({icons:Y});try{if(!a.pdfDoc){D("Loading PDF...");const p=await ee(t);a.pdfDoc=await P.load(p),x()}o.textContent=`${a.pdfDoc.getPageCount()} Pages`}catch(p){console.error("Error loading PDF:",p),b("Error","Failed to load PDF file."),a.files=[],z();return}}N&&N.classList.remove("hidden")}else k&&(k.innerHTML=""),N&&N.classList.add("hidden"),a.pdfDoc=null},te=async()=>{if(y)return;const t=document.getElementById("page-selector-grid");if(t){y=!0,t.textContent="",de(),D("Rendering page previews...");try{if(!a.pdfDoc)if(a.files.length>0){const c=a.files[0],r=await ee(c);a.pdfDoc=await P.load(r)}else throw new Error("No PDF document loaded");const i=await a.pdfDoc.save(),n=await le({data:i}).promise;await pe(n,t,(c,r)=>{const o=document.createElement("div");o.className="page-thumbnail-wrapper p-1 border-2 border-transparent rounded-lg cursor-pointer hover:border-indigo-500 relative",o.dataset.pageIndex=(r-1).toString();const l=document.createElement("img");l.src=c.toDataURL(),l.className="rounded-md w-full h-auto";const p=document.createElement("p");p.className="text-center text-xs mt-1 text-gray-300",p.textContent=`Page ${r}`,o.append(l,p);const L=f=>{f.preventDefault(),f.stopPropagation(),o.classList.contains("selected")?(o.classList.remove("selected","border-indigo-500"),o.classList.add("border-transparent")):(o.classList.add("selected","border-indigo-500"),o.classList.remove("border-transparent"))};return o.addEventListener("click",L),o.addEventListener("touchend",L),o.addEventListener("touchstart",f=>{f.preventDefault()}),o},{batchSize:8,useLazyLoading:!0,lazyLoadMargin:"400px",onProgress:(c,r)=>{D(`Rendering page previews: ${c}/${r}`)},onBatchComplete:()=>{X({icons:Y})}})}catch(i){console.error("Error rendering visual selector:",i),b("Error","Failed to render page previews."),y=!1}finally{x()}}},A=()=>{a.files=[],a.pdfDoc=null,document.querySelectorAll(".page-thumbnail-wrapper.selected").forEach(c=>{c.classList.remove("selected","border-indigo-500"),c.classList.add("border-transparent")}),y=!1;const t=document.getElementById("page-selector-grid");t&&(t.innerHTML="");const i=document.getElementById("page-range");i&&(i.value="");const n=document.getElementById("split-n-value");n&&(n.value="5");const s=document.querySelector('input[name="split-mode"][value="range"]');s&&(s.checked=!0,s.dispatchEvent(new Event("change"))),w&&(w.value="range",w.dispatchEvent(new Event("change"))),z()},ne=async()=>{const t=w.value,i=document.getElementById("download-as-zip")?.checked||!1;D("Splitting PDF...");try{if(!a.pdfDoc)throw new Error("No PDF document loaded.");const n=a.pdfDoc.getPageCount();let s=[];switch(t){case"range":const r=document.getElementById("page-range").value;if(!r)throw new Error("Choose a valid page range.");const o=r.split(",");for(const e of o){const m=e.trim();if(m.includes("-")){const[d,g]=m.split("-").map(Number);if(isNaN(d)||isNaN(g)||d<1||g>n||d>g)continue;for(let u=d;u<=g;u++)s.push(u-1)}else{const d=Number(m);if(isNaN(d)||d<1||d>n)continue;s.push(d-1)}}break;case"even-odd":const l=document.querySelector('input[name="even-odd-choice"]:checked');if(!l)throw new Error("Please select even or odd pages.");const p=l.value;for(let e=0;e<n;e++)p==="even"&&(e+1)%2===0&&s.push(e),p==="odd"&&(e+1)%2!==0&&s.push(e);break;case"all":s=Array.from({length:n},(e,m)=>m);break;case"visual":s=Array.from(document.querySelectorAll(".page-thumbnail-wrapper.selected")).map(e=>parseInt(e.dataset.pageIndex||"0"));break;case"bookmarks":const{getCpdf:L}=await me(async()=>{const{getCpdf:e}=await import("./cpdf-helper-mEqAPeAj.js");return{getCpdf:e}},[]),f=await L(),j=await a.pdfDoc.save(),T=f.fromMemory(new Uint8Array(j),"");f.startGetBookmarkInfo(T);const ae=f.numberBookmarks(),J=document.getElementById("bookmark-level")?.value,h=[];for(let e=0;e<ae;e++){const m=f.getBookmarkLevel(e),d=f.getBookmarkPage(T,e);(J==="all"||m===parseInt(J))&&d>1&&!h.includes(d-1)&&h.push(d-1)}if(f.endGetBookmarkInfo(),f.deletePdf(T),h.length===0)throw new Error("No bookmarks found at the selected level.");h.sort((e,m)=>e-m);const K=new R;for(let e=0;e<h.length;e++){const m=e===0?0:h[e],d=e<h.length-1?h[e+1]-1:n-1,g=await P.create(),u=Array.from({length:d-m+1},(I,_)=>m+_);(await g.copyPages(a.pdfDoc,u)).forEach(I=>g.addPage(I));const M=await g.save();K.file(`split-${e+1}.pdf`,M)}const se=await K.generateAsync({type:"blob"});C(se,"split-by-bookmarks.zip"),x(),b("Success","PDF split successfully!","success",()=>{A()});return;case"n-times":const F=parseInt(document.getElementById("split-n-value")?.value||"5");if(F<1)throw new Error("N must be at least 1.");const Q=new R,oe=Math.ceil(n/F);for(let e=0;e<oe;e++){const m=e*F,d=Math.min(m+F-1,n-1),g=Array.from({length:d-m+1},(I,_)=>m+_),u=await P.create();(await u.copyPages(a.pdfDoc,g)).forEach(I=>u.addPage(I));const M=await u.save();Q.file(`split-${e+1}.pdf`,M)}const ie=await Q.generateAsync({type:"blob"});C(ie,"split-n-times.zip"),x(),b("Success","PDF split successfully!","success",()=>{A()});return}const c=[...new Set(s)];if(c.length===0&&t!=="bookmarks"&&t!=="n-times")throw new Error("No pages were selected for splitting.");if(t==="all"||["range","visual"].includes(t)&&i){D("Creating ZIP file...");const r=new R;for(const l of c){const p=await P.create(),[L]=await p.copyPages(a.pdfDoc,[l]);p.addPage(L);const f=await p.save();r.file(`page-${l+1}.pdf`,f)}const o=await r.generateAsync({type:"blob"});C(o,"split-pages.zip")}else{const r=await P.create();(await r.copyPages(a.pdfDoc,c)).forEach(p=>r.addPage(p));const l=await r.save();C(new Blob([new Uint8Array(l)],{type:"application/pdf"}),"split-document.pdf")}t==="visual"&&(y=!1),b("Success","PDF split successfully!","success",()=>{A()})}catch(n){console.error(n),b("Error",n.message||"Failed to split PDF. Please check your selection.")}finally{x()}},Z=async t=>{t&&t.length>0&&(a.files=[t[0]],await z())};S&&v&&(S.addEventListener("change",t=>{Z(t.target.files),S.value=""}),v.addEventListener("dragover",t=>{t.preventDefault(),v.classList.add("bg-gray-700")}),v.addEventListener("dragleave",t=>{t.preventDefault(),v.classList.remove("bg-gray-700")}),v.addEventListener("drop",t=>{t.preventDefault(),v.classList.remove("bg-gray-700");const i=t.dataTransfer?.files;if(i){const n=Array.from(i).filter(s=>s.type==="application/pdf"||s.name.toLowerCase().endsWith(".pdf"));if(n.length>0){const s=new DataTransfer;s.items.add(n[0]),Z(s.files)}}}),v.addEventListener("click",()=>{S.click()})),w&&w.addEventListener("change",t=>{const i=t.target.value;if(i!=="visual"){y=!1;const n=document.getElementById("page-selector-grid");n&&(n.innerHTML="")}if(W?.classList.add("hidden"),H?.classList.add("hidden"),O?.classList.add("hidden"),U?.classList.add("hidden"),V?.classList.add("hidden"),G?.classList.add("hidden"),B?.classList.add("hidden"),E&&E.classList.add("hidden"),i==="range")W?.classList.remove("hidden"),B?.classList.remove("hidden");else if(i==="visual")H?.classList.remove("hidden"),B?.classList.remove("hidden"),te();else if(i==="even-odd")O?.classList.remove("hidden");else if(i==="all")U?.classList.remove("hidden");else if(i==="bookmarks")V?.classList.remove("hidden"),B?.classList.remove("hidden");else if(i==="n-times"){G?.classList.remove("hidden"),B?.classList.remove("hidden");const n=()=>{if(!a.pdfDoc)return;const s=a.pdfDoc.getPageCount(),c=parseInt(document.getElementById("split-n-value")?.value||"5"),r=s%c;if(r!==0&&E){E.classList.remove("hidden");const o=document.getElementById("n-times-warning-text");o&&(o.textContent=`The PDF has ${s} pages, which is not evenly divisible by ${c}. The last PDF will contain ${r} page(s).`)}else E&&E.classList.add("hidden")};n(),document.getElementById("split-n-value")?.addEventListener("input",n)}}),$&&$.addEventListener("click",ne)});
