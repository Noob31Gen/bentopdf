import{c as B,i as L}from"./lucide-C31GBTWo.js";import{G as ae,l as Z,m as oe,P as A,g as K,n as re,S as ie,o as se,J as le,p as V,i as Q}from"./ui-BS-bvShi.js";import{i as ce}from"./shortcuts-init-C9tdCSuV.js";import"./shortcuts-VDY4emOJ.js";ae.workerSrc=new URL("/assets/pdf.worker.min-qwK7q_zL.mjs",import.meta.url).toString();function N(){return Math.random().toString(36).substr(2,9)+Date.now().toString(36)}let l=[],g=new Set,x=[],b=new Set,h=!1,E=!1,k=null;const de=new Map,F=[],q=[];function m(){const t={allPages:l.map(n=>({...n,canvas:n.canvas})),selectedPages:Array.from(g),splitMarkers:Array.from(b)};F.push(t),q.length=0}function O(t){l=t.allPages.map(n=>({...n,canvas:n.canvas})),g=new Set(t.selectedPages),b=new Set(t.splitMarkers),P()}function v(t,n,e="info"){const a=document.getElementById("modal"),o=document.getElementById("modal-title"),r=document.getElementById("modal-message"),i=document.getElementById("modal-icon");if(!a||!o||!r||!i)return;o.textContent=t,r.textContent=n;const s={info:"info",error:"alert-circle",success:"check-circle"},c={info:"text-blue-400",error:"text-red-400",success:"text-green-400"};i.innerHTML=`<i data-lucide="${s[e]}" class="w-12 h-12 ${c[e]}"></i>`,a.classList.remove("hidden"),B({icons:L})}function _(){const t=document.getElementById("modal");t&&t.classList.add("hidden")}function U(t,n){const e=document.getElementById("loading-overlay"),a=document.getElementById("loading-progress"),o=document.getElementById("loading-text");if(!e||!a||!o)return;e.classList.remove("hidden");const r=Math.round(t/n*100);a.style.width=`${r}%`,o.textContent="Rendering pages..."}async function G(t,n){const e=document.getElementById(t);if(!e)return;const a=e.innerHTML,o=e.style.pointerEvents;try{e.disabled=!0,e.style.pointerEvents="none",e.innerHTML='<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>',await n()}finally{e.disabled=!1,e.style.pointerEvents=o,e.innerHTML=a}}function X(){const t=document.getElementById("loading-overlay");t&&t.classList.add("hidden")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{console.log("PDF Multi Tool: DOMContentLoaded"),W()}):(console.log("PDF Multi Tool: DOMContentLoaded already fired, initializing immediately"),W());function W(){console.log("PDF Multi Tool: Initializing..."),B({icons:L}),ce(),document.getElementById("close-tool-btn")?.addEventListener("click",()=>{window.location.href="/"}),document.getElementById("upload-pdfs-btn")?.addEventListener("click",()=>{if(console.log("Upload button clicked, isRendering:",h),h){v("Please Wait","Pages are still being rendered. Please wait...","info");return}document.getElementById("pdf-file-input")?.click()}),document.getElementById("pdf-file-input")?.addEventListener("change",ge),document.getElementById("insert-pdf-input")?.addEventListener("change",pe),document.getElementById("bulk-rotate-left-btn")?.addEventListener("click",()=>{h||(m(),J(-90))}),document.getElementById("bulk-rotate-btn")?.addEventListener("click",()=>{h||(m(),J(90))}),document.getElementById("bulk-delete-btn")?.addEventListener("click",()=>{h||(m(),ye())}),document.getElementById("bulk-duplicate-btn")?.addEventListener("click",()=>{h||(m(),he())}),document.getElementById("bulk-split-btn")?.addEventListener("click",()=>{h||(m(),be())}),document.getElementById("bulk-download-btn")?.addEventListener("click",()=>{if(!h){if(g.size===0){v("No Pages Selected","Please select at least one page to download.","info");return}G("bulk-download-btn",async()=>{await ne(Array.from(g).sort((n,e)=>n-e),"selected-pages.pdf")})}}),document.getElementById("select-all-btn")?.addEventListener("click",()=>{h||(m(),ue())}),document.getElementById("deselect-all-btn")?.addEventListener("click",()=>{h||(m(),fe())}),document.getElementById("export-pdf-btn")?.addEventListener("click",()=>{if(!h){if(l.length===0){v("No Pages","There are no pages to export.","info");return}G("export-pdf-btn",async()=>{await ve()})}}),document.getElementById("add-blank-page-btn")?.addEventListener("click",()=>{h||(m(),me())}),document.getElementById("undo-btn")?.addEventListener("click",()=>{if(h)return;const n=F.pop();if(n){const e={allPages:l.map(a=>({...a})),selectedPages:Array.from(g),splitMarkers:Array.from(b)};q.push(e),O(n)}}),document.getElementById("redo-btn")?.addEventListener("click",()=>{if(h)return;const n=q.pop();if(n){const e={allPages:l.map(a=>({...a})),selectedPages:Array.from(g),splitMarkers:Array.from(b)};F.push(e),O(n)}}),document.getElementById("reset-btn")?.addEventListener("click",()=>{h?(E=!0,setTimeout(()=>C(),100)):C()}),document.getElementById("modal-close-btn")?.addEventListener("click",_),document.getElementById("modal")?.addEventListener("click",n=>{n.target===document.getElementById("modal")&&_()});const t=document.getElementById("upload-area");t&&(t.addEventListener("dragover",n=>{n.preventDefault(),t.classList.add("border-indigo-500")}),t.addEventListener("dragleave",()=>{t.classList.remove("border-indigo-500")}),t.addEventListener("drop",n=>{n.preventDefault(),t.classList.remove("border-indigo-500");const e=Array.from(n.dataTransfer?.files||[]).filter(a=>a.type==="application/pdf");e.length>0&&Y(e)})),document.getElementById("upload-area")?.classList.remove("hidden")}function C(){E=!0,h=!1,m(),l=[],g.clear(),b.clear(),x=[],de.clear(),Z(),k&&(k.destroy(),k=null);const t=document.getElementById("pages-container");t&&(t.innerHTML=""),P(),document.getElementById("upload-area")?.classList.remove("hidden")}async function ge(t){const n=t.target,e=Array.from(n.files||[]);e.length>0&&await Y(e),n.value=""}async function Y(t){if(h){v("Please Wait","Pages are still being rendered. Please wait...","info");return}const n=document.getElementById("upload-area");n&&n.classList.add("hidden");const e=document.getElementById("pages-container");if(e){h=!0,console.log("PDF Multi Tool: Starting render, isRendering set to true"),E=!1,Z(),U(0,100);try{for(const a of t){if(E)break;try{let o;try{console.log(`Repairing ${a.name}...`);const d=document.getElementById("loading-text");d&&(d.textContent=`Repairing ${a.name}...`);const y=await oe(a);y?(o=y.buffer,console.log(`Successfully repaired ${a.name} before loading.`)):(console.warn(`Repair returned null for ${a.name}, using original file.`),o=await a.arrayBuffer())}catch(d){console.warn(`Failed to repair ${a.name}, attempting to load original:`,d),o=await a.arrayBuffer()}const r=await A.load(o,{ignoreEncryption:!0,throwOnInvalidObject:!1});x.push(r);const i=x.length-1,s=await r.save(),c=await K({data:new Uint8Array(s)}).promise,f=c.numPages,p=l.length;for(let d=0;d<f;d++)l.push({id:N(),pdfIndex:i,pageIndex:d,rotation:0,visualRotation:0,canvas:null,pdfDoc:r,originalPageIndex:d,fileName:a.name});await re(c,e,(d,y)=>{const w=p+y-1;return l[w]&&(l[w].canvas=d),ee(d,w)},{batchSize:8,useLazyLoading:!0,lazyLoadMargin:"400px",onProgress:(d,y)=>{U(d,y)},onBatchComplete:()=>{B({icons:L})},shouldCancel:()=>E})}catch(o){console.error(`Failed to load PDF ${a.name}:`,o),v("Error",`Failed to load ${a.name}. The file may be corrupted.`,"error")}}E||(te(),B({icons:L}))}finally{X(),h=!1,console.log("PDF Multi Tool: Render finished/cancelled, isRendering set to false"),E&&(E=!1),l.length===0&&C()}}}function ee(t,n){const e=l[n];if(!e)return console.error(`Page data not found for index ${n}`),document.createElement("div");const a=document.createElement("div");a.className="bg-gray-800 rounded-lg border-2 border-gray-700 p-2 relative group cursor-move",a.dataset.pageIndex=n.toString(),a.dataset.pageId=e.id,a.dataset.pageNumber=(e.pageIndex+1).toString(),e.fileName&&(a.dataset.fileName=e.fileName),e.canvas||(a.dataset.lazyLoad="true"),g.has(n)&&a.classList.add("border-indigo-500","ring-2","ring-indigo-500");const o=document.createElement("div");if(o.className="bg-white rounded mb-2 overflow-hidden w-full flex items-center justify-center relative h-36 sm:h-64",t){const u=t;u.className="max-w-full max-h-full object-contain",u.style.transform=`rotate(${e.visualRotation}deg)`,u.style.transition="transform 0.2s ease",o.appendChild(u)}else{const u=document.createElement("div");u.className="flex flex-col items-center justify-center text-gray-400",u.innerHTML=`
      <i data-lucide="loader" class="w-8 h-8 animate-spin mb-2"></i>
      <span class="text-xs">Loading...</span>
    `,o.appendChild(u),o.classList.add("bg-gray-700")}const r=document.createElement("div");r.className="text-xs text-gray-400 text-center mb-2",r.textContent=`Page ${n+1}`;const i=document.createElement("div");i.className="flex items-center justify-center gap-1 sm:opacity-0 group-hover:opacity-100 transition-opacity absolute bottom-2 left-0 right-0";const s=document.createElement("div");s.className="flex items-center gap-1 bg-gray-900/90 rounded px-2 py-1",i.appendChild(s);const c=document.createElement("button");c.className="absolute top-2 right-2 p-1 rounded bg-gray-900/70 hover:bg-gray-800 z-10",c.innerHTML=g.has(n)?'<i data-lucide="check-square" class="w-4 h-4 text-indigo-400"></i>':'<i data-lucide="square" class="w-4 h-4 text-gray-200"></i>',c.onclick=u=>{u.stopPropagation(),z(n)};const f=document.createElement("button");f.className="p-1 rounded hover:bg-gray-700",f.innerHTML='<i data-lucide="rotate-cw" class="w-4 h-4 text-gray-300"></i>',f.onclick=u=>{u.stopPropagation(),S(n,90)};const p=document.createElement("button");p.className="p-1 rounded hover:bg-gray-700",p.innerHTML='<i data-lucide="rotate-ccw" class="w-4 h-4 text-gray-300"></i>',p.onclick=u=>{u.stopPropagation(),S(n,-90)};const d=document.createElement("button");d.className="p-1 rounded hover:bg-gray-700",d.innerHTML='<i data-lucide="copy" class="w-4 h-4 text-gray-300"></i>',d.title="Duplicate this page",d.onclick=u=>{u.stopPropagation(),m(),R(n)};const y=document.createElement("button");y.className="p-1 rounded hover:bg-gray-700",y.innerHTML='<i data-lucide="trash-2" class="w-4 h-4 text-red-400"></i>',y.title="Delete this page",y.onclick=u=>{u.stopPropagation(),m(),$(n)};const w=document.createElement("button");w.className="p-1 rounded hover:bg-gray-700",w.innerHTML='<i data-lucide="file-plus" class="w-4 h-4 text-gray-300"></i>',w.title="Insert PDF after this page",w.onclick=u=>{u.stopPropagation(),m(),H(n)};const I=document.createElement("button");if(I.className="p-1 rounded hover:bg-gray-700",I.innerHTML='<i data-lucide="scissors" class="w-4 h-4 text-gray-300"></i>',I.title="Toggle split after this page",I.onclick=u=>{u.stopPropagation(),m(),j(n),D()},s.append(p,f,d,w,I,y),a.append(o,r,i,c),b.has(n)){const u=document.createElement("div");u.className="split-marker absolute -right-3 top-0 bottom-0 w-6 flex items-center justify-center z-20 pointer-events-none",u.innerHTML='<div class="h-full w-0.5 border-l-2 border-dashed border-blue-400"></div>',a.appendChild(u)}return a}function te(){const t=document.getElementById("pages-container");t&&(k&&k.destroy(),k=ie.create(t,{animation:150,forceFallback:!0,touchStartThreshold:3,fallbackTolerance:3,delay:200,delayOnTouchOnly:!0,scroll:document.getElementById("main-scroll-container"),scrollSensitivity:100,bubbleScroll:!1,onEnd:n=>{const e=n.oldIndex,a=n.newIndex;if(e!==a){const[o]=l.splice(e,1);l.splice(a,0,o),Pe()}}}))}function z(t){g.has(t)?g.delete(t):g.add(t);const n=document.getElementById("pages-container");if(!n)return;const e=n.children[t];if(!e)return;const a=e.querySelector('button[class*="absolute top-2 right-2"]');a&&(g.has(t)?(e.classList.add("border-indigo-500","ring-2","ring-indigo-500"),a.innerHTML='<i data-lucide="check-square" class="w-4 h-4 text-indigo-400"></i>'):(e.classList.remove("border-indigo-500","ring-2","ring-indigo-500"),a.innerHTML='<i data-lucide="square" class="w-4 h-4 text-gray-200"></i>'),B({icons:L}))}function ue(){g.clear(),l.forEach((t,n)=>g.add(n)),P()}function fe(){g.clear(),P()}function S(t,n){m();const e=l[t];e.visualRotation=(e.visualRotation+n+360)%360,e.rotation=(e.rotation+n+360)%360;const a=document.getElementById("pages-container");if(!a)return;const o=a.children[t];if(!o)return;const r=o.querySelector("canvas"),i=o.querySelector(".bg-white");r&&i&&(r.style.transform=`rotate(${e.visualRotation}deg)`,r.style.transition="transform 0.2s ease")}function R(t){const n=l[t],e=n.canvas,a=document.createElement("canvas");a.width=e.width,a.height=e.height;const o=a.getContext("2d");o&&o.drawImage(e,0,0);const r={...n,id:N(),canvas:a},i=t+1;l.splice(i,0,r),P()}function $(t){l.splice(t,1),g.delete(t);const n=new Set;if(g.forEach(e=>{e>t?n.add(e-1):e<t&&n.add(e)}),g=n,l.length===0){C();return}P()}async function H(t){document.getElementById("insert-pdf-input")?.click(),window.__insertAfterIndex=t}async function pe(t){const n=t.target,e=n.files?.[0];if(!e)return;const a=window.__insertAfterIndex;if(a!==void 0){try{const o=await e.arrayBuffer(),r=await A.load(o,{ignoreEncryption:!0,throwOnInvalidObject:!1});x.push(r);const i=x.length-1,s=await r.save(),c=await K({data:new Uint8Array(s)}).promise,f=c.numPages,p=[];for(let d=0;d<f;d++)p.push({id:N(),pdfIndex:i,pageIndex:d,rotation:0,visualRotation:0,canvas:null,pdfDoc:r,originalPageIndex:d,fileName:e.name});l.splice(a+1,0,...p),P();for(let d=0;d<f;d++){const y=a+1+d,w=await se(c,d+1);if(l[y]){l[y].canvas=w;const u=document.getElementById("pages-container")?.querySelector(`div[data-page-index="${y}"]`);if(u){const M=u.querySelector(".bg-gray-700")||u.querySelector(".bg-white");if(M){M.innerHTML="",M.className="bg-white rounded mb-2 overflow-hidden w-full flex items-center justify-center relative h-36 sm:h-64";const T=w;T.className="max-w-full max-h-full object-contain",T.style.transform=`rotate(${l[y].visualRotation}deg)`,T.style.transition="transform 0.2s ease",M.appendChild(T)}}}}}catch(o){console.error("Failed to insert PDF:",o),v("Error","Failed to insert PDF. The file may be corrupted.","error")}n.value=""}}function j(t){b.has(t)?b.delete(t):b.add(t)}function D(){const t=document.getElementById("pages-container");t&&(t.querySelectorAll(".split-marker").forEach(n=>n.remove()),Array.from(t.children).forEach((n,e)=>{if(b.has(e)){const a=document.createElement("div");a.className="split-marker absolute -right-3 top-0 bottom-0 w-6 flex items-center justify-center z-20 pointer-events-none",a.innerHTML='<div class="h-full w-0.5 border-l-2 border-dashed border-blue-400"></div>',n.appendChild(a)}}))}function me(){const t=document.createElement("canvas");t.width=595,t.height=842;const n=t.getContext("2d");n&&(n.fillStyle="white",n.fillRect(0,0,595,842));const e={id:N(),pdfIndex:-1,pageIndex:-1,rotation:0,visualRotation:0,canvas:t,pdfDoc:null,originalPageIndex:-1,fileName:""};l.push(e),P()}function J(t){if(g.size===0){v("No Selection","Please select pages to rotate.","info");return}g.forEach(n=>{const e=l[n];if(e){e.visualRotation=(e.visualRotation+t+360)%360,e.rotation=(e.rotation+t+360)%360;const o=document.getElementById("pages-container")?.querySelector(`div[data-page-index="${n}"]`);if(o){const r=o.querySelector("canvas");r&&(r.style.transform=`rotate(${e.visualRotation}deg)`)}}})}function ye(){if(g.size===0){v("No Selection","Please select pages to delete.","info");return}if(Array.from(g).sort((n,e)=>e-n).forEach(n=>l.splice(n,1)),g.clear(),l.length===0){C();return}P()}function he(){if(g.size===0){v("No Selection","Please select pages to duplicate.","info");return}Array.from(g).sort((n,e)=>e-n).forEach(n=>{R(n)}),g.clear(),P()}function be(){if(g.size===0){v("No Selection","Please select pages to mark for splitting.","info");return}Array.from(g).forEach(n=>{b.has(n)||b.add(n)}),D(),g.clear(),P()}async function ve(){if(l.length===0){v("No Pages","Please upload PDFs first.","info");return}if(b.size>0)await we();else{const t=Array.from({length:l.length},(n,e)=>e);await ne(t,"all-pages.pdf")}}async function we(){try{const t=new le,n=Array.from(b).sort((r,i)=>r-i),e=[];let a=[];for(let r=0;r<l.length;r++)a.push(r),b.has(r)&&(e.push(a),a=[]);a.length>0&&e.push(a);for(let r=0;r<e.length;r++){const i=e[r],s=await A.create();for(const f of i){const p=l[f];if(!p){console.warn(`Page data missing for index ${f}`);continue}if(p.pdfDoc&&p.originalPageIndex>=0){const[d]=await s.copyPages(p.pdfDoc,[p.originalPageIndex]),y=s.addPage(d);if(p.rotation!==0){const w=y.getRotation().angle;y.setRotation(V(w+p.rotation))}}else s.addPage([595,842])}const c=await s.save();t.file(`document - ${r+1}.pdf`,c)}const o=await t.generateAsync({type:"blob"});Q(o,"split-documents.zip"),v("Success",`Downloaded ${e.length} PDF files in a ZIP archive.`,"success")}catch(t){console.error("Failed to create split PDFs:",t),v("Error","Failed to create split PDFs.","error")}finally{X()}}async function ne(t,n){try{const e=await A.create();for(const r of t){const i=l[r];if(!i){console.warn(`Page data missing for index ${r}`);continue}if(i.pdfDoc&&i.originalPageIndex>=0){const[s]=await e.copyPages(i.pdfDoc,[i.originalPageIndex]),c=e.addPage(s);if(i.rotation!==0){const f=c.getRotation().angle;c.setRotation(V(f+i.rotation))}}else e.addPage([595,842])}const a=await e.save(),o=new Blob([new Uint8Array(a)],{type:"application/pdf"});Q(o,n),v("Success","PDF downloaded successfully.","success")}catch(e){console.error("Failed to create PDF:",e),v("Error","Failed to create PDF.","error")}}function P(){const t=document.getElementById("pages-container");if(!t)return;const n=new Map;Array.from(t.children).forEach(e=>{const a=e;a.dataset.pageId&&n.set(a.dataset.pageId,a)}),l.forEach((e,a)=>{let o=n.get(e.id);if(o){n.delete(e.id),t.children[a]!==o&&(a<t.children.length?t.insertBefore(o,t.children[a]):t.appendChild(o)),o.dataset.pageIndex=a.toString();const r=o.querySelector(".text-xs.text-gray-400.text-center.mb-2");r&&(r.textContent=`Page ${a+1} `);const i=o.querySelector('button[class*="absolute top-2 right-2"]');i&&(g.has(a)?(o.classList.add("border-indigo-500","ring-2","ring-indigo-500"),i.innerHTML='<i data-lucide="check-square" class="w-4 h-4 text-indigo-400"></i>'):(o.classList.remove("border-indigo-500","ring-2","ring-indigo-500"),i.innerHTML='<i data-lucide="square" class="w-4 h-4 text-gray-200"></i>'),i.onclick=f=>{f.stopPropagation(),z(a)});const s=o.querySelector("canvas");s&&(s.style.transform=`rotate(${e.visualRotation}deg)`);const c=o.querySelector(".flex.items-center.gap-1.bg-gray-900\\/90");if(c){const f=c.querySelectorAll("button");f[0]&&(f[0].onclick=p=>{p.stopPropagation(),S(a,-90)}),f[1]&&(f[1].onclick=p=>{p.stopPropagation(),S(a,90)}),f[2]&&(f[2].onclick=p=>{p.stopPropagation(),m(),R(a)}),f[3]&&(f[3].onclick=p=>{p.stopPropagation(),m(),H(a)}),f[4]&&(f[4].onclick=p=>{p.stopPropagation(),m(),j(a),D()}),f[5]&&(f[5].onclick=p=>{p.stopPropagation(),m(),$(a)})}}else o=ee(e.canvas,a),o.dataset.pageId=e.id,a<t.children.length?t.insertBefore(o,t.children[a]):t.appendChild(o)}),n.forEach(e=>e.remove()),te(),D(),B({icons:L})}function Pe(){const t=document.getElementById("pages-container");if(!t)return;Array.from(t.children).forEach((e,a)=>{e.dataset.pageIndex=a.toString();const o=e.querySelector(".text-xs.text-gray-400.text-center.mb-2");o&&(o.textContent=`Page ${a+1} `);const r=e.querySelector('button[class*="absolute top-2 right-2"]');r&&(r.onclick=s=>{s.stopPropagation(),z(a)});const i=e.querySelector(".flex.items-center.gap-1.bg-gray-900\\/90");if(i){const s=i.querySelectorAll("button");s[0]&&(s[0].onclick=c=>{c.stopPropagation(),S(a,-90)}),s[1]&&(s[1].onclick=c=>{c.stopPropagation(),S(a,90)}),s[2]&&(s[2].onclick=c=>{c.stopPropagation(),m(),R(a)}),s[3]&&(s[3].onclick=c=>{c.stopPropagation(),m(),H(a)}),s[4]&&(s[4].onclick=c=>{c.stopPropagation(),m(),j(a),D()}),s[5]&&(s[5].onclick=c=>{c.stopPropagation(),m(),$(a)})}})}
