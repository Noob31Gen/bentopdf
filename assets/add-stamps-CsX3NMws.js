import{c as b,i as P}from"./version-Ceh7G5a-.js";import"./mobileMenu-Y-8SxjNx.js";import"./full-width-CrKHpSp0.js";import"./simple-mode-footer-taxVzkwL.js";import{f as B,r as I,g as F}from"./main-BBpb6J13.js";import{i as S}from"./shortcuts-init-B5CfxdJB.js";let u=null,l=null,v=!1,c=null;const w=document.getElementById("pdfFile"),p=document.getElementById("fileList"),o=document.getElementById("stamp-viewer-container"),h=document.getElementById("viewer-card"),m=document.getElementById("save-stamped-btn"),y=document.getElementById("back-to-tools"),f=document.getElementById("tool-uploader");function E(){u=null,c&&(URL.revokeObjectURL(c),c=null),l&&o&&l.parentElement===o&&o.removeChild(l),l=null,v=!1,h&&h.classList.add("hidden"),m&&m.classList.add("hidden"),o&&(o.style.height="",o.style.aspectRatio="");const t=localStorage.getItem("fullWidthMode")==="true";f&&!t&&(f.classList.remove("max-w-6xl"),f.classList.add("max-w-2xl")),L(),w&&(w.value="")}function L(){if(!u){p.classList.add("hidden"),p.innerHTML="";return}p.classList.remove("hidden"),p.innerHTML="";const t=localStorage.getItem("fullWidthMode")==="true";f&&!t&&(f.classList.remove("max-w-2xl"),f.classList.add("max-w-6xl"));const e=document.createElement("div");e.className="bg-gray-700 p-3 rounded-lg border border-gray-600 hover:border-indigo-500 transition-colors";const n=document.createElement("div");n.className="flex items-center justify-between";const i=document.createElement("div");i.className="flex-1 min-w-0";const s=document.createElement("p");s.className="truncate font-medium text-white",s.textContent=u.name;const a=document.createElement("p");a.className="text-gray-400 text-sm",a.textContent=B(u.size),i.append(s,a);const r=document.createElement("button");r.className="text-red-400 hover:text-red-300 p-2 flex-shrink-0 ml-2",r.title="Remove file",r.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',r.onclick=g=>{g.stopPropagation(),E()},n.append(i,r),e.appendChild(n),p.appendChild(e),b({icons:P})}async function D(t){if(o)try{const e=await t.arrayBuffer(),a=(await(await F({data:e}).promise).getPage(1)).getViewport({scale:1}),r=a.width/(a.height+50);o.style.height="auto",o.style.aspectRatio=`${r}`}catch(e){console.error("Error adjusting viewer height:",e),o.style.height="70vh"}}async function R(t){if(!o)return;h&&h.classList.remove("hidden"),l&&l.parentElement===o&&o.removeChild(l),c&&(URL.revokeObjectURL(c),c=null),l=null,v=!1,await D(t);const e=await I(t),n=new Blob([e],{type:"application/pdf"});c=URL.createObjectURL(n);try{const a=localStorage.getItem("pdfjs.preferences"),r=a?JSON.parse(a):{};delete r.annotationEditorMode;const g={...r,enablePermissions:!1};localStorage.setItem("pdfjs.preferences",JSON.stringify(g))}catch{}const i=document.createElement("iframe");i.className="w-full h-full border-0",i.allowFullscreen=!0;const s=new URL("/pdfjs-annotation-viewer/web/viewer.html",window.location.origin);i.src=`${s.toString()}?file=${encodeURIComponent(c)}`,i.addEventListener("load",()=>{k(i)}),o.appendChild(i),l=i}function k(t){try{const e=t.contentWindow,n=e?.document;if(!e||!n)return;(async()=>{try{const s=e.PDFViewerApplication;s?.initializedPromise&&await s.initializedPromise;const a=s?.eventBus;a&&typeof a._on=="function"&&a._on("annotationeditoruimanager",()=>{try{n.getElementById("editorStampButton")?.click()}catch{}});const r=n.querySelector(".PdfjsAnnotationExtension");r&&r.classList.add("PdfjsAnnotationExtension_Comment_hidden"),v=!0}catch(s){console.error("Failed to initialize annotation viewer for Add Stamps:",s)}})()}catch(e){console.error("Error wiring Add Stamps viewer:",e)}}async function x(t){u=t,L(),m&&m.classList.remove("hidden"),await R(t)}w&&w.addEventListener("change",async t=>{const e=t.target;if(e.files&&e.files.length>0){const n=e.files[0];await x(n)}});const d=document.getElementById("drop-zone");d&&(d.addEventListener("dragover",t=>{t.preventDefault(),d.classList.add("border-indigo-500")}),d.addEventListener("dragleave",()=>{d.classList.remove("border-indigo-500")}),d.addEventListener("drop",async t=>{t.preventDefault(),d.classList.remove("border-indigo-500");const e=t.dataTransfer?.files[0];e&&e.type==="application/pdf"&&await x(e)}));m&&m.addEventListener("click",()=>{if(!l){alert("Viewer not ready. Please upload a PDF and wait for it to finish loading.");return}try{const e=l.contentWindow?.pdfjsAnnotationExtensionInstance;if(e&&typeof e.exportPdf=="function"){const n=e.exportPdf();n&&typeof n.then=="function"&&n.then(()=>{setTimeout(()=>E(),500)}).catch(i=>{console.error("Error while exporting stamped PDF via annotation extension:",i)});return}alert("Could not access the stamped-PDF exporter. Please use the Export → PDF button in the viewer toolbar as a fallback.")}catch(t){console.error("Failed to trigger stamped PDF export:",t),alert("Could not export the stamped PDF. Please use the Export → PDF button in the viewer toolbar as a fallback.")}});y&&y.addEventListener("click",()=>{window.location.href="/"});S();
