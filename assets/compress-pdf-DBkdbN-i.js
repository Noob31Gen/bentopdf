const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ui-BS-bvShi.js","assets/lucide-C31GBTWo.js","assets/lucide-Cr1Vm7Kh.css"])))=>i.map(i=>d[i]);
import{c as O,i as V}from"./lucide-C31GBTWo.js";import"./mobileMenu-BZ6_9HLx.js";import"./simple-mode-footer-CDVnObzA.js";import{G,z as m,H as F,I as R,r as N,F as $,k as j,i as q,_ as J,g as U,P as W,b as l,K,L as Q,e as I}from"./ui-BS-bvShi.js";G.workerSrc=new URL("/assets/pdf.worker.min-qwK7q_zL.mjs",import.meta.url).toString();function H(x){const e=x.split(",")[1],s=atob(e),p=s.length,v=new Uint8Array(p);for(let d=0;d<p;d++)v[d]=s.charCodeAt(d);return v}async function M(x,e){const s=await W.load(x,{ignoreEncryption:!0}),p=s.getPages();if(e.removeMetadata)try{s.setTitle(""),s.setAuthor(""),s.setSubject(""),s.setKeywords([]),s.setCreator(""),s.setProducer("")}catch(d){console.warn("Could not remove metadata:",d)}for(let d=0;d<p.length;d++){const P=p[d].node.Resources();if(!P)continue;const z=P.lookup(l.of("XObject"));if(z instanceof K)for(const[A,L]of z.entries()){const i=s.context.lookup(L);if(!(!(i instanceof Q)||i.dict.get(l.of("Subtype"))!==l.of("Image")))try{const E=i.getContents();if(E.length<e.skipSize)continue;const t=i.dict.get(l.of("Width"))instanceof I?i.dict.get(l.of("Width")).asNumber():0,c=i.dict.get(l.of("Height"))instanceof I?i.dict.get(l.of("Height")).asNumber():0,C=i.dict.get(l.of("BitsPerComponent"))instanceof I?i.dict.get(l.of("BitsPerComponent")).asNumber():8;if(t>0&&c>0){let a=t,r=c;const f=e.scaleFactor||1;if(a=Math.floor(t*f),r=Math.floor(c*f),a>e.maxWidth||r>e.maxHeight){const w=a/r;a>r?(a=Math.min(a,e.maxWidth),r=a/w):(r=Math.min(r,e.maxHeight),a=r*w)}const h=e.minDimension||50;if(a<h||r<h)continue;const o=document.createElement("canvas"),n=o.getContext("2d");o.width=Math.floor(a),o.height=Math.floor(r);const u=new Image,y=URL.createObjectURL(new Blob([new Uint8Array(E)]));await new Promise((w,k)=>{u.onload=w,u.onerror=k,u.src=y}),n.imageSmoothingEnabled=e.smoothing!==!1,n.imageSmoothingQuality=e.smoothingQuality||"medium",e.grayscale?n.filter="grayscale(100%)":e.contrast&&(n.filter=`contrast(${e.contrast}) brightness(${e.brightness||1})`),n.drawImage(u,0,0,o.width,o.height);let D=null,g=E.length;const b=o.toDataURL("image/jpeg",e.quality),S=H(b);if(S.length<g&&(D=S,g=S.length),e.tryWebP)try{const w=o.toDataURL("image/webp",e.quality),k=H(w);k.length<g&&(D=k,g=k.length)}catch{}D&&g<E.length*e.threshold&&(i.contents=D,i.dict.set(l.of("Length"),I.of(g)),i.dict.set(l.of("Width"),I.of(o.width)),i.dict.set(l.of("Height"),I.of(o.height)),i.dict.set(l.of("Filter"),l.of("DCTDecode")),i.dict.delete(l.of("DecodeParms")),i.dict.set(l.of("BitsPerComponent"),I.of(8)),e.grayscale&&i.dict.set(l.of("ColorSpace"),l.of("DeviceGray"))),URL.revokeObjectURL(y)}}catch(E){console.warn("Skipping an uncompressible image in smart mode:",E)}}}const v={useObjectStreams:e.useObjectStreams!==!1,addDefaultPage:!1,objectsPerTick:e.objectsPerTick||50};return await s.save(v)}async function _(x,e){const s=await U({data:x}).promise,p=await W.create();for(let v=1;v<=s.numPages;v++){const d=await s.getPage(v),B=d.getViewport({scale:e.scale}),P=document.createElement("canvas"),z=P.getContext("2d");P.height=B.height,P.width=B.width,await d.render({canvasContext:z,viewport:B,canvas:P}).promise;const L=await(await new Promise(t=>P.toBlob(t,"image/jpeg",e.quality))).arrayBuffer(),i=await p.embedJpg(L);p.addPage([B.width,B.height]).drawImage(i,{x:0,y:0,width:B.width,height:B.height})}return await p.save()}document.addEventListener("DOMContentLoaded",()=>{const x=document.getElementById("file-input"),e=document.getElementById("drop-zone"),s=document.getElementById("process-btn"),p=document.getElementById("file-display-area"),v=document.getElementById("compress-options"),d=document.getElementById("file-controls"),B=document.getElementById("add-more-btn"),P=document.getElementById("clear-files-btn"),z=document.getElementById("back-to-tools");z&&z.addEventListener("click",()=>{window.location.href="/"});const A=async()=>{if(!(!p||!v||!s||!d))if(m.files.length>0){p.innerHTML="";for(let t=0;t<m.files.length;t++){const c=m.files[t],C=document.createElement("div");C.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const a=document.createElement("div");a.className="flex flex-col overflow-hidden";const r=document.createElement("div");r.className="flex items-center gap-2";const f=document.createElement("span");f.className="truncate font-medium text-gray-200",f.textContent=c.name;const h=document.createElement("span");h.className="flex-shrink-0 text-gray-400 text-xs",h.textContent=`(${j(c.size)})`,r.append(f,h);const o=document.createElement("span");o.className="text-xs text-gray-500 mt-0.5",o.textContent="Loading pages...",a.append(r,o);const n=document.createElement("button");n.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",n.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',n.onclick=()=>{m.files=m.files.filter((u,y)=>y!==t),A()},C.append(a,n),p.appendChild(C);try{const u=await N(c),y=await U({data:u}).promise;o.textContent=`${y.numPages} Pages`}catch(u){console.error("Error loading PDF:",u),o.textContent="Could not load page count"}}O({icons:V}),d.classList.remove("hidden"),v.classList.remove("hidden"),s.disabled=!1}else p.innerHTML="",d.classList.add("hidden"),v.classList.add("hidden"),s.disabled=!0},L=()=>{m.files=[],m.pdfDoc=null;const t=document.getElementById("compression-level");t&&(t.value="balanced");const c=document.getElementById("compression-algorithm");c&&(c.value="vector"),A()},i=async()=>{const t=document.getElementById("compression-level").value,c=document.getElementById("compression-algorithm").value,C={balanced:{smart:{quality:.5,threshold:.95,maxWidth:1800,maxHeight:1800,skipSize:3e3},legacy:{scale:1.5,quality:.6}},"high-quality":{smart:{quality:.7,threshold:.98,maxWidth:2500,maxHeight:2500,skipSize:5e3},legacy:{scale:2,quality:.9}},"small-size":{smart:{quality:.3,threshold:.95,maxWidth:1200,maxHeight:1200,skipSize:2e3},legacy:{scale:1.2,quality:.4}},extreme:{smart:{quality:.1,threshold:.95,maxWidth:1e3,maxHeight:1e3,skipSize:1e3},legacy:{scale:1,quality:.2}}},a={...C[t].smart,removeMetadata:!0},r=C[t].legacy;try{if(m.files.length===0){F("No Files","Please select at least one PDF file."),R();return}if(m.files.length===1){const f=m.files[0],h=await N(f);let o,n;if(c==="vector")$("Running Vector (Smart) compression..."),o=await M(h,a),n="Vector";else if(c==="photon")$("Running Photon (Rasterize) compression..."),o=await _(h,r),n="Photon";else{$("Running Automatic (Vector first)...");const b=await M(h,a);b.length<f.size?(o=b,n="Vector (Automatic)"):(F("Vector failed to reduce size. Trying Photon...","info"),$("Running Automatic (Photon fallback)..."),o=await _(h,r),n="Photon (Automatic)")}const u=j(f.size),y=j(o.length),D=f.size-o.length,g=D>0?(D/f.size*100).toFixed(1):0;q(new Blob([o],{type:"application/pdf"}),"compressed-final.pdf"),R(),D>0?F("Compression Complete",`Method: ${n}. File size reduced from ${u} to ${y} (Saved ${g}%).`,"success",()=>L()):F("Compression Finished",`Method: ${n}. Could not reduce file size. Original: ${u}, New: ${y}.`,"warning",()=>L())}else{$("Compressing multiple PDFs...");const f=(await J(async()=>{const{default:g}=await import("./ui-BS-bvShi.js").then(b=>b.j);return{default:g}},__vite__mapDeps([0,1,2]))).default,h=new f;let o=0,n=0;for(let g=0;g<m.files.length;g++){const b=m.files[g];$(`Compressing ${g+1}/${m.files.length}: ${b.name}...`);const S=await N(b);o+=b.size;let w;if(c==="vector")w=await M(S,a);else if(c==="photon")w=await _(S,r);else{const T=await M(S,a);w=T.length<b.size?T:await _(S,r)}n+=w.length;const k=b.name.replace(/\.pdf$/i,"");h.file(`${k}_compressed.pdf`,w)}const u=await h.generateAsync({type:"blob"}),y=o-n,D=y>0?(y/o*100).toFixed(1):0;q(u,"compressed-pdfs.zip"),R(),y>0?F("Compression Complete",`Compressed ${m.files.length} PDF(s). Total size reduced from ${j(o)} to ${j(n)} (Saved ${D}%).`,"success",()=>L()):F("Compression Finished",`Compressed ${m.files.length} PDF(s). Total size: ${j(n)}.`,"info",()=>L())}}catch(f){R(),F("Error",`An error occurred during compression. Error: ${f.message}`)}},E=t=>{t&&t.length>0&&(m.files=[...m.files,...Array.from(t)],A())};x&&e&&(x.addEventListener("change",t=>{E(t.target.files),x.value=""}),e.addEventListener("dragover",t=>{t.preventDefault(),e.classList.add("bg-gray-700")}),e.addEventListener("dragleave",t=>{t.preventDefault(),e.classList.remove("bg-gray-700")}),e.addEventListener("drop",t=>{t.preventDefault(),e.classList.remove("bg-gray-700");const c=t.dataTransfer?.files;if(c&&c.length>0){const C=Array.from(c).filter(a=>a.type==="application/pdf"||a.name.toLowerCase().endsWith(".pdf"));if(C.length>0){const a=new DataTransfer;C.forEach(r=>a.items.add(r)),E(a.files)}}}),e.addEventListener("click",()=>{x.click()})),B&&B.addEventListener("click",()=>{x.click()}),P&&P.addEventListener("click",()=>{L()}),s&&s.addEventListener("click",i)});
