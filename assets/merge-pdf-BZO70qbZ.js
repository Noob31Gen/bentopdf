import{c as D,i as k}from"./lucide-C31GBTWo.js";import"./mobileMenu-BZ6_9HLx.js";import"./simple-mode-footer-CDVnObzA.js";import{G as C,z as m,F as P,H as y,I as h,i as T,r as S,g as W,S as N,l as $,n as z}from"./ui-BS-bvShi.js";C.workerSrc=new URL("/assets/pdf.worker.min-qwK7q_zL.mjs",import.meta.url).toString();const n={pdfDocs:{},pdfBytes:{},activeMode:"file",sortableInstances:{},isRendering:!1,cachedThumbnails:null,lastFileHash:null,mergeSuccess:!1},B=new Worker("/workers/merge.worker.js");function H(){const t=document.getElementById("file-list");t&&(n.sortableInstances.fileList&&n.sortableInstances.fileList.destroy(),n.sortableInstances.fileList=N.create(t,{handle:".drag-handle",animation:150,ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",onStart:function(r){r.item.style.opacity="0.5"},onEnd:function(r){r.item.style.opacity="1"}}))}function F(){const t=document.getElementById("page-merge-preview");t&&(n.sortableInstances.pageThumbnails&&n.sortableInstances.pageThumbnails.destroy(),n.sortableInstances.pageThumbnails=N.create(t,{animation:150,ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",onStart:function(r){r.item.style.opacity="0.5"},onEnd:function(r){r.item.style.opacity="1"}}))}function A(){return m.files.map(t=>`${t.name}-${t.size}-${t.lastModified}`).join("|")}async function M(){const t=document.getElementById("page-merge-preview");if(!t)return;const r=A();if(!(r!==n.lastFileHash)&&n.cachedThumbnails!==null&&t.firstChild){F();return}if(n.isRendering)return;n.isRendering=!0,t.textContent="",$();let g=0;for(const a of m.files){const l=n.pdfDocs[a.name];l&&(g+=l.numPages)}try{let a=0;const l=(o,e,s)=>{const i=document.createElement("div");i.className="page-thumbnail relative cursor-move flex flex-col items-center gap-1 p-2 border-2 border-gray-600 hover:border-indigo-500 rounded-lg bg-gray-700 transition-colors",i.dataset.fileName=s||"",i.dataset.pageIndex=(e-1).toString();const d=document.createElement("div");d.className="relative";const u=document.createElement("img");u.src=o.toDataURL(),u.className="rounded-md shadow-md max-w-full h-auto";const p=document.createElement("div");p.className="absolute top-1 left-1 bg-indigo-600 text-white text-xs px-2 py-1 rounded-md font-semibold shadow-lg",p.textContent=e.toString(),d.append(u,p);const f=document.createElement("p");f.className="text-xs text-gray-400 truncate w-full text-center";const b=s?`${s} (page ${e})`:`Page ${e}`;return f.title=b,f.textContent=s?`${s.substring(0,10)}... (p${e})`:`Page ${e}`,i.append(d,f),i};for(const o of m.files){const e=n.pdfDocs[o.name];if(!e)continue;await z(e,t,(i,d)=>l(i,d,o.name),{batchSize:8,useLazyLoading:!0,lazyLoadMargin:"300px",onProgress:(i,d)=>{a++,P("Rendering page previews...")},onBatchComplete:()=>{D({icons:k})}})}n.cachedThumbnails=!0,n.lastFileHash=r,F()}catch(a){console.error("Error rendering page thumbnails:",a),y("Error","Failed to render page thumbnails")}finally{h(),n.isRendering=!1}}const w=async()=>{const t=document.getElementById("file-controls"),r=document.getElementById("merge-options");if(m.files.length>0)t&&t.classList.remove("hidden"),r&&r.classList.remove("hidden"),await U();else{t&&t.classList.add("hidden"),r&&r.classList.add("hidden");const c=document.getElementById("file-list");c&&(c.innerHTML="")}},R=async()=>{m.files=[],m.pdfDoc=null,n.pdfDocs={},n.pdfBytes={},n.activeMode="file",n.cachedThumbnails=null,n.lastFileHash=null,n.mergeSuccess=!1;const t=document.getElementById("file-list");t&&(t.innerHTML="");const r=document.getElementById("page-merge-preview");r&&(r.innerHTML="");const c=document.getElementById("file-mode-btn"),g=document.getElementById("page-mode-btn"),a=document.getElementById("file-mode-panel"),l=document.getElementById("page-mode-panel");c&&g&&a&&l&&(c.classList.add("bg-indigo-600","text-white"),c.classList.remove("bg-gray-700","text-gray-300"),g.classList.remove("bg-indigo-600","text-white"),g.classList.add("bg-gray-700","text-gray-300"),a.classList.remove("hidden"),l.classList.add("hidden")),await w()};async function j(){P("Merging PDFs...");try{const t=[],r=[],c=new Set;if(n.activeMode==="file"){const a=document.getElementById("file-list");if(!a)throw new Error("File list not found");const l=Array.from(a.children).map(o=>m.files.find(e=>e.name===o.dataset.fileName)).filter(Boolean);for(const o of l){if(!o)continue;const e=o.name.replace(/[^a-zA-Z0-9]/g,"_"),s=document.getElementById(`range-${e}`);c.add(o.name),s&&s.value.trim()?t.push({fileName:o.name,rangeType:"specific",rangeString:s.value.trim()}):t.push({fileName:o.name,rangeType:"all"})}}else{const a=document.getElementById("page-merge-preview");if(!a)throw new Error("Page container not found");const l=Array.from(a.children),o=[];for(const e of l){const s=e,i=s.dataset.fileName,d=parseInt(s.dataset.pageIndex||"",10);i&&!isNaN(d)&&(c.add(i),o.push({fileName:i,pageIndex:d}))}for(let e=0;e<o.length;e++){const s=o[e];let i=s.pageIndex;for(;e+1<o.length&&o[e+1].fileName===s.fileName&&o[e+1].pageIndex===i+1;)i++,e++;i===s.pageIndex?t.push({fileName:s.fileName,rangeType:"single",pageIndex:s.pageIndex}):t.push({fileName:s.fileName,rangeType:"range",startPage:s.pageIndex+1,endPage:i+1})}}if(t.length===0){y("Error","No files or pages selected to merge."),h();return}for(const a of c){const l=n.pdfBytes[a];l&&r.push({name:a,data:l})}const g={command:"merge",files:r,jobs:t};B.postMessage(g,r.map(a=>a.data)),B.onmessage=a=>{if(h(),a.data.status==="success"){const l=new Blob([a.data.pdfBytes],{type:"application/pdf"});T(l,"merged.pdf"),n.mergeSuccess=!0,y("Success","PDFs merged successfully!","success",async()=>{await R()})}else console.error("Worker merge error:",a.data.message),y("Error",a.data.message||"Failed to merge PDFs.")},B.onerror=a=>{h(),console.error("Worker error:",a),y("Error","An unexpected error occurred in the merge worker.")}}catch(t){console.error("Merge error:",t),y("Error","Failed to merge PDFs. Please check that all files are valid and not password-protected."),h()}}async function U(){document.getElementById("merge-options")?.classList.remove("hidden");const t=document.getElementById("process-btn");t&&(t.disabled=!1);const r=n.activeMode==="page";P("Loading PDF documents...");try{n.pdfDocs={},n.pdfBytes={};for(const i of m.files){const d=await S(i);n.pdfBytes[i.name]=d;const u=d.slice(0),p=await W({data:u}).promise;n.pdfDocs[i.name]=p}}catch(i){console.error("Error loading PDFs:",i),y("Error","Failed to load one or more PDF files");return}finally{h()}const c=document.getElementById("file-mode-btn"),g=document.getElementById("page-mode-btn"),a=document.getElementById("file-mode-panel"),l=document.getElementById("page-mode-panel"),o=document.getElementById("file-list");if(!c||!g||!a||!l||!o)return;o.textContent="",m.files.forEach(i=>{const d=n.pdfDocs[i.name],u=d?d.numPages:"N/A",p=i.name.replace(/[^a-zA-Z0-9]/g,"_"),f=document.createElement("li");f.className="bg-gray-700 p-3 rounded-lg border border-gray-600 hover:border-indigo-500 transition-colors",f.dataset.fileName=i.name;const b=document.createElement("div");b.className="flex items-center justify-between";const L=document.createElement("span");L.className="truncate font-medium text-white flex-1 mr-2",L.title=i.name,L.textContent=i.name;const x=document.createElement("div");x.className="drag-handle cursor-move text-gray-400 hover:text-white p-1 rounded transition-colors",x.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="5" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="19" r="1"/></svg>',b.append(L,x);const I=document.createElement("div");I.className="mt-2";const E=document.createElement("label");E.htmlFor=`range-${p}`,E.className="text-xs text-gray-400",E.textContent=`Pages (e.g., 1-3, 5) - Total: ${u}`;const v=document.createElement("input");v.type="text",v.id=`range-${p}`,v.className="w-full bg-gray-800 border border-gray-600 text-white rounded-md p-2 text-sm mt-1 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-colors",v.placeholder="Leave blank for all pages",I.append(E,v),f.append(b,I),o.appendChild(f)}),H();const e=c.cloneNode(!0),s=g.cloneNode(!0);c.replaceWith(e),g.replaceWith(s),e.addEventListener("click",()=>{n.activeMode!=="file"&&(n.activeMode="file",a.classList.remove("hidden"),l.classList.add("hidden"),e.classList.add("bg-indigo-600","text-white"),e.classList.remove("bg-gray-700","text-gray-300"),s.classList.remove("bg-indigo-600","text-white"),s.classList.add("bg-gray-700","text-gray-300"))}),s.addEventListener("click",async()=>{n.activeMode!=="page"&&(n.activeMode="page",a.classList.add("hidden"),l.classList.remove("hidden"),s.classList.add("bg-indigo-600","text-white"),s.classList.remove("bg-gray-700","text-gray-300"),e.classList.remove("bg-indigo-600","text-white"),e.classList.add("bg-gray-700","text-gray-300"),await M())}),r?(n.activeMode="page",a.classList.add("hidden"),l.classList.remove("hidden"),s.classList.add("bg-indigo-600","text-white"),s.classList.remove("bg-gray-700","text-gray-300"),e.classList.remove("bg-indigo-600","text-white"),e.classList.add("bg-gray-700","text-gray-300"),await M()):(e.classList.add("bg-indigo-600","text-white"),s.classList.add("bg-gray-700","text-gray-300"))}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("file-input"),r=document.getElementById("drop-zone"),c=document.getElementById("process-btn");document.getElementById("file-controls");const g=document.getElementById("add-more-btn"),a=document.getElementById("clear-files-btn"),l=document.getElementById("back-to-tools");document.getElementById("merge-options"),l&&l.addEventListener("click",()=>{window.location.href="/"}),t&&r&&(t.addEventListener("change",async o=>{const e=o.target.files;e&&e.length>0&&(m.files=[...m.files,...Array.from(e)],await w()),t.value=""}),r.addEventListener("dragover",o=>{o.preventDefault(),r.classList.add("bg-gray-700")}),r.addEventListener("dragleave",o=>{o.preventDefault(),r.classList.remove("bg-gray-700")}),r.addEventListener("drop",async o=>{o.preventDefault(),r.classList.remove("bg-gray-700");const e=o.dataTransfer?.files;if(e&&e.length>0){const s=Array.from(e).filter(i=>i.type==="application/pdf"||i.name.toLowerCase().endsWith(".pdf"));s.length>0&&(m.files=[...m.files,...s],await w())}}),r.addEventListener("click",()=>{t.click()})),g&&g.addEventListener("click",()=>{t.click()}),a&&a.addEventListener("click",async()=>{m.files=[],await w()}),c&&c.addEventListener("click",async()=>{await j()})});
