var da=a=>{throw TypeError(a)};var Lr=(a,t,e)=>t.has(a)||da("Cannot "+e);var Nt=(a,t,e)=>(Lr(a,t,"read from private field"),e?e.call(a):t.get(a)),di=(a,t,e)=>t.has(a)?da("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,e),Fe=(a,t,e,i)=>(Lr(a,t,"write to private field"),i?i.call(a,e):t.set(a,e),e),ui=(a,t,e)=>(Lr(a,t,"access private method"),e);var ua=(a,t,e,i)=>({set _(n){Fe(a,t,n,e)},get _(){return Nt(a,t,i)}});import{c as fa,i as pa}from"./version-Ceh7G5a-.js";const _n=[{name:"Popular Tools",tools:[{href:"/pdf-multi-tool.html",name:"PDF Multi Tool",icon:"pencil-ruler",subtitle:"Merge, Split, Organize, Delete, Rotate, Add Blank Pages, Extract and Duplicate in an unified interface."},{href:"/merge-pdf.html",name:"Merge PDF",icon:"combine",subtitle:"Combine multiple PDFs into one file. Preserves Bookmarks."},{href:"/split-pdf.html",name:"Split PDF",icon:"scissors",subtitle:"Extract a range of pages into a new PDF."},{href:"/compress-pdf.html",name:"Compress PDF",icon:"zap",subtitle:"Reduce the file size of your PDF."},{href:"/edit-pdf.html",name:"PDF Editor",icon:"pocket-knife",subtitle:"Annotate, highlight, redact, comment, add shapes/images, search, and view PDFs"},{href:"/jpg-to-pdf.html",name:"JPG to PDF",icon:"image-up",subtitle:"Create a PDF from one or more JPG images."},{href:"/sign-pdf.html",name:"Sign PDF",icon:"pen-tool",subtitle:"Draw, type, or upload your signature."},{href:"/crop-pdf.html",name:"Crop PDF",icon:"crop",subtitle:"Trim the margins of every page in your PDF."},{href:"/extract-pages.html",name:"Extract Pages",icon:"ungroup",subtitle:"Save a selection of pages as new files."},{href:"/organize-pdf.html",name:"Duplicate & Organize",icon:"files",subtitle:"Duplicate, reorder, and delete pages."},{href:"/delete-pages.html",name:"Delete Pages",icon:"trash-2",subtitle:"Remove specific pages from your document."}]},{name:"Edit & Annotate",tools:[{href:"/edit-pdf.html",name:"PDF Editor",icon:"pocket-knife",subtitle:"Annotate, highlight, redact, comment, add shapes/images, search, and view PDFs."},{href:"/bookmark.html",name:"Edit Bookmarks",icon:"bookmark",subtitle:"Add, edit, import, delete and extract PDF bookmarks."},{href:"/table-of-contents.html",name:"Table of Contents",icon:"list",subtitle:"Generate a table of contents page from PDF bookmarks."},{href:"/page-numbers.html",name:"Page Numbers",icon:"list-ordered",subtitle:"Insert page numbers into your document."},{href:"/add-watermark.html",name:"Add Watermark",icon:"droplets",subtitle:"Stamp text or an image over your PDF pages."},{href:"/header-footer.html",name:"Header & Footer",icon:"pilcrow",subtitle:"Add text to the top and bottom of pages."},{href:"/invert-colors.html",name:"Invert Colors",icon:"contrast",subtitle:'Create a "dark mode" version of your PDF.'},{href:"/background-color.html",name:"Background Color",icon:"palette",subtitle:"Change the background color of your PDF."},{href:"/text-color.html",name:"Change Text Color",icon:"type",subtitle:"Change the color of text in your PDF."},{href:"/sign-pdf.html",name:"Sign PDF",icon:"pen-tool",subtitle:"Draw, type, or upload your signature."},{href:"/add-stamps.html",name:"Add Stamps",icon:"stamp",subtitle:"Add image stamps to your PDF using the annotation toolbar."},{href:"/remove-annotations.html",name:"Remove Annotations",icon:"eraser",subtitle:"Strip comments, highlights, and links."},{href:"/crop-pdf.html",name:"Crop PDF",icon:"crop",subtitle:"Trim the margins of every page in your PDF."},{href:"/form-filler.html",name:"PDF Form Filler",icon:"square-pen",subtitle:"Fill in forms directly in the browser. Also supports XFA forms."},{href:"/form-creator.html",name:"Create PDF Form",icon:"file-input",subtitle:"Create fillable PDF forms with drag-and-drop text fields."},{href:"/remove-blank-pages.html",name:"Remove Blank Pages",icon:"file-minus-2",subtitle:"Automatically detect and delete blank pages."}]},{name:"Convert to PDF",tools:[{href:"/image-to-pdf.html",name:"Image to PDF",icon:"images",subtitle:"Convert JPG, PNG, WebP, BMP, TIFF, SVG, HEIC to PDF."},{href:"/jpg-to-pdf.html",name:"JPG to PDF",icon:"image-up",subtitle:"Create a PDF from one or more JPG images."},{href:"/png-to-pdf.html",name:"PNG to PDF",icon:"image-up",subtitle:"Create a PDF from one or more PNG images."},{href:"/webp-to-pdf.html",name:"WebP to PDF",icon:"image-up",subtitle:"Create a PDF from one or more WebP images."},{href:"/svg-to-pdf.html",name:"SVG to PDF",icon:"pen-tool",subtitle:"Create a PDF from one or more SVG images."},{href:"/bmp-to-pdf.html",name:"BMP to PDF",icon:"image",subtitle:"Create a PDF from one or more BMP images."},{href:"/heic-to-pdf.html",name:"HEIC to PDF",icon:"smartphone",subtitle:"Create a PDF from one or more HEIC images."},{href:"/tiff-to-pdf.html",name:"TIFF to PDF",icon:"layers",subtitle:"Create a PDF from one or more TIFF images."},{href:"/txt-to-pdf.html",name:"Text to PDF",icon:"file-pen",subtitle:"Convert a plain text file into a PDF."},{href:"/json-to-pdf.html",name:"JSON to PDF",icon:"file-code",subtitle:"Convert JSON files to PDF format."}]},{name:"Convert from PDF",tools:[{href:"/pdf-to-jpg.html",name:"PDF to JPG",icon:"file-image",subtitle:"Convert each PDF page into a JPG image."},{href:"/pdf-to-png.html",name:"PDF to PNG",icon:"file-image",subtitle:"Convert each PDF page into a PNG image."},{href:"/pdf-to-webp.html",name:"PDF to WebP",icon:"file-image",subtitle:"Convert each PDF page into a WebP image."},{href:"/pdf-to-bmp.html",name:"PDF to BMP",icon:"file-image",subtitle:"Convert each PDF page into a BMP image."},{href:"/pdf-to-tiff.html",name:"PDF to TIFF",icon:"file-image",subtitle:"Convert each PDF page into a TIFF image."},{href:"/pdf-to-greyscale.html",name:"PDF to Greyscale",icon:"palette",subtitle:"Convert all colors to black and white."},{href:"/pdf-to-json.html",name:"PDF to JSON",icon:"file-code",subtitle:"Convert PDF files to JSON format."}]},{name:"Organize & Manage",tools:[{href:"/ocr-pdf.html",name:"OCR PDF",icon:"scan-text",subtitle:"Make a PDF searchable and copyable."},{href:"/merge-pdf.html",name:"Merge PDF",icon:"combine",subtitle:"Combine multiple PDFs into one file."},{href:"/alternate-merge.html",name:"Alternate & Mix Pages",icon:"shuffle",subtitle:"Merge PDFs by alternating pages from each PDF. Preserves Bookmarks"},{href:"/organize-pdf.html",name:"Organize & Duplicate",icon:"files",subtitle:"Duplicate, reorder, and delete pages."},{href:"/add-attachments.html",name:"Add Attachments",icon:"paperclip",subtitle:"Embed one or more files into your PDF."},{href:"/extract-attachments.html",name:"Extract Attachments",icon:"download",subtitle:"Extract all embedded files from PDF(s) as a ZIP."},{href:"/edit-attachments.html",name:"Edit Attachments",icon:"file-edit",subtitle:"View or remove attachments in your PDF."},{href:"/pdf-multi-tool.html",name:"PDF Multi Tool",icon:"pencil-ruler",subtitle:"Full-featured PDF editor with page management."},{href:"/split-pdf.html",name:"Split PDF",icon:"scissors",subtitle:"Extract a range of pages into a new PDF."},{href:"/divide-pages.html",name:"Divide Pages",icon:"table-columns-split",subtitle:"Divide pages horizontally or vertically."},{href:"/extract-pages.html",name:"Extract Pages",icon:"ungroup",subtitle:"Save a selection of pages as new files."},{href:"/delete-pages.html",name:"Delete Pages",icon:"trash-2",subtitle:"Remove specific pages from your document."},{href:"/add-blank-page.html",name:"Add Blank Page",icon:"file-plus-2",subtitle:"Insert an empty page anywhere in your PDF."},{href:"/reverse-pages.html",name:"Reverse Pages",icon:"arrow-down-z-a",subtitle:"Flip the order of all pages in your document."},{href:"/rotate-pdf.html",name:"Rotate PDF",icon:"rotate-cw",subtitle:"Turn pages in 90-degree increments."},{href:"/n-up-pdf.html",name:"N-Up PDF",icon:"layout-grid",subtitle:"Arrange multiple pages onto a single sheet."},{href:"/combine-single-page.html",name:"Combine to Single Page",icon:"unfold-vertical",subtitle:"Stitch all pages into one continuous scroll."},{href:"/view-metadata.html",name:"View Metadata",icon:"info",subtitle:"Inspect the hidden properties of your PDF."},{href:"/edit-metadata.html",name:"Edit Metadata",icon:"file-cog",subtitle:"Change the author, title, and other properties."},{href:"/pdf-to-zip.html",name:"PDFs to ZIP",icon:"stretch-horizontal",subtitle:"Package multiple PDF files into a ZIP archive."},{href:"/compare-pdfs.html",name:"Compare PDFs",icon:"git-compare",subtitle:"Compare two PDFs side by side."},{href:"/posterize-pdf.html",name:"Posterize PDF",icon:"notepad-text-dashed",subtitle:"Split a large page into multiple smaller pages."}]},{name:"Optimize & Repair",tools:[{href:"/compress-pdf.html",name:"Compress PDF",icon:"zap",subtitle:"Reduce the file size of your PDF."},{href:"/fix-page-size.html",name:"Fix Page Size",icon:"ruler-dimension-line",subtitle:"Standardize all pages to a uniform size."},{href:"/linearize-pdf.html",name:"Linearize PDF",icon:"gauge",subtitle:"Optimize PDF for fast web viewing."},{href:"/page-dimensions.html",name:"Page Dimensions",icon:"ruler",subtitle:"Analyze page size, orientation, and units."},{href:"/remove-restrictions.html",name:"Remove Restrictions",icon:"unlink",subtitle:"Remove password protection and security restrictions associated with digitally signed PDF files."},{href:"/repair-pdf.html",name:"Repair PDF",icon:"wrench",subtitle:"Recover data from corrupted or damaged PDF files."}]},{name:"Secure PDF",tools:[{href:"/encrypt-pdf.html",name:"Encrypt PDF",icon:"lock",subtitle:"Lock your PDF by adding a password."},{href:"/sanitize-pdf.html",name:"Sanitize PDF",icon:"brush-cleaning",subtitle:"Remove metadata, annotations, scripts, and more."},{href:"/decrypt-pdf.html",name:"Decrypt PDF",icon:"unlock",subtitle:"Unlock PDF by removing password protection."},{href:"/flatten-pdf.html",name:"Flatten PDF",icon:"layers",subtitle:"Make form fields and annotations non-editable."},{href:"/remove-metadata.html",name:"Remove Metadata",icon:"file-x",subtitle:"Strip hidden data from your PDF."},{href:"/change-permissions.html",name:"Change Permissions",icon:"shield-check",subtitle:"Set or change user permissions on a PDF."}]}],$n={activeTool:null,files:[],pdfDoc:null,pdfPages:[],currentPdfUrl:null};function bc(){$n.activeTool=null,$n.files=[],$n.pdfDoc=null,$n.pdfPages=[],$n.currentPdfUrl=null,document.getElementById("tool-content").innerHTML=""}var Ep=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wc(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function vc(a){if(Object.prototype.hasOwnProperty.call(a,"__esModule"))return a;var t=a.default;if(typeof t=="function"){var e=function i(){var n=!1;try{n=this instanceof i}catch{}return n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(a).forEach(function(i){var n=Object.getOwnPropertyDescriptor(a,i);Object.defineProperty(e,i,n.get?n:{enumerable:!0,get:function(){return a[i]}})}),e}function Ac(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var _l={exports:{}},ee=_l.exports={},mi,yi;function to(){throw new Error("setTimeout has not been defined")}function eo(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?mi=setTimeout:mi=to}catch{mi=to}try{typeof clearTimeout=="function"?yi=clearTimeout:yi=eo}catch{yi=eo}})();function Tl(a){if(mi===setTimeout)return setTimeout(a,0);if((mi===to||!mi)&&setTimeout)return mi=setTimeout,setTimeout(a,0);try{return mi(a,0)}catch{try{return mi.call(null,a,0)}catch{return mi.call(this,a,0)}}}function Ec(a){if(yi===clearTimeout)return clearTimeout(a);if((yi===eo||!yi)&&clearTimeout)return yi=clearTimeout,clearTimeout(a);try{return yi(a)}catch{try{return yi.call(null,a)}catch{return yi.call(this,a)}}}var ki=[],Tn=!1,Qi,Gs=-1;function Sc(){!Tn||!Qi||(Tn=!1,Qi.length?ki=Qi.concat(ki):Gs=-1,ki.length&&Pl())}function Pl(){if(!Tn){var a=Tl(Sc);Tn=!0;for(var t=ki.length;t;){for(Qi=ki,ki=[];++Gs<t;)Qi&&Qi[Gs].run();Gs=-1,t=ki.length}Qi=null,Tn=!1,Ec(a)}}ee.nextTick=function(a){var t=new Array(arguments.length-1);if(arguments.length>1)for(var e=1;e<arguments.length;e++)t[e-1]=arguments[e];ki.push(new kl(a,t)),ki.length===1&&!Tn&&Tl(Pl)};function kl(a,t){this.fun=a,this.array=t}kl.prototype.run=function(){this.fun.apply(null,this.array)};ee.title="browser";ee.browser=!0;ee.env={};ee.argv=[];ee.version="";ee.versions={};function Ii(){}ee.on=Ii;ee.addListener=Ii;ee.once=Ii;ee.off=Ii;ee.removeListener=Ii;ee.removeAllListeners=Ii;ee.emit=Ii;ee.prependListener=Ii;ee.prependOnceListener=Ii;ee.listeners=function(a){return[]};ee.binding=function(a){throw new Error("process.binding is not supported")};ee.cwd=function(){return"/"};ee.chdir=function(a){throw new Error("process.chdir is not supported")};ee.umask=function(){return 0};var xc=_l.exports;const Jt=Ac(xc);var Dl={},ur={};ur.byteLength=Tc;ur.toByteArray=kc;ur.fromByteArray=Ic;var wi=[],Ze=[],Cc=typeof Uint8Array<"u"?Uint8Array:Array,Ir="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var un=0,_c=Ir.length;un<_c;++un)wi[un]=Ir[un],Ze[Ir.charCodeAt(un)]=un;Ze[45]=62;Ze[95]=63;function Ll(a){var t=a.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=a.indexOf("=");e===-1&&(e=t);var i=e===t?0:4-e%4;return[e,i]}function Tc(a){var t=Ll(a),e=t[0],i=t[1];return(e+i)*3/4-i}function Pc(a,t,e){return(t+e)*3/4-e}function kc(a){var t,e=Ll(a),i=e[0],n=e[1],s=new Cc(Pc(a,i,n)),r=0,o=n>0?i-4:i,l;for(l=0;l<o;l+=4)t=Ze[a.charCodeAt(l)]<<18|Ze[a.charCodeAt(l+1)]<<12|Ze[a.charCodeAt(l+2)]<<6|Ze[a.charCodeAt(l+3)],s[r++]=t>>16&255,s[r++]=t>>8&255,s[r++]=t&255;return n===2&&(t=Ze[a.charCodeAt(l)]<<2|Ze[a.charCodeAt(l+1)]>>4,s[r++]=t&255),n===1&&(t=Ze[a.charCodeAt(l)]<<10|Ze[a.charCodeAt(l+1)]<<4|Ze[a.charCodeAt(l+2)]>>2,s[r++]=t>>8&255,s[r++]=t&255),s}function Dc(a){return wi[a>>18&63]+wi[a>>12&63]+wi[a>>6&63]+wi[a&63]}function Lc(a,t,e){for(var i,n=[],s=t;s<e;s+=3)i=(a[s]<<16&16711680)+(a[s+1]<<8&65280)+(a[s+2]&255),n.push(Dc(i));return n.join("")}function Ic(a){for(var t,e=a.length,i=e%3,n=[],s=16383,r=0,o=e-i;r<o;r+=s)n.push(Lc(a,r,r+s>o?o:r+s));return i===1?(t=a[e-1],n.push(wi[t>>2]+wi[t<<4&63]+"==")):i===2&&(t=(a[e-2]<<8)+a[e-1],n.push(wi[t>>10]+wi[t>>4&63]+wi[t<<2&63]+"=")),n.join("")}var Co={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Co.read=function(a,t,e,i,n){var s,r,o=n*8-i-1,l=(1<<o)-1,d=l>>1,c=-7,u=e?n-1:0,p=e?-1:1,y=a[t+u];for(u+=p,s=y&(1<<-c)-1,y>>=-c,c+=o;c>0;s=s*256+a[t+u],u+=p,c-=8);for(r=s&(1<<-c)-1,s>>=-c,c+=i;c>0;r=r*256+a[t+u],u+=p,c-=8);if(s===0)s=1-d;else{if(s===l)return r?NaN:(y?-1:1)*(1/0);r=r+Math.pow(2,i),s=s-d}return(y?-1:1)*r*Math.pow(2,s-i)};Co.write=function(a,t,e,i,n,s){var r,o,l,d=s*8-n-1,c=(1<<d)-1,u=c>>1,p=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,y=i?0:s-1,v=i?1:-1,w=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,r=c):(r=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-r))<1&&(r--,l*=2),r+u>=1?t+=p/l:t+=p*Math.pow(2,1-u),t*l>=2&&(r++,l/=2),r+u>=c?(o=0,r=c):r+u>=1?(o=(t*l-1)*Math.pow(2,n),r=r+u):(o=t*Math.pow(2,u-1)*Math.pow(2,n),r=0));n>=8;a[e+y]=o&255,y+=v,o/=256,n-=8);for(r=r<<n|o,d+=n;d>0;a[e+y]=r&255,y+=v,r/=256,d-=8);a[e+y-v]|=w*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(a){const t=ur,e=Co,i=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;a.Buffer=c,a.SlowBuffer=M,a.INSPECT_MAX_BYTES=50;const n=2147483647;a.kMaxLength=n;const{Uint8Array:s,ArrayBuffer:r,SharedArrayBuffer:o}=globalThis;c.TYPED_ARRAY_SUPPORT=l(),!c.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function l(){try{const E=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(E,g),E.foo()===42}catch{return!1}}Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}});function d(E){if(E>n)throw new RangeError('The value "'+E+'" is invalid for option "size"');const g=new s(E);return Object.setPrototypeOf(g,c.prototype),g}function c(E,g,m){if(typeof E=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return v(E)}return u(E,g,m)}c.poolSize=8192;function u(E,g,m){if(typeof E=="string")return w(E,g);if(r.isView(E))return S(E);if(E==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof E);if(Ye(E,r)||E&&Ye(E.buffer,r)||typeof o<"u"&&(Ye(E,o)||E&&Ye(E.buffer,o)))return P(E,g,m);if(typeof E=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const T=E.valueOf&&E.valueOf();if(T!=null&&T!==E)return c.from(T,g,m);const L=k(E);if(L)return L;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof E[Symbol.toPrimitive]=="function")return c.from(E[Symbol.toPrimitive]("string"),g,m);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof E)}c.from=function(E,g,m){return u(E,g,m)},Object.setPrototypeOf(c.prototype,s.prototype),Object.setPrototypeOf(c,s);function p(E){if(typeof E!="number")throw new TypeError('"size" argument must be of type number');if(E<0)throw new RangeError('The value "'+E+'" is invalid for option "size"')}function y(E,g,m){return p(E),E<=0?d(E):g!==void 0?typeof m=="string"?d(E).fill(g,m):d(E).fill(g):d(E)}c.alloc=function(E,g,m){return y(E,g,m)};function v(E){return p(E),d(E<0?0:D(E)|0)}c.allocUnsafe=function(E){return v(E)},c.allocUnsafeSlow=function(E){return v(E)};function w(E,g){if((typeof g!="string"||g==="")&&(g="utf8"),!c.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const m=R(E,g)|0;let T=d(m);const L=T.write(E,g);return L!==m&&(T=T.slice(0,L)),T}function x(E){const g=E.length<0?0:D(E.length)|0,m=d(g);for(let T=0;T<g;T+=1)m[T]=E[T]&255;return m}function S(E){if(Ye(E,s)){const g=new s(E);return P(g.buffer,g.byteOffset,g.byteLength)}return x(E)}function P(E,g,m){if(g<0||E.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(E.byteLength<g+(m||0))throw new RangeError('"length" is outside of buffer bounds');let T;return g===void 0&&m===void 0?T=new s(E):m===void 0?T=new s(E,g):T=new s(E,g,m),Object.setPrototypeOf(T,c.prototype),T}function k(E){if(c.isBuffer(E)){const g=D(E.length)|0,m=d(g);return m.length===0||E.copy(m,0,0,g),m}if(E.length!==void 0)return typeof E.length!="number"||xi(E.length)?d(0):x(E);if(E.type==="Buffer"&&Array.isArray(E.data))return x(E.data)}function D(E){if(E>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return E|0}function M(E){return+E!=E&&(E=0),c.alloc(+E)}c.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==c.prototype},c.compare=function(g,m){if(Ye(g,s)&&(g=c.from(g,g.offset,g.byteLength)),Ye(m,s)&&(m=c.from(m,m.offset,m.byteLength)),!c.isBuffer(g)||!c.isBuffer(m))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===m)return 0;let T=g.length,L=m.length;for(let B=0,j=Math.min(T,L);B<j;++B)if(g[B]!==m[B]){T=g[B],L=m[B];break}return T<L?-1:L<T?1:0},c.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(g,m){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return c.alloc(0);let T;if(m===void 0)for(m=0,T=0;T<g.length;++T)m+=g[T].length;const L=c.allocUnsafe(m);let B=0;for(T=0;T<g.length;++T){let j=g[T];if(Ye(j,s))B+j.length>L.length?(c.isBuffer(j)||(j=c.from(j)),j.copy(L,B)):s.prototype.set.call(L,j,B);else if(c.isBuffer(j))j.copy(L,B);else throw new TypeError('"list" argument must be an Array of Buffers');B+=j.length}return L};function R(E,g){if(c.isBuffer(E))return E.length;if(r.isView(E)||Ye(E,r))return E.byteLength;if(typeof E!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof E);const m=E.length,T=arguments.length>2&&arguments[2]===!0;if(!T&&m===0)return 0;let L=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return m;case"utf8":case"utf-8":return Te(E).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return m*2;case"hex":return m>>>1;case"base64":return qi(E).length;default:if(L)return T?-1:Te(E).length;g=(""+g).toLowerCase(),L=!0}}c.byteLength=R;function N(E,g,m){let T=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((m===void 0||m>this.length)&&(m=this.length),m<=0)||(m>>>=0,g>>>=0,m<=g))return"";for(E||(E="utf8");;)switch(E){case"hex":return gt(this,g,m);case"utf8":case"utf-8":return W(this,g,m);case"ascii":return Mt(this,g,m);case"latin1":case"binary":return pt(this,g,m);case"base64":return V(this,g,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return bt(this,g,m);default:if(T)throw new TypeError("Unknown encoding: "+E);E=(E+"").toLowerCase(),T=!0}}c.prototype._isBuffer=!0;function F(E,g,m){const T=E[g];E[g]=E[m],E[m]=T}c.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let m=0;m<g;m+=2)F(this,m,m+1);return this},c.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let m=0;m<g;m+=4)F(this,m,m+3),F(this,m+1,m+2);return this},c.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let m=0;m<g;m+=8)F(this,m,m+7),F(this,m+1,m+6),F(this,m+2,m+5),F(this,m+3,m+4);return this},c.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?W(this,0,g):N.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(g){if(!c.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:c.compare(this,g)===0},c.prototype.inspect=function(){let g="";const m=a.INSPECT_MAX_BYTES;return g=this.toString("hex",0,m).replace(/(.{2})/g,"$1 ").trim(),this.length>m&&(g+=" ... "),"<Buffer "+g+">"},i&&(c.prototype[i]=c.prototype.inspect),c.prototype.compare=function(g,m,T,L,B){if(Ye(g,s)&&(g=c.from(g,g.offset,g.byteLength)),!c.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(m===void 0&&(m=0),T===void 0&&(T=g?g.length:0),L===void 0&&(L=0),B===void 0&&(B=this.length),m<0||T>g.length||L<0||B>this.length)throw new RangeError("out of range index");if(L>=B&&m>=T)return 0;if(L>=B)return-1;if(m>=T)return 1;if(m>>>=0,T>>>=0,L>>>=0,B>>>=0,this===g)return 0;let j=B-L,vt=T-m;const Ot=Math.min(j,vt),Rt=this.slice(L,B),Ft=g.slice(m,T);for(let J=0;J<Ot;++J)if(Rt[J]!==Ft[J]){j=Rt[J],vt=Ft[J];break}return j<vt?-1:vt<j?1:0};function O(E,g,m,T,L){if(E.length===0)return-1;if(typeof m=="string"?(T=m,m=0):m>2147483647?m=2147483647:m<-2147483648&&(m=-2147483648),m=+m,xi(m)&&(m=L?0:E.length-1),m<0&&(m=E.length+m),m>=E.length){if(L)return-1;m=E.length-1}else if(m<0)if(L)m=0;else return-1;if(typeof g=="string"&&(g=c.from(g,T)),c.isBuffer(g))return g.length===0?-1:H(E,g,m,T,L);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?L?s.prototype.indexOf.call(E,g,m):s.prototype.lastIndexOf.call(E,g,m):H(E,[g],m,T,L);throw new TypeError("val must be string, number or Buffer")}function H(E,g,m,T,L){let B=1,j=E.length,vt=g.length;if(T!==void 0&&(T=String(T).toLowerCase(),T==="ucs2"||T==="ucs-2"||T==="utf16le"||T==="utf-16le")){if(E.length<2||g.length<2)return-1;B=2,j/=2,vt/=2,m/=2}function Ot(Ft,J){return B===1?Ft[J]:Ft.readUInt16BE(J*B)}let Rt;if(L){let Ft=-1;for(Rt=m;Rt<j;Rt++)if(Ot(E,Rt)===Ot(g,Ft===-1?0:Rt-Ft)){if(Ft===-1&&(Ft=Rt),Rt-Ft+1===vt)return Ft*B}else Ft!==-1&&(Rt-=Rt-Ft),Ft=-1}else for(m+vt>j&&(m=j-vt),Rt=m;Rt>=0;Rt--){let Ft=!0;for(let J=0;J<vt;J++)if(Ot(E,Rt+J)!==Ot(g,J)){Ft=!1;break}if(Ft)return Rt}return-1}c.prototype.includes=function(g,m,T){return this.indexOf(g,m,T)!==-1},c.prototype.indexOf=function(g,m,T){return O(this,g,m,T,!0)},c.prototype.lastIndexOf=function(g,m,T){return O(this,g,m,T,!1)};function U(E,g,m,T){m=Number(m)||0;const L=E.length-m;T?(T=Number(T),T>L&&(T=L)):T=L;const B=g.length;T>B/2&&(T=B/2);let j;for(j=0;j<T;++j){const vt=parseInt(g.substr(j*2,2),16);if(xi(vt))return j;E[m+j]=vt}return j}function K(E,g,m,T){return Xe(Te(g,E.length-m),E,m,T)}function z(E,g,m,T){return Xe(hn(g),E,m,T)}function G(E,g,m,T){return Xe(qi(g),E,m,T)}function et(E,g,m,T){return Xe(ni(g,E.length-m),E,m,T)}c.prototype.write=function(g,m,T,L){if(m===void 0)L="utf8",T=this.length,m=0;else if(T===void 0&&typeof m=="string")L=m,T=this.length,m=0;else if(isFinite(m))m=m>>>0,isFinite(T)?(T=T>>>0,L===void 0&&(L="utf8")):(L=T,T=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const B=this.length-m;if((T===void 0||T>B)&&(T=B),g.length>0&&(T<0||m<0)||m>this.length)throw new RangeError("Attempt to write outside buffer bounds");L||(L="utf8");let j=!1;for(;;)switch(L){case"hex":return U(this,g,m,T);case"utf8":case"utf-8":return K(this,g,m,T);case"ascii":case"latin1":case"binary":return z(this,g,m,T);case"base64":return G(this,g,m,T);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return et(this,g,m,T);default:if(j)throw new TypeError("Unknown encoding: "+L);L=(""+L).toLowerCase(),j=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function V(E,g,m){return g===0&&m===E.length?t.fromByteArray(E):t.fromByteArray(E.slice(g,m))}function W(E,g,m){m=Math.min(E.length,m);const T=[];let L=g;for(;L<m;){const B=E[L];let j=null,vt=B>239?4:B>223?3:B>191?2:1;if(L+vt<=m){let Ot,Rt,Ft,J;switch(vt){case 1:B<128&&(j=B);break;case 2:Ot=E[L+1],(Ot&192)===128&&(J=(B&31)<<6|Ot&63,J>127&&(j=J));break;case 3:Ot=E[L+1],Rt=E[L+2],(Ot&192)===128&&(Rt&192)===128&&(J=(B&15)<<12|(Ot&63)<<6|Rt&63,J>2047&&(J<55296||J>57343)&&(j=J));break;case 4:Ot=E[L+1],Rt=E[L+2],Ft=E[L+3],(Ot&192)===128&&(Rt&192)===128&&(Ft&192)===128&&(J=(B&15)<<18|(Ot&63)<<12|(Rt&63)<<6|Ft&63,J>65535&&J<1114112&&(j=J))}}j===null?(j=65533,vt=1):j>65535&&(j-=65536,T.push(j>>>10&1023|55296),j=56320|j&1023),T.push(j),L+=vt}return Ct(T)}const Q=4096;function Ct(E){const g=E.length;if(g<=Q)return String.fromCharCode.apply(String,E);let m="",T=0;for(;T<g;)m+=String.fromCharCode.apply(String,E.slice(T,T+=Q));return m}function Mt(E,g,m){let T="";m=Math.min(E.length,m);for(let L=g;L<m;++L)T+=String.fromCharCode(E[L]&127);return T}function pt(E,g,m){let T="";m=Math.min(E.length,m);for(let L=g;L<m;++L)T+=String.fromCharCode(E[L]);return T}function gt(E,g,m){const T=E.length;(!g||g<0)&&(g=0),(!m||m<0||m>T)&&(m=T);let L="";for(let B=g;B<m;++B)L+=Sr[E[B]];return L}function bt(E,g,m){const T=E.slice(g,m);let L="";for(let B=0;B<T.length-1;B+=2)L+=String.fromCharCode(T[B]+T[B+1]*256);return L}c.prototype.slice=function(g,m){const T=this.length;g=~~g,m=m===void 0?T:~~m,g<0?(g+=T,g<0&&(g=0)):g>T&&(g=T),m<0?(m+=T,m<0&&(m=0)):m>T&&(m=T),m<g&&(m=g);const L=this.subarray(g,m);return Object.setPrototypeOf(L,c.prototype),L};function ct(E,g,m){if(E%1!==0||E<0)throw new RangeError("offset is not uint");if(E+g>m)throw new RangeError("Trying to access beyond buffer length")}c.prototype.readUintLE=c.prototype.readUIntLE=function(g,m,T){g=g>>>0,m=m>>>0,T||ct(g,m,this.length);let L=this[g],B=1,j=0;for(;++j<m&&(B*=256);)L+=this[g+j]*B;return L},c.prototype.readUintBE=c.prototype.readUIntBE=function(g,m,T){g=g>>>0,m=m>>>0,T||ct(g,m,this.length);let L=this[g+--m],B=1;for(;m>0&&(B*=256);)L+=this[g+--m]*B;return L},c.prototype.readUint8=c.prototype.readUInt8=function(g,m){return g=g>>>0,m||ct(g,1,this.length),this[g]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(g,m){return g=g>>>0,m||ct(g,2,this.length),this[g]|this[g+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(g,m){return g=g>>>0,m||ct(g,2,this.length),this[g]<<8|this[g+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(g,m){return g=g>>>0,m||ct(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(g,m){return g=g>>>0,m||ct(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},c.prototype.readBigUInt64LE=si(function(g){g=g>>>0,ue(g,"offset");const m=this[g],T=this[g+7];(m===void 0||T===void 0)&&fe(g,this.length-8);const L=m+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,B=this[++g]+this[++g]*2**8+this[++g]*2**16+T*2**24;return BigInt(L)+(BigInt(B)<<BigInt(32))}),c.prototype.readBigUInt64BE=si(function(g){g=g>>>0,ue(g,"offset");const m=this[g],T=this[g+7];(m===void 0||T===void 0)&&fe(g,this.length-8);const L=m*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],B=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+T;return(BigInt(L)<<BigInt(32))+BigInt(B)}),c.prototype.readIntLE=function(g,m,T){g=g>>>0,m=m>>>0,T||ct(g,m,this.length);let L=this[g],B=1,j=0;for(;++j<m&&(B*=256);)L+=this[g+j]*B;return B*=128,L>=B&&(L-=Math.pow(2,8*m)),L},c.prototype.readIntBE=function(g,m,T){g=g>>>0,m=m>>>0,T||ct(g,m,this.length);let L=m,B=1,j=this[g+--L];for(;L>0&&(B*=256);)j+=this[g+--L]*B;return B*=128,j>=B&&(j-=Math.pow(2,8*m)),j},c.prototype.readInt8=function(g,m){return g=g>>>0,m||ct(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},c.prototype.readInt16LE=function(g,m){g=g>>>0,m||ct(g,2,this.length);const T=this[g]|this[g+1]<<8;return T&32768?T|4294901760:T},c.prototype.readInt16BE=function(g,m){g=g>>>0,m||ct(g,2,this.length);const T=this[g+1]|this[g]<<8;return T&32768?T|4294901760:T},c.prototype.readInt32LE=function(g,m){return g=g>>>0,m||ct(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},c.prototype.readInt32BE=function(g,m){return g=g>>>0,m||ct(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},c.prototype.readBigInt64LE=si(function(g){g=g>>>0,ue(g,"offset");const m=this[g],T=this[g+7];(m===void 0||T===void 0)&&fe(g,this.length-8);const L=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(T<<24);return(BigInt(L)<<BigInt(32))+BigInt(m+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),c.prototype.readBigInt64BE=si(function(g){g=g>>>0,ue(g,"offset");const m=this[g],T=this[g+7];(m===void 0||T===void 0)&&fe(g,this.length-8);const L=(m<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(L)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+T)}),c.prototype.readFloatLE=function(g,m){return g=g>>>0,m||ct(g,4,this.length),e.read(this,g,!0,23,4)},c.prototype.readFloatBE=function(g,m){return g=g>>>0,m||ct(g,4,this.length),e.read(this,g,!1,23,4)},c.prototype.readDoubleLE=function(g,m){return g=g>>>0,m||ct(g,8,this.length),e.read(this,g,!0,52,8)},c.prototype.readDoubleBE=function(g,m){return g=g>>>0,m||ct(g,8,this.length),e.read(this,g,!1,52,8)};function _t(E,g,m,T,L,B){if(!c.isBuffer(E))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>L||g<B)throw new RangeError('"value" argument is out of bounds');if(m+T>E.length)throw new RangeError("Index out of range")}c.prototype.writeUintLE=c.prototype.writeUIntLE=function(g,m,T,L){if(g=+g,m=m>>>0,T=T>>>0,!L){const vt=Math.pow(2,8*T)-1;_t(this,g,m,T,vt,0)}let B=1,j=0;for(this[m]=g&255;++j<T&&(B*=256);)this[m+j]=g/B&255;return m+T},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(g,m,T,L){if(g=+g,m=m>>>0,T=T>>>0,!L){const vt=Math.pow(2,8*T)-1;_t(this,g,m,T,vt,0)}let B=T-1,j=1;for(this[m+B]=g&255;--B>=0&&(j*=256);)this[m+B]=g/j&255;return m+T},c.prototype.writeUint8=c.prototype.writeUInt8=function(g,m,T){return g=+g,m=m>>>0,T||_t(this,g,m,1,255,0),this[m]=g&255,m+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(g,m,T){return g=+g,m=m>>>0,T||_t(this,g,m,2,65535,0),this[m]=g&255,this[m+1]=g>>>8,m+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(g,m,T){return g=+g,m=m>>>0,T||_t(this,g,m,2,65535,0),this[m]=g>>>8,this[m+1]=g&255,m+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(g,m,T){return g=+g,m=m>>>0,T||_t(this,g,m,4,4294967295,0),this[m+3]=g>>>24,this[m+2]=g>>>16,this[m+1]=g>>>8,this[m]=g&255,m+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(g,m,T){return g=+g,m=m>>>0,T||_t(this,g,m,4,4294967295,0),this[m]=g>>>24,this[m+1]=g>>>16,this[m+2]=g>>>8,this[m+3]=g&255,m+4};function wt(E,g,m,T,L){hi(g,T,L,E,m,7);let B=Number(g&BigInt(4294967295));E[m++]=B,B=B>>8,E[m++]=B,B=B>>8,E[m++]=B,B=B>>8,E[m++]=B;let j=Number(g>>BigInt(32)&BigInt(4294967295));return E[m++]=j,j=j>>8,E[m++]=j,j=j>>8,E[m++]=j,j=j>>8,E[m++]=j,m}function Pt(E,g,m,T,L){hi(g,T,L,E,m,7);let B=Number(g&BigInt(4294967295));E[m+7]=B,B=B>>8,E[m+6]=B,B=B>>8,E[m+5]=B,B=B>>8,E[m+4]=B;let j=Number(g>>BigInt(32)&BigInt(4294967295));return E[m+3]=j,j=j>>8,E[m+2]=j,j=j>>8,E[m+1]=j,j=j>>8,E[m]=j,m+8}c.prototype.writeBigUInt64LE=si(function(g,m=0){return wt(this,g,m,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeBigUInt64BE=si(function(g,m=0){return Pt(this,g,m,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeIntLE=function(g,m,T,L){if(g=+g,m=m>>>0,!L){const Ot=Math.pow(2,8*T-1);_t(this,g,m,T,Ot-1,-Ot)}let B=0,j=1,vt=0;for(this[m]=g&255;++B<T&&(j*=256);)g<0&&vt===0&&this[m+B-1]!==0&&(vt=1),this[m+B]=(g/j>>0)-vt&255;return m+T},c.prototype.writeIntBE=function(g,m,T,L){if(g=+g,m=m>>>0,!L){const Ot=Math.pow(2,8*T-1);_t(this,g,m,T,Ot-1,-Ot)}let B=T-1,j=1,vt=0;for(this[m+B]=g&255;--B>=0&&(j*=256);)g<0&&vt===0&&this[m+B+1]!==0&&(vt=1),this[m+B]=(g/j>>0)-vt&255;return m+T},c.prototype.writeInt8=function(g,m,T){return g=+g,m=m>>>0,T||_t(this,g,m,1,127,-128),g<0&&(g=255+g+1),this[m]=g&255,m+1},c.prototype.writeInt16LE=function(g,m,T){return g=+g,m=m>>>0,T||_t(this,g,m,2,32767,-32768),this[m]=g&255,this[m+1]=g>>>8,m+2},c.prototype.writeInt16BE=function(g,m,T){return g=+g,m=m>>>0,T||_t(this,g,m,2,32767,-32768),this[m]=g>>>8,this[m+1]=g&255,m+2},c.prototype.writeInt32LE=function(g,m,T){return g=+g,m=m>>>0,T||_t(this,g,m,4,2147483647,-2147483648),this[m]=g&255,this[m+1]=g>>>8,this[m+2]=g>>>16,this[m+3]=g>>>24,m+4},c.prototype.writeInt32BE=function(g,m,T){return g=+g,m=m>>>0,T||_t(this,g,m,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[m]=g>>>24,this[m+1]=g>>>16,this[m+2]=g>>>8,this[m+3]=g&255,m+4},c.prototype.writeBigInt64LE=si(function(g,m=0){return wt(this,g,m,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeBigInt64BE=si(function(g,m=0){return Pt(this,g,m,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Tt(E,g,m,T,L,B){if(m+T>E.length)throw new RangeError("Index out of range");if(m<0)throw new RangeError("Index out of range")}function ie(E,g,m,T,L){return g=+g,m=m>>>0,L||Tt(E,g,m,4),e.write(E,g,m,T,23,4),m+4}c.prototype.writeFloatLE=function(g,m,T){return ie(this,g,m,!0,T)},c.prototype.writeFloatBE=function(g,m,T){return ie(this,g,m,!1,T)};function He(E,g,m,T,L){return g=+g,m=m>>>0,L||Tt(E,g,m,8),e.write(E,g,m,T,52,8),m+8}c.prototype.writeDoubleLE=function(g,m,T){return He(this,g,m,!0,T)},c.prototype.writeDoubleBE=function(g,m,T){return He(this,g,m,!1,T)},c.prototype.copy=function(g,m,T,L){if(!c.isBuffer(g))throw new TypeError("argument should be a Buffer");if(T||(T=0),!L&&L!==0&&(L=this.length),m>=g.length&&(m=g.length),m||(m=0),L>0&&L<T&&(L=T),L===T||g.length===0||this.length===0)return 0;if(m<0)throw new RangeError("targetStart out of bounds");if(T<0||T>=this.length)throw new RangeError("Index out of range");if(L<0)throw new RangeError("sourceEnd out of bounds");L>this.length&&(L=this.length),g.length-m<L-T&&(L=g.length-m+T);const B=L-T;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(m,T,L):s.prototype.set.call(g,this.subarray(T,L),m),B},c.prototype.fill=function(g,m,T,L){if(typeof g=="string"){if(typeof m=="string"?(L=m,m=0,T=this.length):typeof T=="string"&&(L=T,T=this.length),L!==void 0&&typeof L!="string")throw new TypeError("encoding must be a string");if(typeof L=="string"&&!c.isEncoding(L))throw new TypeError("Unknown encoding: "+L);if(g.length===1){const j=g.charCodeAt(0);(L==="utf8"&&j<128||L==="latin1")&&(g=j)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(m<0||this.length<m||this.length<T)throw new RangeError("Out of range index");if(T<=m)return this;m=m>>>0,T=T===void 0?this.length:T>>>0,g||(g=0);let B;if(typeof g=="number")for(B=m;B<T;++B)this[B]=g;else{const j=c.isBuffer(g)?g:c.from(g,L),vt=j.length;if(vt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(B=0;B<T-m;++B)this[B+m]=j[B%vt]}return this};const Ae={};function je(E,g,m){Ae[E]=class extends m{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${E}]`,this.stack,delete this.name}get code(){return E}set code(L){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:L,writable:!0})}toString(){return`${this.name} [${E}]: ${this.message}`}}}je("ERR_BUFFER_OUT_OF_BOUNDS",function(E){return E?`${E} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),je("ERR_INVALID_ARG_TYPE",function(E,g){return`The "${E}" argument must be of type number. Received type ${typeof g}`},TypeError),je("ERR_OUT_OF_RANGE",function(E,g,m){let T=`The value of "${E}" is out of range.`,L=m;return Number.isInteger(m)&&Math.abs(m)>2**32?L=_e(String(m)):typeof m=="bigint"&&(L=String(m),(m>BigInt(2)**BigInt(32)||m<-(BigInt(2)**BigInt(32)))&&(L=_e(L)),L+="n"),T+=` It must be ${g}. Received ${L}`,T},RangeError);function _e(E){let g="",m=E.length;const T=E[0]==="-"?1:0;for(;m>=T+4;m-=3)g=`_${E.slice(m-3,m)}${g}`;return`${E.slice(0,m)}${g}`}function Wt(E,g,m){ue(g,"offset"),(E[g]===void 0||E[g+m]===void 0)&&fe(g,E.length-(m+1))}function hi(E,g,m,T,L,B){if(E>m||E<g){const j=typeof g=="bigint"?"n":"";let vt;throw g===0||g===BigInt(0)?vt=`>= 0${j} and < 2${j} ** ${(B+1)*8}${j}`:vt=`>= -(2${j} ** ${(B+1)*8-1}${j}) and < 2 ** ${(B+1)*8-1}${j}`,new Ae.ERR_OUT_OF_RANGE("value",vt,E)}Wt(T,L,B)}function ue(E,g){if(typeof E!="number")throw new Ae.ERR_INVALID_ARG_TYPE(g,"number",E)}function fe(E,g,m){throw Math.floor(E)!==E?(ue(E,m),new Ae.ERR_OUT_OF_RANGE("offset","an integer",E)):g<0?new Ae.ERR_BUFFER_OUT_OF_BOUNDS:new Ae.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,E)}const Wi=/[^+/0-9A-Za-z-_]/g;function Ri(E){if(E=E.split("=")[0],E=E.trim().replace(Wi,""),E.length<2)return"";for(;E.length%4!==0;)E=E+"=";return E}function Te(E,g){g=g||1/0;let m;const T=E.length;let L=null;const B=[];for(let j=0;j<T;++j){if(m=E.charCodeAt(j),m>55295&&m<57344){if(!L){if(m>56319){(g-=3)>-1&&B.push(239,191,189);continue}else if(j+1===T){(g-=3)>-1&&B.push(239,191,189);continue}L=m;continue}if(m<56320){(g-=3)>-1&&B.push(239,191,189),L=m;continue}m=(L-55296<<10|m-56320)+65536}else L&&(g-=3)>-1&&B.push(239,191,189);if(L=null,m<128){if((g-=1)<0)break;B.push(m)}else if(m<2048){if((g-=2)<0)break;B.push(m>>6|192,m&63|128)}else if(m<65536){if((g-=3)<0)break;B.push(m>>12|224,m>>6&63|128,m&63|128)}else if(m<1114112){if((g-=4)<0)break;B.push(m>>18|240,m>>12&63|128,m>>6&63|128,m&63|128)}else throw new Error("Invalid code point")}return B}function hn(E){const g=[];for(let m=0;m<E.length;++m)g.push(E.charCodeAt(m)&255);return g}function ni(E,g){let m,T,L;const B=[];for(let j=0;j<E.length&&!((g-=2)<0);++j)m=E.charCodeAt(j),T=m>>8,L=m%256,B.push(L),B.push(T);return B}function qi(E){return t.toByteArray(Ri(E))}function Xe(E,g,m,T){let L;for(L=0;L<T&&!(L+m>=g.length||L>=E.length);++L)g[L+m]=E[L];return L}function Ye(E,g){return E instanceof g||E!=null&&E.constructor!=null&&E.constructor.name!=null&&E.constructor.name===g.name}function xi(E){return E!==E}const Sr=(function(){const E="0123456789abcdef",g=new Array(256);for(let m=0;m<16;++m){const T=m*16;for(let L=0;L<16;++L)g[T+L]=E[m]+E[L]}return g})();function si(E){return typeof BigInt>"u"?cn:E}function cn(){throw new Error("BigInt not supported")}})(Dl);const io=Dl.Buffer;var Mr={exports:{}};const Mc={},Rc=Object.freeze(Object.defineProperty({__proto__:null,default:Mc},Symbol.toStringTag,{value:"Module"})),ga=vc(Rc);var ma;function Fc(){return ma||(ma=1,(function(a,t){var e=(()=>{var i=typeof document<"u"?document.currentScript?.src:void 0;return typeof __filename<"u"&&(i=i||__filename),(function(n={}){var s,r=n,o,l,d=new Promise((h,f)=>{o=h,l=f}),c=typeof window=="object",u=typeof WorkerGlobalScope<"u",p=typeof Jt=="object"&&typeof Jt.versions=="object"&&typeof Jt.versions.node=="string"&&Jt.type!="renderer";r.noInitialRun=!0;var y=Object.assign({},r),v=[],w="./this.program",x=(h,f)=>{throw f},S="",P,k;if(p){var D=ga;S=__dirname+"/",k=h=>(h=wt(h)?new URL(h):h,D.readFileSync(h)),P=async h=>(h=wt(h)?new URL(h):h,D.readFileSync(h,void 0)),!r.thisProgram&&1<Jt.argv.length&&(w=Jt.argv[1].replace(/\\/g,"/")),v=Jt.argv.slice(2),x=(h,f)=>{throw Jt.exitCode=h,f}}else(c||u)&&(u?S=self.location.href:typeof document<"u"&&document.currentScript&&(S=document.currentScript.src),i&&(S=i),S.startsWith("blob:")?S="":S=S.substr(0,S.replace(/[?#].*/,"").lastIndexOf("/")+1),u&&(k=h=>{var f=new XMLHttpRequest;return f.open("GET",h,!1),f.responseType="arraybuffer",f.send(null),new Uint8Array(f.response)}),P=async h=>{if(wt(h))return new Promise((b,A)=>{var C=new XMLHttpRequest;C.open("GET",h,!0),C.responseType="arraybuffer",C.onload=()=>{C.status==200||C.status==0&&C.response?b(C.response):A(C.status)},C.onerror=A,C.send(null)});var f=await fetch(h,{credentials:"same-origin"});if(f.ok)return f.arrayBuffer();throw Error(f.status+" : "+f.url)});var M=console.log.bind(console),R=console.error.bind(console);Object.assign(r,y),y=null;var N,F=!1,O,H,U,K,z,G,et;function V(){var h=N.buffer;r.HEAP8=H=new Int8Array(h),r.HEAP16=K=new Int16Array(h),r.HEAPU8=U=new Uint8Array(h),r.HEAPU16=new Uint16Array(h),r.HEAP32=z=new Int32Array(h),r.HEAPU32=G=new Uint32Array(h),r.HEAPF32=new Float32Array(h),r.HEAPF64=new Float64Array(h),r.HEAP64=et=new BigInt64Array(h),r.HEAPU64=new BigUint64Array(h)}var W=[],Q=[],Ct=[],Mt=[],pt=0,gt=null;function bt(){if(pt--,pt==0&&gt){var h=gt;gt=null,h()}}function ct(h){throw h="Aborted("+h+")",R(h),F=!0,h=new WebAssembly.RuntimeError(h+". Build with -sASSERTIONS for more info."),l(h),h}var _t=h=>h.startsWith("data:application/octet-stream;base64,"),wt=h=>h.startsWith("file://"),Pt;async function Tt(h){try{var f=await P(h);return new Uint8Array(f)}catch{}if(k)h=k(h);else throw"both async and sync fetching of the wasm failed";return h}async function ie(h,f){try{var b=await Tt(h);return await WebAssembly.instantiate(b,f)}catch(A){R(`failed to asynchronously prepare wasm: ${A}`),ct(A)}}async function He(h){var f=Pt;if(!(typeof WebAssembly.instantiateStreaming!="function"||_t(f)||wt(f)||p)&&typeof fetch=="function")try{var b=fetch(f,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(b,h)}catch(A){R(`wasm streaming compile failed: ${A}`),R("falling back to ArrayBuffer instantiation")}return ie(f,h)}class Ae{name="ExitStatus";constructor(f){this.message=`Program terminated with exit(${f})`,this.status=f}}var je=h=>{for(;0<h.length;)h.shift()(r)},_e=typeof TextDecoder<"u"?new TextDecoder:void 0,Wt=(h,f=0)=>{for(var b=f+NaN,A=f;h[A]&&!(A>=b);)++A;if(16<A-f&&h.buffer&&_e)return _e.decode(h.subarray(f,A));for(b="";f<A;){var C=h[f++];if(C&128){var I=h[f++]&63;if((C&224)==192)b+=String.fromCharCode((C&31)<<6|I);else{var $=h[f++]&63;C=(C&240)==224?(C&15)<<12|I<<6|$:(C&7)<<18|I<<12|$<<6|h[f++]&63,65536>C?b+=String.fromCharCode(C):(C-=65536,b+=String.fromCharCode(55296|C>>10,56320|C&1023))}}else b+=String.fromCharCode(C)}return b},hi=[],ue=0,fe=0;class Wi{constructor(f){this.nb=f,this.wa=f-24}Pa(f,b){G[this.wa+16>>2]=0,G[this.wa+4>>2]=f,G[this.wa+8>>2]=b}}var Ri=h=>{var f=fe;if(!f)return Un(0),0;var b=new Wi(f);G[b.wa+16>>2]=f;var A=G[b.wa+4>>2];if(!A)return Un(0),f;for(var C of h){if(C===0||C===A)break;if(oa(C,A,b.wa+16))return Un(C),f}return Un(A),f},Te=()=>{var h=z[+Nn>>2];return Nn+=4,h},hn=(h,f)=>{for(var b=0,A=h.length-1;0<=A;A--){var C=h[A];C==="."?h.splice(A,1):C===".."?(h.splice(A,1),b++):b&&(h.splice(A,1),b--)}if(f)for(;b;b--)h.unshift("..");return h},ni=h=>{var f=h.charAt(0)==="/",b=h.substr(-1)==="/";return(h=hn(h.split("/").filter(A=>!!A),!f).join("/"))||f||(h="."),h&&b&&(h+="/"),(f?"/":"")+h},qi=h=>{var f=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(h).slice(1);return h=f[0],f=f[1],!h&&!f?".":(f&&=f.substr(0,f.length-1),h+f)},Xe=h=>{if(h==="/")return"/";h=ni(h),h=h.replace(/\/$/,"");var f=h.lastIndexOf("/");return f===-1?h:h.substr(f+1)},Ye=(...h)=>ni(h.join("/")),xi=(h,f)=>ni(h+"/"+f),Sr=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return b=>crypto.getRandomValues(b);if(p)try{var h=ga;if(h.randomFillSync)return b=>h.randomFillSync(b);var f=h.randomBytes;return b=>(b.set(f(b.byteLength)),b)}catch{}ct("initRandomDevice")},si=h=>(si=Sr())(h),cn=(...h)=>{for(var f="",b=!1,A=h.length-1;-1<=A&&!b;A--){if(b=0<=A?h[A]:_.cwd(),typeof b!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!b)return"";f=b+"/"+f,b=b.charAt(0)==="/"}return f=hn(f.split("/").filter(C=>!!C),!b).join("/"),(b?"/":"")+f||"."},E=(h,f)=>{function b($){for(var q=0;q<$.length&&$[q]==="";q++);for(var it=$.length-1;0<=it&&$[it]==="";it--);return q>it?[]:$.slice(q,it-q+1)}h=cn(h).substr(1),f=cn(f).substr(1),h=b(h.split("/")),f=b(f.split("/"));for(var A=Math.min(h.length,f.length),C=A,I=0;I<A;I++)if(h[I]!==f[I]){C=I;break}for(A=[],I=C;I<h.length;I++)A.push("..");return A=A.concat(f.slice(C)),A.join("/")},g=[],m=h=>{for(var f=0,b=0;b<h.length;++b){var A=h.charCodeAt(b);127>=A?f++:2047>=A?f+=2:55296<=A&&57343>=A?(f+=4,++b):f+=3}return f},T=(h,f,b,A)=>{if(!(0<A))return 0;var C=b;A=b+A-1;for(var I=0;I<h.length;++I){var $=h.charCodeAt(I);if(55296<=$&&57343>=$){var q=h.charCodeAt(++I);$=65536+(($&1023)<<10)|q&1023}if(127>=$){if(b>=A)break;f[b++]=$}else{if(2047>=$){if(b+1>=A)break;f[b++]=192|$>>6}else{if(65535>=$){if(b+2>=A)break;f[b++]=224|$>>12}else{if(b+3>=A)break;f[b++]=240|$>>18,f[b++]=128|$>>12&63}f[b++]=128|$>>6&63}f[b++]=128|$&63}}return f[b]=0,b-C};function L(h){var f=Array(m(h)+1);return h=T(h,f,0,f.length),f.length=h,f}var B=[];function j(h,f){B[h]={input:[],output:[],Ea:f},Cr(h,vt)}var vt={open(h){var f=B[h.node.rdev];if(!f)throw new _.oa(43);h.tty=f,h.seekable=!1},close(h){h.tty.Ea.fsync(h.tty)},fsync(h){h.tty.Ea.fsync(h.tty)},read(h,f,b,A){if(!h.tty||!h.tty.Ea.pb)throw new _.oa(60);for(var C=0,I=0;I<A;I++){try{var $=h.tty.Ea.pb(h.tty)}catch{throw new _.oa(29)}if($===void 0&&C===0)throw new _.oa(6);if($==null)break;C++,f[b+I]=$}return C&&(h.node.atime=Date.now()),C},write(h,f,b,A){if(!h.tty||!h.tty.Ea.eb)throw new _.oa(60);try{for(var C=0;C<A;C++)h.tty.Ea.eb(h.tty,f[b+C])}catch{throw new _.oa(29)}return A&&(h.node.mtime=h.node.ctime=Date.now()),C}},Ot={pb(){t:{if(!g.length){var h=null;if(p){var f=io.alloc(256),b=0,A=Jt.stdin.fd;try{b=D.readSync(A,f,0,256)}catch(C){if(C.toString().includes("EOF"))b=0;else throw C}0<b&&(h=f.slice(0,b).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(h=window.prompt("Input: "),h!==null&&(h+=`
`));if(!h){h=null;break t}g=L(h)}h=g.shift()}return h},eb(h,f){f===null||f===10?(M(Wt(h.output)),h.output=[]):f!=0&&h.output.push(f)},fsync(h){h.output&&0<h.output.length&&(M(Wt(h.output)),h.output=[])},Lb(){return{Yb:25856,$b:5,Xb:191,Zb:35387,Wb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Mb(){return 0},Nb(){return[24,80]}},Rt={eb(h,f){f===null||f===10?(R(Wt(h.output)),h.output=[]):f!=0&&h.output.push(f)},fsync(h){h.output&&0<h.output.length&&(R(Wt(h.output)),h.output=[])}};function Ft(h,f){var b=h.ra?h.ra.length:0;b>=f||(f=Math.max(f,b*(1048576>b?2:1.125)>>>0),b!=0&&(f=Math.max(f,256)),b=h.ra,h.ra=new Uint8Array(f),0<h.ta&&h.ra.set(b.subarray(0,h.ta),0))}var J={Da:null,sa(){return J.createNode(null,"/",16895,0)},createNode(h,f,b,A){if((b&61440)===24576||_.isFIFO(b))throw new _.oa(63);return J.Da||(J.Da={dir:{node:{ya:J.pa.ya,ua:J.pa.ua,lookup:J.pa.lookup,Aa:J.pa.Aa,rename:J.pa.rename,unlink:J.pa.unlink,rmdir:J.pa.rmdir,readdir:J.pa.readdir,symlink:J.pa.symlink},stream:{va:J.qa.va}},file:{node:{ya:J.pa.ya,ua:J.pa.ua},stream:{va:J.qa.va,read:J.qa.read,write:J.qa.write,Oa:J.qa.Oa,Ia:J.qa.Ia,La:J.qa.La}},link:{node:{ya:J.pa.ya,ua:J.pa.ua,readlink:J.pa.readlink},stream:{}},jb:{node:{ya:J.pa.ya,ua:J.pa.ua},stream:_.Db}}),b=_.createNode(h,f,b,A),le(b.mode)?(b.pa=J.Da.dir.node,b.qa=J.Da.dir.stream,b.ra={}):_.isFile(b.mode)?(b.pa=J.Da.file.node,b.qa=J.Da.file.stream,b.ta=0,b.ra=null):(b.mode&61440)===40960?(b.pa=J.Da.link.node,b.qa=J.Da.link.stream):(b.mode&61440)===8192&&(b.pa=J.Da.jb.node,b.qa=J.Da.jb.stream),b.atime=b.mtime=b.ctime=Date.now(),h&&(h.ra[f]=b,h.atime=h.mtime=h.ctime=b.atime),b},hc(h){return h.ra?h.ra.subarray?h.ra.subarray(0,h.ta):new Uint8Array(h.ra):new Uint8Array(0)},pa:{ya(h){var f={};return f.dev=(h.mode&61440)===8192?h.id:1,f.ino=h.id,f.mode=h.mode,f.nlink=1,f.uid=0,f.gid=0,f.rdev=h.rdev,le(h.mode)?f.size=4096:_.isFile(h.mode)?f.size=h.ta:(h.mode&61440)===40960?f.size=h.link.length:f.size=0,f.atime=new Date(h.atime),f.mtime=new Date(h.mtime),f.ctime=new Date(h.ctime),f.Fa=4096,f.blocks=Math.ceil(f.size/f.Fa),f},ua(h,f){for(var b of["mode","atime","mtime","ctime"])f[b]&&(h[b]=f[b]);f.size!==void 0&&(f=f.size,h.ta!=f&&(f==0?(h.ra=null,h.ta=0):(b=h.ra,h.ra=new Uint8Array(f),b&&h.ra.set(b.subarray(0,Math.min(f,h.ta))),h.ta=f)))},lookup(){throw J.mb},Aa(h,f,b,A){return J.createNode(h,f,b,A)},rename(h,f,b){try{var A=Ci(f,b)}catch{}if(A){if(le(h.mode))for(var C in A.ra)throw new _.oa(55);On(A)}delete h.parent.ra[h.name],f.ra[b]=h,h.name=b,f.ctime=f.mtime=h.parent.ctime=h.parent.mtime=Date.now()},unlink(h,f){delete h.ra[f],h.ctime=h.mtime=Date.now()},rmdir(h,f){var b=Ci(h,f),A;for(A in b.ra)throw new _.oa(55);delete h.ra[f],h.ctime=h.mtime=Date.now()},readdir(h){return[".","..",...Object.keys(h.ra)]},symlink(h,f,b){return h=J.createNode(h,f,41471,0),h.link=b,h},readlink(h){if((h.mode&61440)!==40960)throw new _.oa(28);return h.link}},qa:{read(h,f,b,A,C){var I=h.node.ra;if(C>=h.node.ta)return 0;if(h=Math.min(h.node.ta-C,A),8<h&&I.subarray)f.set(I.subarray(C,C+h),b);else for(A=0;A<h;A++)f[b+A]=I[C+A];return h},write(h,f,b,A,C,I){if(f.buffer===H.buffer&&(I=!1),!A)return 0;if(h=h.node,h.mtime=h.ctime=Date.now(),f.subarray&&(!h.ra||h.ra.subarray)){if(I)return h.ra=f.subarray(b,b+A),h.ta=A;if(h.ta===0&&C===0)return h.ra=f.slice(b,b+A),h.ta=A;if(C+A<=h.ta)return h.ra.set(f.subarray(b,b+A),C),A}if(Ft(h,C+A),h.ra.subarray&&f.subarray)h.ra.set(f.subarray(b,b+A),C);else for(I=0;I<A;I++)h.ra[C+I]=f[b+I];return h.ta=Math.max(h.ta,C+A),A},va(h,f,b){if(b===1?f+=h.position:b===2&&_.isFile(h.node.mode)&&(f+=h.node.ta),0>f)throw new _.oa(28);return f},Oa(h,f,b){Ft(h.node,f+b),h.node.ta=Math.max(h.node.ta,f+b)},Ia(h,f,b,A,C){if(!_.isFile(h.node.mode))throw new _.oa(43);if(h=h.node.ra,C&2||!h||h.buffer!==H.buffer){if(A=!0,ct(),C=void 0,!C)throw new _.oa(48);h&&((0<b||b+f<h.length)&&(h.subarray?h=h.subarray(b,b+f):h=Array.prototype.slice.call(h,b,b+f)),H.set(h,C))}else A=!1,C=h.byteOffset;return{wa:C,Ab:A}},La(h,f,b,A){return J.qa.write(h,f,0,A,b,!1),0}}},Bh=async h=>(h=await P(h),new Uint8Array(h)),Uh=[],$h=(h,f,b,A)=>{typeof Browser<"u"&&Browser.Pa();var C=!1;return Uh.forEach(I=>{!C&&I.canHandle(f)&&(I.handle(h,f,b,A),C=!0)}),C},xr=(h,f)=>{var b=0;return h&&(b|=365),f&&(b|=146),b},Hh={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135};function Ee(h){try{return h()}catch(f){throw f.code?f.code==="UNKNOWN"?new _.oa(28):new _.oa(Hh[f.code]):f}}function qo(h){return Ee(()=>{var f=D.lstatSync(h).mode;return pe.Ta&&(f|=(f&292)>>2),f})}function Ke(h){for(var f=[];h.parent!==h;)f.push(h.name),h=h.parent;return f.push(h.sa.Ma.root),f.reverse(),Ye(...f)}var pe={Ta:!1,ib(){pe.Ta=!!Jt.platform.match(/^win/);var h=Jt.binding("constants");h.fs&&(h=h.fs),pe.ob={1024:h.O_APPEND,64:h.O_CREAT,128:h.O_EXCL,256:h.O_NOCTTY,0:h.O_RDONLY,2:h.O_RDWR,4096:h.O_SYNC,512:h.O_TRUNC,1:h.O_WRONLY,131072:h.O_NOFOLLOW}},sa(h){return pe.createNode(null,"/",qo(h.Ma.root),0)},createNode(h,f,b){if(!le(b)&&!_.isFile(b)&&(b&61440)!==40960)throw new _.oa(28);return h=_.createNode(h,f,b),h.pa=pe.pa,h.qa=pe.qa,h},pa:{ya(h){var f=Ke(h),b;return Ee(()=>b=D.lstatSync(f)),pe.Ta&&(b.Fa||(b.Fa=4096),b.blocks||(b.blocks=(b.size+b.Fa-1)/b.Fa|0),b.mode|=(b.mode&292)>>2),{dev:b.dev,ino:b.ino,mode:b.mode,nlink:b.nlink,uid:b.uid,gid:b.gid,rdev:b.rdev,size:b.size,atime:b.atime,mtime:b.mtime,ctime:b.ctime,Fa:b.Fa,blocks:b.blocks}},ua(h,f){var b=Ke(h);Ee(()=>{if(f.mode!==void 0){var A=f.mode;pe.Ta&&(A&=384),D.chmodSync(b,A),h.mode=f.mode}f.size!==void 0&&D.truncateSync(b,f.size)})},lookup(h,f){var b=Ke(h);return b=ni(b+"/"+f),b=qo(b),pe.createNode(h,f,b)},Aa(h,f,b,A){var C=pe.createNode(h,f,b,A),I=Ke(C);return Ee(()=>{le(C.mode)?D.mkdirSync(I,C.mode):D.writeFileSync(I,"",{mode:C.mode})}),C},rename(h,f,b){var A=Ke(h),C=xi(Ke(f),b);try{_.unlink(C)}catch{}Ee(()=>D.renameSync(A,C)),h.name=b},unlink(h,f){var b=xi(Ke(h),f);Ee(()=>D.unlinkSync(b))},rmdir(h,f){var b=xi(Ke(h),f);Ee(()=>D.rmdirSync(b))},readdir(h){var f=Ke(h);return Ee(()=>D.readdirSync(f))},symlink(h,f,b){var A=xi(Ke(h),f);Ee(()=>D.symlinkSync(b,A))},readlink(h){var f=Ke(h);return Ee(()=>D.readlinkSync(f))},hb(h){var f=Ee(()=>D.mc(h));return f.Ib=f.Bb,f}},qa:{open(h){var f=Ke(h.node);Ee(()=>{if(_.isFile(h.node.mode)){h.Ka.tb=1;var b=D,A=b.openSync,C=h.flags;C&=-2721793;var I=0,$;for($ in pe.ob)C&$&&(I|=pe.ob[$],C^=$);if(C)throw new _.oa(28);h.Ra=A.call(b,f,I)}})},close(h){Ee(()=>{_.isFile(h.node.mode)&&h.Ra&&--h.Ka.tb===0&&D.closeSync(h.Ra)})},Fb(h){h.Ka.tb++},read(h,f,b,A,C){return A===0?0:Ee(()=>D.readSync(h.Ra,new Int8Array(f.buffer,b,A),0,A,C))},write(h,f,b,A,C){return Ee(()=>D.writeSync(h.Ra,new Int8Array(f.buffer,b,A),0,A,C))},va(h,f,b){var A=f;if(b===1?A+=h.position:b===2&&_.isFile(h.node.mode)&&Ee(()=>{A+=D.fstatSync(h.Ra).size}),0>A)throw new _.oa(28);return A},Ia(h,f,b){if(!_.isFile(h.node.mode))throw new _.oa(43);return ct(),pe.qa.read(h,H,void 0,f,b),{wa:void 0,Ab:!0}},La(h,f,b,A){return pe.qa.write(h,f,0,A,b,!1),0}}},ne={Wa:16895,Na:33279,gb:null,sa(h){function f(I){I=I.split("/");for(var $=A,q=0;q<I.length-1;q++){var it=I.slice(0,q+1).join("/");let st,mt;(st=C)[mt=it]||(st[mt]=ne.createNode($,I[q],ne.Wa,0)),$=C[it]}return $}function b(I){return I=I.split("/"),I[I.length-1]}u||ct(),ne.gb??(ne.gb=new FileReaderSync);var A=ne.createNode(null,"/",ne.Wa,0),C={};return Array.prototype.forEach.call(h.Ma.files||[],function(I){ne.createNode(f(I.name),b(I.name),ne.Na,0,I,I.lastModifiedDate)}),(h.Ma.blobs||[]).forEach(I=>{ne.createNode(f(I.name),b(I.name),ne.Na,0,I.data)}),(h.Ma.packages||[]).forEach(I=>{I.metadata.files.forEach($=>{var q=$.filename.substr(1);ne.createNode(f(q),b(q),ne.Na,0,I.blob.slice($.start,$.end))})}),A},createNode(h,f,b,A,C,I){return A=_.createNode(h,f,b),A.mode=b,A.pa=ne.pa,A.qa=ne.qa,A.atime=A.mtime=A.ctime=(I||new Date).getTime(),ne.Na!==ne.Wa||ct(),b===ne.Na?(A.size=C.size,A.ra=C):(A.size=4096,A.ra={}),h&&(h.ra[f]=A),A},pa:{ya(h){return{dev:1,ino:h.id,mode:h.mode,nlink:1,uid:0,gid:0,rdev:0,size:h.size,atime:new Date(h.atime),mtime:new Date(h.mtime),ctime:new Date(h.ctime),Fa:4096,blocks:Math.ceil(h.size/4096)}},ua(h,f){for(const b of["mode","atime","mtime","ctime"])f[b]&&(h[b]=f[b])},lookup(){throw new _.oa(44)},Aa(){throw new _.oa(63)},rename(){throw new _.oa(63)},unlink(){throw new _.oa(63)},rmdir(){throw new _.oa(63)},readdir(h){var f=[".",".."],b;for(b of Object.keys(h.ra))f.push(b);return f},symlink(){throw new _.oa(63)}},qa:{read(h,f,b,A,C){return C>=h.node.size?0:(h=h.node.ra.slice(C,C+A),A=ne.gb.readAsArrayBuffer(h),f.set(new Uint8Array(A),b),h.size)},write(){throw new _.oa(29)},va(h,f,b){if(b===1?f+=h.position:b===2&&_.isFile(h.node.mode)&&(f+=h.node.size),0>f)throw new _.oa(28);return f}}};function Cr(h,f){_.lb[h]={qa:f}}function le(h){return(h&61440)===16384}function Ci(h,f){var b=le(h.mode)?(b=Xi(h,"x"))?b:h.pa.lookup?0:2:54;if(b)throw new _.oa(b);for(b=_.Ca[_r(h.id,f)];b;b=b.Ja){var A=b.name;if(b.parent.id===h.id&&A===f)return b}return _.lookup(h,f)}function On(h){var f=_r(h.parent.id,h.name);if(_.Ca[f]===h)_.Ca[f]=h.Ja;else for(f=_.Ca[f];f;){if(f.Ja===h){f.Ja=h.Ja;break}f=f.Ja}}function Zt(h,f={}){if(!h)return{path:"",node:null};f.Sa??(f.Sa=!0),h.charAt(0)==="/"||(h=_.cwd()+"/"+h);var b=0;t:for(;40>b;b++){h=h.split("/").filter(q=>!!q&&q!==".");for(var A=_.root,C="/",I=0;I<h.length;I++){var $=I===h.length-1;if($&&f.parent)break;if(h[I]==="..")C=qi(C),A=A.parent;else{C=ni(C+"/"+h[I]);try{A=Ci(A,h[I])}catch(q){if(q?.xa===44&&$&&f.Qb)return{path:C};throw q}if(!A.Ba||$&&!f.Sa||(A=A.Ba.root),(A.mode&61440)===40960&&(!$||f.za)){if(!A.pa.readlink)throw new _.oa(52);A=A.pa.readlink(A),A.charAt(0)==="/"||(A=qi(C)+"/"+A),h=A+"/"+h.slice(I+1).join("/");continue t}}}return{path:C,node:A}}throw new _.oa(32)}function dn(h){for(var f;;){if(_.qb(h))return h=h.sa.rb,f?h[h.length-1]!=="/"?`${h}/${f}`:h+f:h;f=f?`${h.name}/${f}`:h.name,h=h.parent}}function _r(h,f){for(var b=0,A=0;A<f.length;A++)b=(b<<5)-b+f.charCodeAt(A)|0;return(h+b>>>0)%_.Ca.length}function Xo(h){var f=_r(h.parent.id,h.name);h.Ja=_.Ca[f],_.Ca[f]=h}function Yo(h){var f=["r","w","rw"][h&3];return h&512&&(f+="w"),f}function Xi(h,f){if(_.Ya)return 0;if(!f.includes("r")||h.mode&292){if(f.includes("w")&&!(h.mode&146)||f.includes("x")&&!(h.mode&73))return 2}else return 2;return 0}function Tr(h,f){if(!le(h.mode))return 54;try{return Ci(h,f),20}catch{}return Xi(h,"wx")}function Ss(h,f,b){try{var A=Ci(h,f)}catch(C){return C.xa}if(h=Xi(h,"wx"))return h;if(b){if(!le(A.mode))return 54;if(_.qb(A)||dn(A)===_.cwd())return 10}else if(le(A.mode))return 31;return 0}function ri(h){if(h=_.Kb(h),!h)throw new _.oa(8);return h}function Ko(h,f=-1){if(h=Object.assign(new _.yb,h),f==-1)t:{for(f=0;f<=_.zb;f++)if(!_.streams[f])break t;throw new _.oa(33)}return h.fd=f,_.streams[f]=h}function jh(h,f=-1){return h=Ko(h,f),h.qa?.Fb?.(h),h}function Jo(h){var f=[];for(h=[h];h.length;){var b=h.pop();f.push(b),h.push(...b.Qa)}return f}function xs(h,f,b){return typeof b>"u"&&(b=f,f=438),_.Aa(h,f|8192,b)}function zh(){_.mkdir("/dev"),Cr(_.Ha(1,3),{read:()=>0,write:(A,C,I,$)=>$,va:()=>0}),xs("/dev/null",_.Ha(1,3)),j(_.Ha(5,0),Ot),j(_.Ha(6,0),Rt),xs("/dev/tty",_.Ha(5,0)),xs("/dev/tty1",_.Ha(6,0));var h=new Uint8Array(1024),f=0,b=()=>(f===0&&(f=si(h).byteLength),h[--f]);_.Ga("/dev","random",b),_.Ga("/dev","urandom",b),_.mkdir("/dev/shm"),_.mkdir("/dev/shm/tmp")}function Gh(){_.mkdir("/proc");var h=_.mkdir("/proc/self");_.mkdir("/proc/self/fd"),_.sa({sa(){var f=_.createNode(h,"fd",16895,73);return f.qa={va:J.qa.va},f.pa={lookup(b,A){b=+A;var C=ri(b);return b={parent:null,sa:{rb:"fake"},pa:{readlink:()=>C.path},id:b+1},b.parent=b},readdir(){return Array.from(_.streams.entries()).filter(([,b])=>b).map(([b])=>b.toString())}},f}},{},"/proc/self/fd")}function Vh(h,f,b,A){return h=typeof h=="string"?h:dn(h),f=ni(h+"/"+f),_.create(f,xr(b,A))}function Pr(h){if(!(h.Ob||h.Pb||h.link||h.ra)){if(typeof XMLHttpRequest<"u")throw Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{h.ra=k(h.url),h.ta=h.ra.length}catch{throw new _.oa(29)}}}var _={root:null,Qa:[],lb:{},streams:[],bb:1,Ca:null,kb:"/",Za:!1,Ya:!0,oa:class{name="ErrnoError";constructor(h){this.xa=h}},Hb:null,Va:0,yb:class{Ka={};node=null;get object(){return this.node}set object(h){this.node=h}get flags(){return this.Ka.flags}set flags(h){this.Ka.flags=h}get position(){return this.Ka.position}set position(h){this.Ka.position=h}},xb:class{pa={};qa={};Ba=null;constructor(h,f,b,A){h||=this,this.parent=h,this.sa=h.sa,this.id=_.bb++,this.name=f,this.mode=b,this.rdev=A,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&365)===365}set read(h){h?this.mode|=365:this.mode&=-366}get write(){return(this.mode&146)===146}set write(h){h?this.mode|=146:this.mode&=-147}get Pb(){return le(this.mode)}get Ob(){return(this.mode&61440)===8192}},createNode(h,f,b,A){return h=new _.xb(h,f,b,A),Xo(h),h},qb(h){return h===h.parent},isFile(h){return(h&61440)===32768},isFIFO(h){return(h&61440)===4096},isSocket(h){return(h&49152)===49152},zb:4096,Kb:h=>_.streams[h],Db:{open(h){h.qa=_.Jb(h.node.rdev).qa,h.qa.open?.(h)},va(){throw new _.oa(70)}},ab:h=>h>>8,ic:h=>h&255,Ha:(h,f)=>h<<8|f,Jb:h=>_.lb[h],vb(h,f){function b($){return _.Va--,f($)}function A($){if($){if(!A.Gb)return A.Gb=!0,b($)}else++I>=C.length&&b(null)}typeof h=="function"&&(f=h,h=!1),_.Va++,1<_.Va&&R(`warning: ${_.Va} FS.syncfs operations in flight at once, probably just doing extra work`);var C=Jo(_.root.sa),I=0;C.forEach($=>{if(!$.type.vb)return A(null);$.type.vb($,h,A)})},sa(h,f,b){var A=b==="/";if(A&&_.root)throw new _.oa(10);if(!A&&b){var C=Zt(b,{Sa:!1});if(b=C.path,C=C.node,C.Ba)throw new _.oa(10);if(!le(C.mode))throw new _.oa(54)}return f={type:h,Ma:f,rb:b,Qa:[]},h=h.sa(f),h.sa=f,f.root=h,A?_.root=h:C&&(C.Ba=f,C.sa&&C.sa.Qa.push(f)),h},Tb(h){if(h=Zt(h,{Sa:!1}),!h.node.Ba)throw new _.oa(28);h=h.node;var f=h.Ba,b=Jo(f);Object.keys(_.Ca).forEach(A=>{for(A=_.Ca[A];A;){var C=A.Ja;b.includes(A.sa)&&On(A),A=C}}),h.Ba=null,h.sa.Qa.splice(h.sa.Qa.indexOf(f),1)},lookup(h,f){return h.pa.lookup(h,f)},Aa(h,f,b){var A=Zt(h,{parent:!0}).node;if(h=Xe(h),!h||h==="."||h==="..")throw new _.oa(28);var C=Tr(A,h);if(C)throw new _.oa(C);if(!A.pa.Aa)throw new _.oa(63);return A.pa.Aa(A,h,f,b)},hb(h){var f={Bb:4096,Ib:4096,blocks:1e6,Vb:5e5,Ub:5e5,files:_.bb,cc:_.bb-1,ec:42,flags:2,kc:255};return h=Zt(h,{za:!0}).node,h?.pa.hb&&Object.assign(f,h.pa.hb(h.sa.Ma.root)),f},create(h,f=438){return _.Aa(h,f&4095|32768,0)},mkdir(h,f=511){return _.Aa(h,f&1023|16384,0)},jc(h,f){h=h.split("/");for(var b="",A=0;A<h.length;++A)if(h[A]){b+="/"+h[A];try{_.mkdir(b,f)}catch(C){if(C.xa!=20)throw C}}},symlink(h,f){if(!cn(h))throw new _.oa(44);var b=Zt(f,{parent:!0}).node;if(!b)throw new _.oa(44);f=Xe(f);var A=Tr(b,f);if(A)throw new _.oa(A);if(!b.pa.symlink)throw new _.oa(63);return b.pa.symlink(b,f,h)},rename(h,f){var b=qi(h),A=qi(f),C=Xe(h),I=Xe(f),$=Zt(h,{parent:!0}),q=$.node;if($=Zt(f,{parent:!0}),$=$.node,!q||!$)throw new _.oa(44);if(q.sa!==$.sa)throw new _.oa(75);var it=Ci(q,C);if(h=E(h,A),h.charAt(0)!==".")throw new _.oa(28);if(h=E(f,b),h.charAt(0)!==".")throw new _.oa(55);try{var st=Ci($,I)}catch{}if(it!==st){if(f=le(it.mode),C=Ss(q,C,f))throw new _.oa(C);if(C=st?Ss($,I,f):Tr($,I))throw new _.oa(C);if(!q.pa.rename)throw new _.oa(63);if(it.Ba||st&&st.Ba)throw new _.oa(10);if($!==q&&(C=Xi(q,"w")))throw new _.oa(C);On(it);try{q.pa.rename(it,$,I),it.parent=$}catch(mt){throw mt}finally{Xo(it)}}},rmdir(h){var f=Zt(h,{parent:!0}).node;h=Xe(h);var b=Ci(f,h),A=Ss(f,h,!0);if(A)throw new _.oa(A);if(!f.pa.rmdir)throw new _.oa(63);if(b.Ba)throw new _.oa(10);f.pa.rmdir(f,h),On(b)},readdir(h){if(h=Zt(h,{za:!0}).node,!h.pa.readdir)throw new _.oa(54);return h.pa.readdir(h)},unlink(h){var f=Zt(h,{parent:!0}).node;if(!f)throw new _.oa(44);h=Xe(h);var b=Ci(f,h),A=Ss(f,h,!1);if(A)throw new _.oa(A);if(!f.pa.unlink)throw new _.oa(63);if(b.Ba)throw new _.oa(10);f.pa.unlink(f,h),On(b)},readlink(h){if(h=Zt(h).node,!h)throw new _.oa(44);if(!h.pa.readlink)throw new _.oa(28);return h.pa.readlink(h)},stat(h,f){if(h=Zt(h,{za:!f}).node,!h)throw new _.oa(44);if(!h.pa.ya)throw new _.oa(63);return h.pa.ya(h)},lstat(h){return _.stat(h,!0)},chmod(h,f,b){if(h=typeof h=="string"?Zt(h,{za:!b}).node:h,!h.pa.ua)throw new _.oa(63);h.pa.ua(h,{mode:f&4095|h.mode&-4096,ctime:Date.now()})},lchmod(h,f){_.chmod(h,f,!0)},fchmod(h,f){h=ri(h),_.chmod(h.node,f)},chown(h,f,b,A){if(h=typeof h=="string"?Zt(h,{za:!A}).node:h,!h.pa.ua)throw new _.oa(63);h.pa.ua(h,{timestamp:Date.now()})},lchown(h,f,b){_.chown(h,f,b,!0)},fchown(h,f,b){h=ri(h),_.chown(h.node,f,b)},truncate(h,f){if(0>f)throw new _.oa(28);if(h=typeof h=="string"?Zt(h,{za:!0}).node:h,!h.pa.ua)throw new _.oa(63);if(le(h.mode))throw new _.oa(31);if(!_.isFile(h.mode))throw new _.oa(28);var b=Xi(h,"w");if(b)throw new _.oa(b);h.pa.ua(h,{size:f,timestamp:Date.now()})},fc(h,f){if(h=ri(h),(h.flags&2097155)===0)throw new _.oa(28);_.truncate(h.node,f)},oc(h,f,b){h=Zt(h,{za:!0}).node,h.pa.ua(h,{atime:f,mtime:b})},open(h,f,b=438){if(h==="")throw new _.oa(44);if(typeof f=="string"){var A={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[f];if(typeof A>"u")throw Error(`Unknown file open mode: ${f}`);f=A}b=f&64?b&4095|32768:0,typeof h=="object"?A=h:(h=Zt(h,{za:!(f&131072),Qb:!0}),A=h.node,h=h.path);var C=!1;if(f&64)if(A){if(f&128)throw new _.oa(20)}else A=_.Aa(h,b,0),C=!0;if(!A)throw new _.oa(44);if((A.mode&61440)===8192&&(f&=-513),f&65536&&!le(A.mode))throw new _.oa(54);if(!C&&(b=A?(A.mode&61440)===40960?32:le(A.mode)&&(Yo(f)!=="r"||f&512)?31:Xi(A,Yo(f)):44))throw new _.oa(b);return f&512&&!C&&_.truncate(A,0),f&=-131713,f=Ko({node:A,path:dn(A),flags:f,seekable:!0,position:0,qa:A.qa,Sb:[],error:!1}),f.qa.open&&f.qa.open(f),f},close(h){if(h.fd===null)throw new _.oa(8);h.Xa&&(h.Xa=null);try{h.qa.close&&h.qa.close(h)}catch(f){throw f}finally{_.streams[h.fd]=null}h.fd=null},va(h,f,b){if(h.fd===null)throw new _.oa(8);if(!h.seekable||!h.qa.va)throw new _.oa(70);if(b!=0&&b!=1&&b!=2)throw new _.oa(28);return h.position=h.qa.va(h,f,b),h.Sb=[],h.position},read(h,f,b,A,C){if(0>A||0>C)throw new _.oa(28);if(h.fd===null)throw new _.oa(8);if((h.flags&2097155)===1)throw new _.oa(8);if(le(h.node.mode))throw new _.oa(31);if(!h.qa.read)throw new _.oa(28);var I=typeof C<"u";if(!I)C=h.position;else if(!h.seekable)throw new _.oa(70);return f=h.qa.read(h,f,b,A,C),I||(h.position+=f),f},write(h,f,b,A,C,I){if(0>A||0>C)throw new _.oa(28);if(h.fd===null)throw new _.oa(8);if((h.flags&2097155)===0)throw new _.oa(8);if(le(h.node.mode))throw new _.oa(31);if(!h.qa.write)throw new _.oa(28);h.seekable&&h.flags&1024&&_.va(h,0,2);var $=typeof C<"u";if(!$)C=h.position;else if(!h.seekable)throw new _.oa(70);return f=h.qa.write(h,f,b,A,C,I),$||(h.position+=f),f},Oa(h,f,b){if(h.fd===null)throw new _.oa(8);if(0>f||0>=b)throw new _.oa(28);if((h.flags&2097155)===0)throw new _.oa(8);if(!_.isFile(h.node.mode)&&!le(h.node.mode))throw new _.oa(43);if(!h.qa.Oa)throw new _.oa(138);h.qa.Oa(h,f,b)},Ia(h,f,b,A,C){if((A&2)!==0&&(C&2)===0&&(h.flags&2097155)!==2)throw new _.oa(2);if((h.flags&2097155)===1)throw new _.oa(2);if(!h.qa.Ia)throw new _.oa(43);if(!f)throw new _.oa(28);return h.qa.Ia(h,f,b,A,C)},La(h,f,b,A,C){return h.qa.La?h.qa.La(h,f,b,A,C):0},$a(h,f,b){if(!h.qa.$a)throw new _.oa(59);return h.qa.$a(h,f,b)},readFile(h,f={}){if(f.flags=f.flags||0,f.encoding=f.encoding||"binary",f.encoding!=="utf8"&&f.encoding!=="binary")throw Error(`Invalid encoding type "${f.encoding}"`);var b,A=_.open(h,f.flags);h=_.stat(h).size;var C=new Uint8Array(h);return _.read(A,C,0,h,0),f.encoding==="utf8"?b=Wt(C):f.encoding==="binary"&&(b=C),_.close(A),b},writeFile(h,f,b={}){if(b.flags=b.flags||577,h=_.open(h,b.flags,b.mode),typeof f=="string"){var A=new Uint8Array(m(f)+1);f=T(f,A,0,A.length),_.write(h,A,0,f,void 0,b.Cb)}else if(ArrayBuffer.isView(f))_.write(h,f,0,f.byteLength,void 0,b.Cb);else throw Error("Unsupported data type");_.close(h)},cwd:()=>_.kb,chdir(h){if(h=Zt(h,{za:!0}),h.node===null)throw new _.oa(44);if(!le(h.node.mode))throw new _.oa(54);var f=Xi(h.node,"x");if(f)throw new _.oa(f);_.kb=h.path},ib(){_.Ca=Array(4096),_.sa(J,{},"/"),_.mkdir("/tmp"),_.mkdir("/home"),_.mkdir("/home/web_user"),zh(),Gh(),_.Hb={MEMFS:J,NODEFS:pe,WORKERFS:ne}},Pa(h,f,b){_.Za=!0,h?_.Ga("/dev","stdin",h):_.symlink("/dev/tty","/dev/stdin"),f?_.Ga("/dev","stdout",null,f):_.symlink("/dev/tty","/dev/stdout"),b?_.Ga("/dev","stderr",null,b):_.symlink("/dev/tty1","/dev/stderr"),_.open("/dev/stdin",0),_.open("/dev/stdout",1),_.open("/dev/stderr",1)},lc(){_.Za=!1;for(var h=0;h<_.streams.length;h++){var f=_.streams[h];f&&_.close(f)}},dc(h,f){try{var b=Zt(h,{za:!f});h=b.path}catch{}var A=!1,C=null;try{b=Zt(h,{parent:!0}),Xe(h),b=Zt(h,{za:!f}),A=!0,C=b.node}catch{}return A?C:null},ac(h,f){for(h=typeof h=="string"?h:dn(h),f=f.split("/").reverse();f.length;){var b=f.pop();if(b){var A=ni(h+"/"+b);try{_.mkdir(A)}catch{}h=A}}return A},Ga(h,f,b,A){h=xi(typeof h=="string"?h:dn(h),f),f=xr(!!b,!!A);var C;return(C=_.Ga).ab??(C.ab=64),C=_.Ha(_.Ga.ab++,0),Cr(C,{open(I){I.seekable=!1},close(){A?.buffer?.length&&A(10)},read(I,$,q,it){for(var st=0,mt=0;mt<it;mt++){try{var at=b()}catch{throw new _.oa(29)}if(at===void 0&&st===0)throw new _.oa(6);if(at==null)break;st++,$[q+mt]=at}return st&&(I.node.atime=Date.now()),st},write(I,$,q,it){for(var st=0;st<it;st++)try{A($[q+st])}catch{throw new _.oa(29)}return it&&(I.node.mtime=I.node.ctime=Date.now()),st}}),xs(h,f,C)},Eb(h,f,b,A,C){class I{fb=!1;Ua=[];cb=void 0;ub=0;sb=0;get(at){if(!(at>this.length-1||0>at)){var Dt=at%this.chunkSize;return this.cb(at/this.chunkSize|0)[Dt]}}Rb(at){this.cb=at}wb(){var at=new XMLHttpRequest;if(at.open("HEAD",b,!1),at.send(null),!(200<=at.status&&300>at.status||at.status===304))throw Error("Couldn't load "+b+". Status: "+at.status);var Dt=Number(at.getResponseHeader("Content-length")),he,ge=(he=at.getResponseHeader("Accept-Ranges"))&&he==="bytes";at=(he=at.getResponseHeader("Content-Encoding"))&&he==="gzip";var kt=1048576;ge||(kt=Dt);var Re=this;Re.Rb(Se=>{var ci=Se*kt,Fi=(Se+1)*kt-1;if(Fi=Math.min(Fi,Dt-1),typeof Re.Ua[Se]>"u"){var yc=Re.Ua;if(ci>Fi)throw Error("invalid range ("+ci+", "+Fi+") or no bytes requested!");if(Fi>Dt-1)throw Error("only "+Dt+" bytes available! programmer error!");var ze=new XMLHttpRequest;if(ze.open("GET",b,!1),Dt!==kt&&ze.setRequestHeader("Range","bytes="+ci+"-"+Fi),ze.responseType="arraybuffer",ze.overrideMimeType&&ze.overrideMimeType("text/plain; charset=x-user-defined"),ze.send(null),!(200<=ze.status&&300>ze.status||ze.status===304))throw Error("Couldn't load "+b+". Status: "+ze.status);ci=ze.response!==void 0?new Uint8Array(ze.response||[]):L(ze.responseText||""),yc[Se]=ci}if(typeof Re.Ua[Se]>"u")throw Error("doXHR failed!");return Re.Ua[Se]}),(at||!Dt)&&(kt=Dt=1,kt=Dt=this.cb(0).length,M("LazyFiles on gzip forces download of the whole file when length is accessed")),this.ub=Dt,this.sb=kt,this.fb=!0}get length(){return this.fb||this.wb(),this.ub}get chunkSize(){return this.fb||this.wb(),this.sb}}if(typeof XMLHttpRequest<"u"){if(!u)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var $=new I,q=void 0}else q=b,$=void 0;var it=Vh(h,f,A,C);$?it.ra=$:q&&(it.ra=null,it.url=q),Object.defineProperties(it,{ta:{get:function(){return this.ra.length}}});var st={};return Object.keys(it.qa).forEach(mt=>{var at=it.qa[mt];st[mt]=(...Dt)=>(Pr(it),at(...Dt))}),st.read=(mt,at,Dt,he,ge)=>{if(Pr(it),mt=mt.node.ra,ge>=mt.length)at=0;else{if(he=Math.min(mt.length-ge,he),mt.slice)for(var kt=0;kt<he;kt++)at[Dt+kt]=mt[ge+kt];else for(kt=0;kt<he;kt++)at[Dt+kt]=mt.get(ge+kt);at=he}return at},st.Ia=()=>{throw Pr(it),ct(),new _.oa(48)},it.qa=st,it}};function Cs(h,f){if(f.charAt(0)==="/")return f;if(h=h===-100?_.cwd():ri(h).path,f.length==0)throw new _.oa(44);return h+"/"+f}var Nn=void 0,Wh=[0,31,60,91,121,152,182,213,244,274,305,335],qh=[0,31,59,90,120,151,181,212,243,273,304,334],Bn={},Qo=h=>{if(h instanceof Ae||h=="unwind")return O;x(1,h)},Zo=h=>{O=h,x(h,new Ae(h))},ta=h=>{O=h,Zo(h)},Xh=h=>{if(!F)try{h()}catch(f){Qo(f)}},_s={},ea=()=>{if(!kr){var h={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:w||"./this.program"},f;for(f in _s)_s[f]===void 0?delete h[f]:h[f]=_s[f];var b=[];for(f in h)b.push(`${f}=${h[f]}`);kr=b}return kr},kr,qt;_.bc=(h,f,b,A,C,I,$,q,it,st)=>{function mt(Dt){function he(ge){if(st?.(),!q){var kt=h,Re=f;if(kt&&(kt=typeof kt=="string"?kt:dn(kt),Re=f?ni(kt+"/"+f):kt),kt=xr(A,C),Re=_.create(Re,kt),ge){if(typeof ge=="string"){for(var Se=Array(ge.length),ci=0,Fi=ge.length;ci<Fi;++ci)Se[ci]=ge.charCodeAt(ci);ge=Se}_.chmod(Re,kt|146),Se=_.open(Re,577),_.write(Se,ge,0,ge.length,0,it),_.close(Se),_.chmod(Re,kt)}}I?.(),bt()}$h(Dt,at,he,()=>{$?.(),bt()})||he(Dt)}var at=f?cn(ni(h+"/"+f)):h;pt++,typeof b=="string"?Bh(b).then(mt,$):mt(b)},_.ib(),J.mb=new _.oa(44),J.mb.stack="<generic error, no stack>",p&&pe.ib();var Yh={o:(h,f,b,A)=>ct(`Assertion failed: ${h?Wt(U,h):""}, at: `+[f?f?Wt(U,f):"":"unknown filename",b,A?A?Wt(U,A):"":"unknown function"]),n:h=>{var f=new Wi(h);return H[f.wa+12]==0&&(H[f.wa+12]=1,ue--),H[f.wa+13]=0,hi.push(f),ra(h),aa(h)},q:()=>{jt(0,0);var h=hi.pop();sa(h.nb),fe=0},d:()=>Ri([]),j:h=>Ri([h]),K:(h,f)=>Ri([h,f]),B:()=>{var h=hi.pop();h||ct("no exception to throw");var f=h.nb;throw H[h.wa+13]==0&&(hi.push(h),H[h.wa+13]=1,H[h.wa+12]=0,ue++),fe=f,fe},a:(h,f,b)=>{throw new Wi(h).Pa(f,b),fe=h,ue++,fe},R:()=>ue,g:h=>{throw fe||=h,fe},w:function(h,f,b){Nn=b;try{var A=ri(h);switch(f){case 0:var C=Te();if(0>C)break;for(;_.streams[C];)C++;return jh(A,C).fd;case 1:case 2:return 0;case 3:return A.flags;case 4:return C=Te(),A.flags|=C,0;case 12:return C=Te(),K[C+0>>1]=2,0;case 13:case 14:return 0}return-28}catch(I){if(typeof _>"u"||I.name!=="ErrnoError")throw I;return-I.xa}},D:function(h,f,b){Nn=b;try{var A=ri(h);switch(f){case 21509:return A.tty?0:-59;case 21505:if(!A.tty)return-59;if(A.tty.Ea.Lb){h=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var C=Te();z[C>>2]=25856,z[C+4>>2]=5,z[C+8>>2]=191,z[C+12>>2]=35387;for(var I=0;32>I;I++)H[C+I+17]=h[I]||0}return 0;case 21510:case 21511:case 21512:return A.tty?0:-59;case 21506:case 21507:case 21508:if(!A.tty)return-59;if(A.tty.Ea.Mb)for(C=Te(),h=[],I=0;32>I;I++)h.push(H[C+I+17]);return 0;case 21519:return A.tty?(C=Te(),z[C>>2]=0):-59;case 21520:return A.tty?-28:-59;case 21531:return C=Te(),_.$a(A,f,C);case 21523:return A.tty?(A.tty.Ea.Nb&&(I=[24,80],C=Te(),K[C>>1]=I[0],K[C+2>>1]=I[1]),0):-59;case 21524:return A.tty?0:-59;case 21515:return A.tty?0:-59;default:return-28}}catch($){if(typeof _>"u"||$.name!=="ErrnoError")throw $;return-$.xa}},E:function(h,f,b,A){Nn=A;try{f=f?Wt(U,f):"",f=Cs(h,f);var C=A?Te():0;return _.open(f,b,C).fd}catch(I){if(typeof _>"u"||I.name!=="ErrnoError")throw I;return-I.xa}},V:function(h,f,b,A){try{return f=f?Wt(U,f):"",A=A?Wt(U,A):"",f=Cs(h,f),A=Cs(b,A),_.rename(f,A),0}catch(C){if(typeof _>"u"||C.name!=="ErrnoError")throw C;return-C.xa}},U:function(h,f){try{h=h?Wt(U,h):"";var b=_.stat,A=b(h);z[f>>2]=A.dev,z[f+4>>2]=A.mode,G[f+8>>2]=A.nlink,z[f+12>>2]=A.uid,z[f+16>>2]=A.gid,z[f+20>>2]=A.rdev,et[f+24>>3]=BigInt(A.size),z[f+32>>2]=4096,z[f+36>>2]=A.blocks;var C=A.atime.getTime(),I=A.mtime.getTime(),$=A.ctime.getTime();return et[f+40>>3]=BigInt(Math.floor(C/1e3)),G[f+48>>2]=C%1e3*1e6,et[f+56>>3]=BigInt(Math.floor(I/1e3)),G[f+64>>2]=I%1e3*1e6,et[f+72>>3]=BigInt(Math.floor($/1e3)),G[f+80>>2]=$%1e3*1e6,et[f+88>>3]=BigInt(A.ino),0}catch(q){if(typeof _>"u"||q.name!=="ErrnoError")throw q;return-q.xa}},T:function(h,f,b){try{return f=f?Wt(U,f):"",f=Cs(h,f),b===0?_.unlink(f):b===512?_.rmdir(f):ct("Invalid flags passed to unlinkat"),0}catch(A){if(typeof _>"u"||A.name!=="ErrnoError")throw A;return-A.xa}},Q:()=>ct(""),O:()=>{},M:()=>{throw 1/0},W:function(h,f){h=-9007199254740992>h||9007199254740992<h?NaN:Number(h),h=new Date(1e3*h),z[f>>2]=h.getSeconds(),z[f+4>>2]=h.getMinutes(),z[f+8>>2]=h.getHours(),z[f+12>>2]=h.getDate(),z[f+16>>2]=h.getMonth(),z[f+20>>2]=h.getFullYear()-1900,z[f+24>>2]=h.getDay();var b=h.getFullYear();z[f+28>>2]=(b%4!==0||b%100===0&&b%400!==0?qh:Wh)[h.getMonth()]+h.getDate()-1|0,z[f+36>>2]=-(60*h.getTimezoneOffset()),b=new Date(h.getFullYear(),6,1).getTimezoneOffset();var A=new Date(h.getFullYear(),0,1).getTimezoneOffset();z[f+32>>2]=(b!=A&&h.getTimezoneOffset()==Math.min(A,b))|0},P:(h,f)=>{if(Bn[h]&&(clearTimeout(Bn[h].id),delete Bn[h]),!f)return 0;var b=setTimeout(()=>{delete Bn[h],Xh(()=>na(h,performance.now()))},f);return Bn[h]={id:b,nc:f},0},H:(h,f,b,A)=>{var C=new Date().getFullYear(),I=new Date(C,0,1).getTimezoneOffset();C=new Date(C,6,1).getTimezoneOffset(),G[h>>2]=60*Math.max(I,C),z[f>>2]=+(I!=C),f=$=>{var q=Math.abs($);return`UTC${0<=$?"-":"+"}${String(Math.floor(q/60)).padStart(2,"0")}${String(q%60).padStart(2,"0")}`},h=f(I),f=f(C),C<I?(T(h,U,b,17),T(f,U,A,17)):(T(h,U,A,17),T(f,U,b,17))},F:()=>Date.now(),S:h=>{var f=U.length;if(h>>>=0,2147483648<h)return!1;for(var b=1;4>=b;b*=2){var A=f*(1+.2/b);A=Math.min(A,h+100663296);t:{A=(Math.min(2147483648,65536*Math.ceil(Math.max(h,A)/65536))-N.buffer.byteLength+65535)/65536|0;try{N.grow(A),V();var C=1;break t}catch{}C=void 0}if(C)return!0}return!1},Y:(h,f)=>{var b=0;return ea().forEach((A,C)=>{var I=f+b;for(C=G[h+4*C>>2]=I,I=0;I<A.length;++I)H[C++]=A.charCodeAt(I);H[C]=0,b+=A.length+1}),0},Z:(h,f)=>{var b=ea();G[h>>2]=b.length;var A=0;return b.forEach(C=>A+=C.length+1),G[f>>2]=A,0},t:ta,C:function(h){try{var f=ri(h);return _.close(f),0}catch(b){if(typeof _>"u"||b.name!=="ErrnoError")throw b;return b.xa}},$:function(h,f,b,A){try{t:{var C=ri(h);h=f;for(var I,$=f=0;$<b;$++){var q=G[h>>2],it=G[h+4>>2];h+=8;var st=_.read(C,H,q,it,I);if(0>st){var mt=-1;break t}if(f+=st,st<it)break;typeof I<"u"&&(I+=st)}mt=f}return G[A>>2]=mt,0}catch(at){if(typeof _>"u"||at.name!=="ErrnoError")throw at;return at.xa}},X:function(h,f,b,A){f=-9007199254740992>f||9007199254740992<f?NaN:Number(f);try{if(isNaN(f))return 61;var C=ri(h);return _.va(C,f,b),et[A>>3]=BigInt(C.position),C.Xa&&f===0&&b===0&&(C.Xa=null),0}catch(I){if(typeof _>"u"||I.name!=="ErrnoError")throw I;return I.xa}},_:function(h,f,b,A){try{t:{var C=ri(h);h=f;for(var I,$=f=0;$<b;$++){var q=G[h>>2],it=G[h+4>>2];h+=8;var st=_.write(C,H,q,it,I);if(0>st){var mt=-1;break t}if(f+=st,st<it)break;typeof I<"u"&&(I+=st)}mt=f}return G[A>>2]=mt,0}catch(at){if(typeof _>"u"||at.name!=="ErrnoError")throw at;return at.xa}},G:mc,b:Jh,c:Kh,h:ic,m:rc,J:hc,z:ac,p:Qh,x:dc,v:fc,y:lc,I:cc,i:ec,e:tc,f:Zh,k:sc,l:oc,L:nc,r:uc,s:pc,u:gc,A:h=>h,N:Zo},Pe;(async function(){pt++;var h={a:Yh};Pt??=_t("qpdf.wasm")?"qpdf.wasm":r.locateFile?r.locateFile("qpdf.wasm",S):S+"qpdf.wasm";try{var f=await He(h);return Pe=f.instance.exports,N=Pe.aa,V(),qt=Pe.da,Q.unshift(Pe.ba),bt(),f}catch(b){l(b)}})();var ia=r._main=(h,f)=>(ia=r._main=Pe.ca)(h,f),na=(h,f)=>(na=Pe.ea)(h,f),jt=(h,f)=>(jt=Pe.fa)(h,f),Un=h=>(Un=Pe.ga)(h),Xt=h=>(Xt=Pe.ha)(h),Dr=h=>(Dr=Pe.ia)(h),Yt=()=>(Yt=Pe.ja)(),sa=h=>(sa=Pe.ka)(h),ra=h=>(ra=Pe.la)(h),oa=(h,f,b)=>(oa=Pe.ma)(h,f,b),aa=h=>(aa=Pe.na)(h);function Kh(h,f,b){var A=Yt();try{return qt.get(h)(f,b)}catch(C){if(Xt(A),C!==C+0)throw C;jt(1,0)}}function Jh(h,f){var b=Yt();try{return qt.get(h)(f)}catch(A){if(Xt(b),A!==A+0)throw A;jt(1,0)}}function Qh(h,f,b,A,C,I,$){var q=Yt();try{return qt.get(h)(f,b,A,C,I,$)}catch(it){if(Xt(q),it!==it+0)throw it;jt(1,0)}}function Zh(h,f,b){var A=Yt();try{qt.get(h)(f,b)}catch(C){if(Xt(A),C!==C+0)throw C;jt(1,0)}}function tc(h,f){var b=Yt();try{qt.get(h)(f)}catch(A){if(Xt(b),A!==A+0)throw A;jt(1,0)}}function ec(h){var f=Yt();try{qt.get(h)()}catch(b){if(Xt(f),b!==b+0)throw b;jt(1,0)}}function ic(h,f,b,A){var C=Yt();try{return qt.get(h)(f,b,A)}catch(I){if(Xt(C),I!==I+0)throw I;jt(1,0)}}function nc(h,f,b,A,C,I){var $=Yt();try{qt.get(h)(f,b,A,C,I)}catch(q){if(Xt($),q!==q+0)throw q;jt(1,0)}}function sc(h,f,b,A){var C=Yt();try{qt.get(h)(f,b,A)}catch(I){if(Xt(C),I!==I+0)throw I;jt(1,0)}}function rc(h,f,b,A,C){var I=Yt();try{return qt.get(h)(f,b,A,C)}catch($){if(Xt(I),$!==$+0)throw $;jt(1,0)}}function oc(h,f,b,A,C){var I=Yt();try{qt.get(h)(f,b,A,C)}catch($){if(Xt(I),$!==$+0)throw $;jt(1,0)}}function ac(h,f,b,A,C,I){var $=Yt();try{return qt.get(h)(f,b,A,C,I)}catch(q){if(Xt($),q!==q+0)throw q;jt(1,0)}}function lc(h,f,b,A,C,I){var $=Yt();try{return qt.get(h)(f,b,A,C,I)}catch(q){if(Xt($),q!==q+0)throw q;jt(1,0)}}function hc(h,f,b,A,C,I){var $=Yt();try{return qt.get(h)(f,b,A,C,I)}catch(q){if(Xt($),q!==q+0)throw q;jt(1,0)}}function cc(h,f,b){var A=Yt();try{return qt.get(h)(f,b)}catch(C){if(Xt(A),C!==C+0)throw C;jt(1,0)}}function dc(h,f,b,A,C,I,$,q){var it=Yt();try{return qt.get(h)(f,b,A,C,I,$,q)}catch(st){if(Xt(it),st!==st+0)throw st;jt(1,0)}}function uc(h,f,b,A,C,I,$,q){var it=Yt();try{qt.get(h)(f,b,A,C,I,$,q)}catch(st){if(Xt(it),st!==st+0)throw st;jt(1,0)}}function fc(h,f,b,A,C,I,$,q,it,st,mt,at){var Dt=Yt();try{return qt.get(h)(f,b,A,C,I,$,q,it,st,mt,at)}catch(he){if(Xt(Dt),he!==he+0)throw he;jt(1,0)}}function pc(h,f,b,A,C,I,$,q,it,st,mt){var at=Yt();try{qt.get(h)(f,b,A,C,I,$,q,it,st,mt)}catch(Dt){if(Xt(at),Dt!==Dt+0)throw Dt;jt(1,0)}}function gc(h,f,b,A,C,I,$,q,it,st,mt,at,Dt,he,ge,kt){var Re=Yt();try{qt.get(h)(f,b,A,C,I,$,q,it,st,mt,at,Dt,he,ge,kt)}catch(Se){if(Xt(Re),Se!==Se+0)throw Se;jt(1,0)}}function mc(h,f,b){var A=Yt();try{return qt.get(h)(f,b)}catch(C){if(Xt(A),C!==C+0)throw C;jt(1,0)}}r.callMain=la,r.ENV=_s,r.FS=_,r.NODEFS=pe,r.WORKERFS=ne;var Ts;gt=function h(){Ts||ha(),Ts||(gt=h)};function la(h=[]){var f=ia;h.unshift(w);var b=h.length,A=Dr(4*(b+1)),C=A;h.forEach($=>{var q=G,it=C>>2,st=m($)+1,mt=Dr(st);T($,U,mt,st),q[it]=mt,C+=4}),G[C>>2]=0;try{var I=f(b,A);return ta(I,!0),I}catch($){return Qo($)}}function ha(){var h=v;if(!(0<pt)){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;){var f=r.preRun.shift();W.unshift(f)}je(W),0<pt||Ts||(Ts=!0,r.calledRun=!0,F||(r.noFSInit||_.Za||_.Pa(),_.Ya=!1,je(Q),je(Ct),o(r),ca&&la(h),je(Mt)))}}var ca=!0;return r.noInitialRun&&(ca=!1),ha(),Object.assign(_,{init:_.Pa,mkdir:_.mkdir,mount:_.sa,unlink:_.unlink,unmount:_.Tb,chdir:_.chdir,writeFile:_.writeFile,readFile:_.readFile,createLazyFile:_.Eb,setIgnorePermissions:function(h){_.Ya=h}}),s=d,s})})();a.exports=e,a.exports.default=e})(Mr)),Mr.exports}var Oc=Fc();const Nc=wc(Oc),Le=typeof Jt=="object"&&Jt+""=="[object process]"&&!Jt.versions.nw&&!(Jt.versions.electron&&Jt.type&&Jt.type!=="browser"),no=[.001,0,0,.001,0,0],Rr=1.35,We={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Bi={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},os="pdfjs_internal_editor_",ft={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},St={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},Bc={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},me={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Vs={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},re={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},wn={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},fr={ERRORS:0,WARNINGS:1,INFOS:5},as={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Ps={moveTo:0,lineTo:1,curveTo:2,closePath:3},Uc={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let pr=fr.WARNINGS;function $c(a){Number.isInteger(a)&&(pr=a)}function Hc(){return pr}function gr(a){pr>=fr.INFOS&&console.info(`Info: ${a}`)}function ut(a){pr>=fr.WARNINGS&&console.warn(`Warning: ${a}`)}function It(a){throw new Error(a)}function xt(a,t){a||It(t)}function jc(a){switch(a?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Il(a,t=null,e=null){if(!a)return null;if(e&&typeof a=="string"&&(e.addDefaultProtocol&&a.startsWith("www.")&&a.match(/\./g)?.length>=2&&(a=`http://${a}`),e.tryConvertEncoding))try{a=qc(a)}catch{}const i=t?URL.parse(a,t):URL.parse(a);return jc(i)?i:null}function Ml(a,t,e=!1){const i=URL.parse(a);return i?(i.hash=t,i.href):e&&Il(a,"http://example.com")?a.split("#",1)[0]+`${t?`#${t}`:""}`:""}function yt(a,t,e,i=!1){return Object.defineProperty(a,t,{value:e,enumerable:!i,configurable:!0,writable:!1}),e}const an=(function(){function t(e,i){this.message=e,this.name=i}return t.prototype=new Error,t.constructor=t,t})();class ya extends an{constructor(t,e){super(t,"PasswordException"),this.code=e}}class Fr extends an{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class so extends an{constructor(t){super(t,"InvalidPDFException")}}class Zs extends an{constructor(t,e,i){super(t,"ResponseException"),this.status=e,this.missing=i}}class zc extends an{constructor(t){super(t,"FormatError")}}class zi extends an{constructor(t){super(t,"AbortException")}}function Rl(a){(typeof a!="object"||a?.length===void 0)&&It("Invalid argument for bytesToString");const t=a.length,e=8192;if(t<e)return String.fromCharCode.apply(null,a);const i=[];for(let n=0;n<t;n+=e){const s=Math.min(n+e,t),r=a.subarray(n,s);i.push(String.fromCharCode.apply(null,r))}return i.join("")}function ps(a){typeof a!="string"&&It("Invalid argument for stringToBytes");const t=a.length,e=new Uint8Array(t);for(let i=0;i<t;++i)e[i]=a.charCodeAt(i)&255;return e}function Gc(a){return String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,a&255)}function Vc(){const a=new Uint8Array(4);return a[0]=1,new Uint32Array(a.buffer,0,1)[0]===1}function Wc(){try{return new Function(""),!0}catch{return!1}}class ve{static get isLittleEndian(){return yt(this,"isLittleEndian",Vc())}static get isEvalSupported(){return yt(this,"isEvalSupported",Wc())}static get isOffscreenCanvasSupported(){return yt(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return yt(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return yt(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){return yt(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const Or=Array.from(Array(256).keys(),a=>a.toString(16).padStart(2,"0"));class tt{static makeHexColor(t,e,i){return`#${Or[t]}${Or[e]}${Or[i]}`}static domMatrixToTransform(t){return[t.a,t.b,t.c,t.d,t.e,t.f]}static scaleMinMax(t,e){let i;t[0]?(t[0]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[3],e[3]*=t[3]):(i=e[0],e[0]=e[1],e[1]=i,i=e[2],e[2]=e[3],e[3]=i,t[1]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static multiplyByDOMMatrix(t,e){return[t[0]*e.a+t[2]*e.b,t[1]*e.a+t[3]*e.b,t[0]*e.c+t[2]*e.d,t[1]*e.c+t[3]*e.d,t[0]*e.e+t[2]*e.f+t[4],t[1]*e.e+t[3]*e.f+t[5]]}static applyTransform(t,e,i=0){const n=t[i],s=t[i+1];t[i]=n*e[0]+s*e[2]+e[4],t[i+1]=n*e[1]+s*e[3]+e[5]}static applyTransformToBezier(t,e,i=0){const n=e[0],s=e[1],r=e[2],o=e[3],l=e[4],d=e[5];for(let c=0;c<6;c+=2){const u=t[i+c],p=t[i+c+1];t[i+c]=u*n+p*r+l,t[i+c+1]=u*s+p*o+d}}static applyInverseTransform(t,e){const i=t[0],n=t[1],s=e[0]*e[3]-e[1]*e[2];t[0]=(i*e[3]-n*e[2]+e[2]*e[5]-e[4]*e[3])/s,t[1]=(-i*e[1]+n*e[0]+e[4]*e[1]-e[5]*e[0])/s}static axialAlignedBoundingBox(t,e,i){const n=e[0],s=e[1],r=e[2],o=e[3],l=e[4],d=e[5],c=t[0],u=t[1],p=t[2],y=t[3];let v=n*c+l,w=v,x=n*p+l,S=x,P=o*u+d,k=P,D=o*y+d,M=D;if(s!==0||r!==0){const R=s*c,N=s*p,F=r*u,O=r*y;v+=F,S+=F,x+=O,w+=O,P+=R,M+=R,D+=N,k+=N}i[0]=Math.min(i[0],v,x,w,S),i[1]=Math.min(i[1],P,D,k,M),i[2]=Math.max(i[2],v,x,w,S),i[3]=Math.max(i[3],P,D,k,M)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const i=t[0],n=t[1],s=t[2],r=t[3],o=i**2+n**2,l=i*s+n*r,d=s**2+r**2,c=(o+d)/2,u=Math.sqrt(c**2-(o*d-l**2));e[0]=Math.sqrt(c+u||1),e[1]=Math.sqrt(c-u||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const i=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),n=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(i>n)return null;const s=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return s>r?null:[i,s,n,r]}static pointBoundingBox(t,e,i){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}static rectBoundingBox(t,e,i,n,s){s[0]=Math.min(s[0],t,i),s[1]=Math.min(s[1],e,n),s[2]=Math.max(s[2],t,i),s[3]=Math.max(s[3],e,n)}static#t(t,e,i,n,s,r,o,l,d,c){if(d<=0||d>=1)return;const u=1-d,p=d*d,y=p*d,v=u*(u*(u*t+3*d*e)+3*p*i)+y*n,w=u*(u*(u*s+3*d*r)+3*p*o)+y*l;c[0]=Math.min(c[0],v),c[1]=Math.min(c[1],w),c[2]=Math.max(c[2],v),c[3]=Math.max(c[3],w)}static#e(t,e,i,n,s,r,o,l,d,c,u,p){if(Math.abs(d)<1e-12){Math.abs(c)>=1e-12&&this.#t(t,e,i,n,s,r,o,l,-u/c,p);return}const y=c**2-4*u*d;if(y<0)return;const v=Math.sqrt(y),w=2*d;this.#t(t,e,i,n,s,r,o,l,(-c+v)/w,p),this.#t(t,e,i,n,s,r,o,l,(-c-v)/w,p)}static bezierBoundingBox(t,e,i,n,s,r,o,l,d){d[0]=Math.min(d[0],t,o),d[1]=Math.min(d[1],e,l),d[2]=Math.max(d[2],t,o),d[3]=Math.max(d[3],e,l),this.#e(t,i,s,o,e,n,r,l,3*(-t+3*(i-s)+o),6*(t-2*i+s),3*(i-t),d),this.#e(t,i,s,o,e,n,r,l,3*(-e+3*(n-r)+l),6*(e-2*n+r),3*(n-e),d)}}function qc(a){return decodeURIComponent(escape(a))}let Nr=null,ba=null;function Xc(a){return Nr||(Nr=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,ba=new Map([["","t"]])),a.replaceAll(Nr,(t,e,i)=>e?e.normalize("NFKC"):ba.get(i))}function Fl(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const a=new Uint8Array(32);return crypto.getRandomValues(a),Rl(a)}const _o="pdfjs_internal_id_";function Yc(a,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[i,n,...s]=e;if(!a(i)&&!Number.isInteger(i)||!t(n))return!1;const r=s.length;let o=!0;switch(n.name){case"XYZ":if(r<2||r>3)return!1;break;case"Fit":case"FitB":return r===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(r>1)return!1;break;case"FitR":if(r!==4)return!1;o=!1;break;default:return!1}for(const l of s)if(!(typeof l=="number"||o&&l===null))return!1;return!0}function Ie(a,t,e){return Math.min(Math.max(a,t),e)}function Ol(a){return Uint8Array.prototype.toBase64?a.toBase64():btoa(Rl(a))}function Kc(a){return Uint8Array.fromBase64?Uint8Array.fromBase64(a):ps(atob(a))}typeof Promise.try!="function"&&(Promise.try=function(a,...t){return new Promise(e=>{e(a(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(a){return a.reduce((t,e)=>t+e,0)});class ls{static textContent(t){const e=[],i={items:e,styles:Object.create(null)};function n(s){if(!s)return;let r=null;const o=s.name;if(o==="#text")r=s.value;else if(ls.shouldBuildText(o))s?.attributes?.textContent?r=s.attributes.textContent:s.value&&(r=s.value);else return;if(r!==null&&e.push({str:r}),!!s.children)for(const l of s.children)n(l)}return n(t),i}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}class Nl{static setupStorage(t,e,i,n,s){const r=n.getValue(e,{value:null});switch(i.name){case"textarea":if(r.value!==null&&(t.textContent=r.value),s==="print")break;t.addEventListener("input",o=>{n.setValue(e,{value:o.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(r.value===i.attributes.xfaOn?t.setAttribute("checked",!0):r.value===i.attributes.xfaOff&&t.removeAttribute("checked"),s==="print")break;t.addEventListener("change",o=>{n.setValue(e,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&t.setAttribute("value",r.value),s==="print")break;t.addEventListener("input",o=>{n.setValue(e,{value:o.target.value})})}break;case"select":if(r.value!==null){t.setAttribute("value",r.value);for(const o of i.children)o.attributes.value===r.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}t.addEventListener("input",o=>{const l=o.target.options,d=l.selectedIndex===-1?"":l[l.selectedIndex].value;n.setValue(e,{value:d})});break}}static setAttributes({html:t,element:e,storage:i=null,intent:n,linkService:s}){const{attributes:r}=e,o=t instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${n}`);for(const[l,d]of Object.entries(r))if(d!=null)switch(l){case"class":d.length&&t.setAttribute(l,d.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",d);break;case"style":Object.assign(t.style,d);break;case"textContent":t.textContent=d;break;default:(!o||l!=="href"&&l!=="newWindow")&&t.setAttribute(l,d)}o&&s.addLinkAttributes(t,r.href,r.newWindow),i&&r.dataId&&this.setupStorage(t,r.dataId,e,i)}static render(t){const e=t.annotationStorage,i=t.linkService,n=t.xfaHtml,s=t.intent||"display",r=document.createElement(n.name);n.attributes&&this.setAttributes({html:r,element:n,intent:s,linkService:i});const o=s!=="richText",l=t.div;if(l.append(r),t.viewport){const u=`matrix(${t.viewport.transform.join(",")})`;l.style.transform=u}o&&l.setAttribute("class","xfaLayer xfaFont");const d=[];if(n.children.length===0){if(n.value){const u=document.createTextNode(n.value);r.append(u),o&&ls.shouldBuildText(n.name)&&d.push(u)}return{textDivs:d}}const c=[[n,-1,r]];for(;c.length>0;){const[u,p,y]=c.at(-1);if(p+1===u.children.length){c.pop();continue}const v=u.children[++c.at(-1)[1]];if(v===null)continue;const{name:w}=v;if(w==="#text"){const S=document.createTextNode(v.value);d.push(S),y.append(S);continue}const x=v?.attributes?.xmlns?document.createElementNS(v.attributes.xmlns,w):document.createElement(w);if(y.append(x),v.attributes&&this.setAttributes({html:x,element:v,storage:e,intent:s,linkService:i}),v.children?.length>0)c.push([v,-1,x]);else if(v.value){const S=document.createTextNode(v.value);o&&ls.shouldBuildText(w)&&d.push(S),x.append(S)}}for(const u of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))u.setAttribute("readOnly",!0);return{textDivs:d}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const _i="http://www.w3.org/2000/svg";class Mn{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function gs(a,t="text"){if(Wn(a,document.baseURI)){const e=await fetch(a);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,i)=>{const n=new XMLHttpRequest;n.open("GET",a,!0),n.responseType=t,n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE){if(n.status===200||n.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(n.response);return}e(n.responseText);return}i(new Error(n.statusText))}},n.send(null)})}class ms{constructor({viewBox:t,userUnit:e,scale:i,rotation:n,offsetX:s=0,offsetY:r=0,dontFlip:o=!1}){this.viewBox=t,this.userUnit=e,this.scale=i,this.rotation=n,this.offsetX=s,this.offsetY=r,i*=e;const l=(t[2]+t[0])/2,d=(t[3]+t[1])/2;let c,u,p,y;switch(n%=360,n<0&&(n+=360),n){case 180:c=-1,u=0,p=0,y=1;break;case 90:c=0,u=1,p=1,y=0;break;case 270:c=0,u=-1,p=-1,y=0;break;case 0:c=1,u=0,p=0,y=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(p=-p,y=-y);let v,w,x,S;c===0?(v=Math.abs(d-t[1])*i+s,w=Math.abs(l-t[0])*i+r,x=(t[3]-t[1])*i,S=(t[2]-t[0])*i):(v=Math.abs(l-t[0])*i+s,w=Math.abs(d-t[1])*i+r,x=(t[2]-t[0])*i,S=(t[3]-t[1])*i),this.transform=[c*i,u*i,p*i,y*i,v-c*i*l-p*i*d,w-u*i*l-y*i*d],this.width=x,this.height=S}get rawDims(){const t=this.viewBox;return yt(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:i=this.offsetX,offsetY:n=this.offsetY,dontFlip:s=!1}={}){return new ms({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:i,offsetY:n,dontFlip:s})}convertToViewportPoint(t,e){const i=[t,e];return tt.applyTransform(i,this.transform),i}convertToViewportRectangle(t){const e=[t[0],t[1]];tt.applyTransform(e,this.transform);const i=[t[2],t[3]];return tt.applyTransform(i,this.transform),[e[0],e[1],i[0],i[1]]}convertToPdfPoint(t,e){const i=[t,e];return tt.applyInverseTransform(i,this.transform),i}}class To extends an{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function mr(a){const t=a.length;let e=0;for(;e<t&&a[e].trim()==="";)e++;return a.substring(e,e+5).toLowerCase()==="data:"}function Po(a){return typeof a=="string"&&/\.pdf$/i.test(a)}function Jc(a){return[a]=a.split(/[#?]/,1),a.substring(a.lastIndexOf("/")+1)}function Qc(a,t="document.pdf"){if(typeof a!="string")return t;if(mr(a))return ut('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const i=(o=>{try{return new URL(o)}catch{try{return new URL(decodeURIComponent(o))}catch{try{return new URL(o,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(o),"https://foo.bar")}catch{return null}}}}})(a);if(!i)return t;const n=o=>{try{let l=decodeURIComponent(o);return l.includes("/")?(l=l.split("/").at(-1),l.test(/^\.pdf$/i)?l:o):l}catch{return o}},s=/\.pdf$/i,r=i.pathname.split("/").at(-1);if(s.test(r))return n(r);if(i.searchParams.size>0){const o=Array.from(i.searchParams.values()).reverse();for(const d of o)if(s.test(d))return n(d);const l=Array.from(i.searchParams.keys()).reverse();for(const d of l)if(s.test(d))return n(d)}if(i.hash){const l=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(i.hash);if(l)return n(l[0])}return t}class wa{started=Object.create(null);times=[];time(t){t in this.started&&ut(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||ut(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:i}of this.times)e=Math.max(i.length,e);for(const{name:i,start:n,end:s}of this.times)t.push(`${i.padEnd(e)} ${s-n}ms
`);return t.join("")}}function Wn(a,t){const e=t?URL.parse(a,t):URL.parse(a);return e?.protocol==="http:"||e?.protocol==="https:"}function ii(a){a.preventDefault()}function Qt(a){a.preventDefault(),a.stopPropagation()}function Zc(a){console.log("Deprecated API usage: "+a)}class ro{static#t;static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#t.exec(t);if(!e)return null;const i=parseInt(e[1],10);let n=parseInt(e[2],10);n=n>=1&&n<=12?n-1:0;let s=parseInt(e[3],10);s=s>=1&&s<=31?s:1;let r=parseInt(e[4],10);r=r>=0&&r<=23?r:0;let o=parseInt(e[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(e[6],10);l=l>=0&&l<=59?l:0;const d=e[7]||"Z";let c=parseInt(e[8],10);c=c>=0&&c<=23?c:0;let u=parseInt(e[9],10)||0;return u=u>=0&&u<=59?u:0,d==="-"?(r+=c,o+=u):d==="+"&&(r-=c,o-=u),new Date(Date.UTC(i,n,s,r,o,l))}}function td(a,{scale:t=1,rotation:e=0}){const{width:i,height:n}=a.attributes.style,s=[0,0,parseInt(i),parseInt(n)];return new ms({viewBox:s,userUnit:1,scale:t,rotation:e})}function ys(a){if(a.startsWith("#")){const t=parseInt(a.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return a.startsWith("rgb(")?a.slice(4,-1).split(",").map(t=>parseInt(t)):a.startsWith("rgba(")?a.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(ut(`Not a valid color format: "${a}"`),[0,0,0])}function ed(a){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of a.keys()){t.style.color=e;const i=window.getComputedStyle(t).color;a.set(e,ys(i))}t.remove()}function Gt(a){const{a:t,b:e,c:i,d:n,e:s,f:r}=a.getTransform();return[t,e,i,n,s,r]}function fi(a){const{a:t,b:e,c:i,d:n,e:s,f:r}=a.getTransform().invertSelf();return[t,e,i,n,s,r]}function sn(a,t,e=!1,i=!0){if(t instanceof ms){const{pageWidth:n,pageHeight:s}=t.rawDims,{style:r}=a,o=ve.isCSSRoundSupported,l=`var(--total-scale-factor) * ${n}px`,d=`var(--total-scale-factor) * ${s}px`,c=o?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,u=o?`round(down, ${d}, var(--scale-round-y))`:`calc(${d})`;!e||t.rotation%180===0?(r.width=c,r.height=u):(r.width=u,r.height=c)}i&&a.setAttribute("data-main-rotation",t.rotation)}class Ei{constructor(){const{pixelRatio:t}=Ei;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,i,n,s=-1){let r=1/0,o=1/0,l=1/0;i=Ei.capPixels(i,s),i>0&&(r=Math.sqrt(i/(t*e))),n!==-1&&(o=n/t,l=n/e);const d=Math.min(r,o,l);return this.sx>d||this.sy>d?(this.sx=d,this.sy=d,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const i=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,i):i}return t}}const oo=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class id{static get isDarkMode(){return yt(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class nd{static get commentForegroundColor(){const t=document.createElement("span");t.classList.add("comment","sidebar");const{style:e}=t;e.width=e.height="0",e.display="none",e.color="var(--comment-fg-color)",document.body.append(t);const{color:i}=window.getComputedStyle(t);return t.remove(),yt(this,"commentForegroundColor",ys(i))}}function sd(a,t,e,i){i=Math.min(Math.max(i??1,0),1);const n=255*(1-i);return a=Math.round(a*i+n),t=Math.round(t*i+n),e=Math.round(e*i+n),[a,t,e]}function va(a,t){const e=a[0]/255,i=a[1]/255,n=a[2]/255,s=Math.max(e,i,n),r=Math.min(e,i,n),o=(s+r)/2;if(s===r)t[0]=t[1]=0;else{const l=s-r;switch(t[1]=o<.5?l/(s+r):l/(2-s-r),s){case e:t[0]=((i-n)/l+(i<n?6:0))*60;break;case i:t[0]=((n-e)/l+2)*60;break;case n:t[0]=((e-i)/l+4)*60;break}}t[2]=o}function ao(a,t){const e=a[0],i=a[1],n=a[2],s=(1-Math.abs(2*n-1))*i,r=s*(1-Math.abs(e/60%2-1)),o=n-s/2;switch(Math.floor(e/60)){case 0:t[0]=s+o,t[1]=r+o,t[2]=o;break;case 1:t[0]=r+o,t[1]=s+o,t[2]=o;break;case 2:t[0]=o,t[1]=s+o,t[2]=r+o;break;case 3:t[0]=o,t[1]=r+o,t[2]=s+o;break;case 4:t[0]=r+o,t[1]=o,t[2]=s+o;break;case 5:case 6:t[0]=s+o,t[1]=o,t[2]=r+o;break}}function Aa(a){return a<=.03928?a/12.92:((a+.055)/1.055)**2.4}function Ea(a,t,e){ao(a,e),e.map(Aa);const i=.2126*e[0]+.7152*e[1]+.0722*e[2];ao(t,e),e.map(Aa);const n=.2126*e[0]+.7152*e[1]+.0722*e[2];return i>n?(i+.05)/(n+.05):(n+.05)/(i+.05)}const Sa=new Map;function rd(a,t){const e=a[0]+a[1]*256+a[2]*65536+t[0]*16777216+t[1]*4294967296+t[2]*1099511627776;let i=Sa.get(e);if(i)return i;const n=new Float32Array(9),s=n.subarray(0,3),r=n.subarray(3,6);va(a,r);const o=n.subarray(6,9);va(t,o);const l=o[2]<.5,d=l?12:4.5;if(r[2]=l?Math.sqrt(r[2]):1-Math.sqrt(1-r[2]),Ea(r,o,s)<d){let c,u;l?(c=r[2],u=1):(c=0,u=r[2]);const p=.005;for(;u-c>p;){const y=r[2]=(c+u)/2;l===Ea(r,o,s)<d?c=y:u=y}r[2]=l?u:c}return ao(r,s),i=tt.makeHexColor(Math.round(s[0]*255),Math.round(s[1]*255),Math.round(s[2]*255)),Sa.set(e,i),i}function Bl({html:a,dir:t,className:e},i){const n=document.createDocumentFragment();if(typeof a=="string"){const s=document.createElement("p");s.dir=t||"auto";const r=a.split(/(?:\r\n?|\n)/);for(let o=0,l=r.length;o<l;++o){const d=r[o];s.append(document.createTextNode(d)),o<l-1&&s.append(document.createElement("br"))}n.append(s)}else Nl.render({xfaHtml:a,div:n,intent:"richText"});n.firstChild.classList.add("richText",e),i.append(n)}class Qn{#t=null;#e=null;#n;#i=null;#o=null;#s=null;#r=null;#a=null;static#h=null;constructor(t){this.#n=t,Qn.#h||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#n._uiManager._signal;e instanceof AbortSignal&&!e.aborted&&(t.addEventListener("contextmenu",ii,{signal:e}),t.addEventListener("pointerdown",Qn.#l,{signal:e}));const i=this.#i=document.createElement("div");i.className="buttons",t.append(i);const n=this.#n.toolbarPosition;if(n){const{style:s}=t,r=this.#n._uiManager.direction==="ltr"?1-n[0]:n[0];s.insetInlineEnd=`${100*r}%`,s.top=`calc(${100*n[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#t}static#l(t){t.stopPropagation()}#u(t){this.#n._focusEventsAllowed=!1,Qt(t)}#d(t){this.#n._focusEventsAllowed=!0,Qt(t)}#f(t){const e=this.#n._uiManager._signal;return!(e instanceof AbortSignal)||e.aborted?!1:(t.addEventListener("focusin",this.#u.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#d.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",ii,{signal:e}),!0)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#o?.shown(),this.#s?.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=this.#n,i=document.createElement("button");i.classList.add("basic","deleteButton"),i.tabIndex=0,i.setAttribute("data-l10n-id",Qn.#h[t]),this.#f(i)&&i.addEventListener("click",n=>{e.delete()},{signal:e._signal}),this.#i.append(i)}get#m(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#f(e),this.#i.append(e,this.#m),this.#o=t}addComment(t,e=null){if(this.#s)return;const i=t.renderForToolbar();if(!i)return;this.#f(i);const n=this.#r=this.#m;e?(this.#i.insertBefore(i,e),this.#i.insertBefore(n,e)):this.#i.append(i,n),this.#s=t,t.toolbar=this}addColorPicker(t){if(this.#e)return;this.#e=t;const e=t.renderButton();this.#f(e),this.#i.append(e,this.#m)}async addEditSignatureButton(t){const e=this.#a=await t.renderEditButton(this.#n);this.#f(e),this.#i.append(e,this.#m)}removeButton(t){switch(t){case"comment":this.#s?.removeToolbarCommentButton(),this.#s=null,this.#r?.remove(),this.#r=null;break}}async addButton(t,e){switch(t){case"colorPicker":this.addColorPicker(e);break;case"altText":await this.addAltText(e);break;case"editSignature":await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(e);break}}async addButtonBefore(t,e,i){const n=this.#i.querySelector(i);n&&t==="comment"&&this.addComment(e,n)}updateEditSignatureButton(t){this.#a&&(this.#a.title=t)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class od{#t=null;#e=null;#n;constructor(t){this.#n=t}#i(){const t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar");const e=this.#n._signal;e instanceof AbortSignal&&!e.aborted&&t.addEventListener("contextmenu",ii,{signal:e});const i=this.#t=document.createElement("div");return i.className="buttons",t.append(i),this.#n.hasCommentManager()&&this.#s("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#n.commentSelection("floating_button")}),this.#s("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#n.highlightSelection("floating_button")}),t}#o(t,e){let i=0,n=0;for(const s of t){const r=s.y+s.height;if(r<i)continue;const o=s.x+(e?s.width:0);if(r>i){n=o,i=r;continue}e?o>n&&(n=o):o<n&&(n=o)}return[e?1-n:n,i]}show(t,e,i){const[n,s]=this.#o(e,i),{style:r}=this.#e||=this.#i();t.append(this.#e),r.insetInlineEnd=`${100*n}%`,r.top=`calc(${100*s}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#s(t,e,i,n){const s=document.createElement("button");s.classList.add("basic",t),s.tabIndex=0,s.setAttribute("data-l10n-id",e);const r=document.createElement("span");s.append(r),r.className="visuallyHidden",r.setAttribute("data-l10n-id",i);const o=this.#n._signal;o instanceof AbortSignal&&!o.aborted&&(s.addEventListener("contextmenu",ii,{signal:o}),s.addEventListener("click",n,{signal:o})),this.#t.append(s)}}function Ul(a,t,e){for(const i of e)t.addEventListener(i,a[i].bind(a))}class ad{#t=0;get id(){return`${os}${this.#t++}`}}class ko{#t=Fl();#e=0;#n=null;static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),n=new Image;n.src=t;const s=n.decode().then(()=>(i.drawImage(n,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return yt(this,"_isSVGFittingCanvas",s)}async#i(t,e){this.#n||=new Map;let i=this.#n.get(t);if(i===null)return null;if(i?.bitmap)return i.refCounter+=1,i;try{i||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let n;if(typeof e=="string"?(i.url=e,n=await gs(e,"blob")):e instanceof File?n=i.file=e:e instanceof Blob&&(n=e),n.type==="image/svg+xml"){const s=ko._isSVGFittingCanvas,r=new FileReader,o=new Image,l=new Promise((d,c)=>{o.onload=()=>{i.bitmap=o,i.isSvg=!0,d()},r.onload=async()=>{const u=i.svgUrl=r.result;o.src=await s?`${u}#svgView(preserveAspectRatio(none))`:u},o.onerror=r.onerror=c});r.readAsDataURL(n),await l}else i.bitmap=await createImageBitmap(n);i.refCounter=1}catch(n){ut(n),i=null}return this.#n.set(t,i),i&&this.#n.set(i.id,i),i}async getFromFile(t){const{lastModified:e,name:i,size:n,type:s}=t;return this.#i(`${e}_${i}_${n}_${s}`,t)}async getFromUrl(t){return this.#i(t,t)}async getFromBlob(t,e){const i=await e;return this.#i(t,i)}async getFromId(t){this.#n||=new Map;const e=this.#n.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:i}=e;return delete e.blobPromise,this.getFromBlob(e.id,i)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#n||=new Map;let i=this.#n.get(t);if(i?.bitmap)return i.refCounter+=1,i;const n=new OffscreenCanvas(e.width,e.height);return n.getContext("2d").drawImage(e,0,0),i={bitmap:n.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#n.set(t,i),this.#n.set(i.id,i),i}getSvgUrl(t){const e=this.#n.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#n||=new Map;const e=this.#n.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:i}=e;if(!e.url&&!e.file){const n=new OffscreenCanvas(i.width,i.height);n.getContext("bitmaprenderer").transferFromImageBitmap(i),e.blobPromise=n.convertToBlob()}i.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}}class ld{#t=[];#e=!1;#n;#i=-1;constructor(t=128){this.#n=t}add({cmd:t,undo:e,post:i,mustExec:n,type:s=NaN,overwriteIfSameType:r=!1,keepUndo:o=!1}){if(n&&t(),this.#e)return;const l={cmd:t,undo:e,post:i,type:s};if(this.#i===-1){this.#t.length>0&&(this.#t.length=0),this.#i=0,this.#t.push(l);return}if(r&&this.#t[this.#i].type===s){o&&(l.undo=this.#t[this.#i].undo),this.#t[this.#i]=l;return}const d=this.#i+1;d===this.#n?this.#t.splice(0,1):(this.#i=d,d<this.#t.length&&this.#t.splice(d)),this.#t.push(l)}undo(){if(this.#i===-1)return;this.#e=!0;const{undo:t,post:e}=this.#t[this.#i];t(),e?.(),this.#e=!1,this.#i-=1}redo(){if(this.#i<this.#t.length-1){this.#i+=1,this.#e=!0;const{cmd:t,post:e}=this.#t[this.#i];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#i!==-1}hasSomethingToRedo(){return this.#i<this.#t.length-1}cleanType(t){if(this.#i!==-1){for(let e=this.#i;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#i-e),this.#i=e;return}this.#t.length=0,this.#i=-1}}destroy(){this.#t=null}}class bs{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=ve.platform;for(const[i,n,s={}]of t)for(const r of i){const o=r.startsWith("mac+");e&&o?(this.callbacks.set(r.slice(4),{callback:n,options:s}),this.allKeys.add(r.split("+").at(-1))):!e&&!o&&(this.callbacks.set(r,{callback:n,options:s}),this.allKeys.add(r.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const i=this.callbacks.get(this.#t(e));if(!i)return;const{callback:n,options:{bubbles:s=!1,args:r=[],checker:o=null}}=i;o&&!o(t,e)||(n.bind(t,...r,e)(),s||Qt(e))}}class Do{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return ed(t),yt(this,"_colors",t)}convert(t){const e=ys(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[i,n]of this._colors)if(n.every((s,r)=>s===e[r]))return Do._colorsMapping.get(i);return e}getHexCode(t){const e=this._colors.get(t);return e?tt.makeHexColor(...e):t}}class Gi{#t=new AbortController;#e=null;#n=null;#i=new Map;#o=new Map;#s=null;#r=null;#a=null;#h=new ld;#l=null;#u=null;#d=null;#f=0;#m=new Set;#p=null;#c=null;#g=new Set;_editorUndoBar=null;#y=!1;#w=!1;#b=!1;#C=null;#S=null;#v=null;#T=null;#E=!1;#x=null;#D=new ad;#P=!1;#k=!1;#N=!1;#I=null;#R=null;#B=null;#F=null;#G=null;#_=ft.NONE;#A=new Set;#M=null;#U=null;#H=null;#q=null;#W=null;#X={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#j=[0,0];#O=null;#V=null;#Q=null;#Z=null;#$=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=Gi.prototype,e=r=>r.#V.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&r.hasSomethingToControl(),i=(r,{target:o})=>{if(o instanceof HTMLInputElement){const{type:l}=o;return l!=="text"&&l!=="number"}return!0},n=this.TRANSLATE_SMALL,s=this.TRANSLATE_BIG;return yt(this,"_keyboardManager",new bs([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],t.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:i}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(r,{target:o})=>!(o instanceof HTMLButtonElement)&&r.#V.contains(o)&&!r.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(r,{target:o})=>!(o instanceof HTMLButtonElement)&&r.#V.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-s,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[s,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-s],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,s],checker:e}]]))}constructor(t,e,i,n,s,r,o,l,d,c,u,p,y,v,w,x){const S=this._signal=this.#t.signal;this.#V=t,this.#Q=e,this.#Z=i,this.#s=n,this.#l=s,this.#U=r,this.#W=l,this._eventBus=o,o._on("editingaction",this.onEditingAction.bind(this),{signal:S}),o._on("pagechanging",this.onPageChanging.bind(this),{signal:S}),o._on("scalechanging",this.onScaleChanging.bind(this),{signal:S}),o._on("rotationchanging",this.onRotationChanging.bind(this),{signal:S}),o._on("setpreference",this.onSetPreference.bind(this),{signal:S}),o._on("switchannotationeditorparams",P=>this.updateParams(P.type,P.value),{signal:S}),window.addEventListener("pointerdown",()=>{this.#k=!0},{capture:!0,signal:S}),window.addEventListener("pointerup",()=>{this.#k=!1},{capture:!0,signal:S}),this.#lt(),this.#ut(),this.#et(),this.#r=l.annotationStorage,this.#C=l.filterFactory,this.#H=d,this.#T=c||null,this.#y=u,this.#w=p,this.#b=y,this.#G=v||null,this.viewParameters={realScale:Mn.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=w||null,this._supportsPinchToZoom=x!==!1,s?.setSidebarUiManager(this)}destroy(){this.#$?.resolve(),this.#$=null,this.#t?.abort(),this.#t=null,this._signal=null;for(const t of this.#o.values())t.destroy();this.#o.clear(),this.#i.clear(),this.#g.clear(),this.#F?.clear(),this.#e=null,this.#A.clear(),this.#h.destroy(),this.#s?.destroy(),this.#l?.destroy(),this.#U?.destroy(),this.#x?.hide(),this.#x=null,this.#B?.destroy(),this.#B=null,this.#n=null,this.#S&&(clearTimeout(this.#S),this.#S=null),this.#O&&(clearTimeout(this.#O),this.#O=null),this._editorUndoBar?.destroy(),this.#W=null}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#G}get useNewAltTextFlow(){return this.#w}get useNewAltTextWhenAddingImage(){return this.#b}get hcmFilter(){return yt(this,"hcmFilter",this.#H?this.#C.addHCMFilter(this.#H.foreground,this.#H.background):"none")}get direction(){return yt(this,"direction",getComputedStyle(this.#V).direction)}get _highlightColors(){return yt(this,"_highlightColors",this.#T?new Map(this.#T.split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return yt(this,"highlightColors",null);const e=new Map,i=!!this.#H;for(const[n,s]of t){const r=n.endsWith("_HCM");if(i&&r){e.set(n.replace("_HCM",""),s);continue}!i&&!r&&e.set(n,s)}return yt(this,"highlightColors",e)}get highlightColorNames(){return yt(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#d=t}setMainHighlightColorPicker(t){this.#B=t}editAltText(t,e=!1){this.#s?.editAltText(this,t,e)}hasCommentManager(){return!!this.#l}editComment(t,e,i,n){this.#l?.showDialog(this,t,e,i,n)}selectComment(t,e){this.#o.get(t)?.getEditorByUID(e)?.toggleComment(!0,!0)}updateComment(t){this.#l?.updateComment(t.getData())}updatePopupColor(t){this.#l?.updatePopupColor(t)}removeComment(t){this.#l?.removeComments([t.uid])}toggleComment(t,e,i=void 0){this.#l?.toggleCommentPopup(t,e,i)}makeCommentColor(t,e){return t&&this.#l?.makeCommentColor(t,e)||null}getCommentDialogElement(){return this.#l?.dialogElement||null}async waitForEditorsRendered(t){if(this.#o.has(t-1))return;const{resolve:e,promise:i}=Promise.withResolvers(),n=s=>{s.pageNumber===t&&(this._eventBus._off("editorsrendered",n),e())};this._eventBus.on("editorsrendered",n),await i}getSignature(t){this.#U?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#U}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":this.#b=e;break}}onPageChanging({pageNumber:t}){this.#f=t-1}focusMainContainer(){this.#V.focus()}findParent(t,e){for(const i of this.#o.values()){const{x:n,y:s,width:r,height:o}=i.div.getBoundingClientRect();if(t>=n&&t<=n+r&&e>=s&&e<=s+o)return i}return null}disableUserSelect(t=!1){this.#Q.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#g.add(t)}removeShouldRescale(t){this.#g.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*Mn.PDF_TO_CSS_UNITS;for(const e of this.#g)e.onScaleChanging();this.#d?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#J({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#tt(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const i of this.#o.values())if(i.hasTextLayer(t))return i;return null}highlightSelection(t="",e=!1){const i=document.getSelection();if(!i||i.isCollapsed)return;const{anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o}=i,l=i.toString(),c=this.#J(i).closest(".textLayer"),u=this.getSelectionBoxes(c);if(!u)return;i.empty();const p=this.#tt(c),y=this.#_===ft.NONE,v=()=>{const w=p?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:u,anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o,text:l});y&&this.showAllEditors("highlight",!0,!0),e&&w?.editComment()};if(y){this.switchToMode(ft.HIGHLIGHT,v);return}v()}commentSelection(t=""){this.highlightSelection(t,!0)}#ot(){const t=document.getSelection();if(!t||t.isCollapsed)return;const i=this.#J(t).closest(".textLayer"),n=this.getSelectionBoxes(i);n&&(this.#x||=new od(this),this.#x.show(i,n,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(t){if(!this.#r)return null;const e=`${os}${t}`,i=this.#r.getRawValue(e);return i&&this.#r.remove(e),i}addToAnnotationStorage(t){!t.isEmpty()&&this.#r&&!this.#r.has(t.id)&&this.#r.setValue(t.id,t)}a11yAlert(t,e=null){const i=this.#Z;i&&(i.setAttribute("data-l10n-id",t),e?i.setAttribute("data-l10n-args",JSON.stringify(e)):i.removeAttribute("data-l10n-args"))}#at(){const t=document.getSelection();if(!t||t.isCollapsed){this.#M&&(this.#x?.hide(),this.#M=null,this.#L({hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===this.#M)return;const n=this.#J(t).closest(".textLayer");if(!n){this.#M&&(this.#x?.hide(),this.#M=null,this.#L({hasSelectedText:!1}));return}if(this.#x?.hide(),this.#M=e,this.#L({hasSelectedText:!0}),!(this.#_!==ft.HIGHLIGHT&&this.#_!==ft.NONE)&&(this.#_===ft.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#E=this.isShiftKeyDown,!this.isShiftKeyDown)){const s=this.#_===ft.HIGHLIGHT?this.#tt(n):null;if(s?.toggleDrawing(),this.#k){const r=new AbortController,o=this.combinedSignal(r),l=d=>{d.type==="pointerup"&&d.button!==0||(r.abort(),s?.toggleDrawing(!0),d.type==="pointerup"&&this.#Y("main_toolbar"))};window.addEventListener("pointerup",l,{signal:o}),window.addEventListener("blur",l,{signal:o})}else s?.toggleDrawing(!0),this.#Y("main_toolbar")}}#Y(t=""){this.#_===ft.HIGHLIGHT?this.highlightSelection(t):this.#y&&this.#ot()}#lt(){document.addEventListener("selectionchange",this.#at.bind(this),{signal:this._signal})}#ht(){if(this.#v)return;this.#v=new AbortController;const t=this.combinedSignal(this.#v);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#ct(){this.#v?.abort(),this.#v=null}blur(){if(this.isShiftKeyDown=!1,this.#E&&(this.#E=!1,this.#Y("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#A)if(e.div.contains(t)){this.#R=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#R)return;const[t,e]=this.#R;this.#R=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#et(){if(this.#I)return;this.#I=new AbortController;const t=this.combinedSignal(this.#I);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#dt(){this.#I?.abort(),this.#I=null}#it(){if(this.#u)return;this.#u=new AbortController;const t=this.combinedSignal(this.#u);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#nt(){this.#u?.abort(),this.#u=null}#ut(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#et(),this.#it()}removeEditListeners(){this.#dt(),this.#nt()}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const i of this.#c)if(i.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const i of this.#c)if(i.isHandlingMimeForPasting(e.type)){i.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const i of this.#A){const n=i.serialize(!0);n&&e.push(n)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const s of e.items)for(const r of this.#c)if(r.isHandlingMimeForPasting(s.type)){r.paste(s,this.currentLayer);return}let i=e.getData("application/pdfjs");if(!i)return;try{i=JSON.parse(i)}catch(s){ut(`paste: "${s.message}".`);return}if(!Array.isArray(i))return;this.unselectAll();const n=this.currentLayer;try{const s=[];for(const l of i){const d=await n.deserialize(l);if(!d)return;s.push(d)}const r=()=>{for(const l of s)this.#st(l);this.#rt(s)},o=()=>{for(const l of s)l.remove()};this.addCommands({cmd:r,undo:o,mustExec:!0})}catch(s){ut(`paste: "${s.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#_!==ft.NONE&&!this.isEditorHandlingKeyboard&&Gi._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#E&&(this.#E=!1,this.#Y("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#L(t){Object.entries(t).some(([i,n])=>this.#X[i]!==n)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#X,t)}),this.#_===ft.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#z([[St.HIGHLIGHT_FREE,!0]]))}#z(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#ht(),this.#it(),this.#L({isEditing:this.#_!==ft.NONE,isEmpty:this.#K(),hasSomethingToUndo:this.#h.hasSomethingToUndo(),hasSomethingToRedo:this.#h.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#ct(),this.#nt(),this.#L({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#c){this.#c=t;for(const e of this.#c)this.#z(e.defaultPropertiesToUpdate)}}getId(){return this.#D.id}get currentLayer(){return this.#o.get(this.#f)}getLayer(t){return this.#o.get(t)}get currentPageIndex(){return this.#f}addLayer(t){this.#o.set(t.pageIndex,t),this.#P?t.enable():t.disable()}removeLayer(t){this.#o.delete(t.pageIndex)}async updateMode(t,e=null,i=!1,n=!1,s=!1){if(this.#_!==t&&!(this.#$&&(await this.#$.promise,!this.#$))){if(this.#$=Promise.withResolvers(),this.#d?.commitOrRemove(),this.#_===ft.POPUP&&this.#l?.hideSidebar(),this.#l?.destroyPopup(),this.#_=t,t===ft.NONE){this.setEditingState(!1),this.#pt();for(const r of this.#i.values())r.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#$.resolve();return}for(const r of this.#i.values())r.addStandaloneCommentButton();t===ft.SIGNATURE&&await this.#U?.loadSignatures(),this.setEditingState(!0),await this.#ft(),this.unselectAll();for(const r of this.#o.values())r.updateMode(t);if(t===ft.POPUP){this.#n||=await this.#W.getAnnotationsByType(new Set(this.#c.map(l=>l._editorType)));const r=new Set,o=[];for(const l of this.#i.values()){const{annotationElementId:d,hasComment:c,deleted:u}=l;d&&r.add(d),c&&!u&&o.push(l.getData())}for(const l of this.#n){const{id:d,popupRef:c,contentsObj:u}=l;c&&u?.str&&!r.has(d)&&!this.#m.has(d)&&o.push(l)}this.#l?.showSidebar(o)}if(!e){i&&this.addNewEditorFromKeyboard(),this.#$.resolve();return}for(const r of this.#i.values())r.uid===e?(this.setSelected(r),s?r.editComment():n?r.enterInEditMode():r.focus()):r.unselect();this.#$.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==this.#_&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(this.#c){switch(t){case St.CREATE:this.currentLayer.addNewEditor(e);return;case St.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#q||=new Map).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const i of this.#A)i.updateParams(t,e);else for(const i of this.#c)i.updateDefaultParams(t,e)}}showAllEditors(t,e,i=!1){for(const s of this.#i.values())s.editorType===t&&s.show(e);(this.#q?.get(St.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#z([[St.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#N!==t){this.#N=t;for(const e of this.#o.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#ft(){if(!this.#P){this.#P=!0;const t=[];for(const e of this.#o.values())t.push(e.enable());await Promise.all(t);for(const e of this.#i.values())e.enable()}}#pt(){if(this.unselectAll(),this.#P){this.#P=!1;for(const t of this.#o.values())t.disable();for(const t of this.#i.values())t.disable()}}*getEditors(t){for(const e of this.#i.values())e.pageIndex===t&&(yield e)}getEditor(t){return this.#i.get(t)}addEditor(t){this.#i.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#S&&clearTimeout(this.#S),this.#S=setTimeout(()=>{this.focusMainContainer(),this.#S=null},0)),this.#i.delete(t.id),t.annotationElementId&&this.#F?.delete(t.annotationElementId),this.unselect(t),(!t.annotationElementId||!this.#m.has(t.annotationElementId))&&this.#r?.remove(t.id)}addDeletedAnnotationElement(t){this.#m.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#m.has(t)}removeDeletedAnnotationElement(t){this.#m.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#st(t){const e=this.#o.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#z(t.propertiesToUpdate))}get#gt(){let t=null;for(t of this.#A);return t}updateUI(t){this.#gt===t&&this.#z(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#z(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#A.has(t)){this.#A.delete(t),t.unselect(),this.#L({hasSelectedEditor:this.hasSelection});return}this.#A.add(t),t.select(),this.#z(t.propertiesToUpdate),this.#L({hasSelectedEditor:!0})}setSelected(t){this.updateToolbar({mode:t.mode,editId:t.id}),this.#d?.commitOrRemove();for(const e of this.#A)e!==t&&e.unselect();this.#A.clear(),this.#A.add(t),t.select(),this.#z(t.propertiesToUpdate),this.#L({hasSelectedEditor:!0})}isSelected(t){return this.#A.has(t)}get firstSelectedEditor(){return this.#A.values().next().value}unselect(t){t.unselect(),this.#A.delete(t),this.#L({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#A.size!==0}get isEnterHandled(){return this.#A.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#h.undo(),this.#L({hasSomethingToUndo:this.#h.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#K()}),this._editorUndoBar?.hide()}redo(){this.#h.redo(),this.#L({hasSomethingToUndo:!0,hasSomethingToRedo:this.#h.hasSomethingToRedo(),isEmpty:this.#K()})}addCommands(t){this.#h.add(t),this.#L({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#K()})}cleanUndoStack(t){this.#h.cleanType(t)}#K(){if(this.#i.size===0)return!0;if(this.#i.size===1)for(const t of this.#i.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#A],i=()=>{this._editorUndoBar?.show(n,e.length===1?e[0].editorType:e.length);for(const s of e)s.remove()},n=()=>{for(const s of e)this.#st(s)};this.addCommands({cmd:i,undo:n,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#rt(t){for(const e of this.#A)e.unselect();this.#A.clear();for(const e of t)e.isEmpty()||(this.#A.add(e),e.select());this.#L({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#A)t.commit();this.#rt(this.#i.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#_!==ft.NONE))&&!this.#d?.commitOrRemove()&&this.hasSelection){for(const t of this.#A)t.unselect();this.#A.clear(),this.#L({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,i=!1){if(i||this.commitOrRemove(),!this.hasSelection)return;this.#j[0]+=t,this.#j[1]+=e;const[n,s]=this.#j,r=[...this.#A],o=1e3;this.#O&&clearTimeout(this.#O),this.#O=setTimeout(()=>{this.#O=null,this.#j[0]=this.#j[1]=0,this.addCommands({cmd:()=>{for(const l of r)this.#i.has(l.id)&&(l.translateInPage(n,s),l.translationDone())},undo:()=>{for(const l of r)this.#i.has(l.id)&&(l.translateInPage(-n,-s),l.translationDone())},mustExec:!1})},o);for(const l of r)l.translateInPage(t,e),l.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#p=new Map;for(const t of this.#A)this.#p.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#p)return!1;this.disableUserSelect(!1);const t=this.#p;this.#p=null;let e=!1;for(const[{x:n,y:s,pageIndex:r},o]of t)o.newX=n,o.newY=s,o.newPageIndex=r,e||=n!==o.savedX||s!==o.savedY||r!==o.savedPageIndex;if(!e)return!1;const i=(n,s,r,o)=>{if(this.#i.has(n.id)){const l=this.#o.get(o);l?n._setParentAndPosition(l,s,r):(n.pageIndex=o,n.x=s,n.y=r)}};return this.addCommands({cmd:()=>{for(const[n,{newX:s,newY:r,newPageIndex:o}]of t)i(n,s,r,o)},undo:()=>{for(const[n,{savedX:s,savedY:r,savedPageIndex:o}]of t)i(n,s,r,o)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#p)for(const i of this.#p.keys())i.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#A.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#_}isEditingMode(){return this.#_!==ft.NONE}get imageManager(){return yt(this,"imageManager",new ko)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let d=0,c=e.rangeCount;d<c;d++)if(!t.contains(e.getRangeAt(d).commonAncestorContainer))return null;const{x:i,y:n,width:s,height:r}=t.getBoundingClientRect();let o;switch(t.getAttribute("data-main-rotation")){case"90":o=(d,c,u,p)=>({x:(c-n)/r,y:1-(d+u-i)/s,width:p/r,height:u/s});break;case"180":o=(d,c,u,p)=>({x:1-(d+u-i)/s,y:1-(c+p-n)/r,width:u/s,height:p/r});break;case"270":o=(d,c,u,p)=>({x:1-(c+p-n)/r,y:(d-i)/s,width:p/r,height:u/s});break;default:o=(d,c,u,p)=>({x:(d-i)/s,y:(c-n)/r,width:u/s,height:p/r});break}const l=[];for(let d=0,c=e.rangeCount;d<c;d++){const u=e.getRangeAt(d);if(!u.collapsed)for(const{x:p,y,width:v,height:w}of u.getClientRects())v===0||w===0||l.push(o(p,y,v,w))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#a||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#a?.delete(t)}renderAnnotationElement(t){const e=this.#a?.get(t.data.id);if(!e)return;const i=this.#r.getRawValue(e);i&&(this.#_===ft.NONE&&!i.hasBeenModified||i.renderAnnotationElement(t))}setMissingCanvas(t,e,i){const n=this.#F?.get(t);n&&(n.setCanvas(e,i),this.#F.delete(t))}addMissingCanvas(t,e){(this.#F||=new Map).set(t,e)}}class bi{#t=null;#e=!1;#n=null;#i=null;#o=null;#s=null;#r=!1;#a=null;#h=null;#l=null;#u=null;#d=!1;static#f=null;static _l10n=null;constructor(t){this.#h=t,this.#d=t._uiManager.useNewAltTextFlow,bi.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){bi._l10n??=t}async render(){const t=this.#n=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#i=document.createElement("span");t.append(e),this.#d?(t.classList.add("new"),t.setAttribute("data-l10n-id",bi.#f.missing),e.setAttribute("data-l10n-id",bi.#f["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const i=this.#h._uiManager._signal;t.addEventListener("contextmenu",ii,{signal:i}),t.addEventListener("pointerdown",s=>s.stopPropagation(),{signal:i});const n=s=>{s.preventDefault(),this.#h._uiManager.editAltText(this.#h),this.#d&&this.#h._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#m}})};return t.addEventListener("click",n,{capture:!0,signal:i}),t.addEventListener("keydown",s=>{s.target===t&&s.key==="Enter"&&(this.#r=!0,n(s))},{signal:i}),await this.#p(),t}get#m(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#n&&(this.#n.focus({focusVisible:this.#r}),this.#r=!1)}isEmpty(){return this.#d?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#d?this.#t!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}async setGuessedText(t){this.#t===null&&(this.#l=t,this.#u=await bi._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#p())}toggleAltTextBadge(t=!1){if(!this.#d||this.#t){this.#a?.remove(),this.#a=null;return}if(!this.#a){const e=this.#a=document.createElement("div");e.className="noAltTextBadge",this.#h.div.append(e)}this.#a.classList.toggle("hidden",!t)}serialize(t){let e=this.#t;return!t&&this.#l===e&&(e=this.#u),{altText:e,decorative:this.#e,guessedText:this.#l,textWithDisclaimer:this.#u}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:e,guessedText:i,textWithDisclaimer:n,cancel:s=!1}){i&&(this.#l=i,this.#u=n),!(this.#t===t&&this.#e===e)&&(s||(this.#t=t,this.#e=e),this.#p())}toggle(t=!1){this.#n&&(!t&&this.#s&&(clearTimeout(this.#s),this.#s=null),this.#n.disabled=!t)}shown(){this.#h._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#m}})}destroy(){this.#n?.remove(),this.#n=null,this.#i=null,this.#o=null,this.#a?.remove(),this.#a=null}async#p(){const t=this.#n;if(!t)return;if(this.#d){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",bi.#f[this.#m]),this.#i?.setAttribute("data-l10n-id",bi.#f[`${this.#m}-label`]),!this.#t){this.#o?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#o?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#o;if(!e){this.#o=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#h.id}`;const n=100,s=this.#h._uiManager._signal;s.addEventListener("abort",()=>{clearTimeout(this.#s),this.#s=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#s=setTimeout(()=>{this.#s=null,this.#o.classList.add("show"),this.#h._reportTelemetry({action:"alt_text_tooltip"})},n)},{signal:s}),t.addEventListener("mouseleave",()=>{this.#s&&(clearTimeout(this.#s),this.#s=null),this.#o?.classList.remove("show")},{signal:s})}this.#e?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#t),e.parentNode||t.append(e),this.#h.getElementForAltText()?.setAttribute("aria-describedby",e.id)}}class ks{#t=null;#e=null;#n=!1;#i=null;#o=null;#s=null;#r=null;#a=null;#h=!1;#l=null;constructor(t){this.#i=t}renderForToolbar(){const t=this.#e=document.createElement("button");return t.className="comment",this.#u(t,!1)}renderForStandalone(){const t=this.#t=document.createElement("button");t.className="annotationCommentButton";const e=this.#i.commentButtonPosition;if(e){const{style:i}=t;i.insetInlineEnd=`calc(${100*(this.#i._uiManager.direction==="ltr"?1-e[0]:e[0])}% - var(--comment-button-dim))`,i.top=`calc(${100*e[1]}% - var(--comment-button-dim))`;const n=this.#i.commentButtonColor;n&&(i.backgroundColor=n)}return this.#u(t,!0)}focusButton(){setTimeout(()=>{(this.#t??this.#e)?.focus()},0)}onUpdatedColor(){if(!this.#t)return;const t=this.#i.commentButtonColor;t&&(this.#t.style.backgroundColor=t),this.#i._uiManager.updatePopupColor(this.#i)}get commentButtonWidth(){return(this.#t?.getBoundingClientRect().width??0)/this.#i.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#l)return this.#l;if(!this.#t)return null;const{x:t,y:e,height:i}=this.#t.getBoundingClientRect(),{x:n,y:s,width:r,height:o}=this.#i.parent.boundingClientRect;return[(t-n)/r,(e+i-s)/o]}set commentPopupPositionInLayer(t){this.#l=t}hasDefaultPopupPosition(){return this.#l===null}removeStandaloneCommentButton(){this.#t?.remove(),this.#t=null}removeToolbarCommentButton(){this.#e?.remove(),this.#e=null}setCommentButtonStates({selected:t,hasPopup:e}){this.#t&&(this.#t.classList.toggle("selected",t),this.#t.ariaExpanded=e)}#u(t,e){if(!this.#i._uiManager.hasCommentManager())return null;t.tabIndex="0",t.ariaHasPopup="dialog",e?(t.ariaControls="commentPopup",t.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(t.ariaControlsElements=[this.#i._uiManager.getCommentDialogElement()],t.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button"));const i=this.#i._uiManager._signal;if(!(i instanceof AbortSignal)||i.aborted)return t;t.addEventListener("contextmenu",ii,{signal:i}),e&&(t.addEventListener("focusin",s=>{this.#i._focusEventsAllowed=!1,Qt(s)},{capture:!0,signal:i}),t.addEventListener("focusout",s=>{this.#i._focusEventsAllowed=!0,Qt(s)},{capture:!0,signal:i})),t.addEventListener("pointerdown",s=>s.stopPropagation(),{signal:i});const n=s=>{s.preventDefault(),t===this.#e?this.edit():this.#i.toggleComment(!0)};return t.addEventListener("click",n,{capture:!0,signal:i}),t.addEventListener("keydown",s=>{s.target===t&&s.key==="Enter"&&(this.#n=!0,n(s))},{signal:i}),t.addEventListener("pointerenter",()=>{this.#i.toggleComment(!1,!0)},{signal:i}),t.addEventListener("pointerleave",()=>{this.#i.toggleComment(!1,!1)},{signal:i}),t}edit(t){const e=this.commentPopupPositionInLayer;let i,n;if(e)[i,n]=e;else{[i,n]=this.#i.commentButtonPosition;const{width:c,height:u,x:p,y}=this.#i;i=p+i*c,n=y+n*u}const s=this.#i.parent.boundingClientRect,{x:r,y:o,width:l,height:d}=s;this.#i._uiManager.editComment(this.#i,r+i*l,o+n*d,{...t,parentDimensions:s})}finish(){this.#e&&(this.#e.focus({focusVisible:this.#n}),this.#n=!1)}isDeleted(){return this.#h||this.#r===""}isEmpty(){return this.#r===null}hasBeenEdited(){return this.isDeleted()||this.#r!==this.#o}serialize(){return this.data}get data(){return{text:this.#r,richText:this.#s,date:this.#a,deleted:this.isDeleted()}}set data(t){if(t!==this.#r&&(this.#s=null),t===null){this.#r="",this.#h=!0;return}this.#r=t,this.#a=new Date,this.#h=!1}setInitialText(t,e=null){this.#o=t,this.data=t,this.#a=null,this.#s=e}shown(){}destroy(){this.#e?.remove(),this.#e=null,this.#t?.remove(),this.#t=null,this.#r="",this.#s=null,this.#a=null,this.#i=null,this.#n=!1,this.#h=!1}}class yr{#t;#e=!1;#n=null;#i;#o;#s;#r;#a=null;#h;#l=null;#u;#d=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:i=null,onPinchStart:n=null,onPinching:s=null,onPinchEnd:r=null,signal:o}){this.#t=t,this.#n=i,this.#i=e,this.#o=n,this.#s=s,this.#r=r,this.#u=new AbortController,this.#h=AbortSignal.any([o,this.#u.signal]),t.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#h})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Ei.pixelRatio}#f(t){if(this.#i?.())return;if(t.touches.length===1){if(this.#a)return;const n=this.#a=new AbortController,s=AbortSignal.any([this.#h,n.signal]),r=this.#t,o={capture:!0,signal:s,passive:!1},l=d=>{d.pointerType==="touch"&&(this.#a?.abort(),this.#a=null)};r.addEventListener("pointerdown",d=>{d.pointerType==="touch"&&(Qt(d),l(d))},o),r.addEventListener("pointerup",l,o),r.addEventListener("pointercancel",l,o);return}if(!this.#d){this.#d=new AbortController;const n=AbortSignal.any([this.#h,this.#d.signal]),s=this.#t,r={signal:n,capture:!1,passive:!1};s.addEventListener("touchmove",this.#m.bind(this),r);const o=this.#p.bind(this);s.addEventListener("touchend",o,r),s.addEventListener("touchcancel",o,r),r.capture=!0,s.addEventListener("pointerdown",Qt,r),s.addEventListener("pointermove",Qt,r),s.addEventListener("pointercancel",Qt,r),s.addEventListener("pointerup",Qt,r),this.#o?.()}if(Qt(t),t.touches.length!==2||this.#n?.()){this.#l=null;return}let[e,i]=t.touches;e.identifier>i.identifier&&([e,i]=[i,e]),this.#l={touch0X:e.screenX,touch0Y:e.screenY,touch1X:i.screenX,touch1Y:i.screenY}}#m(t){if(!this.#l||t.touches.length!==2)return;Qt(t);let[e,i]=t.touches;e.identifier>i.identifier&&([e,i]=[i,e]);const{screenX:n,screenY:s}=e,{screenX:r,screenY:o}=i,l=this.#l,{touch0X:d,touch0Y:c,touch1X:u,touch1Y:p}=l,y=u-d,v=p-c,w=r-n,x=o-s,S=Math.hypot(w,x)||1,P=Math.hypot(y,v)||1;if(!this.#e&&Math.abs(P-S)<=yr.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=n,l.touch0Y=s,l.touch1X=r,l.touch1Y=o,!this.#e){this.#e=!0;return}const k=[(n+r)/2,(s+o)/2];this.#s?.(k,P,S)}#p(t){t.touches.length>=2||(this.#d&&(this.#d.abort(),this.#d=null,this.#r?.()),this.#l&&(Qt(t),this.#l=null,this.#e=!1))}destroy(){this.#u?.abort(),this.#u=null,this.#a?.abort(),this.#a=null}}class nt{#t=null;#e=null;#n=null;#i=null;#o=null;#s=!1;#r=null;#a="";#h=null;#l=null;#u=null;#d=null;#f=null;#m="";#p=!1;#c=null;#g=!1;#y=!1;#w=!1;#b=null;#C=0;#S=0;#v=null;#T=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#E=!1;#x=nt._zIndex++;static _borderLineWidth=-1;static _colorManager=new Do;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=nt.prototype._resizeWithKeyboard,e=Gi.TRANSLATE_SMALL,i=Gi.TRANSLATE_BIG;return yt(this,"_resizerKeyboardManager",new bs([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,i]}],[["Escape","mac+Escape"],nt.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null,this.creationDate=t.creationDate||new Date,this.modificationDate=t.modificationDate||null;const{rotation:e,rawDims:{pageWidth:i,pageHeight:n,pageX:s,pageY:r}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,n],this.pageTranslation=[s,r];const[o,l]=this.parentDimensions;this.x=t.x/o,this.y=t.y/l,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return yt(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new hd({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(nt._l10n??=t,nt._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),nt._borderLineWidth!==-1)return;const i=getComputedStyle(document.documentElement);nt._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){It("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#E}set _isDraggable(t){this.#E=t,this.div?.classList.toggle("draggable",t)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#x}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):(this.#O(),this.#d?.remove(),this.#d=null),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#p?this.#p=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,i,n){const[s,r]=this.parentDimensions;[i,n]=this.screenToPageTranslation(i,n),this.x=(t+i)/s,this.y=(e+n)/r,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[i,n]=this.parentDimensions;this.setAt(t*i,e*n,this.width*i,this.height*n),this._onTranslated()}#D([t,e],i,n){[i,n]=this.screenToPageTranslation(i,n),this.x+=i/t,this.y+=n/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#D(this.parentDimensions,t,e)}translateInPage(t,e){this.#c||=[this.x,this.y,this.width,this.height],this.#D(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){this.#c||=[this.x,this.y,this.width,this.height];const{div:i,parentDimensions:[n,s]}=this;if(this.x+=t/n,this.y+=e/s,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:u,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,u,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:o}=this;const[l,d]=this.getBaseTranslation();r+=l,o+=d;const{style:c}=i;c.left=`${(100*r).toFixed(2)}%`,c.top=`${(100*o).toFixed(2)}%`,this._onTranslating(r,o),i.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#c&&(this.#c[0]!==this.x||this.#c[1]!==this.y)}get _hasBeenResized(){return!!this.#c&&(this.#c[2]!==this.width||this.#c[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:i}=nt,n=i/t,s=i/e;switch(this.rotation){case 90:return[-n,s];case 180:return[n,s];case 270:return[n,-s];default:return[-n,-s]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[i,n]}=this;let{x:s,y:r,width:o,height:l}=this;if(o*=i,l*=n,s*=i,r*=n,this._mustFixPosition)switch(t){case 0:s=Ie(s,0,i-o),r=Ie(r,0,n-l);break;case 90:s=Ie(s,0,i-l),r=Ie(r,o,n);break;case 180:s=Ie(s,o,i),r=Ie(r,l,n);break;case 270:s=Ie(s,l,i),r=Ie(r,0,n-o);break}this.x=s/=i,this.y=r/=n;const[d,c]=this.getBaseTranslation();s+=d,r+=c,e.left=`${(100*s).toFixed(2)}%`,e.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}static#P(t,e,i){switch(i){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return nt.#P(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return nt.#P(t,e,360-this.parentRotation)}#k(t){switch(t){case 90:{const[e,i]=this.pageDimensions;return[0,-e/i,i/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,i]=this.pageDimensions;return[0,e/i,-i/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,i]}=this;return[e*t,i*t]}setDims(){const{div:{style:t},width:e,height:i}=this;t.width=`${(100*e).toFixed(2)}%`,t.height=`${(100*i).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#N(){if(this.#h)return;this.#h=document.createElement("div"),this.#h.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const i of t){const n=document.createElement("div");this.#h.append(n),n.classList.add("resizer",i),n.setAttribute("data-resizer-name",i),n.addEventListener("pointerdown",this.#I.bind(this,i),{signal:e}),n.addEventListener("contextmenu",ii,{signal:e}),n.tabIndex=-1}this.div.prepend(this.#h)}#I(t,e){e.preventDefault();const{isMac:i}=ve.platform;if(e.button!==0||e.ctrlKey&&i)return;this.#n?.toggle(!1);const n=this._isDraggable;this._isDraggable=!1,this.#l=[e.screenX,e.screenY];const s=new AbortController,r=this._uiManager.combinedSignal(s);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#F.bind(this,t),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",Qt,{passive:!1,signal:r}),window.addEventListener("contextmenu",ii,{signal:r}),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const d=()=>{s.abort(),this.parent.togglePointerEvents(!0),this.#n?.toggle(!0),this._isDraggable=n,this.parent.div.style.cursor=o,this.div.style.cursor=l,this.#B()};window.addEventListener("pointerup",d,{signal:r}),window.addEventListener("blur",d,{signal:r})}#R(t,e,i,n){this.width=i,this.height=n,this.x=t,this.y=e,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#B(){if(!this.#u)return;const{savedX:t,savedY:e,savedWidth:i,savedHeight:n}=this.#u;this.#u=null;const s=this.x,r=this.y,o=this.width,l=this.height;s===t&&r===e&&o===i&&l===n||this.addCommands({cmd:this.#R.bind(this,s,r,o,l),undo:this.#R.bind(this,t,e,i,n),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#F(t,e){const[i,n]=this.parentDimensions,s=this.x,r=this.y,o=this.width,l=this.height,d=nt.MIN_SIZE/i,c=nt.MIN_SIZE/n,u=this.#k(this.rotation),p=(V,W)=>[u[0]*V+u[2]*W,u[1]*V+u[3]*W],y=this.#k(360-this.rotation),v=(V,W)=>[y[0]*V+y[2]*W,y[1]*V+y[3]*W];let w,x,S=!1,P=!1;switch(t){case"topLeft":S=!0,w=(V,W)=>[0,0],x=(V,W)=>[V,W];break;case"topMiddle":w=(V,W)=>[V/2,0],x=(V,W)=>[V/2,W];break;case"topRight":S=!0,w=(V,W)=>[V,0],x=(V,W)=>[0,W];break;case"middleRight":P=!0,w=(V,W)=>[V,W/2],x=(V,W)=>[0,W/2];break;case"bottomRight":S=!0,w=(V,W)=>[V,W],x=(V,W)=>[0,0];break;case"bottomMiddle":w=(V,W)=>[V/2,W],x=(V,W)=>[V/2,0];break;case"bottomLeft":S=!0,w=(V,W)=>[0,W],x=(V,W)=>[V,0];break;case"middleLeft":P=!0,w=(V,W)=>[0,W/2],x=(V,W)=>[V,W/2];break}const k=w(o,l),D=x(o,l);let M=p(...D);const R=nt._round(s+M[0]),N=nt._round(r+M[1]);let F=1,O=1,H,U;if(e.fromKeyboard)({deltaX:H,deltaY:U}=e);else{const{screenX:V,screenY:W}=e,[Q,Ct]=this.#l;[H,U]=this.screenToPageTranslation(V-Q,W-Ct),this.#l[0]=V,this.#l[1]=W}if([H,U]=v(H/i,U/n),S){const V=Math.hypot(o,l);F=O=Math.max(Math.min(Math.hypot(D[0]-k[0]-H,D[1]-k[1]-U)/V,1/o,1/l),d/o,c/l)}else P?F=Ie(Math.abs(D[0]-k[0]-H),d,1)/o:O=Ie(Math.abs(D[1]-k[1]-U),c,1)/l;const K=nt._round(o*F),z=nt._round(l*O);M=p(...x(K,z));const G=R-M[0],et=N-M[1];this.#c||=[this.x,this.y,this.width,this.height],this.width=K,this.height=z,this.x=G,this.y=et,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#n?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#y)return this._editToolbar;this._editToolbar=new Qn(this),this.div.append(this._editToolbar.render());const{toolbarButtons:t}=this;if(t)for(const[e,i]of t)await this._editToolbar.addButton(e,i);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#n?.destroy()}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#n||(bi.initialize(nt._l10n),this.#n=new bi(this),this.#t&&(this.#n.data=this.#t,this.#t=null)),this.#n}get altTextData(){return this.#n?.data}set altTextData(t){this.#n&&(this.#n.data=t)}get guessedAltText(){return this.#n?.guessedText}async setGuessedAltText(t){await this.#n?.setGuessedText(t)}serializeAltText(t){return this.#n?.serialize(t)}hasAltText(){return!!this.#n&&!this.#n.isEmpty()}hasAltTextData(){return this.#n?.hasData()??!1}focusCommentButton(){this.#i?.focusButton()}addCommentButton(){return this.#i||=new ks(this)}addStandaloneCommentButton(){if(this.#o){this._uiManager.isEditingMode()&&this.#o.classList.remove("hidden");return}this.hasComment&&(this.#o=this.#i.renderForStandalone(),this.div.append(this.#o))}removeStandaloneCommentButton(){this.#i.removeStandaloneCommentButton(),this.#o=null}hideStandaloneCommentButton(){this.#o?.classList.add("hidden")}get comment(){const{data:{richText:t,text:e,date:i,deleted:n}}=this.#i;return{text:e,richText:t,date:i,deleted:n,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(t){this.#i||=new ks(this),this.#i.data=t,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:t,popupRef:e,richText:i}){if(!e||(this.#i||=new ks(this),this.#i.setInitialText(t,i),!this.annotationElementId))return;const n=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);n&&this.updateFromAnnotationLayer(n)}get hasEditedComment(){return this.#i?.hasBeenEdited()}get hasDeletedComment(){return this.#i?.isDeleted()}get hasComment(){return!!this.#i&&!this.#i.isEmpty()&&!this.#i.isDeleted()}async editComment(t){this.#i||=new ks(this),this.#i.edit(t)}toggleComment(t,e=void 0){this.hasComment&&this._uiManager.toggleComment(this,t,e)}setSelectedCommentButton(t){this.#i.setSelectedButton(t)}addComment(t){if(this.hasEditedComment){const[,,,n]=t.rect,[s]=this.pageDimensions,[r]=this.pageTranslation,o=r+s+1,l=n-100,d=o+180;t.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[o,l,d,n]}}}updateFromAnnotationLayer({popup:{contents:t,deleted:e}}){this.#i.data=e?null:t}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=this.#s?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),this.#H();const[e,i]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*i/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/i).toFixed(2)}%`);const[n,s]=this.getInitialTranslation();return this.translate(n,s),Ul(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#T||=new yr({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#G.bind(this),onPinching:this.#_.bind(this),onPinchEnd:this.#A.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),t}#G(){this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#n?.toggle(!1),this.parent.togglePointerEvents(!1)}#_(t,e,i){let s=.7*(i/e)+1-.7;if(s===1)return;const r=this.#k(this.rotation),o=(R,N)=>[r[0]*R+r[2]*N,r[1]*R+r[3]*N],[l,d]=this.parentDimensions,c=this.x,u=this.y,p=this.width,y=this.height,v=nt.MIN_SIZE/l,w=nt.MIN_SIZE/d;s=Math.max(Math.min(s,1/p,1/y),v/p,w/y);const x=nt._round(p*s),S=nt._round(y*s);if(x===p&&S===y)return;this.#c||=[c,u,p,y];const P=o(p/2,y/2),k=nt._round(c+P[0]),D=nt._round(u+P[1]),M=o(x/2,S/2);this.x=k-M[0],this.y=D-M[1],this.width=x,this.height=S,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#A(){this.#n?.toggle(!0),this.parent.togglePointerEvents(!0),this.#B()}pointerdown(t){const{isMac:e}=ve.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#p=!0,this._isDraggable){this.#U(t);return}this.#M(t)}#M(t){const{isMac:e}=ve.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#U(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let i=!1;const n=new AbortController,s=this._uiManager.combinedSignal(n),r={capture:!0,passive:!1,signal:s},o=d=>{n.abort(),this.#r=null,this.#p=!1,this._uiManager.endDragSession()||this.#M(d),i&&this._onStopDragging()};e&&(this.#C=t.clientX,this.#S=t.clientY,this.#r=t.pointerId,this.#a=t.pointerType,window.addEventListener("pointermove",d=>{i||(i=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:c,clientY:u,pointerId:p}=d;if(p!==this.#r){Qt(d);return}const[y,v]=this.screenToPageTranslation(c-this.#C,u-this.#S);this.#C=c,this.#S=u,this._uiManager.dragSelectedEditors(y,v)},r),window.addEventListener("touchmove",Qt,r),window.addEventListener("pointerdown",d=>{d.pointerType===this.#a&&(this.#T||d.isPrimary)&&o(d),Qt(d)},r));const l=d=>{if(!this.#r||this.#r===d.pointerId){o(d);return}Qt(d)};window.addEventListener("pointerup",l,{signal:s}),window.addEventListener("blur",l,{signal:s})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#b&&clearTimeout(this.#b),this.#b=setTimeout(()=>{this.#b=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,i){t.changeParent(this),this.x=e,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,i=this.rotation){const n=this.parentScale,[s,r]=this.pageDimensions,[o,l]=this.pageTranslation,d=t/n,c=e/n,u=this.x*s,p=this.y*r,y=this.width*s,v=this.height*r;switch(i){case 0:return[u+d+o,r-p-c-v+l,u+d+y+o,r-p-c+l];case 90:return[u+c+o,r-p+d+l,u+c+v+o,r-p+d+y+l];case 180:return[u-d-y+o,r-p+c+l,u-d+o,r-p+c+v+l];case 270:return[u-c-v+o,r-p-d-y+l,u-c+o,r-p-d+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[i,n,s,r]=t,o=s-i,l=r-n;switch(this.rotation){case 0:return[i,e-r,o,l];case 90:return[i,e-n,l,o];case 180:return[s,e-n,o,l];case 270:return[s,e-r,l,o];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&nt._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#i?.onUpdatedColor()}getData(){const{comment:{text:t,color:e,date:i,opacity:n,deleted:s,richText:r},uid:o,pageIndex:l,creationDate:d,modificationDate:c}=this;return{id:o,pageIndex:l,rect:this.getPDFRect(),richText:r,contentsObj:{str:t},creationDate:d,modificationDate:i||c,popupRef:!s,color:e,opacity:n}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#y=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#y=!1,!0):!1}isInEditMode(){return this.#y}shouldGetKeyboardEvents(){return this.#w}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:i,right:n}=this.getClientDimensions(),{innerHeight:s,innerWidth:r}=window;return e<r&&n>0&&t<s&&i>0}#H(){if(this.#f||!this.div)return;this.#f=new AbortController;const t=this._uiManager.combinedSignal(this.#f);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#H()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(t,e,i){const n=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:i,annotationElementId:t.annotationElementId,creationDate:t.creationDate,modificationDate:t.modificationDate});n.rotation=t.rotation,n.#t=t.accessibilityData,n._isCopy=t.isCopy||!1;const[s,r]=n.pageDimensions,[o,l,d,c]=n.getRectInCurrentCoords(t.rect,r);return n.x=o/s,n.y=l/r,n.width=d/s,n.height=c/r,n}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#f?.abort(),this.#f=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#b&&(clearTimeout(this.#b),this.#b=null),this.#O(),this.removeEditToolbar(),this.#v){for(const t of this.#v.values())clearTimeout(t);this.#v=null}this.parent=null,this.#T?.destroy(),this.#T=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#N(),this.#h.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[t,e]}=this,[i,n,s,r]=this.getPDFRect();return[nt._round(i+(s-i)*t),nt._round(n+(r-n)*(1-e))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#i.commentPopupPositionInLayer}set commentPopupPosition(t){this.#i.commentPopupPositionInLayer=t}hasDefaultPopupPosition(){return this.#i.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#i.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(t){this.#i.setCommentButtonStates(t)}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#h.children;if(!this.#e){this.#e=Array.from(e);const r=this.#q.bind(this),o=this.#W.bind(this),l=this._uiManager._signal;for(const d of this.#e){const c=d.getAttribute("data-resizer-name");d.setAttribute("role","spinbutton"),d.addEventListener("keydown",r,{signal:l}),d.addEventListener("blur",o,{signal:l}),d.addEventListener("focus",this.#X.bind(this,c),{signal:l}),d.setAttribute("data-l10n-id",nt._l10nResizer[c])}}const i=this.#e[0];let n=0;for(const r of e){if(r===i)break;n++}const s=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(s!==n){if(s<n)for(let o=0;o<n-s;o++)this.#h.append(this.#h.firstChild);else if(s>n)for(let o=0;o<s-n;o++)this.#h.firstChild.before(this.#h.lastChild);let r=0;for(const o of e){const d=this.#e[r++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",nt._l10nResizer[d])}}this.#j(0),this.#w=!0,this.#h.firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#q(t){nt._resizerKeyboardManager.exec(this,t)}#W(t){this.#w&&t.relatedTarget?.parentNode!==this.#h&&this.#O()}#X(t){this.#m=this.#w?t:""}#j(t){if(this.#e)for(const e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#w&&this.#F(this.#m,{deltaX:t,deltaY:e,fromKeyboard:!0})}#O(){this.#w=!1,this.#j(-1),this.#B()}_stopResizingWithKeyboard(){this.#O(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#n?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#h?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#n?.toggleAltTextBadge(!0),this.hasComment&&this._uiManager.toggleComment(this,!1,!1))}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){t.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#g}set isEditing(t){this.#g=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#v||=new Map;const{action:i}=t;let n=this.#v.get(i);n&&clearTimeout(n),n=setTimeout(()=>{this._reportTelemetry(t),this.#v.delete(i),this.#v.size===0&&(this.#v=null)},nt._telemetryTimeout),this.#v.set(i,n);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#s=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#s=!0}updateFakeAnnotationElement(t){if(!this.#d&&!this.deleted){this.#d=t.addFakeAnnotation(this);return}if(this.deleted){this.#d.remove(),this.#d=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#d.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const i=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),i.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}}class hd extends nt{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const xa=3285377520,Je=4294901760,pi=65535;class $l{constructor(t){this.h1=t?t&4294967295:xa,this.h2=t?t&4294967295:xa}update(t){let e,i;if(typeof t=="string"){e=new Uint8Array(t.length*2),i=0;for(let w=0,x=t.length;w<x;w++){const S=t.charCodeAt(w);S<=255?e[i++]=S:(e[i++]=S>>>8,e[i++]=S&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),i=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const n=i>>2,s=i-n*4,r=new Uint32Array(e.buffer,0,n);let o=0,l=0,d=this.h1,c=this.h2;const u=3432918353,p=461845907,y=u&pi,v=p&pi;for(let w=0;w<n;w++)w&1?(o=r[w],o=o*u&Je|o*y&pi,o=o<<15|o>>>17,o=o*p&Je|o*v&pi,d^=o,d=d<<13|d>>>19,d=d*5+3864292196):(l=r[w],l=l*u&Je|l*y&pi,l=l<<15|l>>>17,l=l*p&Je|l*v&pi,c^=l,c=c<<13|c>>>19,c=c*5+3864292196);switch(o=0,s){case 3:o^=e[n*4+2]<<16;case 2:o^=e[n*4+1]<<8;case 1:o^=e[n*4],o=o*u&Je|o*y&pi,o=o<<15|o>>>17,o=o*p&Je|o*v&pi,n&1?d^=o:c^=o}this.h1=d,this.h2=c}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&Je|t*36045&pi,e=e*4283543511&Je|((e<<16|t>>>16)*2950163797&Je)>>>16,t^=e>>>1,t=t*444984403&Je|t*60499&pi,e=e*3301882366&Je|((e<<16|t>>>16)*3120437893&Je)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const lo=Object.freeze({map:null,hash:"",transfer:void 0});class Lo{#t=!1;#e=null;#n=null;#i=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const i=this.#i.get(t);return i===void 0?e:Object.assign(e,i)}getRawValue(t){return this.#i.get(t)}remove(t){const e=this.#i.get(t);if(e!==void 0&&(e instanceof nt&&this.#n.delete(e.annotationElementId),this.#i.delete(t),this.#i.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const i of this.#i.values())if(i instanceof nt)return;this.onAnnotationEditor(null)}}setValue(t,e){const i=this.#i.get(t);let n=!1;if(i!==void 0)for(const[s,r]of Object.entries(e))i[s]!==r&&(n=!0,i[s]=r);else n=!0,this.#i.set(t,e);n&&this.#o(),e instanceof nt&&((this.#n||=new Map).set(e.annotationElementId,e),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type))}has(t){return this.#i.has(t)}get size(){return this.#i.size}#o(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Hl(this)}get serializable(){if(this.#i.size===0)return lo;const t=new Map,e=new $l,i=[],n=Object.create(null);let s=!1;for(const[r,o]of this.#i){const l=o instanceof nt?o.serialize(!1,n):o;l&&(t.set(r,l),e.update(`${r}:${JSON.stringify(l)}`),s||=!!l.bitmap)}if(s)for(const r of t.values())r.bitmap&&i.push(r.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:i}:lo}get editorStats(){let t=null;const e=new Map;let i=0,n=0;for(const s of this.#i.values()){if(!(s instanceof nt)){s.popup&&(s.popup.deleted?n+=1:i+=1);continue}s.isCommentDeleted?n+=1:s.hasEditedComment&&(i+=1);const r=s.telemetryFinalData;if(!r)continue;const{type:o}=r;e.has(o)||e.set(o,Object.getPrototypeOf(s).constructor),t||=Object.create(null);const l=t[o]||=new Map;for(const[d,c]of Object.entries(r)){if(d==="type")continue;let u=l.get(d);u||(u=new Map,l.set(d,u));const p=u.get(c)??0;u.set(c,p+1)}}if((n>0||i>0)&&(t||=Object.create(null),t.comments={deleted:n,edited:i}),!t)return null;for(const[s,r]of e)t[s]=r.computeTelemetryFinalData(t[s]);return t}resetModifiedIds(){this.#e=null}updateEditor(t,e){const i=this.#n?.get(t);return i?(i.updateFromAnnotationLayer(e),!0):!1}getEditor(t){return this.#n?.get(t)||null}get modifiedIds(){if(this.#e)return this.#e;const t=[];if(this.#n)for(const e of this.#n.values())e.serialize()&&t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#i.entries()}}class Hl extends Lo{#t;constructor(t){super();const{map:e,hash:i,transfer:n}=t.serializable,s=structuredClone(e,n?{transfer:n}:null);this.#t={map:s,hash:i,transfer:n}}get print(){It("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return yt(this,"modifiedIds",{ids:new Set,hash:""})}}class cd{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:i}){if(!(!t||this.#t.has(t.loadedName))){if(xt(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:n,src:s,style:r}=t,o=new FontFace(n,s,r);this.addNativeFontFace(o);try{await o.load(),this.#t.add(n),i?.(t)}catch{ut(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}It("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const i=t.createNativeFontFace();if(i){this.addNativeFontFace(i);try{await i.loaded}catch(n){throw ut(`Failed to load font '${i.family}': '${n}'.`),t.disableFontFace=!0,n}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(i=>{const n=this._queueLoadingCallback(i);this._prepareFontLoadEvent(t,n)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return yt(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return yt(this,"isSyncFontLoadingSupported",Le||ve.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(xt(!n.done,"completeRequest() cannot be called twice."),n.done=!0;i.length>0&&i[0].done;){const s=i.shift();setTimeout(s.callback,0)}}const{loadingRequests:i}=this,n={done:!1,complete:e,callback:t};return i.push(n),n}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return yt(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function i(D,M){return D.charCodeAt(M)<<24|D.charCodeAt(M+1)<<16|D.charCodeAt(M+2)<<8|D.charCodeAt(M+3)&255}function n(D,M,R,N){const F=D.substring(0,M),O=D.substring(M+R);return F+N+O}let s,r;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let d=0;function c(D,M){if(++d>30){ut("Load test font never loaded."),M();return}if(l.font="30px "+D,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){M();return}setTimeout(c.bind(null,D,M))}const u=`lt${Date.now()}${this.loadTestFontId++}`;let p=this._loadTestFont;p=n(p,976,u.length,u);const v=16,w=1482184792;let x=i(p,v);for(s=0,r=u.length-3;s<r;s+=4)x=x-w+i(u,s)|0;s<u.length&&(x=x-w+i(u+"XXX",s)|0),p=n(p,v,4,Gc(x));const S=`url(data:font/opentype;base64,${btoa(p)});`,P=`@font-face {font-family:"${u}";src:${S}}`;this.insertRule(P);const k=this._document.createElement("div");k.style.visibility="hidden",k.style.width=k.style.height="10px",k.style.position="absolute",k.style.top=k.style.left="0px";for(const D of[t.loadedName,u]){const M=this._document.createElement("span");M.textContent="Hi",M.style.fontFamily=D,k.append(M)}this._document.body.append(k),c(u,()=>{k.remove(),e.complete()})}}class dd{#t;constructor(t,e=null,i,n){this.compiledGlyphs=Object.create(null),this.#t=t,this._inspectFont=e,i&&Object.assign(this,i),n&&(this.charProcOperatorList=n)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${Ol(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const i=this.loadedName+"_path_"+e;let n;try{n=t.get(i)}catch(r){ut(`getPathGenerator - ignoring character: "${r}".`)}const s=new Path2D(n||"");return this.fontExtraProperties||t.delete(i),this.compiledGlyphs[e]=s}get black(){return this.#t.black}get bold(){return this.#t.bold}get disableFontFace(){return this.#t.disableFontFace??!1}get fontExtraProperties(){return this.#t.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#t.isInvalidPDFjsFont}get isType3Font(){return this.#t.isType3Font}get italic(){return this.#t.italic}get missingFile(){return this.#t.missingFile}get remeasure(){return this.#t.remeasure}get vertical(){return this.#t.vertical}get ascent(){return this.#t.ascent}get defaultWidth(){return this.#t.defaultWidth}get descent(){return this.#t.descent}get bbox(){return this.#t.bbox}get fontMatrix(){return this.#t.fontMatrix}get fallbackName(){return this.#t.fallbackName}get loadedName(){return this.#t.loadedName}get mimetype(){return this.#t.mimetype}get name(){return this.#t.name}get data(){return this.#t.data}clearData(){this.#t.clearData()}get cssFontInfo(){return this.#t.cssFontInfo}get systemFontInfo(){return this.#t.systemFontInfo}get defaultVMetrics(){return this.#t.defaultVMetrics}}function ud(a){if(a instanceof URL)return a.href;if(typeof a=="string"){if(Le)return a;const t=URL.parse(a,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function fd(a){if(Le&&typeof io<"u"&&a instanceof io)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(a instanceof Uint8Array&&a.byteLength===a.buffer.byteLength)return a;if(typeof a=="string")return ps(a);if(a instanceof ArrayBuffer||ArrayBuffer.isView(a)||typeof a=="object"&&!isNaN(a?.length))return new Uint8Array(a);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Ds(a){if(typeof a!="string")return null;if(a.endsWith("/"))return a;throw new Error(`Invalid factory url: "${a}" must include trailing slash.`)}const ho=a=>typeof a=="object"&&Number.isInteger(a?.num)&&a.num>=0&&Number.isInteger(a?.gen)&&a.gen>=0,pd=a=>typeof a=="object"&&typeof a?.name=="string",gd=Yc.bind(null,ho,pd);class md{#t=new Map;#e=Promise.resolve();postMessage(t,e){const i={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(const[n]of this.#t)n.call(this,i)})}addEventListener(t,e,i=null){let n=null;if(i?.signal instanceof AbortSignal){const{signal:s}=i;if(s.aborted){ut("LoopbackPort - cannot use an `aborted` signal.");return}const r=()=>this.removeEventListener(t,e);n=()=>s.removeEventListener("abort",r),s.addEventListener("abort",r)}this.#t.set(e,n)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(const[,t]of this.#t)t?.();this.#t.clear()}}const Ls={DATA:1,ERROR:2},se={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Ca(){}function Be(a){if(a instanceof zi||a instanceof so||a instanceof ya||a instanceof Zs||a instanceof Fr)return a;switch(a instanceof Error||typeof a=="object"&&a!==null||It('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),a.name){case"AbortException":return new zi(a.message);case"InvalidPDFException":return new so(a.message);case"PasswordException":return new ya(a.message,a.code);case"ResponseException":return new Zs(a.message,a.status,a.missing);case"UnknownErrorException":return new Fr(a.message,a.details)}return new Fr(a.message,a.toString())}class qn{#t=new AbortController;constructor(t,e,i){this.sourceName=t,this.targetName=e,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#i(t);return}if(t.callback){const i=t.callbackId,n=this.callbackCapabilities[i];if(!n)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],t.callback===Ls.DATA)n.resolve(t.data);else if(t.callback===Ls.ERROR)n.reject(Be(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const i=this.sourceName,n=t.sourceName,s=this.comObj;Promise.try(e,t.data).then(function(r){s.postMessage({sourceName:i,targetName:n,callback:Ls.DATA,callbackId:t.callbackId,data:r})},function(r){s.postMessage({sourceName:i,targetName:n,callback:Ls.ERROR,callbackId:t.callbackId,reason:Be(r)})});return}if(t.streamId){this.#n(t);return}e(t.data)}on(t,e){const i=this.actionHandler;if(i[t])throw new Error(`There is already an actionName called "${t}"`);i[t]=e}send(t,e,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},i)}sendWithPromise(t,e,i){const n=this.callbackId++,s=Promise.withResolvers();this.callbackCapabilities[n]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:n,data:e},i)}catch(r){s.reject(r)}return s.promise}sendWithStream(t,e,i,n){const s=this.streamId++,r=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:d=>{const c=Promise.withResolvers();return this.streamControllers[s]={controller:d,startCall:c,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:r,targetName:o,action:t,streamId:s,data:e,desiredSize:d.desiredSize},n),c.promise},pull:d=>{const c=Promise.withResolvers();return this.streamControllers[s].pullCall=c,l.postMessage({sourceName:r,targetName:o,stream:se.PULL,streamId:s,desiredSize:d.desiredSize}),c.promise},cancel:d=>{xt(d instanceof Error,"cancel must have a valid reason");const c=Promise.withResolvers();return this.streamControllers[s].cancelCall=c,this.streamControllers[s].isClosed=!0,l.postMessage({sourceName:r,targetName:o,stream:se.CANCEL,streamId:s,reason:Be(d)}),c.promise}},i)}#n(t){const e=t.streamId,i=this.sourceName,n=t.sourceName,s=this.comObj,r=this,o=this.actionHandler[t.action],l={enqueue(d,c=1,u){if(this.isCancelled)return;const p=this.desiredSize;this.desiredSize-=c,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),s.postMessage({sourceName:i,targetName:n,stream:se.ENQUEUE,streamId:e,chunk:d},u)},close(){this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:i,targetName:n,stream:se.CLOSE,streamId:e}),delete r.streamSinks[e])},error(d){xt(d instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,s.postMessage({sourceName:i,targetName:n,stream:se.ERROR,streamId:e,reason:Be(d)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[e]=l,Promise.try(o,t.data,l).then(function(){s.postMessage({sourceName:i,targetName:n,stream:se.START_COMPLETE,streamId:e,success:!0})},function(d){s.postMessage({sourceName:i,targetName:n,stream:se.START_COMPLETE,streamId:e,reason:Be(d)})})}#i(t){const e=t.streamId,i=this.sourceName,n=t.sourceName,s=this.comObj,r=this.streamControllers[e],o=this.streamSinks[e];switch(t.stream){case se.START_COMPLETE:t.success?r.startCall.resolve():r.startCall.reject(Be(t.reason));break;case se.PULL_COMPLETE:t.success?r.pullCall.resolve():r.pullCall.reject(Be(t.reason));break;case se.PULL:if(!o){s.postMessage({sourceName:i,targetName:n,stream:se.PULL_COMPLETE,streamId:e,success:!0});break}o.desiredSize<=0&&t.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=t.desiredSize,Promise.try(o.onPull||Ca).then(function(){s.postMessage({sourceName:i,targetName:n,stream:se.PULL_COMPLETE,streamId:e,success:!0})},function(d){s.postMessage({sourceName:i,targetName:n,stream:se.PULL_COMPLETE,streamId:e,reason:Be(d)})});break;case se.ENQUEUE:if(xt(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(t.chunk);break;case se.CLOSE:if(xt(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),this.#o(r,e);break;case se.ERROR:xt(r,"error should have stream controller"),r.controller.error(Be(t.reason)),this.#o(r,e);break;case se.CANCEL_COMPLETE:t.success?r.cancelCall.resolve():r.cancelCall.reject(Be(t.reason)),this.#o(r,e);break;case se.CANCEL:if(!o)break;const l=Be(t.reason);Promise.try(o.onCancel||Ca,l).then(function(){s.postMessage({sourceName:i,targetName:n,stream:se.CANCEL_COMPLETE,streamId:e,success:!0})},function(d){s.postMessage({sourceName:i,targetName:n,stream:se.CANCEL_COMPLETE,streamId:e,reason:Be(d)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#o(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#t?.abort(),this.#t=null}}class jl{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const i=this._createCanvas(t,e);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,i){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||i<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=i}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){It("Abstract method `_createCanvas` called.")}}class yd extends jl{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const i=this._document.createElement("canvas");return i.width=t,i.height=e,i}}class zl{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(i=>({cMapData:i,isCompressed:this.isCompressed})).catch(i=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){It("Abstract method `_fetch` called.")}}class _a extends zl{async _fetch(t){const e=await gs(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):ps(e)}}class Gl{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,i,n,s){return"none"}destroy(t=!1){}}class bd extends Gl{#t;#e;#n;#i;#o;#s;#r=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#i=t,this.#o=e}get#a(){return this.#e||=new Map}get#h(){return this.#s||=new Map}get#l(){if(!this.#n){const t=this.#o.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const i=this.#o.createElementNS(_i,"svg");i.setAttribute("width",0),i.setAttribute("height",0),this.#n=this.#o.createElementNS(_i,"defs"),t.append(i),i.append(this.#n),this.#o.body.append(t)}return this.#n}#u(t){if(t.length===1){const l=t[0],d=new Array(256);for(let u=0;u<256;u++)d[u]=l[u]/255;const c=d.join(",");return[c,c,c]}const[e,i,n]=t,s=new Array(256),r=new Array(256),o=new Array(256);for(let l=0;l<256;l++)s[l]=e[l]/255,r[l]=i[l]/255,o[l]=n[l]/255;return[s.join(","),r.join(","),o.join(",")]}#d(t){if(this.#t===void 0){this.#t="";const e=this.#o.URL;e!==this.#o.baseURI&&(mr(e)?ut('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=Ml(e,""))}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#a.get(t);if(e)return e;const[i,n,s]=this.#u(t),r=t.length===1?i:`${i}${n}${s}`;if(e=this.#a.get(r),e)return this.#a.set(t,e),e;const o=`g_${this.#i}_transfer_map_${this.#r++}`,l=this.#d(o);this.#a.set(t,l),this.#a.set(r,l);const d=this.#p(o);return this.#g(i,n,s,d),l}addHCMFilter(t,e){const i=`${t}-${e}`,n="base";let s=this.#h.get(n);if(s?.key===i||(s?(s.filter?.remove(),s.key=i,s.url="none",s.filter=null):(s={key:i,url:"none",filter:null},this.#h.set(n,s)),!t||!e))return s.url;const r=this.#w(t);t=tt.makeHexColor(...r);const o=this.#w(e);if(e=tt.makeHexColor(...o),this.#l.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return s.url;const l=new Array(256);for(let y=0;y<=255;y++){const v=y/255;l[y]=v<=.03928?v/12.92:((v+.055)/1.055)**2.4}const d=l.join(","),c=`g_${this.#i}_hcm_filter`,u=s.filter=this.#p(c);this.#g(d,d,d,u),this.#m(u);const p=(y,v)=>{const w=r[y]/255,x=o[y]/255,S=new Array(v+1);for(let P=0;P<=v;P++)S[P]=w+P/v*(x-w);return S.join(",")};return this.#g(p(0,5),p(1,5),p(2,5),u),s.url=this.#d(c),s.url}addAlphaFilter(t){let e=this.#a.get(t);if(e)return e;const[i]=this.#u([t]),n=`alpha_${i}`;if(e=this.#a.get(n),e)return this.#a.set(t,e),e;const s=`g_${this.#i}_alpha_map_${this.#r++}`,r=this.#d(s);this.#a.set(t,r),this.#a.set(n,r);const o=this.#p(s);return this.#y(i,o),r}addLuminosityFilter(t){let e=this.#a.get(t||"luminosity");if(e)return e;let i,n;if(t?([i]=this.#u([t]),n=`luminosity_${i}`):n="luminosity",e=this.#a.get(n),e)return this.#a.set(t,e),e;const s=`g_${this.#i}_luminosity_map_${this.#r++}`,r=this.#d(s);this.#a.set(t,r),this.#a.set(n,r);const o=this.#p(s);return this.#f(o),t&&this.#y(i,o),r}addHighlightHCMFilter(t,e,i,n,s){const r=`${e}-${i}-${n}-${s}`;let o=this.#h.get(t);if(o?.key===r||(o?(o.filter?.remove(),o.key=r,o.url="none",o.filter=null):(o={key:r,url:"none",filter:null},this.#h.set(t,o)),!e||!i))return o.url;const[l,d]=[e,i].map(this.#w.bind(this));let c=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),u=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),[p,y]=[n,s].map(this.#w.bind(this));u<c&&([c,u,p,y]=[u,c,y,p]),this.#l.style.color="";const v=(S,P,k)=>{const D=new Array(256),M=(u-c)/k,R=S/255,N=(P-S)/(255*k);let F=0;for(let O=0;O<=k;O++){const H=Math.round(c+O*M),U=R+O*N;for(let K=F;K<=H;K++)D[K]=U;F=H+1}for(let O=F;O<256;O++)D[O]=D[F-1];return D.join(",")},w=`g_${this.#i}_hcm_${t}_filter`,x=o.filter=this.#p(w);return this.#m(x),this.#g(v(p[0],y[0],5),v(p[1],y[1],5),v(p[2],y[2],5),x),o.url=this.#d(w),o.url}destroy(t=!1){t&&this.#s?.size||(this.#n?.parentNode.parentNode.remove(),this.#n=null,this.#e?.clear(),this.#e=null,this.#s?.clear(),this.#s=null,this.#r=0)}#f(t){const e=this.#o.createElementNS(_i,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#m(t){const e=this.#o.createElementNS(_i,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#p(t){const e=this.#o.createElementNS(_i,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#l.append(e),e}#c(t,e,i){const n=this.#o.createElementNS(_i,e);n.setAttribute("type","discrete"),n.setAttribute("tableValues",i),t.append(n)}#g(t,e,i,n){const s=this.#o.createElementNS(_i,"feComponentTransfer");n.append(s),this.#c(s,"feFuncR",t),this.#c(s,"feFuncG",e),this.#c(s,"feFuncB",i)}#y(t,e){const i=this.#o.createElementNS(_i,"feComponentTransfer");e.append(i),this.#c(i,"feFuncA",t)}#w(t){return this.#l.style.color=t,ys(getComputedStyle(this.#l).getPropertyValue("color"))}}class Vl{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(i=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){It("Abstract method `_fetch` called.")}}class Ta extends Vl{async _fetch(t){const e=await gs(t,"arraybuffer");return new Uint8Array(e)}}class Wl{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(i=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){It("Abstract method `_fetch` called.")}}class Pa extends Wl{async _fetch(t){const e=await gs(t,"arraybuffer");return new Uint8Array(e)}}Le&&ut("Please use the `legacy` build in Node.js environments.");async function Io(a){const e=await Jt.getBuiltinModule("fs").promises.readFile(a);return new Uint8Array(e)}class wd extends Gl{}class vd extends jl{_createCanvas(t,e){return Jt.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class Ad extends zl{async _fetch(t){return Io(t)}}class Ed extends Vl{async _fetch(t){return Io(t)}}class Sd extends Wl{async _fetch(t){return Io(t)}}const fn="__forcedDependency",{floor:ka,ceil:Da}=Math;function Is(a,t,e,i,n,s){a[t*4+0]=Math.min(a[t*4+0],e),a[t*4+1]=Math.min(a[t*4+1],i),a[t*4+2]=Math.max(a[t*4+2],n),a[t*4+3]=Math.max(a[t*4+3],s)}const co=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class xd{#t;#e;constructor(t,e){this.#t=t,this.#e=e}get length(){return this.#t.length}isEmpty(t){return this.#t[t]===co}minX(t){return this.#e[t*4+0]/256}minY(t){return this.#e[t*4+1]/256}maxX(t){return(this.#e[t*4+2]+1)/256}maxY(t){return(this.#e[t*4+3]+1)/256}}const Ms=(a,t)=>{if(!a)return;let e=a.get(t);return e||(e={dependencies:new Set,isRenderingOperation:!1},a.set(t,e)),e};class Cd{#t={__proto__:null};#e={__proto__:null,transform:[],moveText:[],sameLineText:[],[fn]:[]};#n=new Map;#i=[];#o=[];#s=[[1,0,0,1,0,0]];#r=[-1/0,-1/0,1/0,1/0];#a=new Float64Array([1/0,1/0,-1/0,-1/0]);#h=-1;#l=new Set;#u=new Map;#d=new Map;#f;#m;#p;#c;#g;constructor(t,e,i=!1){this.#f=t.width,this.#m=t.height,this.#y(e),i&&(this.#g=new Map)}growOperationsCount(t){t>=this.#c.length&&this.#y(t,this.#c)}#y(t,e){const i=new ArrayBuffer(t*4);this.#p=new Uint8ClampedArray(i),this.#c=new Uint32Array(i),e&&e.length>0?(this.#c.set(e),this.#c.fill(co,e.length)):this.#c.fill(co)}save(t){return this.#t={__proto__:this.#t},this.#e={__proto__:this.#e,transform:{__proto__:this.#e.transform},moveText:{__proto__:this.#e.moveText},sameLineText:{__proto__:this.#e.sameLineText},[fn]:{__proto__:this.#e[fn]}},this.#r={__proto__:this.#r},this.#i.push(t),this}restore(t){const e=Object.getPrototypeOf(this.#t);if(e===null)return this;this.#t=e,this.#e=Object.getPrototypeOf(this.#e),this.#r=Object.getPrototypeOf(this.#r);const i=this.#i.pop();return i!==void 0&&(Ms(this.#g,t)?.dependencies.add(i),this.#c[t]=this.#c[i]),this}recordOpenMarker(t){return this.#i.push(t),this}getOpenMarker(){return this.#i.length===0?null:this.#i.at(-1)}recordCloseMarker(t){const e=this.#i.pop();return e!==void 0&&(Ms(this.#g,t)?.dependencies.add(e),this.#c[t]=this.#c[e]),this}beginMarkedContent(t){return this.#o.push(t),this}endMarkedContent(t){const e=this.#o.pop();return e!==void 0&&(Ms(this.#g,t)?.dependencies.add(e),this.#c[t]=this.#c[e]),this}pushBaseTransform(t){return this.#s.push(tt.multiplyByDOMMatrix(this.#s.at(-1),t.getTransform())),this}popBaseTransform(){return this.#s.length>1&&this.#s.pop(),this}recordSimpleData(t,e){return this.#t[t]=e,this}recordIncrementalData(t,e){return this.#e[t].push(e),this}resetIncrementalData(t,e){return this.#e[t].length=0,this}recordNamedData(t,e){return this.#n.set(t,e),this}recordSimpleDataFromNamed(t,e,i){this.#t[t]=this.#n.get(e)??i}recordFutureForcedDependency(t,e){return this.recordIncrementalData(fn,e),this}inheritSimpleDataAsFutureForcedDependencies(t){for(const e of t)e in this.#t&&this.recordFutureForcedDependency(e,this.#t[e]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const t of this.#l)this.recordFutureForcedDependency(fn,t);return this}resetBBox(t){return this.#h!==t&&(this.#h=t,this.#a[0]=1/0,this.#a[1]=1/0,this.#a[2]=-1/0,this.#a[3]=-1/0),this}recordClipBox(t,e,i,n,s,r){const o=tt.multiplyByDOMMatrix(this.#s.at(-1),e.getTransform()),l=[1/0,1/0,-1/0,-1/0];tt.axialAlignedBoundingBox([i,s,n,r],o,l);const d=tt.intersect(this.#r,l);return d?(this.#r[0]=d[0],this.#r[1]=d[1],this.#r[2]=d[2],this.#r[3]=d[3]):(this.#r[0]=this.#r[1]=1/0,this.#r[2]=this.#r[3]=-1/0),this}recordBBox(t,e,i,n,s,r){const o=this.#r;if(o[0]===1/0)return this;const l=tt.multiplyByDOMMatrix(this.#s.at(-1),e.getTransform());if(o[0]===-1/0)return tt.axialAlignedBoundingBox([i,s,n,r],l,this.#a),this;const d=[1/0,1/0,-1/0,-1/0];return tt.axialAlignedBoundingBox([i,s,n,r],l,d),this.#a[0]=Math.min(this.#a[0],Math.max(d[0],o[0])),this.#a[1]=Math.min(this.#a[1],Math.max(d[1],o[1])),this.#a[2]=Math.max(this.#a[2],Math.min(d[2],o[2])),this.#a[3]=Math.max(this.#a[3],Math.min(d[3],o[3])),this}recordCharacterBBox(t,e,i,n=1,s=0,r=0,o){const l=i.bbox;let d,c;if(l&&(d=l[2]!==l[0]&&l[3]!==l[1]&&this.#d.get(i),d!==!1&&(c=[0,0,0,0],tt.axialAlignedBoundingBox(l,i.fontMatrix,c),(n!==1||s!==0||r!==0)&&tt.scaleMinMax([n,0,0,-n,s,r],c),d)))return this.recordBBox(t,e,c[0],c[2],c[1],c[3]);if(!o)return this.recordFullPageBBox(t);const u=o();return l&&c&&d===void 0&&(d=c[0]<=s-u.actualBoundingBoxLeft&&c[2]>=s+u.actualBoundingBoxRight&&c[1]<=r-u.actualBoundingBoxAscent&&c[3]>=r+u.actualBoundingBoxDescent,this.#d.set(i,d),d)?this.recordBBox(t,e,c[0],c[2],c[1],c[3]):this.recordBBox(t,e,s-u.actualBoundingBoxLeft,s+u.actualBoundingBoxRight,r-u.actualBoundingBoxAscent,r+u.actualBoundingBoxDescent)}recordFullPageBBox(t){return this.#a[0]=Math.max(0,this.#r[0]),this.#a[1]=Math.max(0,this.#r[1]),this.#a[2]=Math.min(this.#f,this.#r[2]),this.#a[3]=Math.min(this.#m,this.#r[3]),this}getSimpleIndex(t){return this.#t[t]}recordDependencies(t,e){const i=this.#l,n=this.#t,s=this.#e;for(const r of e)r in this.#t?i.add(n[r]):r in s&&s[r].forEach(i.add,i);return this}recordNamedDependency(t,e){return this.#n.has(e)&&this.#l.add(this.#n.get(e)),this}recordOperation(t,e=!1){if(this.recordDependencies(t,[fn]),this.#g){const i=Ms(this.#g,t),{dependencies:n}=i;this.#l.forEach(n.add,n),this.#i.forEach(n.add,n),this.#o.forEach(n.add,n),n.delete(t),i.isRenderingOperation=!0}if(this.#h===t){const i=ka(this.#a[0]*256/this.#f),n=ka(this.#a[1]*256/this.#m),s=Da(this.#a[2]*256/this.#f),r=Da(this.#a[3]*256/this.#m);Is(this.#p,t,i,n,s,r);for(const o of this.#l)o!==t&&Is(this.#p,o,i,n,s,r);for(const o of this.#i)o!==t&&Is(this.#p,o,i,n,s,r);for(const o of this.#o)o!==t&&Is(this.#p,o,i,n,s,r);e||(this.#l.clear(),this.#h=-1)}return this}recordShowTextOperation(t,e=!1){const i=Array.from(this.#l);this.recordOperation(t,e),this.recordIncrementalData("sameLineText",t);for(const n of i)this.recordIncrementalData("sameLineText",n);return this}bboxToClipBoxDropOperation(t,e=!1){return this.#h===t&&(this.#h=-1,this.#r[0]=Math.max(this.#r[0],this.#a[0]),this.#r[1]=Math.max(this.#r[1],this.#a[1]),this.#r[2]=Math.min(this.#r[2],this.#a[2]),this.#r[3]=Math.min(this.#r[3],this.#a[3]),e||this.#l.clear()),this}_takePendingDependencies(){const t=this.#l;return this.#l=new Set,t}_extractOperation(t){const e=this.#u.get(t);return this.#u.delete(t),e}_pushPendingDependencies(t){for(const e of t)this.#l.add(e)}take(){return this.#d.clear(),new xd(this.#c,this.#p)}takeDebugMetadata(){return this.#g}}class tr{#t;#e;#n;#i=0;#o=0;constructor(t,e,i){if(t instanceof tr&&t.#n===!!i)return t;this.#t=t,this.#e=e,this.#n=!!i}growOperationsCount(){throw new Error("Unreachable")}save(t){return this.#o++,this.#t.save(this.#e),this}restore(t){return this.#o>0&&(this.#t.restore(this.#e),this.#o--),this}recordOpenMarker(t){return this.#i++,this}getOpenMarker(){return this.#i>0?this.#e:this.#t.getOpenMarker()}recordCloseMarker(t){return this.#i--,this}beginMarkedContent(t){return this}endMarkedContent(t){return this}pushBaseTransform(t){return this.#t.pushBaseTransform(t),this}popBaseTransform(){return this.#t.popBaseTransform(),this}recordSimpleData(t,e){return this.#t.recordSimpleData(t,this.#e),this}recordIncrementalData(t,e){return this.#t.recordIncrementalData(t,this.#e),this}resetIncrementalData(t,e){return this.#t.resetIncrementalData(t,this.#e),this}recordNamedData(t,e){return this}recordSimpleDataFromNamed(t,e,i){return this.#t.recordSimpleDataFromNamed(t,e,this.#e),this}recordFutureForcedDependency(t,e){return this.#t.recordFutureForcedDependency(t,this.#e),this}inheritSimpleDataAsFutureForcedDependencies(t){return this.#t.inheritSimpleDataAsFutureForcedDependencies(t),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#t.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(t){return this.#n||this.#t.resetBBox(this.#e),this}recordClipBox(t,e,i,n,s,r){return this.#n||this.#t.recordClipBox(this.#e,e,i,n,s,r),this}recordBBox(t,e,i,n,s,r){return this.#n||this.#t.recordBBox(this.#e,e,i,n,s,r),this}recordCharacterBBox(t,e,i,n,s,r,o){return this.#n||this.#t.recordCharacterBBox(this.#e,e,i,n,s,r,o),this}recordFullPageBBox(t){return this.#n||this.#t.recordFullPageBBox(this.#e),this}getSimpleIndex(t){return this.#t.getSimpleIndex(t)}recordDependencies(t,e){return this.#t.recordDependencies(this.#e,e),this}recordNamedDependency(t,e){return this.#t.recordNamedDependency(this.#e,e),this}recordOperation(t){return this.#t.recordOperation(this.#e,!0),this}recordShowTextOperation(t){return this.#t.recordShowTextOperation(this.#e,!0),this}bboxToClipBoxDropOperation(t){return this.#n||this.#t.bboxToClipBoxDropOperation(this.#e,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const Qe={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},we={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function uo(a,t){if(!t)return;const e=t[2]-t[0],i=t[3]-t[1],n=new Path2D;n.rect(t[0],t[1],e,i),a.clip(n)}class Mo{isModifyingCurrentTransform(){return!1}getPattern(){It("Abstract method `getPattern` called.")}}class _d extends Mo{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const i of this._colorStops)e.addColorStop(i[0],i[1]);return e}getPattern(t,e,i,n){let s;if(n===we.STROKE||n===we.FILL){const r=e.current.getClippedPathBoundingBox(n,Gt(t))||[0,0,0,0],o=Math.ceil(r[2]-r[0])||1,l=Math.ceil(r[3]-r[1])||1,d=e.cachedCanvases.getCanvas("pattern",o,l),c=d.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-r[0],-r[1]),i=tt.transform(i,[1,0,0,1,r[0],r[1]]),c.transform(...e.baseTransform),this.matrix&&c.transform(...this.matrix),uo(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),s=t.createPattern(d.canvas,"no-repeat");const u=new DOMMatrix(i);s.setTransform(u)}else uo(t,this._bbox),s=this._createGradient(t);return s}}function Br(a,t,e,i,n,s,r,o){const l=t.coords,d=t.colors,c=a.data,u=a.width*4;let p;l[e+1]>l[i+1]&&(p=e,e=i,i=p,p=s,s=r,r=p),l[i+1]>l[n+1]&&(p=i,i=n,n=p,p=r,r=o,o=p),l[e+1]>l[i+1]&&(p=e,e=i,i=p,p=s,s=r,r=p);const y=(l[e]+t.offsetX)*t.scaleX,v=(l[e+1]+t.offsetY)*t.scaleY,w=(l[i]+t.offsetX)*t.scaleX,x=(l[i+1]+t.offsetY)*t.scaleY,S=(l[n]+t.offsetX)*t.scaleX,P=(l[n+1]+t.offsetY)*t.scaleY;if(v>=P)return;const k=d[s],D=d[s+1],M=d[s+2],R=d[r],N=d[r+1],F=d[r+2],O=d[o],H=d[o+1],U=d[o+2],K=Math.round(v),z=Math.round(P);let G,et,V,W,Q,Ct,Mt,pt;for(let gt=K;gt<=z;gt++){if(gt<x){const Pt=gt<v?0:(v-gt)/(v-x);G=y-(y-w)*Pt,et=k-(k-R)*Pt,V=D-(D-N)*Pt,W=M-(M-F)*Pt}else{let Pt;gt>P?Pt=1:x===P?Pt=0:Pt=(x-gt)/(x-P),G=w-(w-S)*Pt,et=R-(R-O)*Pt,V=N-(N-H)*Pt,W=F-(F-U)*Pt}let bt;gt<v?bt=0:gt>P?bt=1:bt=(v-gt)/(v-P),Q=y-(y-S)*bt,Ct=k-(k-O)*bt,Mt=D-(D-H)*bt,pt=M-(M-U)*bt;const ct=Math.round(Math.min(G,Q)),_t=Math.round(Math.max(G,Q));let wt=u*gt+ct*4;for(let Pt=ct;Pt<=_t;Pt++)bt=(G-Pt)/(G-Q),bt<0?bt=0:bt>1&&(bt=1),c[wt++]=et-(et-Ct)*bt|0,c[wt++]=V-(V-Mt)*bt|0,c[wt++]=W-(W-pt)*bt|0,c[wt++]=255}}function Td(a,t,e){const i=t.coords,n=t.colors;let s,r;switch(t.type){case"lattice":const o=t.verticesPerRow,l=Math.floor(i.length/o)-1,d=o-1;for(s=0;s<l;s++){let c=s*o;for(let u=0;u<d;u++,c++)Br(a,e,i[c],i[c+1],i[c+o],n[c],n[c+1],n[c+o]),Br(a,e,i[c+o+1],i[c+1],i[c+o],n[c+o+1],n[c+1],n[c+o])}break;case"triangles":for(s=0,r=i.length;s<r;s+=3)Br(a,e,i[s],i[s+1],i[s+2],n[s],n[s+1],n[s+2]);break;default:throw new Error("illegal figure")}}class Pd extends Mo{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,i){const o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),d=Math.ceil(this._bounds[2])-o,c=Math.ceil(this._bounds[3])-l,u=Math.min(Math.ceil(Math.abs(d*t[0]*1.1)),3e3),p=Math.min(Math.ceil(Math.abs(c*t[1]*1.1)),3e3),y=d/u,v=c/p,w={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/y,scaleY:1/v},x=u+4,S=p+4,P=i.getCanvas("mesh",x,S),k=P.context,D=k.createImageData(u,p);if(e){const R=D.data;for(let N=0,F=R.length;N<F;N+=4)R[N]=e[0],R[N+1]=e[1],R[N+2]=e[2],R[N+3]=255}for(const R of this._figures)Td(D,R,w);return k.putImageData(D,2,2),{canvas:P.canvas,offsetX:o-2*y,offsetY:l-2*v,scaleX:y,scaleY:v}}isModifyingCurrentTransform(){return!0}getPattern(t,e,i,n){uo(t,this._bbox);const s=new Float32Array(2);if(n===we.SHADING)tt.singularValueDecompose2dScale(Gt(t),s);else if(this.matrix){tt.singularValueDecompose2dScale(this.matrix,s);const[o,l]=s;tt.singularValueDecompose2dScale(e.baseTransform,s),s[0]*=o,s[1]*=l}else tt.singularValueDecompose2dScale(e.baseTransform,s);const r=this._createMeshCanvas(s,n===we.SHADING?null:this._background,e.cachedCanvases);return n!==we.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(r.offsetX,r.offsetY),t.scale(r.scaleX,r.scaleY),t.createPattern(r.canvas,"no-repeat")}}class kd extends Mo{getPattern(){return"hotpink"}}function Dd(a){switch(a[0]){case"RadialAxial":return new _d(a);case"Mesh":return new Pd(a);case"Dummy":return new kd}throw new Error(`Unknown IR type: ${a[0]}`)}const La={COLORED:1,UNCOLORED:2};class Ro{static MAX_PATTERN_SIZE=3e3;constructor(t,e,i,n){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=i,this.baseTransform=n}createPatternCanvas(t,e){const{bbox:i,operatorList:n,paintType:s,tilingType:r,color:o,canvasGraphicsFactory:l}=this;let{xstep:d,ystep:c}=this;d=Math.abs(d),c=Math.abs(c),gr("TilingType: "+r);const u=i[0],p=i[1],y=i[2],v=i[3],w=y-u,x=v-p,S=new Float32Array(2);tt.singularValueDecompose2dScale(this.matrix,S);const[P,k]=S;tt.singularValueDecompose2dScale(this.baseTransform,S);const D=P*S[0],M=k*S[1];let R=w,N=x,F=!1,O=!1;const H=Math.ceil(d*D),U=Math.ceil(c*M),K=Math.ceil(w*D),z=Math.ceil(x*M);H>=K?R=d:F=!0,U>=z?N=c:O=!0;const G=this.getSizeAndScale(R,this.ctx.canvas.width,D),et=this.getSizeAndScale(N,this.ctx.canvas.height,M),V=t.cachedCanvases.getCanvas("pattern",G.size,et.size),W=V.context,Q=l.createCanvasGraphics(W,e);if(Q.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(Q,s,o),W.translate(-G.scale*u,-et.scale*p),Q.transform(0,G.scale,0,0,et.scale,0,0),W.save(),Q.dependencyTracker?.save(),this.clipBbox(Q,u,p,y,v),Q.baseTransform=Gt(Q.ctx),Q.executeOperatorList(n),Q.endDrawing(),Q.dependencyTracker?.restore(),W.restore(),F||O){const Ct=V.canvas;F&&(R=d),O&&(N=c);const Mt=this.getSizeAndScale(R,this.ctx.canvas.width,D),pt=this.getSizeAndScale(N,this.ctx.canvas.height,M),gt=Mt.size,bt=pt.size,ct=t.cachedCanvases.getCanvas("pattern-workaround",gt,bt),_t=ct.context,wt=F?Math.floor(w/d):0,Pt=O?Math.floor(x/c):0;for(let Tt=0;Tt<=wt;Tt++)for(let ie=0;ie<=Pt;ie++)_t.drawImage(Ct,gt*Tt,bt*ie,gt,bt,0,0,gt,bt);return{canvas:ct.canvas,scaleX:Mt.scale,scaleY:pt.scale,offsetX:u,offsetY:p}}return{canvas:V.canvas,scaleX:G.scale,scaleY:et.scale,offsetX:u,offsetY:p}}getSizeAndScale(t,e,i){const n=Math.max(Ro.MAX_PATTERN_SIZE,e);let s=Math.ceil(t*i);return s>=n?s=n:i=s/t,{scale:i,size:s}}clipBbox(t,e,i,n,s){const r=n-e,o=s-i;t.ctx.rect(e,i,r,o),tt.axialAlignedBoundingBox([e,i,n,s],Gt(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,i){const n=t.ctx,s=t.current;switch(e){case La.COLORED:const{fillStyle:r,strokeStyle:o}=this.ctx;n.fillStyle=s.fillColor=r,n.strokeStyle=s.strokeColor=o;break;case La.UNCOLORED:n.fillStyle=n.strokeStyle=i,s.fillColor=s.strokeColor=i;break;default:throw new zc(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,i,n,s){let r=i;n!==we.SHADING&&(r=tt.transform(r,e.baseTransform),this.matrix&&(r=tt.transform(r,this.matrix)));const o=this.createPatternCanvas(e,s);let l=new DOMMatrix(r);l=l.translate(o.offsetX,o.offsetY),l=l.scale(1/o.scaleX,1/o.scaleY);const d=t.createPattern(o.canvas,"repeat");return d.setTransform(l),d}}function Ld({src:a,srcPos:t=0,dest:e,width:i,height:n,nonBlackColor:s=4294967295,inverseDecode:r=!1}){const o=ve.isLittleEndian?4278190080:255,[l,d]=r?[s,o]:[o,s],c=i>>3,u=i&7,p=a.length;e=new Uint32Array(e.buffer);let y=0;for(let v=0;v<n;v++){for(const x=t+c;t<x;t++){const S=t<p?a[t]:255;e[y++]=S&128?d:l,e[y++]=S&64?d:l,e[y++]=S&32?d:l,e[y++]=S&16?d:l,e[y++]=S&8?d:l,e[y++]=S&4?d:l,e[y++]=S&2?d:l,e[y++]=S&1?d:l}if(u===0)continue;const w=t<p?a[t++]:255;for(let x=0;x<u;x++)e[y++]=w&1<<7-x?d:l}return{srcPos:t,destPos:y}}const Ia=16,Ma=100,Id=15,Ra=10,Ue=16,Ur=new DOMMatrix,qe=new Float32Array(2),Sn=new Float32Array([1/0,1/0,-1/0,-1/0]);function Md(a,t){if(a._removeMirroring)throw new Error("Context is already forwarding operations.");a.__originalSave=a.save,a.__originalRestore=a.restore,a.__originalRotate=a.rotate,a.__originalScale=a.scale,a.__originalTranslate=a.translate,a.__originalTransform=a.transform,a.__originalSetTransform=a.setTransform,a.__originalResetTransform=a.resetTransform,a.__originalClip=a.clip,a.__originalMoveTo=a.moveTo,a.__originalLineTo=a.lineTo,a.__originalBezierCurveTo=a.bezierCurveTo,a.__originalRect=a.rect,a.__originalClosePath=a.closePath,a.__originalBeginPath=a.beginPath,a._removeMirroring=()=>{a.save=a.__originalSave,a.restore=a.__originalRestore,a.rotate=a.__originalRotate,a.scale=a.__originalScale,a.translate=a.__originalTranslate,a.transform=a.__originalTransform,a.setTransform=a.__originalSetTransform,a.resetTransform=a.__originalResetTransform,a.clip=a.__originalClip,a.moveTo=a.__originalMoveTo,a.lineTo=a.__originalLineTo,a.bezierCurveTo=a.__originalBezierCurveTo,a.rect=a.__originalRect,a.closePath=a.__originalClosePath,a.beginPath=a.__originalBeginPath,delete a._removeMirroring},a.save=function(){t.save(),this.__originalSave()},a.restore=function(){t.restore(),this.__originalRestore()},a.translate=function(e,i){t.translate(e,i),this.__originalTranslate(e,i)},a.scale=function(e,i){t.scale(e,i),this.__originalScale(e,i)},a.transform=function(e,i,n,s,r,o){t.transform(e,i,n,s,r,o),this.__originalTransform(e,i,n,s,r,o)},a.setTransform=function(e,i,n,s,r,o){t.setTransform(e,i,n,s,r,o),this.__originalSetTransform(e,i,n,s,r,o)},a.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},a.rotate=function(e){t.rotate(e),this.__originalRotate(e)},a.clip=function(e){t.clip(e),this.__originalClip(e)},a.moveTo=function(e,i){t.moveTo(e,i),this.__originalMoveTo(e,i)},a.lineTo=function(e,i){t.lineTo(e,i),this.__originalLineTo(e,i)},a.bezierCurveTo=function(e,i,n,s,r,o){t.bezierCurveTo(e,i,n,s,r,o),this.__originalBezierCurveTo(e,i,n,s,r,o)},a.rect=function(e,i,n,s){t.rect(e,i,n,s),this.__originalRect(e,i,n,s)},a.closePath=function(){t.closePath(),this.__originalClosePath()},a.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class Rd{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,i){let n;return this.cache[t]!==void 0?(n=this.cache[t],this.canvasFactory.reset(n,e,i)):(n=this.canvasFactory.create(e,i),this.cache[t]=n),n}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function Rs(a,t,e,i,n,s,r,o,l,d){const[c,u,p,y,v,w]=Gt(a);if(u===0&&p===0){const P=r*c+v,k=Math.round(P),D=o*y+w,M=Math.round(D),R=(r+l)*c+v,N=Math.abs(Math.round(R)-k)||1,F=(o+d)*y+w,O=Math.abs(Math.round(F)-M)||1;return a.setTransform(Math.sign(c),0,0,Math.sign(y),k,M),a.drawImage(t,e,i,n,s,0,0,N,O),a.setTransform(c,u,p,y,v,w),[N,O]}if(c===0&&y===0){const P=o*p+v,k=Math.round(P),D=r*u+w,M=Math.round(D),R=(o+d)*p+v,N=Math.abs(Math.round(R)-k)||1,F=(r+l)*u+w,O=Math.abs(Math.round(F)-M)||1;return a.setTransform(0,Math.sign(u),Math.sign(p),0,k,M),a.drawImage(t,e,i,n,s,0,0,O,N),a.setTransform(c,u,p,y,v,w),[O,N]}a.drawImage(t,e,i,n,s,r,o,l,d);const x=Math.hypot(c,u),S=Math.hypot(p,y);return[x*l,S*d]}class Fa{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=no;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=me.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,e,i){i?.(this),this.clipBox=new Float32Array([0,0,t,e]),this.minMax=Sn.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=we.FILL,e=null){const i=this.minMax.slice();if(t===we.STROKE){e||It("Stroke bounding box must include transform."),tt.singularValueDecompose2dScale(e,qe);const n=qe[0]*this.lineWidth/2,s=qe[1]*this.lineWidth/2;i[0]-=n,i[1]-=s,i[2]+=n,i[3]+=s}return i}updateClipFromPath(){const t=tt.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(Sn,0)}getClippedPathBoundingBox(t=we.FILL,e=null){return tt.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function Oa(a,t){if(t instanceof ImageData){a.putImageData(t,0,0);return}const e=t.height,i=t.width,n=e%Ue,s=(e-n)/Ue,r=n===0?s:s+1,o=a.createImageData(i,Ue);let l=0,d;const c=t.data,u=o.data;let p,y,v,w;if(t.kind===Vs.GRAYSCALE_1BPP){const x=c.byteLength,S=new Uint32Array(u.buffer,0,u.byteLength>>2),P=S.length,k=i+7>>3,D=4294967295,M=ve.isLittleEndian?4278190080:255;for(p=0;p<r;p++){for(v=p<s?Ue:n,d=0,y=0;y<v;y++){const R=x-l;let N=0;const F=R>k?i:R*8-7,O=F&-8;let H=0,U=0;for(;N<O;N+=8)U=c[l++],S[d++]=U&128?D:M,S[d++]=U&64?D:M,S[d++]=U&32?D:M,S[d++]=U&16?D:M,S[d++]=U&8?D:M,S[d++]=U&4?D:M,S[d++]=U&2?D:M,S[d++]=U&1?D:M;for(;N<F;N++)H===0&&(U=c[l++],H=128),S[d++]=U&H?D:M,H>>=1}for(;d<P;)S[d++]=0;a.putImageData(o,0,p*Ue)}}else if(t.kind===Vs.RGBA_32BPP){for(y=0,w=i*Ue*4,p=0;p<s;p++)u.set(c.subarray(l,l+w)),l+=w,a.putImageData(o,0,y),y+=Ue;p<r&&(w=i*n*4,u.set(c.subarray(l,l+w)),a.putImageData(o,0,y))}else if(t.kind===Vs.RGB_24BPP)for(v=Ue,w=i*v,p=0;p<r;p++){for(p>=s&&(v=n,w=i*v),d=0,y=w;y--;)u[d++]=c[l++],u[d++]=c[l++],u[d++]=c[l++],u[d++]=255;a.putImageData(o,0,p*Ue)}else throw new Error(`bad image kind: ${t.kind}`)}function Na(a,t){if(t.bitmap){a.drawImage(t.bitmap,0,0);return}const e=t.height,i=t.width,n=e%Ue,s=(e-n)/Ue,r=n===0?s:s+1,o=a.createImageData(i,Ue);let l=0;const d=t.data,c=o.data;for(let u=0;u<r;u++){const p=u<s?Ue:n;({srcPos:l}=Ld({src:d,srcPos:l,dest:c,width:i,height:p,nonBlackColor:0})),a.putImageData(o,0,u*Ue)}}function Hn(a,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of e)a[i]!==void 0&&(t[i]=a[i]);a.setLineDash!==void 0&&(t.setLineDash(a.getLineDash()),t.lineDashOffset=a.lineDashOffset)}function Fs(a){a.strokeStyle=a.fillStyle="#000000",a.fillRule="nonzero",a.globalAlpha=1,a.lineWidth=1,a.lineCap="butt",a.lineJoin="miter",a.miterLimit=10,a.globalCompositeOperation="source-over",a.font="10px sans-serif",a.setLineDash!==void 0&&(a.setLineDash([]),a.lineDashOffset=0);const{filter:t}=a;t!=="none"&&t!==""&&(a.filter="none")}function Ba(a,t){if(t)return!0;tt.singularValueDecompose2dScale(a,qe);const e=Math.fround(Ei.pixelRatio*Mn.PDF_TO_CSS_UNITS);return qe[0]<=e&&qe[1]<=e}const Fd=["butt","round","square"],Od=["miter","round","bevel"],Nd={},Ua={};class Pn{constructor(t,e,i,n,s,{optionalContentConfig:r,markedContentStack:o=null},l,d,c){this.ctx=t,this.current=new Fa(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=i,this.canvasFactory=n,this.filterFactory=s,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=r,this.cachedCanvases=new Rd(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=d,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=c??null}getObject(t,e,i=null){return typeof e=="string"?(this.dependencyTracker?.recordNamedDependency(t,e),e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e)):i}beginDrawing({transform:t,viewport:e,transparency:i=!1,background:n=null}){const s=this.ctx.canvas.width,r=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=n||"#ffffff",this.ctx.fillRect(0,0,s,r),this.ctx.fillStyle=o,i){const l=this.cachedCanvases.getCanvas("transparent",s,r);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...Gt(this.compositeCtx))}this.ctx.save(),Fs(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=Gt(this.ctx)}executeOperatorList(t,e,i,n,s){const r=t.argsArray,o=t.fnArray;let l=e||0;const d=r.length;if(d===l)return l;const c=d-l>Ra&&typeof i=="function",u=c?Date.now()+Id:0;let p=0;const y=this.commonObjs,v=this.objs;let w,x;for(;;){if(n!==void 0&&l===n.nextBreakPoint)return n.breakIt(l,i),l;if(!s||s(l))if(w=o[l],x=r[l]??null,w!==as.dependency)x===null?this[w](l):this[w](l,...x);else for(const S of x){this.dependencyTracker?.recordNamedData(S,l);const P=S.startsWith("g_")?y:v;if(!P.has(S))return P.get(S,i),l}if(l++,l===d)return l;if(c&&++p>Ra){if(Date.now()>u)return i(),l;p=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const i=t.width??t.displayWidth,n=t.height??t.displayHeight;let s=Math.max(Math.hypot(e[0],e[1]),1),r=Math.max(Math.hypot(e[2],e[3]),1),o=i,l=n,d="prescale1",c,u;for(;s>2&&o>1||r>2&&l>1;){let p=o,y=l;s>2&&o>1&&(p=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),s/=o/p),r>2&&l>1&&(y=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,r/=l/y),c=this.cachedCanvases.getCanvas(d,p,y),u=c.context,u.clearRect(0,0,p,y),u.drawImage(t,0,0,o,l,0,0,p,y),t=c.canvas,o=p,l=y,d=d==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:o,paintHeight:l}}_createMaskCanvas(t,e){const i=this.ctx,{width:n,height:s}=e,r=this.current.fillColor,o=this.current.patternFill,l=Gt(i);let d,c,u,p;if((e.bitmap||e.data)&&e.count>1){const H=e.bitmap||e.data.buffer;c=JSON.stringify(o?l:[l.slice(0,4),r]),d=this._cachedBitmapsMap.get(H),d||(d=new Map,this._cachedBitmapsMap.set(H,d));const U=d.get(c);if(U&&!o){const K=Math.round(Math.min(l[0],l[2])+l[4]),z=Math.round(Math.min(l[1],l[3])+l[5]);return this.dependencyTracker?.recordDependencies(t,Qe.transformAndFill),{canvas:U,offsetX:K,offsetY:z}}u=U}u||(p=this.cachedCanvases.getCanvas("maskCanvas",n,s),Na(p.context,e));let y=tt.transform(l,[1/n,0,0,-1/s,0,0]);y=tt.transform(y,[1,0,0,1,0,-s]);const v=Sn.slice();tt.axialAlignedBoundingBox([0,0,n,s],y,v);const[w,x,S,P]=v,k=Math.round(S-w)||1,D=Math.round(P-x)||1,M=this.cachedCanvases.getCanvas("fillCanvas",k,D),R=M.context,N=w,F=x;R.translate(-N,-F),R.transform(...y),u||(u=this._scaleImage(p.canvas,fi(R)),u=u.img,d&&o&&d.set(c,u)),R.imageSmoothingEnabled=Ba(Gt(R),e.interpolate),Rs(R,u,0,0,u.width,u.height,0,0,n,s),R.globalCompositeOperation="source-in";const O=tt.transform(fi(R),[1,0,0,1,-N,-F]);return R.fillStyle=o?r.getPattern(i,this,O,we.FILL,t):r,R.fillRect(0,0,n,s),d&&!o&&(this.cachedCanvases.delete("fillCanvas"),d.set(c,M.canvas)),this.dependencyTracker?.recordDependencies(t,Qe.transformAndFill),{canvas:M.canvas,offsetX:Math.round(N),offsetY:Math.round(F)}}setLineWidth(t,e){this.dependencyTracker?.recordSimpleData("lineWidth",t),e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(t,e){this.dependencyTracker?.recordSimpleData("lineCap",t),this.ctx.lineCap=Fd[e]}setLineJoin(t,e){this.dependencyTracker?.recordSimpleData("lineJoin",t),this.ctx.lineJoin=Od[e]}setMiterLimit(t,e){this.dependencyTracker?.recordSimpleData("miterLimit",t),this.ctx.miterLimit=e}setDash(t,e,i){this.dependencyTracker?.recordSimpleData("dash",t);const n=this.ctx;n.setLineDash!==void 0&&(n.setLineDash(e),n.lineDashOffset=i)}setRenderingIntent(t,e){}setFlatness(t,e){}setGState(t,e){for(const[i,n]of e)switch(i){case"LW":this.setLineWidth(t,n);break;case"LC":this.setLineCap(t,n);break;case"LJ":this.setLineJoin(t,n);break;case"ML":this.setMiterLimit(t,n);break;case"D":this.setDash(t,n[0],n[1]);break;case"RI":this.setRenderingIntent(t,n);break;case"FL":this.setFlatness(t,n);break;case"Font":this.setFont(t,n[0],n[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",t),this.current.strokeAlpha=n;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",t),this.ctx.globalAlpha=this.current.fillAlpha=n;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",t),this.ctx.globalCompositeOperation=n;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",t),this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",t),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(t){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,i=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(n,e,i);this.suspendedCtx=this.ctx;const r=this.ctx=s.context;r.setTransform(this.suspendedCtx.getTransform()),Hn(this.suspendedCtx,r),Md(r,this.suspendedCtx),this.setGState(t,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Hn(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,i,n){const s=n[0],r=n[1],o=n[2]-s,l=n[3]-r;o===0||l===0||(this.genericComposeSMask(e.context,i,o,l,e.subtype,e.backdrop,e.transferMap,s,r,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(i.canvas,0,0),t.restore())}genericComposeSMask(t,e,i,n,s,r,o,l,d,c,u){let p=t.canvas,y=l-c,v=d-u;if(r)if(y<0||v<0||y+i>p.width||v+n>p.height){const x=this.cachedCanvases.getCanvas("maskExtension",i,n),S=x.context;S.drawImage(p,-y,-v),S.globalCompositeOperation="destination-atop",S.fillStyle=r,S.fillRect(0,0,i,n),S.globalCompositeOperation="source-over",p=x.canvas,y=v=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const x=new Path2D;x.rect(y,v,i,n),t.clip(x),t.globalCompositeOperation="destination-atop",t.fillStyle=r,t.fillRect(y,v,i,n),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),s==="Alpha"&&o?e.filter=this.filterFactory.addAlphaFilter(o):s==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(o));const w=new Path2D;w.rect(l,d,i,n),e.clip(w),e.globalCompositeOperation="destination-in",e.drawImage(p,y,v,i,n,l,d,i,n),e.restore()}save(t){this.inSMaskMode&&Hn(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone(),this.dependencyTracker?.save(t)}restore(t){if(this.dependencyTracker?.restore(t),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Hn(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,i,n,s,r,o){this.dependencyTracker?.recordIncrementalData("transform",t),this.ctx.transform(e,i,n,s,r,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,i,n){let[s]=i;if(!n){s||=i[0]=new Path2D,this[e](t,s);return}if(this.dependencyTracker!==null){const r=e===as.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(t).recordBBox(t,this.ctx,n[0]-r,n[2]+r,n[1]-r,n[3]+r).recordDependencies(t,["transform"])}if(!(s instanceof Path2D)){const r=i[0]=new Path2D;for(let o=0,l=s.length;o<l;)switch(s[o++]){case Ps.moveTo:r.moveTo(s[o++],s[o++]);break;case Ps.lineTo:r.lineTo(s[o++],s[o++]);break;case Ps.curveTo:r.bezierCurveTo(s[o++],s[o++],s[o++],s[o++],s[o++],s[o++]);break;case Ps.closePath:r.closePath();break;default:ut(`Unrecognized drawing path operator: ${s[o-1]}`);break}s=r}tt.axialAlignedBoundingBox(n,Gt(this.ctx),this.current.minMax),this[e](t,s),this._pathStartIdx=t}closePath(t){this.ctx.closePath()}stroke(t,e,i=!0){const n=this.ctx,s=this.current.strokeColor;if(n.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof s=="object"&&s?.getPattern){const r=s.isModifyingCurrentTransform()?n.getTransform():null;if(n.save(),n.strokeStyle=s.getPattern(n,this,fi(n),we.STROKE,t),r){const o=new Path2D;o.addPath(e,n.getTransform().invertSelf().multiplySelf(r)),e=o}this.rescaleAndStroke(e,!1),n.restore()}else this.rescaleAndStroke(e,!0);this.dependencyTracker?.recordDependencies(t,Qe.stroke),i&&this.consumePath(t,e,this.current.getClippedPathBoundingBox(we.STROKE,Gt(this.ctx))),n.globalAlpha=this.current.fillAlpha}closeStroke(t,e){this.stroke(t,e)}fill(t,e,i=!0){const n=this.ctx,s=this.current.fillColor,r=this.current.patternFill;let o=!1;if(r){const d=s.isModifyingCurrentTransform()?n.getTransform():null;if(this.dependencyTracker?.save(t),n.save(),n.fillStyle=s.getPattern(n,this,fi(n),we.FILL,t),d){const c=new Path2D;c.addPath(e,n.getTransform().invertSelf().multiplySelf(d)),e=c}o=!0}const l=this.current.getClippedPathBoundingBox();this.contentVisible&&l!==null&&(this.pendingEOFill?(n.fill(e,"evenodd"),this.pendingEOFill=!1):n.fill(e)),this.dependencyTracker?.recordDependencies(t,Qe.fill),o&&(n.restore(),this.dependencyTracker?.restore(t)),i&&this.consumePath(t,e,l)}eoFill(t,e){this.pendingEOFill=!0,this.fill(t,e)}fillStroke(t,e){this.fill(t,e,!1),this.stroke(t,e,!1),this.consumePath(t,e)}eoFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}closeFillStroke(t,e){this.fillStroke(t,e)}closeEOFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}endPath(t,e){this.consumePath(t,e)}rawFillPath(t,e){this.ctx.fill(e),this.dependencyTracker?.recordDependencies(t,Qe.rawFillPath).recordOperation(t)}clip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=Nd}eoClip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=Ua}beginText(t){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(t).resetIncrementalData("sameLineText").resetIncrementalData("moveText",t)}endText(t){const e=this.pendingTextPaths,i=this.ctx;if(this.dependencyTracker){const{dependencyTracker:n}=this;e!==void 0&&n.recordFutureForcedDependency("textClip",n.getOpenMarker()).recordFutureForcedDependency("textClip",t),n.recordCloseMarker(t)}if(e!==void 0){const n=new Path2D,s=i.getTransform().invertSelf();for(const{transform:r,x:o,y:l,fontSize:d,path:c}of e)c&&n.addPath(c,new DOMMatrix(r).preMultiplySelf(s).translate(o,l).scale(d,-d));i.clip(n)}delete this.pendingTextPaths}setCharSpacing(t,e){this.dependencyTracker?.recordSimpleData("charSpacing",t),this.current.charSpacing=e}setWordSpacing(t,e){this.dependencyTracker?.recordSimpleData("wordSpacing",t),this.current.wordSpacing=e}setHScale(t,e){this.dependencyTracker?.recordSimpleData("hScale",t),this.current.textHScale=e/100}setLeading(t,e){this.dependencyTracker?.recordSimpleData("leading",t),this.current.leading=-e}setFont(t,e,i){this.dependencyTracker?.recordSimpleData("font",t).recordSimpleDataFromNamed("fontObj",e,t);const n=this.commonObjs.get(e),s=this.current;if(!n)throw new Error(`Can't find font for ${e}`);if(s.fontMatrix=n.fontMatrix||no,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&ut("Invalid font matrix for font "+e),i<0?(i=-i,s.fontDirection=-1):s.fontDirection=1,this.current.font=n,this.current.fontSize=i,n.isType3Font)return;const r=n.loadedName||"sans-serif",o=n.systemFontInfo?.css||`"${r}", ${n.fallbackName}`;let l="normal";n.black?l="900":n.bold&&(l="bold");const d=n.italic?"italic":"normal";let c=i;i<Ia?c=Ia:i>Ma&&(c=Ma),this.current.fontSizeScale=i/c,this.ctx.font=`${d} ${l} ${c}px ${o}`}setTextRenderingMode(t,e){this.dependencyTracker?.recordSimpleData("textRenderingMode",t),this.current.textRenderingMode=e}setTextRise(t,e){this.dependencyTracker?.recordSimpleData("textRise",t),this.current.textRise=e}moveText(t,e,i){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",t),this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=i}setLeadingMoveText(t,e,i){this.setLeading(t,-i),this.moveText(t,e,i)}setTextMatrix(t,e){this.dependencyTracker?.recordSimpleData("textMatrix",t);const{current:i}=this;i.textMatrix=e,i.textMatrixScale=Math.hypot(e[0],e[1]),i.x=i.lineX=0,i.y=i.lineY=0}nextLine(t){this.moveText(t,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??t)}#n(t,e,i){const n=new Path2D;return n.addPath(t,new DOMMatrix(i).invertSelf().multiplySelf(e)),n}paintChar(t,e,i,n,s,r){const o=this.ctx,l=this.current,d=l.font,c=l.textRenderingMode,u=l.fontSize/l.fontSizeScale,p=c&me.FILL_STROKE_MASK,y=!!(c&me.ADD_TO_PATH_FLAG),v=l.patternFill&&!d.missingFile,w=l.patternStroke&&!d.missingFile;let x;if((d.disableFontFace||y||v||w)&&!d.missingFile&&(x=d.getPathGenerator(this.commonObjs,e)),x&&(d.disableFontFace||v||w)){o.save(),o.translate(i,n),o.scale(u,-u),this.dependencyTracker?.recordCharacterBBox(t,o,d);let S;if(p===me.FILL||p===me.FILL_STROKE)if(s){S=o.getTransform(),o.setTransform(...s);const P=this.#n(x,S,s);o.fill(P)}else o.fill(x);if(p===me.STROKE||p===me.FILL_STROKE)if(r){S||=o.getTransform(),o.setTransform(...r);const{a:P,b:k,c:D,d:M}=S,R=tt.inverseTransform(r),N=tt.transform([P,k,D,M,0,0],R);tt.singularValueDecompose2dScale(N,qe),o.lineWidth*=Math.max(qe[0],qe[1])/u,o.stroke(this.#n(x,S,r))}else o.lineWidth/=u,o.stroke(x);o.restore()}else(p===me.FILL||p===me.FILL_STROKE)&&(o.fillText(e,i,n),this.dependencyTracker?.recordCharacterBBox(t,o,d,u,i,n,()=>o.measureText(e))),(p===me.STROKE||p===me.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(t,o,d,u,i,n,()=>o.measureText(e)).recordDependencies(t,Qe.stroke),o.strokeText(e,i,n));y&&((this.pendingTextPaths||=[]).push({transform:Gt(o),x:i,y:n,fontSize:u,path:x}),this.dependencyTracker?.recordCharacterBBox(t,o,d,u,i,n))}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let i=!1;for(let n=3;n<e.length;n+=4)if(e[n]>0&&e[n]<255){i=!0;break}return yt(this,"isFontSubpixelAAEnabled",i)}showText(t,e){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(t,Qe.showText).resetBBox(t),this.current.textRenderingMode&me.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",t).inheritPendingDependenciesAsFutureForcedDependencies());const i=this.current,n=i.font;if(n.isType3Font){this.showType3Text(t,e),this.dependencyTracker?.recordShowTextOperation(t);return}const s=i.fontSize;if(s===0){this.dependencyTracker?.recordOperation(t);return}const r=this.ctx,o=i.fontSizeScale,l=i.charSpacing,d=i.wordSpacing,c=i.fontDirection,u=i.textHScale*c,p=e.length,y=n.vertical,v=y?1:-1,w=n.defaultVMetrics,x=s*i.fontMatrix[0],S=i.textRenderingMode===me.FILL&&!n.disableFontFace&&!i.patternFill;r.save(),i.textMatrix&&r.transform(...i.textMatrix),r.translate(i.x,i.y+i.textRise),c>0?r.scale(u,-1):r.scale(u,1);let P,k;if(i.patternFill){r.save();const F=i.fillColor.getPattern(r,this,fi(r),we.FILL,t);P=Gt(r),r.restore(),r.fillStyle=F}if(i.patternStroke){r.save();const F=i.strokeColor.getPattern(r,this,fi(r),we.STROKE,t);k=Gt(r),r.restore(),r.strokeStyle=F}let D=i.lineWidth;const M=i.textMatrixScale;if(M===0||D===0){const F=i.textRenderingMode&me.FILL_STROKE_MASK;(F===me.STROKE||F===me.FILL_STROKE)&&(D=this.getSinglePixelWidth())}else D/=M;if(o!==1&&(r.scale(o,o),D/=o),r.lineWidth=D,n.isInvalidPDFjsFont){const F=[];let O=0;for(const U of e)F.push(U.unicode),O+=U.width;const H=F.join("");if(r.fillText(H,0,0),this.dependencyTracker!==null){const U=r.measureText(H);this.dependencyTracker.recordBBox(t,this.ctx,-U.actualBoundingBoxLeft,U.actualBoundingBoxRight,-U.actualBoundingBoxAscent,U.actualBoundingBoxDescent).recordShowTextOperation(t)}i.x+=O*x*u,r.restore(),this.compose();return}let R=0,N;for(N=0;N<p;++N){const F=e[N];if(typeof F=="number"){R+=v*F*s/1e3;continue}let O=!1;const H=(F.isSpace?d:0)+l,U=F.fontChar,K=F.accent;let z,G,et=F.width;if(y){const Q=F.vmetric||w,Ct=-(F.vmetric?Q[1]:et*.5)*x,Mt=Q[2]*x;et=Q?-Q[0]:et,z=Ct/o,G=(R+Mt)/o}else z=R/o,G=0;let V;if(n.remeasure&&et>0){V=r.measureText(U);const Q=V.width*1e3/s*o;if(et<Q&&this.isFontSubpixelAAEnabled){const Ct=et/Q;O=!0,r.save(),r.scale(Ct,1),z/=Ct}else et!==Q&&(z+=(et-Q)/2e3*s/o)}if(this.contentVisible&&(F.isInFont||n.missingFile)){if(S&&!K)r.fillText(U,z,G),this.dependencyTracker?.recordCharacterBBox(t,r,V?{bbox:null}:n,s/o,z,G,()=>V??r.measureText(U));else if(this.paintChar(t,U,z,G,P,k),K){const Q=z+s*K.offset.x/o,Ct=G-s*K.offset.y/o;this.paintChar(t,K.fontChar,Q,Ct,P,k)}}const W=y?et*x-H*c:et*x+H*c;R+=W,O&&r.restore()}y?i.y-=R:i.x+=R*u,r.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(t)}showType3Text(t,e){const i=this.ctx,n=this.current,s=n.font,r=n.fontSize,o=n.fontDirection,l=s.vertical?1:-1,d=n.charSpacing,c=n.wordSpacing,u=n.textHScale*o,p=n.fontMatrix||no,y=e.length,v=n.textRenderingMode===me.INVISIBLE;let w,x,S,P;if(v||r===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,i.save(),n.textMatrix&&i.transform(...n.textMatrix),i.translate(n.x,n.y+n.textRise),i.scale(u,o);const k=this.dependencyTracker;for(this.dependencyTracker=k?new tr(k,t):null,w=0;w<y;++w){if(x=e[w],typeof x=="number"){P=l*x*r/1e3,this.ctx.translate(P,0),n.x+=P*u;continue}const D=(x.isSpace?c:0)+d,M=s.charProcOperatorList[x.operatorListId];M?this.contentVisible&&(this.save(),i.scale(r,r),i.transform(...p),this.executeOperatorList(M),this.restore()):ut(`Type3 character "${x.operatorListId}" is not available.`);const R=[x.width,0];tt.applyTransform(R,p),S=R[0]*r+D,i.translate(S,0),n.x+=S*u}i.restore(),k&&(this.dependencyTracker=k)}setCharWidth(t,e,i){}setCharWidthAndBounds(t,e,i,n,s,r,o){const l=new Path2D;l.rect(n,s,r-n,o-s),this.ctx.clip(l),this.dependencyTracker?.recordBBox(t,this.ctx,n,r,s,o).recordClipBox(t,this.ctx,n,r,s,o),this.endPath(t)}getColorN_Pattern(t,e){let i;if(e[0]==="TilingPattern"){const n=this.baseTransform||Gt(this.ctx),s={createCanvasGraphics:(r,o)=>new Pn(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new tr(this.dependencyTracker,o,!0):null)};i=new Ro(e,this.ctx,s,n)}else i=this._getPattern(t,e[1],e[2]);return i}setStrokeColorN(t,...e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.current.strokeColor=this.getColorN_Pattern(t,e),this.current.patternStroke=!0}setFillColorN(t,...e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.current.fillColor=this.getColorN_Pattern(t,e),this.current.patternFill=!0}setStrokeRGBColor(t,e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(t){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(t){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e,i=null){let n;return this.cachedPatterns.has(e)?n=this.cachedPatterns.get(e):(n=Dd(this.getObject(t,e)),this.cachedPatterns.set(e,n)),i&&(n.matrix=i),n}shadingFill(t,e){if(!this.contentVisible)return;const i=this.ctx;this.save(t);const n=this._getPattern(t,e);i.fillStyle=n.getPattern(i,this,fi(i),we.SHADING,t);const s=fi(i);if(s){const{width:r,height:o}=i.canvas,l=Sn.slice();tt.axialAlignedBoundingBox([0,0,r,o],s,l);const[d,c,u,p]=l;this.ctx.fillRect(d,c,u-d,p-c)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(t).recordFullPageBBox(t).recordDependencies(t,Qe.transform).recordDependencies(t,Qe.fill).recordOperation(t),this.compose(this.current.getClippedPathBoundingBox()),this.restore(t)}beginInlineImage(){It("Should not call beginInlineImage")}beginImageData(){It("Should not call beginImageData")}paintFormXObjectBegin(t,e,i){if(this.contentVisible&&(this.save(t),this.baseTransformStack.push(this.baseTransform),e&&this.transform(t,...e),this.baseTransform=Gt(this.ctx),i)){tt.axialAlignedBoundingBox(i,this.baseTransform,this.current.minMax);const[n,s,r,o]=i,l=new Path2D;l.rect(n,s,r-n,o-s),this.ctx.clip(l),this.dependencyTracker?.recordClipBox(t,this.ctx,n,r,s,o),this.endPath(t)}}paintFormXObjectEnd(t){this.contentVisible&&(this.restore(t),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t,e){if(!this.contentVisible)return;this.save(t),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const i=this.ctx;e.isolated||gr("TODO: Support non-isolated groups."),e.knockout&&ut("Knockout groups not supported.");const n=Gt(i);if(e.matrix&&i.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let s=Sn.slice();tt.axialAlignedBoundingBox(e.bbox,Gt(i),s);const r=[0,0,i.canvas.width,i.canvas.height];s=tt.intersect(s,r)||[0,0,0,0];const o=Math.floor(s[0]),l=Math.floor(s[1]),d=Math.max(Math.ceil(s[2])-o,1),c=Math.max(Math.ceil(s[3])-l,1);this.current.startNewPathAndClipBox([0,0,d,c]);let u="groupAt"+this.groupLevel;e.smask&&(u+="_smask_"+this.smaskCounter++%2);const p=this.cachedCanvases.getCanvas(u,d,c),y=p.context;y.translate(-o,-l),y.transform(...n);let v=new Path2D;const[w,x,S,P]=e.bbox;if(v.rect(w,x,S-w,P-x),e.matrix){const k=new Path2D;k.addPath(v,new DOMMatrix(e.matrix)),v=k}y.clip(v),e.smask&&this.smaskStack.push({canvas:p.canvas,context:y,offsetX:o,offsetY:l,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}),(!e.smask||this.dependencyTracker)&&(i.setTransform(1,0,0,1,0,0),i.translate(o,l),i.save()),Hn(i,y),this.ctx=y,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(i),this.setGState(t,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(i),this.groupLevel++}endGroup(t,e){if(!this.contentVisible)return;this.groupLevel--;const i=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),e.smask)this.tempSMask=this.smaskStack.pop(),this.restore(t),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const s=Gt(this.ctx);this.restore(t),this.ctx.save(),this.ctx.setTransform(...s);const r=Sn.slice();tt.axialAlignedBoundingBox([0,0,i.canvas.width,i.canvas.height],s,r),this.ctx.drawImage(i.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(t,e,i,n,s,r){if(this.#t(),Fs(this.ctx),this.ctx.save(),this.save(t),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),i){const o=i[2]-i[0],l=i[3]-i[1];if(r&&this.annotationCanvasMap){n=n.slice(),n[4]-=i[0],n[5]-=i[1],i=i.slice(),i[0]=i[1]=0,i[2]=o,i[3]=l,tt.singularValueDecompose2dScale(Gt(this.ctx),qe);const{viewportScale:d}=this,c=Math.ceil(o*this.outputScaleX*d),u=Math.ceil(l*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(c,u);const{canvas:p,context:y}=this.annotationCanvas;this.annotationCanvasMap.set(e,p),this.annotationCanvas.savedCtx=this.ctx,this.ctx=y,this.ctx.save(),this.ctx.setTransform(qe[0],0,0,-qe[1],0,l*qe[1]),Fs(this.ctx)}else{Fs(this.ctx),this.endPath(t);const d=new Path2D;d.rect(i[0],i[1],o,l),this.ctx.clip(d)}}this.current=new Fa(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(t,...n),this.transform(t,...s)}endAnnotation(t){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t,e){if(!this.contentVisible)return;const i=e.count;e=this.getObject(t,e.data,e),e.count=i;const n=this.ctx,s=this._createMaskCanvas(t,e),r=s.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(r,s.offsetX,s.offsetY),this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,s.offsetX,s.offsetX+r.width,s.offsetY,s.offsetY+r.height).recordOperation(t),n.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,i,n=0,s=0,r,o){if(!this.contentVisible)return;e=this.getObject(t,e.data,e);const l=this.ctx;l.save();const d=Gt(l);l.transform(i,n,s,r,0,0);const c=this._createMaskCanvas(t,e);l.setTransform(1,0,0,1,c.offsetX-d[4],c.offsetY-d[5]),this.dependencyTracker?.resetBBox(t);for(let u=0,p=o.length;u<p;u+=2){const y=tt.transform(d,[i,n,s,r,o[u],o[u+1]]);l.drawImage(c.canvas,y[4],y[5]),this.dependencyTracker?.recordBBox(t,this.ctx,y[4],y[4]+c.canvas.width,y[5],y[5]+c.canvas.height)}l.restore(),this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageMaskXObjectGroup(t,e){if(!this.contentVisible)return;const i=this.ctx,n=this.current.fillColor,s=this.current.patternFill;this.dependencyTracker?.resetBBox(t).recordDependencies(t,Qe.transformAndFill);for(const r of e){const{data:o,width:l,height:d,transform:c}=r,u=this.cachedCanvases.getCanvas("maskCanvas",l,d),p=u.context;p.save();const y=this.getObject(t,o,r);Na(p,y),p.globalCompositeOperation="source-in",p.fillStyle=s?n.getPattern(p,this,fi(i),we.FILL,t):n,p.fillRect(0,0,l,d),p.restore(),i.save(),i.transform(...c),i.scale(1,-1),Rs(i,u.canvas,0,0,l,d,0,-1,1,1),this.dependencyTracker?.recordBBox(t,i,0,l,0,d),i.restore()}this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageXObject(t,e){if(!this.contentVisible)return;const i=this.getObject(t,e);if(!i){ut("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t,i)}paintImageXObjectRepeat(t,e,i,n,s){if(!this.contentVisible)return;const r=this.getObject(t,e);if(!r){ut("Dependent image isn't ready yet");return}const o=r.width,l=r.height,d=[];for(let c=0,u=s.length;c<u;c+=2)d.push({transform:[i,0,0,n,s[c],s[c+1]],x:0,y:0,w:o,h:l});this.paintInlineImageXObjectGroup(t,r,d)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:i,height:n}=t,s=this.cachedCanvases.getCanvas("inlineImage",i,n),r=s.context;return r.filter=this.current.transferMaps,r.drawImage(e,0,0),r.filter="none",s.canvas}paintInlineImageXObject(t,e){if(!this.contentVisible)return;const i=e.width,n=e.height,s=this.ctx;this.save(t);const{filter:r}=s;r!=="none"&&r!==""&&(s.filter="none"),s.scale(1/i,-1/n);let o;if(e.bitmap)o=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)o=e;else{const c=this.cachedCanvases.getCanvas("inlineImage",i,n).context;Oa(c,e),o=this.applyTransferMapsToCanvas(c)}const l=this._scaleImage(o,fi(s));s.imageSmoothingEnabled=Ba(Gt(s),e.interpolate),this.dependencyTracker?.resetBBox(t).recordBBox(t,s,0,i,-n,0).recordDependencies(t,Qe.imageXObject).recordOperation(t),Rs(s,l.img,0,0,l.paintWidth,l.paintHeight,0,-n,i,n),this.compose(),this.restore(t)}paintInlineImageXObjectGroup(t,e,i){if(!this.contentVisible)return;const n=this.ctx;let s;if(e.bitmap)s=e.bitmap;else{const r=e.width,o=e.height,d=this.cachedCanvases.getCanvas("inlineImage",r,o).context;Oa(d,e),s=this.applyTransferMapsToCanvas(d)}this.dependencyTracker?.resetBBox(t);for(const r of i)n.save(),n.transform(...r.transform),n.scale(1,-1),Rs(n,s,r.x,r.y,r.w,r.h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,n,0,1,-1,0),n.restore();this.dependencyTracker?.recordOperation(t),this.compose()}paintSolidColorImageMask(t){this.contentVisible&&(this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,0,1,0,1).recordDependencies(t,Qe.fill).recordOperation(t),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t,e){}markPointProps(t,e,i){}beginMarkedContent(t,e){this.dependencyTracker?.beginMarkedContent(t),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e,i){this.dependencyTracker?.beginMarkedContent(t),e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(i)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(t){this.dependencyTracker?.endMarkedContent(t),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(t){}endCompat(t){}consumePath(t,e,i){const n=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(i);const s=this.ctx;this.pendingClip?(n||(this.pendingClip===Ua?s.clip(e,"evenodd"):s.clip(e)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(t).recordFutureForcedDependency("clipPath",t)):this.dependencyTracker?.recordOperation(t),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=Gt(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),i=Math.hypot(t[0],t[2]),n=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(i,n)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:i,c:n,d:s}=this.ctx.getTransform();let r,o;if(i===0&&n===0){const l=Math.abs(e),d=Math.abs(s);if(l===d)if(t===0)r=o=1/l;else{const c=l*t;r=o=c<1?1/c:1}else if(t===0)r=1/l,o=1/d;else{const c=l*t,u=d*t;r=c<1?1/c:1,o=u<1?1/u:1}}else{const l=Math.abs(e*s-i*n),d=Math.hypot(e,i),c=Math.hypot(n,s);if(t===0)r=c/l,o=d/l;else{const u=t*l;r=c>u?c/u:1,o=d>u?d/u:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:i,current:{lineWidth:n}}=this,[s,r]=this.getScaleForStroking();if(s===r){i.lineWidth=(n||1)*s,i.stroke(t);return}const o=i.getLineDash();e&&i.save(),i.scale(s,r),Ur.a=1/s,Ur.d=1/r;const l=new Path2D;if(l.addPath(t,Ur),o.length>0){const d=Math.max(s,r);i.setLineDash(o.map(c=>c/d)),i.lineDashOffset/=d}i.lineWidth=n||1,i.stroke(l),e&&i.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const a in as)Pn.prototype[a]!==void 0&&(Pn.prototype[as[a]]=Pn.prototype[a]);class kn{#t;#e;#n;static strings=["fontFamily","fontWeight","italicAngle"];static write(t){const e=new TextEncoder,i={};let n=0;for(const d of kn.strings){const c=e.encode(t[d]);i[d]=c,n+=4+c.length}const s=new ArrayBuffer(n),r=new Uint8Array(s),o=new DataView(s);let l=0;for(const d of kn.strings){const c=i[d],u=c.length;o.setUint32(l,u),r.set(c,l+4),l+=4+u}return xt(l===s.byteLength,"CssFontInfo.write: Buffer overflow"),s}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#n=new TextDecoder}#i(t){xt(t<kn.strings.length,"Invalid string index");let e=0;for(let n=0;n<t;n++)e+=this.#e.getUint32(e)+4;const i=this.#e.getUint32(e);return this.#n.decode(new Uint8Array(this.#t,e+4,i))}get fontFamily(){return this.#i(0)}get fontWeight(){return this.#i(1)}get italicAngle(){return this.#i(2)}}class Dn{#t;#e;#n;static strings=["css","loadedName","baseFontName","src"];static write(t){const e=new TextEncoder,i={};let n=0;for(const p of Dn.strings){const y=e.encode(t[p]);i[p]=y,n+=4+y.length}n+=4;let s,r,o=1+n;t.style&&(s=e.encode(t.style.style),r=e.encode(t.style.weight),o+=4+s.length+4+r.length);const l=new ArrayBuffer(o),d=new Uint8Array(l),c=new DataView(l);let u=0;c.setUint8(u++,t.guessFallback?1:0),c.setUint32(u,0),u+=4,n=0;for(const p of Dn.strings){const y=i[p],v=y.length;n+=4+v,c.setUint32(u,v),d.set(y,u+4),u+=4+v}return c.setUint32(u-n-4,n),t.style&&(c.setUint32(u,s.length),d.set(s,u+4),u+=4+s.length,c.setUint32(u,r.length),d.set(r,u+4),u+=4+r.length),xt(u<=l.byteLength,"SubstitionInfo.write: Buffer overflow"),l.transferToFixedLength(u)}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#n=new TextDecoder}get guessFallback(){return this.#e.getUint8(0)!==0}#i(t){xt(t<Dn.strings.length,"Invalid string index");let e=5;for(let n=0;n<t;n++)e+=this.#e.getUint32(e)+4;const i=this.#e.getUint32(e);return this.#n.decode(new Uint8Array(this.#t,e+4,i))}get css(){return this.#i(0)}get loadedName(){return this.#i(1)}get baseFontName(){return this.#i(2)}get src(){return this.#i(3)}get style(){let t=1;t+=4+this.#e.getUint32(t);const e=this.#e.getUint32(t),i=this.#n.decode(new Uint8Array(this.#t,t+4,e));t+=4+e;const n=this.#e.getUint32(t),s=this.#n.decode(new Uint8Array(this.#t,t+4,n));return{style:i,weight:s}}}class Lt{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#t=Math.ceil(this.bools.length*2/8);static#e=this.#t+this.numbers.length*8;static#n=this.#e+1+8;static#i=this.#n+1+48;static#o=this.#i+1+6;#s;#r;#a;constructor({data:t,extra:e}){this.#s=t,this.#r=new TextDecoder,this.#a=new DataView(this.#s),e&&Object.assign(this,e)}#h(t){xt(t<Lt.bools.length,"Invalid boolean index");const e=Math.floor(t/4),i=t*2%8,n=this.#a.getUint8(e)>>i&3;return n===0?void 0:n===2}get black(){return this.#h(0)}get bold(){return this.#h(1)}get disableFontFace(){return this.#h(2)}get fontExtraProperties(){return this.#h(3)}get isInvalidPDFjsFont(){return this.#h(4)}get isType3Font(){return this.#h(5)}get italic(){return this.#h(6)}get missingFile(){return this.#h(7)}get remeasure(){return this.#h(8)}get vertical(){return this.#h(9)}#l(t){return xt(t<Lt.numbers.length,"Invalid number index"),this.#a.getFloat64(Lt.#t+t*8)}get ascent(){return this.#l(0)}get defaultWidth(){return this.#l(1)}get descent(){return this.#l(2)}get bbox(){let t=Lt.#e;if(this.#a.getUint8(t)===0)return;t+=1;const i=[];for(let n=0;n<4;n++)i.push(this.#a.getInt16(t,!0)),t+=2;return i}get fontMatrix(){let t=Lt.#n;if(this.#a.getUint8(t)===0)return;t+=1;const i=[];for(let n=0;n<6;n++)i.push(this.#a.getFloat64(t,!0)),t+=8;return i}get defaultVMetrics(){let t=Lt.#i;if(this.#a.getUint8(t)===0)return;t+=1;const i=[];for(let n=0;n<3;n++)i.push(this.#a.getInt16(t,!0)),t+=2;return i}#u(t){xt(t<Lt.strings.length,"Invalid string index");let e=Lt.#o+4;for(let s=0;s<t;s++)e+=this.#a.getUint32(e)+4;const i=this.#a.getUint32(e),n=new Uint8Array(i);return n.set(new Uint8Array(this.#s,e+4,i)),this.#r.decode(n)}get fallbackName(){return this.#u(0)}get loadedName(){return this.#u(1)}get mimetype(){return this.#u(2)}get name(){return this.#u(3)}get data(){let t=Lt.#o;const e=this.#a.getUint32(t);t+=4+e;const i=this.#a.getUint32(t);t+=4+i;const n=this.#a.getUint32(t);t+=4+n;const s=this.#a.getUint32(t);if(s!==0)return new Uint8Array(this.#s,t+4,s)}clearData(){let t=Lt.#o;const e=this.#a.getUint32(t);t+=4+e;const i=this.#a.getUint32(t);t+=4+i;const n=this.#a.getUint32(t);t+=4+n;const s=this.#a.getUint32(t);new Uint8Array(this.#s,t+4,s).fill(0),this.#a.setUint32(t,0)}get cssFontInfo(){let t=Lt.#o;const e=this.#a.getUint32(t);t+=4+e;const i=this.#a.getUint32(t);t+=4+i;const n=this.#a.getUint32(t);if(n===0)return null;const s=new Uint8Array(n);return s.set(new Uint8Array(this.#s,t+4,n)),new kn(s.buffer)}get systemFontInfo(){let t=Lt.#o;const e=this.#a.getUint32(t);t+=4+e;const i=this.#a.getUint32(t);if(i===0)return null;const n=new Uint8Array(i);return n.set(new Uint8Array(this.#s,t+4,i)),new Dn(n.buffer)}static write(t){const e=t.systemFontInfo?Dn.write(t.systemFontInfo):null,i=t.cssFontInfo?kn.write(t.cssFontInfo):null,n=new TextEncoder,s={};let r=0;for(const w of Lt.strings)s[w]=n.encode(t[w]),r+=4+s[w].length;const o=Lt.#o+4+r+4+(e?e.byteLength:0)+4+(i?i.byteLength:0)+4+(t.data?t.data.length:0),l=new ArrayBuffer(o),d=new Uint8Array(l),c=new DataView(l);let u=0;const p=Lt.bools.length;let y=0,v=0;for(let w=0;w<p;w++){const x=t[Lt.bools[w]];y|=(x===void 0?0:x?2:1)<<v,v+=2,(v===8||w===p-1)&&(c.setUint8(u++,y),y=0,v=0)}xt(u===Lt.#t,"FontInfo.write: Boolean properties offset mismatch");for(const w of Lt.numbers)c.setFloat64(u,t[w]),u+=8;if(xt(u===Lt.#e,"FontInfo.write: Number properties offset mismatch"),t.bbox){c.setUint8(u++,4);for(const w of t.bbox)c.setInt16(u,w,!0),u+=2}else c.setUint8(u++,0),u+=8;if(xt(u===Lt.#n,"FontInfo.write: BBox properties offset mismatch"),t.fontMatrix){c.setUint8(u++,6);for(const w of t.fontMatrix)c.setFloat64(u,w,!0),u+=8}else c.setUint8(u++,0),u+=48;if(xt(u===Lt.#i,"FontInfo.write: FontMatrix properties offset mismatch"),t.defaultVMetrics){c.setUint8(u++,1);for(const w of t.defaultVMetrics)c.setInt16(u,w,!0),u+=2}else c.setUint8(u++,0),u+=6;xt(u===Lt.#o,"FontInfo.write: DefaultVMetrics properties offset mismatch"),c.setUint32(Lt.#o,0),u+=4;for(const w of Lt.strings){const x=s[w],S=x.length;c.setUint32(u,S),d.set(x,u+4),u+=4+S}if(c.setUint32(Lt.#o,u-Lt.#o-4),!e)c.setUint32(u,0),u+=4;else{const w=e.byteLength;c.setUint32(u,w),xt(u+4+w<=l.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),d.set(new Uint8Array(e),u+4),u+=4+w}if(!i)c.setUint32(u,0),u+=4;else{const w=i.byteLength;c.setUint32(u,w),xt(u+4+w<=l.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),d.set(new Uint8Array(i),u+4),u+=4+w}return t.data===void 0?(c.setUint32(u,0),u+=4):(c.setUint32(u,t.data.length),d.set(t.data,u+4),u+=4+t.data.length),xt(u<=l.byteLength,"FontInfo.write: Buffer overflow"),l.transferToFixedLength(u)}}class ji{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}}class Bd{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}[Symbol.iterator](){return this.#t.entries()}}const vn=Symbol("INTERNAL");class Ud{#t=!1;#e=!1;#n=!1;#i=!0;constructor(t,{name:e,intent:i,usage:n,rbGroups:s}){this.#t=!!(t&We.DISPLAY),this.#e=!!(t&We.PRINT),this.name=e,this.intent=i,this.usage=n,this.rbGroups=s}get visible(){if(this.#n)return this.#i;if(!this.#i)return!1;const{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,i=!1){t!==vn&&It("Internal method `_setVisible` called."),this.#n=i,this.#i=e}}class $d{#t=null;#e=new Map;#n=null;#i=null;constructor(t,e=We.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#i=t.order;for(const i of t.groups)this.#e.set(i.id,new Ud(e,i));if(t.baseState==="OFF")for(const i of this.#e.values())i._setVisible(vn,!1);for(const i of t.on)this.#e.get(i)._setVisible(vn,!0);for(const i of t.off)this.#e.get(i)._setVisible(vn,!1);this.#n=this.getHash()}}#o(t){const e=t.length;if(e<2)return!0;const i=t[0];for(let n=1;n<e;n++){const s=t[n];let r;if(Array.isArray(s))r=this.#o(s);else if(this.#e.has(s))r=this.#e.get(s).visible;else return ut(`Optional content group not found: ${s}`),!0;switch(i){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return i==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return gr("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:(ut(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#o(t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#e.has(e))return ut(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#e.has(e))return ut(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#e.has(e))return ut(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#e.has(e))return ut(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return ut(`Unknown optional content policy ${t.policy}.`),!0}return ut(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,i=!0){const n=this.#e.get(t);if(!n){ut(`Optional content group not found: ${t}`);return}if(i&&e&&n.rbGroups.length)for(const s of n.rbGroups)for(const r of s)r!==t&&this.#e.get(r)?._setVisible(vn,!1,!0);n._setVisible(vn,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let i;for(const n of t){switch(n){case"ON":case"OFF":case"Toggle":i=n;continue}const s=this.#e.get(n);if(s)switch(i){case"ON":this.setVisibility(n,!0,e);break;case"OFF":this.setVisibility(n,!1,e);break;case"Toggle":this.setVisibility(n,!s.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#n===null||this.getHash()===this.#n}getOrder(){return this.#e.size?this.#i?this.#i.slice():[...this.#e.keys()]:null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;const t=new $l;for(const[e,i]of this.#e)t.update(`${e}:${i.visible}`);return this.#t=t.hexdigest()}[Symbol.iterator](){return this.#e.entries()}}class Hd{constructor(t,{disableRange:e=!1,disableStream:i=!1}){xt(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:n,initialData:s,progressiveDone:r,contentDispositionFilename:o}=t;if(this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=o,s?.length>0){const l=s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!i,this._isRangeSupported=!e,this._contentLength=n,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((l,d)=>{this._onReceiveData({begin:l,chunk:d})}),t.addProgressListener((l,d)=>{this._onProgress({loaded:l,total:d})}),t.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const i=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{const n=this._rangeReaders.some(function(s){return s._begin!==t?!1:(s._enqueue(i),!0)});xt(n,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){xt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new jd(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new zd(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class jd{constructor(t,e,i=!1,n=null){this._stream=t,this._done=i||!1,this._filename=Po(n)?n:null,this._queuedChunks=e||[],this._loaded=0;for(const s of this._queuedChunks)this._loaded+=s.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class zd{constructor(t,e,i){this._stream=t,this._begin=e,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Gd(a){let t=!0,e=i("filename\\*","i").exec(a);if(e){e=e[1];let c=o(e);return c=unescape(c),c=l(c),c=d(c),s(c)}if(e=r(a),e){const c=d(e);return s(c)}if(e=i("filename","i").exec(a),e){e=e[1];let c=o(e);return c=d(c),s(c)}function i(c,u){return new RegExp("(?:^|;)\\s*"+c+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',u)}function n(c,u){if(c){if(!/^[\x00-\xFF]+$/.test(u))return u;try{const p=new TextDecoder(c,{fatal:!0}),y=ps(u);u=p.decode(y),t=!1}catch{}}return u}function s(c){return t&&/[\x80-\xff]/.test(c)&&(c=n("utf-8",c),t&&(c=n("iso-8859-1",c))),c}function r(c){const u=[];let p;const y=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(p=y.exec(c))!==null;){let[,w,x,S]=p;if(w=parseInt(w,10),w in u){if(w===0)break;continue}u[w]=[x,S]}const v=[];for(let w=0;w<u.length&&w in u;++w){let[x,S]=u[w];S=o(S),x&&(S=unescape(S),w===0&&(S=l(S))),v.push(S)}return v.join("")}function o(c){if(c.startsWith('"')){const u=c.slice(1).split('\\"');for(let p=0;p<u.length;++p){const y=u[p].indexOf('"');y!==-1&&(u[p]=u[p].slice(0,y),u.length=p+1),u[p]=u[p].replaceAll(/\\(.)/g,"$1")}c=u.join('"')}return c}function l(c){const u=c.indexOf("'");if(u===-1)return c;const p=c.slice(0,u),v=c.slice(u+1).replace(/^[^']*'/,"");return n(p,v)}function d(c){return!c.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(c)?c:c.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(u,p,y,v){if(y==="q"||y==="Q")return v=v.replaceAll("_"," "),v=v.replaceAll(/=([0-9a-fA-F]{2})/g,function(w,x){return String.fromCharCode(parseInt(x,16))}),n(p,v);try{v=atob(v)}catch{}return n(p,v)})}return""}function ql(a,t){const e=new Headers;if(!a||!t||typeof t!="object")return e;for(const i in t){const n=t[i];n!==void 0&&e.append(i,n)}return e}function br(a){return URL.parse(a)?.origin??null}function Xl({responseHeaders:a,isHttp:t,rangeChunkSize:e,disableRange:i}){const n={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(a.get("Content-Length"),10);return!Number.isInteger(s)||(n.suggestedLength=s,s<=2*e)||i||!t||a.get("Accept-Ranges")!=="bytes"||(a.get("Content-Encoding")||"identity")!=="identity"||(n.allowRangeRequests=!0),n}function Yl(a){const t=a.get("Content-Disposition");if(t){let e=Gd(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Po(e))return e}return null}function ws(a,t){return new Zs(`Unexpected server response (${a}) while retrieving PDF "${t}".`,a,a===404||a===0&&t.startsWith("file:"))}function Kl(a){return a===200||a===206}function Jl(a,t,e){return{method:"GET",headers:a,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function Ql(a){return a instanceof Uint8Array?a.buffer:a instanceof ArrayBuffer?a:(ut(`getArrayBuffer - unexpected data format: ${a}`),new Uint8Array(a).buffer)}class Vd{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=ql(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return xt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Wd(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new qd(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Wd{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const i=new Headers(t.headers),n=e.url;fetch(n,Jl(i,this._withCredentials,this._abortController)).then(s=>{if(t._responseOrigin=br(s.url),!Kl(s.status))throw ws(s.status,n);this._reader=s.body.getReader(),this._headersCapability.resolve();const r=s.headers,{allowRangeRequests:o,suggestedLength:l}=Xl({responseHeaders:r,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=Yl(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new zi("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Ql(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class qd{constructor(t,e,i){this._stream=t,this._reader=null,this._loaded=0;const n=t.source;this._withCredentials=n.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!n.disableStream,this._abortController=new AbortController;const s=new Headers(t.headers);s.append("Range",`bytes=${e}-${i-1}`);const r=n.url;fetch(r,Jl(s,this._withCredentials,this._abortController)).then(o=>{const l=br(o.url);if(l!==t._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${t._responseOrigin}".`);if(!Kl(o.status))throw ws(o.status,r);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:Ql(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}const $r=200,Hr=206;function Xd(a){const t=a.response;return typeof t!="string"?t:ps(t).buffer}class Yd{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:i}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=ql(this.isHttp,e),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,i=this.currXhrId++,n=this.pendingRequests[i]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[s,r]of this.headers)e.setRequestHeader(s,r);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),n.expectedStatus=Hr):n.expectedStatus=$r,e.responseType="arraybuffer",xt(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,i),e.onprogress=this.onProgress.bind(this,i),n.onHeadersReceived=t.onHeadersReceived,n.onDone=t.onDone,n.onError=t.onError,n.onProgress=t.onProgress,e.send(null),i}onProgress(t,e){const i=this.pendingRequests[t];i&&i.onProgress?.(e)}onStateChange(t,e){const i=this.pendingRequests[t];if(!i)return;const n=i.xhr;if(n.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),n.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],n.status===0&&this.isHttp){i.onError(n.status);return}const s=n.status||$r;if(!(s===$r&&i.expectedStatus===Hr)&&s!==i.expectedStatus){i.onError(n.status);return}const o=Xd(n);if(s===Hr){const l=n.getResponseHeader("Content-Range"),d=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);d?i.onDone({begin:parseInt(d[1],10),chunk:o}):(ut('Missing or invalid "Content-Range" header.'),i.onError(0))}else o?i.onDone({begin:0,chunk:o}):i.onError(n.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class Kd{constructor(t){this._source=t,this._manager=new Yd(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return xt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Jd(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const i=new Qd(this._manager,t,e);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Jd{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=br(e.responseURL);const i=e.getAllResponseHeaders(),n=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[l,...d]=o.split(": ");return[l,d.join(": ")]}):[]),{allowRangeRequests:s,suggestedLength:r}=Xl({responseHeaders:n,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=Yl(n),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=ws(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Qd{constructor(t,e,i){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:i,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const t=br(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=ws(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const Zd=/^[a-z][a-z0-9\-+.]+:/i;function tu(a){if(Zd.test(a))return new URL(a);const t=Jt.getBuiltinModule("url");return new URL(t.pathToFileURL(a))}class eu{constructor(t){this.source=t,this.url=tu(t.url),xt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return xt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new iu(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new nu(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class iu{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const i=Jt.getBuiltinModule("fs");i.promises.lstat(this._url).then(n=>{this._contentLength=n.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},n=>{n.code==="ENOENT"&&(n=ws(0,this._url.href)),this._storedError=n,this._headersCapability.reject(n)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new zi("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class nu{constructor(t,e,i){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const n=t.source;this._isStreamingSupported=!n.disableStream;const s=Jt.getBuiltinModule("fs");this._setReadableStream(s.createReadStream(this._url,{start:e,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const jn=Symbol("INITIAL_DATA");class Zl{#t=Object.create(null);#e(t){return this.#t[t]||={...Promise.withResolvers(),data:jn}}get(t,e=null){if(e){const n=this.#e(t);return n.promise.then(()=>e(n.data)),null}const i=this.#t[t];if(!i||i.data===jn)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return i.data}has(t){const e=this.#t[t];return!!e&&e.data!==jn}delete(t){const e=this.#t[t];return!e||e.data===jn?!1:(delete this.#t[t],!0)}resolve(t,e=null){const i=this.#e(t);i.data=e,i.resolve()}clear(){for(const t in this.#t){const{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const t in this.#t){const{data:e}=this.#t[t];e!==jn&&(yield[t,e])}}}const su=1e5,$a=30;class De{#t=Promise.withResolvers();#e=null;#n=!1;#i=!!globalThis.FontInspector?.enabled;#o=null;#s=null;#r=0;#a=0;#h=null;#l=null;#u=0;#d=0;#f=Object.create(null);#m=[];#p=null;#c=[];#g=new WeakMap;#y=null;static#w=new Map;static#b=new Map;static#C=new WeakMap;static#S=null;static#v=new Set;constructor({textContentSource:t,container:e,viewport:i}){if(t instanceof ReadableStream)this.#p=t;else if(typeof t=="object")this.#p=new ReadableStream({start(l){l.enqueue(t),l.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#l=e,this.#d=i.scale*Ei.pixelRatio,this.#u=i.rotation,this.#s={div:null,properties:null,ctx:null};const{pageWidth:n,pageHeight:s,pageX:r,pageY:o}=i.rawDims;this.#y=[1,0,0,-1,-r,o+s],this.#a=n,this.#r=s,De.#k(),sn(e,i),this.#t.promise.finally(()=>{De.#v.delete(this),this.#s=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=ve.platform;return yt(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#h.read().then(({value:e,done:i})=>{if(i){this.#t.resolve();return}this.#o??=e.lang,Object.assign(this.#f,e.styles),this.#T(e.items),t()},this.#t.reject)};return this.#h=this.#p.getReader(),De.#v.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){const i=t.scale*Ei.pixelRatio,n=t.rotation;if(n!==this.#u&&(e?.(),this.#u=n,sn(this.#l,{rotation:n})),i!==this.#d){e?.(),this.#d=i;const s={div:null,properties:null,ctx:De.#D(this.#o)};for(const r of this.#c)s.properties=this.#g.get(r),s.div=r,this.#x(s)}}cancel(){const t=new zi("TextLayer task cancelled.");this.#h?.cancel(t).catch(()=>{}),this.#h=null,this.#t.reject(t)}get textDivs(){return this.#c}get textContentItemsStr(){return this.#m}#T(t){if(this.#n)return;this.#s.ctx??=De.#D(this.#o);const e=this.#c,i=this.#m;for(const n of t){if(e.length>su){ut("Ignoring additional textDivs for performance reasons."),this.#n=!0;return}if(n.str===void 0){if(n.type==="beginMarkedContentProps"||n.type==="beginMarkedContent"){const s=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),n.id&&this.#e.setAttribute("id",`${n.id}`),s.append(this.#e)}else n.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}i.push(n.str),this.#E(n)}}#E(t){const e=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#c.push(e);const n=tt.transform(this.#y,t.transform);let s=Math.atan2(n[1],n[0]);const r=this.#f[t.fontName];r.vertical&&(s+=Math.PI/2);let o=this.#i&&r.fontSubstitution||r.fontFamily;o=De.fontFamilyMap.get(o)||o;const l=Math.hypot(n[2],n[3]),d=l*De.#N(o,r,this.#o);let c,u;s===0?(c=n[4],u=n[5]-d):(c=n[4]+d*Math.sin(s),u=n[5]-d*Math.cos(s));const p="calc(var(--total-scale-factor) *",y=e.style;this.#e===this.#l?(y.left=`${(100*c/this.#a).toFixed(2)}%`,y.top=`${(100*u/this.#r).toFixed(2)}%`):(y.left=`${p}${c.toFixed(2)}px)`,y.top=`${p}${u.toFixed(2)}px)`),y.fontSize=`${p}${(De.#S*l).toFixed(2)}px)`,y.fontFamily=o,i.fontSize=l,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#i&&(e.dataset.fontName=r.fontSubstitutionLoadedName||t.fontName),s!==0&&(i.angle=s*(180/Math.PI));let v=!1;if(t.str.length>1)v=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const w=Math.abs(t.transform[0]),x=Math.abs(t.transform[3]);w!==x&&Math.max(w,x)/Math.min(w,x)>1.5&&(v=!0)}if(v&&(i.canvasWidth=r.vertical?t.height:t.width),this.#g.set(e,i),this.#s.div=e,this.#s.properties=i,this.#x(this.#s),i.hasText&&this.#e.append(e),i.hasEOL){const w=document.createElement("br");w.setAttribute("role","presentation"),this.#e.append(w)}}#x(t){const{div:e,properties:i,ctx:n}=t,{style:s}=e;let r="";if(De.#S>1&&(r=`scale(${1/De.#S})`),i.canvasWidth!==0&&i.hasText){const{fontFamily:o}=s,{canvasWidth:l,fontSize:d}=i;De.#P(n,d*this.#d,o);const{width:c}=n.measureText(e.textContent);c>0&&(r=`scaleX(${l*this.#d/c}) ${r}`)}i.angle!==0&&(r=`rotate(${i.angle}deg) ${r}`),r.length>0&&(s.transform=r)}static cleanup(){if(!(this.#v.size>0)){this.#w.clear();for(const{canvas:t}of this.#b.values())t.remove();this.#b.clear()}}static#D(t=null){let e=this.#b.get(t||="");if(!e){const i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=t,document.body.append(i),e=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#b.set(t,e),this.#C.set(e,{size:0,family:""})}return e}static#P(t,e,i){const n=this.#C.get(t);e===n.size&&i===n.family||(t.font=`${e}px ${i}`,n.size=e,n.family=i)}static#k(){if(this.#S!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#S=t.getBoundingClientRect().height,t.remove()}static#N(t,e,i){const n=this.#w.get(t);if(n)return n;const s=this.#D(i);s.canvas.width=s.canvas.height=$a,this.#P(s,$a,t);const r=s.measureText(""),o=r.fontBoundingBoxAscent,l=Math.abs(r.fontBoundingBoxDescent);s.canvas.width=s.canvas.height=0;let d=.8;return o?d=o/(o+l):(ve.platform.isFirefox&&ut("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?d=e.ascent:e.descent&&(d=1+e.descent)),this.#w.set(t,d),d}}const ru=100;function th(a={}){typeof a=="string"||a instanceof URL?a={url:a}:(a instanceof ArrayBuffer||ArrayBuffer.isView(a))&&(a={data:a});const t=new Fo,{docId:e}=t,i=a.url?ud(a.url):null,n=a.data?fd(a.data):null,s=a.httpHeaders||null,r=a.withCredentials===!0,o=a.password??null,l=a.range instanceof eh?a.range:null,d=Number.isInteger(a.rangeChunkSize)&&a.rangeChunkSize>0?a.rangeChunkSize:2**16;let c=a.worker instanceof hs?a.worker:null;const u=a.verbosity,p=typeof a.docBaseUrl=="string"&&!mr(a.docBaseUrl)?a.docBaseUrl:null,y=Ds(a.cMapUrl),v=a.cMapPacked!==!1,w=a.CMapReaderFactory||(Le?Ad:_a),x=Ds(a.iccUrl),S=Ds(a.standardFontDataUrl),P=a.StandardFontDataFactory||(Le?Ed:Ta),k=Ds(a.wasmUrl),D=a.WasmFactory||(Le?Sd:Pa),M=a.stopAtErrors!==!0,R=Number.isInteger(a.maxImageSize)&&a.maxImageSize>-1?a.maxImageSize:-1,N=a.isEvalSupported!==!1,F=typeof a.isOffscreenCanvasSupported=="boolean"?a.isOffscreenCanvasSupported:!Le,O=typeof a.isImageDecoderSupported=="boolean"?a.isImageDecoderSupported:!Le&&(ve.platform.isFirefox||!globalThis.chrome),H=Number.isInteger(a.canvasMaxAreaInBytes)?a.canvasMaxAreaInBytes:-1,U=typeof a.disableFontFace=="boolean"?a.disableFontFace:Le,K=a.fontExtraProperties===!0,z=a.enableXfa===!0,G=a.ownerDocument||globalThis.document,et=a.disableRange===!0,V=a.disableStream===!0,W=a.disableAutoFetch===!0,Q=a.pdfBug===!0,Ct=a.CanvasFactory||(Le?vd:yd),Mt=a.FilterFactory||(Le?wd:bd),pt=a.enableHWA===!0,gt=a.useWasm!==!1,bt=l?l.length:a.length??NaN,ct=typeof a.useSystemFonts=="boolean"?a.useSystemFonts:!Le&&!U,_t=typeof a.useWorkerFetch=="boolean"?a.useWorkerFetch:!!(w===_a&&P===Ta&&D===Pa&&y&&S&&k&&Wn(y,document.baseURI)&&Wn(S,document.baseURI)&&Wn(k,document.baseURI)),wt=null;$c(u);const Pt={canvasFactory:new Ct({ownerDocument:G,enableHWA:pt}),filterFactory:new Mt({docId:e,ownerDocument:G}),cMapReaderFactory:_t?null:new w({baseUrl:y,isCompressed:v}),standardFontDataFactory:_t?null:new P({baseUrl:S}),wasmFactory:_t?null:new D({baseUrl:k})};c||(c=hs.create({verbosity:u,port:ji.workerPort}),t._worker=c);const Tt={docId:e,apiVersion:"5.4.296",data:n,password:o,disableAutoFetch:W,rangeChunkSize:d,length:bt,docBaseUrl:p,enableXfa:z,evaluatorOptions:{maxImageSize:R,disableFontFace:U,ignoreErrors:M,isEvalSupported:N,isOffscreenCanvasSupported:F,isImageDecoderSupported:O,canvasMaxAreaInBytes:H,fontExtraProperties:K,useSystemFonts:ct,useWasm:gt,useWorkerFetch:_t,cMapUrl:y,iccUrl:x,standardFontDataUrl:S,wasmUrl:k}},ie={ownerDocument:G,pdfBug:Q,styleElement:wt,loadingParams:{disableAutoFetch:W,enableXfa:z}};return c.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const He=c.messageHandler.sendWithPromise("GetDocRequest",Tt,n?[n.buffer]:null);let Ae;if(l)Ae=new Hd(l,{disableRange:et,disableStream:V});else if(!n){if(!i)throw new Error("getDocument - no `url` parameter provided.");const je=Wn(i)?Vd:Le?eu:Kd;Ae=new je({url:i,length:bt,httpHeaders:s,withCredentials:r,rangeChunkSize:d,disableRange:et,disableStream:V})}return He.then(je=>{if(t.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const _e=new qn(e,je,c.port),Wt=new lu(_e,t,Ae,ie,Pt,pt);t._transport=Wt,_e.send("Ready",null)})}).catch(t._capability.reject),t}class Fo{static#t=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${Fo.#t++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class eh{#t=Promise.withResolvers();#e=[];#n=[];#i=[];#o=[];constructor(t,e,i=!1,n=null){this.length=t,this.initialData=e,this.progressiveDone=i,this.contentDispositionFilename=n}addRangeListener(t){this.#o.push(t)}addProgressListener(t){this.#i.push(t)}addProgressiveReadListener(t){this.#n.push(t)}addProgressiveDoneListener(t){this.#e.push(t)}onDataRange(t,e){for(const i of this.#o)i(t,e)}onDataProgress(t,e){this.#t.promise.then(()=>{for(const i of this.#i)i(t,e)})}onDataProgressiveRead(t){this.#t.promise.then(()=>{for(const e of this.#n)e(t)})}onDataProgressiveDone(){this.#t.promise.then(()=>{for(const t of this.#e)t()})}transportReady(){this.#t.resolve()}requestDataRange(t,e){It("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class ou{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return yt(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(t,e){return this._transport.getAnnotationsByType(t,e)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class au{#t=!1;constructor(t,e,i,n=!1){this._pageIndex=t,this._pageInfo=e,this._transport=i,this._stats=n?new wa:null,this._pdfBug=n,this.commonObjs=i.commonObjs,this.objs=new Zl,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:i=0,offsetY:n=0,dontFlip:s=!1}={}){return new ms({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:i,offsetY:n,dontFlip:s})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return yt(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,canvas:e=t.canvas,viewport:i,intent:n="display",annotationMode:s=Bi.ENABLE,transform:r=null,background:o=null,optionalContentConfigPromise:l=null,annotationCanvasMap:d=null,pageColors:c=null,printAnnotationStorage:u=null,isEditing:p=!1,recordOperations:y=!1,operationsFilter:v=null}){this._stats?.time("Overall");const w=this._transport.getRenderingIntent(n,s,u,p),{renderingIntent:x,cacheKey:S}=w;this.#t=!1,l||=this._transport.getOptionalContentConfig(x);let P=this._intentStates.get(S);P||(P=Object.create(null),this._intentStates.set(S,P)),P.streamReaderCancelTimeout&&(clearTimeout(P.streamReaderCancelTimeout),P.streamReaderCancelTimeout=null);const k=!!(x&We.PRINT);P.displayReadyCapability||(P.displayReadyCapability=Promise.withResolvers(),P.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(w));const D=!!(this._pdfBug&&globalThis.StepperManager?.enabled),M=!this.recordedBBoxes&&(y||D),R=O=>{if(P.renderTasks.delete(N),M){const H=N.gfx?.dependencyTracker.take();H&&(N.stepper&&N.stepper.setOperatorBBoxes(H,N.gfx.dependencyTracker.takeDebugMetadata()),y&&(this.recordedBBoxes=H))}k&&(this.#t=!0),this.#e(),O?(N.capability.reject(O),this._abortOperatorList({intentState:P,reason:O instanceof Error?O:new Error(O)})):N.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},N=new xn({callback:R,params:{canvas:e,canvasContext:t,dependencyTracker:M?new Cd(e,P.operatorList.length,D):null,viewport:i,transform:r,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:d,operatorList:P.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!k,pdfBug:this._pdfBug,pageColors:c,enableHWA:this._transport.enableHWA,operationsFilter:v});(P.renderTasks||=new Set).add(N);const F=N.task;return Promise.all([P.displayReadyCapability.promise,l]).then(([O,H])=>{if(this.destroyed){R();return}if(this._stats?.time("Rendering"),!(H.renderingIntent&x))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");N.initializeGraphics({transparency:O,optionalContentConfig:H}),N.operatorListChanged()}).catch(R),F}getOperatorList({intent:t="display",annotationMode:e=Bi.ENABLE,printAnnotationStorage:i=null,isEditing:n=!1}={}){function s(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}const r=this._transport.getRenderingIntent(t,e,i,n,!0);let o=this._intentStates.get(r.cacheKey);o||(o=Object.create(null),this._intentStates.set(r.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=s,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||=new Set).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(r)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(n){return n.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>ls.textContent(i));const e=this.streamTextContent(t);return new Promise(function(i,n){function s(){r.read().then(function({value:l,done:d}){if(d){i(o);return}o.lang??=l.lang,Object.assign(o.styles,l.styles),o.items.push(...l.items),s()},n)}const r=e.getReader(),o={items:[],styles:Object.create(null),lang:null};s()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const i of e.renderTasks)t.push(i.completed),i.cancel();return this.objs.clear(),this.#t=!1,Promise.all(t)}cleanup(t=!1){this.#t=!0;const e=this.#e();return t&&e&&(this._stats&&=new wa),e}#e(){if(!this.#t||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}_startRenderPage(t,e){const i=this._intentStates.get(e);i&&(this._stats?.timeEnd("Page Request"),i.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let i=0,n=t.length;i<n;i++)e.operatorList.fnArray.push(t.fnArray[i]),e.operatorList.argsArray.push(t.argsArray[i]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const i of e.renderTasks)i.operatorListChanged();t.lastChunk&&this.#e()}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:i,modifiedIds:n}){const{map:s,transfer:r}=i,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:s,modifiedIds:n},r).getReader(),d=this._intentStates.get(e);d.streamReader=l;const c=()=>{l.read().then(({value:u,done:p})=>{if(p){d.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(u,d),c())},u=>{if(d.streamReader=null,!this._transport.destroyed){if(d.operatorList){d.operatorList.lastChunk=!0;for(const p of d.renderTasks)p.operatorListChanged();this.#e()}if(d.displayReadyCapability)d.displayReadyCapability.reject(u);else if(d.opListReadCapability)d.opListReadCapability.reject(u);else throw u}})};c()}_abortOperatorList({intentState:t,reason:e,force:i=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!i){if(t.renderTasks.size>0)return;if(e instanceof To){let n=ru;e.extraDelay>0&&e.extraDelay<1e3&&(n+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},n);return}}if(t.streamReader.cancel(new zi(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[n,s]of this._intentStates)if(s===t){this._intentStates.delete(n);break}this.cleanup()}}}get stats(){return this._stats}}var $i,ai,Pi,tn,dr,en,nn,Me,Ws,ih,nh,Xn,In,qs;const Ut=class Ut{constructor({name:t=null,port:e=null,verbosity:i=Hc()}={}){di(this,Me);di(this,$i,Promise.withResolvers());di(this,ai,null);di(this,Pi,null);di(this,tn,null);if(this.name=t,this.destroyed=!1,this.verbosity=i,e){if(Nt(Ut,nn).has(e))throw new Error("Cannot use more than one PDFWorker per port.");Nt(Ut,nn).set(e,this),ui(this,Me,ih).call(this,e)}else ui(this,Me,nh).call(this)}get promise(){return Nt(this,$i).promise}get port(){return Nt(this,Pi)}get messageHandler(){return Nt(this,ai)}destroy(){this.destroyed=!0,Nt(this,tn)?.terminate(),Fe(this,tn,null),Nt(Ut,nn).delete(Nt(this,Pi)),Fe(this,Pi,null),Nt(this,ai)?.destroy(),Fe(this,ai,null)}static create(t){const e=Nt(this,nn).get(t?.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new Ut(t)}static get workerSrc(){if(ji.workerSrc)return ji.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return yt(this,"_setupFakeWorkerGlobal",(async()=>Nt(this,In,qs)?Nt(this,In,qs):(await import(this.workerSrc)).WorkerMessageHandler)())}};$i=new WeakMap,ai=new WeakMap,Pi=new WeakMap,tn=new WeakMap,dr=new WeakMap,en=new WeakMap,nn=new WeakMap,Me=new WeakSet,Ws=function(){Nt(this,$i).resolve(),Nt(this,ai).send("configure",{verbosity:this.verbosity})},ih=function(t){Fe(this,Pi,t),Fe(this,ai,new qn("main","worker",t)),Nt(this,ai).on("ready",()=>{}),ui(this,Me,Ws).call(this)},nh=function(){if(Nt(Ut,en)||Nt(Ut,In,qs)){ui(this,Me,Xn).call(this);return}let{workerSrc:t}=Ut;try{Ut._isSameOrigin(window.location,t)||(t=Ut._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),i=new qn("main","worker",e),n=()=>{s.abort(),i.destroy(),e.terminate(),this.destroyed?Nt(this,$i).reject(new Error("Worker was destroyed")):ui(this,Me,Xn).call(this)},s=new AbortController;e.addEventListener("error",()=>{Nt(this,tn)||n()},{signal:s.signal}),i.on("test",o=>{if(s.abort(),this.destroyed||!o){n();return}Fe(this,ai,i),Fe(this,Pi,e),Fe(this,tn,e),ui(this,Me,Ws).call(this)}),i.on("ready",o=>{if(s.abort(),this.destroyed){n();return}try{r()}catch{ui(this,Me,Xn).call(this)}});const r=()=>{const o=new Uint8Array;i.send("test",o,[o.buffer])};r();return}catch{gr("The worker has been disabled.")}ui(this,Me,Xn).call(this)},Xn=function(){Nt(Ut,en)||(ut("Setting up fake worker."),Fe(Ut,en,!0)),Ut._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){Nt(this,$i).reject(new Error("Worker was destroyed"));return}const e=new md;Fe(this,Pi,e);const i=`fake${ua(Ut,dr)._++}`,n=new qn(i+"_worker",i,e);t.setup(n,e),Fe(this,ai,new qn(i,i+"_worker",e)),ui(this,Me,Ws).call(this)}).catch(t=>{Nt(this,$i).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},In=new WeakSet,qs=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},di(Ut,In),di(Ut,dr,0),di(Ut,en,!1),di(Ut,nn,new WeakMap),Le&&(Fe(Ut,en,!0),ji.workerSrc||="./pdf.worker.mjs"),Ut._isSameOrigin=(t,e)=>{const i=URL.parse(t);if(!i?.origin||i.origin==="null")return!1;const n=new URL(e,i);return i.origin===n.origin},Ut._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},Ut.fromPort=t=>{if(Zc("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return Ut.create(t)};let hs=Ut;class lu{#t=new Map;#e=new Map;#n=new Map;#i=new Map;#o=null;constructor(t,e,i,n,s,r){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new Zl,this.fontLoader=new cd({ownerDocument:n.ownerDocument,styleElement:n.styleElement}),this.loadingParams=n.loadingParams,this._params=n,this.canvasFactory=s.canvasFactory,this.filterFactory=s.filterFactory,this.cMapReaderFactory=s.cMapReaderFactory,this.standardFontDataFactory=s.standardFontDataFactory,this.wasmFactory=s.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=r,this.setupMessageHandler()}#s(t,e=null){const i=this.#t.get(t);if(i)return i;const n=this.messageHandler.sendWithPromise(t,e);return this.#t.set(t,n),n}get annotationStorage(){return yt(this,"annotationStorage",new Lo)}getRenderingIntent(t,e=Bi.ENABLE,i=null,n=!1,s=!1){let r=We.DISPLAY,o=lo;switch(t){case"any":r=We.ANY;break;case"display":break;case"print":r=We.PRINT;break;default:ut(`getRenderingIntent - invalid intent: ${t}`)}const l=r&We.PRINT&&i instanceof Hl?i:this.annotationStorage;switch(e){case Bi.DISABLE:r+=We.ANNOTATIONS_DISABLE;break;case Bi.ENABLE:break;case Bi.ENABLE_FORMS:r+=We.ANNOTATIONS_FORMS;break;case Bi.ENABLE_STORAGE:r+=We.ANNOTATIONS_STORAGE,o=l.serializable;break;default:ut(`getRenderingIntent - invalid annotationMode: ${e}`)}n&&(r+=We.IS_EDITING),s&&(r+=We.OPLIST);const{ids:d,hash:c}=l.modifiedIds,u=[r,o.hash,c];return{renderingIntent:r,cacheKey:u.join("_"),annotationStorageSerializable:o,modifiedIds:d}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#o?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const i of this.#e.values())t.push(i._destroy());this.#e.clear(),this.#n.clear(),this.#i.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),De.cleanup(),this._networkStream?.cancelAllRequests(new zi("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(i,n)=>{xt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=s=>{this._lastProgress={loaded:s.loaded,total:s.total}},n.onPull=()=>{this._fullReader.read().then(function({value:s,done:r}){if(r){n.close();return}xt(s instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),n.enqueue(new Uint8Array(s),1,[s])}).catch(s=>{n.error(s)})},n.onCancel=s=>{this._fullReader.cancel(s),n.ready.catch(r=>{if(!this.destroyed)throw r})}}),t.on("ReaderHeadersReady",async i=>{await this._fullReader.headersReady;const{isStreamingSupported:n,isRangeSupported:s,contentLength:r}=this._fullReader;return(!n||!s)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=o=>{e.onProgress?.({loaded:o.loaded,total:o.total})}),{isStreamingSupported:n,isRangeSupported:s,contentLength:r}}),t.on("GetRangeReader",(i,n)=>{xt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const s=this._networkStream.getRangeReader(i.begin,i.end);if(!s){n.close();return}n.onPull=()=>{s.read().then(function({value:r,done:o}){if(o){n.close();return}xt(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),n.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{n.error(r)})},n.onCancel=r=>{s.cancel(r),n.ready.catch(o=>{if(!this.destroyed)throw o})}}),t.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,e._capability.resolve(new ou(i,this))}),t.on("DocException",i=>{e._capability.reject(Be(i))}),t.on("PasswordRequest",i=>{this.#o=Promise.withResolvers();try{if(!e.onPassword)throw Be(i);const n=s=>{s instanceof Error?this.#o.reject(s):this.#o.resolve({password:s})};e.onPassword(n,i.code)}catch(n){this.#o.reject(n)}return this.#o.promise}),t.on("DataLoaded",i=>{e.onProgress?.({loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),t.on("StartRenderPage",i=>{if(this.destroyed)return;this.#e.get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),t.on("commonobj",([i,n,s])=>{if(this.destroyed||this.commonObjs.has(i))return null;switch(n){case"Font":if("error"in s){const c=s.error;ut(`Error during font loading: ${c}`),this.commonObjs.resolve(i,c);break}const r=new Lt(s),o=this._params.pdfBug&&globalThis.FontInspector?.enabled?(c,u)=>globalThis.FontInspector.fontAdded(c,u):null,l=new dd(r,o,s.extra,s.charProcOperatorList);this.fontLoader.bind(l).catch(()=>t.sendWithPromise("FontFallback",{id:i})).finally(()=>{!l.fontExtraProperties&&l.data&&l.clearData(),this.commonObjs.resolve(i,l)});break;case"CopyLocalImage":const{imageRef:d}=s;xt(d,"The imageRef must be defined.");for(const c of this.#e.values())for(const[,u]of c.objs)if(u?.ref===d)return u.dataLen?(this.commonObjs.resolve(i,structuredClone(u)),u.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,s);break;default:throw new Error(`Got unknown common object type ${n}`)}return null}),t.on("obj",([i,n,s,r])=>{if(this.destroyed)return;const o=this.#e.get(n);if(!o.objs.has(i)){if(o._intentStates.size===0){r?.bitmap?.close();return}switch(s){case"Image":case"Pattern":o.objs.resolve(i,r);break;default:throw new Error(`Got unknown object type ${s}`)}}}),t.on("DocProgress",i=>{this.destroyed||e.onProgress?.({loaded:i.loaded,total:i.total})}),t.on("FetchBinaryData",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");const n=this[i.type];if(!n)throw new Error(`${i.type} not initialized, see the \`useWorkerFetch\` parameter.`);return n.fetch(i)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&ut("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,i=this.#n.get(e);if(i)return i;const n=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(s=>{if(this.destroyed)throw new Error("Transport destroyed");s.refStr&&this.#i.set(s.refStr,t);const r=new au(e,s,this,this._params.pdfBug);return this.#e.set(e,r),r});return this.#n.set(e,n),n}getPageIndex(t){return ho(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#s("GetFieldObjects")}hasJSActions(){return this.#s("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(t,e){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:t,pageIndexesToSkip:e})}getDocJSActions(){return this.#s("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#s("GetOptionalContentConfig").then(e=>new $d(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#t.get(t);if(e)return e;const i=this.messageHandler.sendWithPromise(t,null).then(n=>({info:n[0],metadata:n[1]?new Bd(n[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(t,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#e.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),De.cleanup()}}cachedPageNumber(t){if(!ho(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#i.get(e)??null}}class hu{#t=null;onContinue=null;onError=null;constructor(t){this.#t=t}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#t;return t.form||t.canvas&&e?.size>0}}class xn{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:i,commonObjs:n,annotationCanvasMap:s,operatorList:r,pageIndex:o,canvasFactory:l,filterFactory:d,useRequestAnimationFrame:c=!1,pdfBug:u=!1,pageColors:p=null,enableHWA:y=!1,operationsFilter:v=null}){this.callback=t,this.params=e,this.objs=i,this.commonObjs=n,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=d,this._pdfBug=u,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=c===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new hu(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=y,this._dependencyTracker=e.dependencyTracker,this._operationsFilter=v}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(xn.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");xn.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:i,transform:n,background:s,dependencyTracker:r}=this.params,o=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Pn(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors,r),this.gfx.beginDrawing({transform:n,viewport:i,transparency:t,background:s}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),xn.#e.delete(this._canvas),t||=new To(`Rendering cancelled, page ${this._pageIndex+1}`,e),this.callback(t),this.task.onError?.(t)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),xn.#e.delete(this._canvas),this.callback())))}}const cu="5.4.296",du="f56dc8601";class ti{#t=null;#e=null;#n;#i=null;#o=!1;#s=!1;#r=null;#a;#h=null;#l=null;static#u=null;static get _keyboardManager(){return yt(this,"_keyboardManager",new bs([[["Escape","mac+Escape"],ti.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],ti.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],ti.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],ti.prototype._moveToPrevious],[["Home","mac+Home"],ti.prototype._moveToBeginning],[["End","mac+End"],ti.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#s=!1,this.#r=t):this.#s=!0,this.#l=t?._uiManager||e,this.#a=this.#l._eventBus,this.#n=t?.color?.toUpperCase()||this.#l?.highlightColors.values().next().value||"#FFFF98",ti.#u||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",this.#r&&(t.ariaControls=`${this.#r.id}_colorpicker_dropdown`);const e=this.#l._signal;t.addEventListener("click",this.#p.bind(this),{signal:e}),t.addEventListener("keydown",this.#m.bind(this),{signal:e});const i=this.#e=document.createElement("span");return i.className="swatch",i.ariaHidden="true",i.style.backgroundColor=this.#n,t.append(i),t}renderMainDropdown(){const t=this.#i=this.#d();return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}#d(){const t=document.createElement("div"),e=this.#l._signal;t.addEventListener("contextmenu",ii,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#r&&(t.id=`${this.#r.id}_colorpicker_dropdown`);for(const[i,n]of this.#l.highlightColors){const s=document.createElement("button");s.tabIndex="0",s.role="option",s.setAttribute("data-color",n),s.title=i,s.setAttribute("data-l10n-id",ti.#u[i]);const r=document.createElement("span");s.append(r),r.className="swatch",r.style.backgroundColor=n,s.ariaSelected=n===this.#n,s.addEventListener("click",this.#f.bind(this,n),{signal:e}),t.append(s)}return t.addEventListener("keydown",this.#m.bind(this),{signal:e}),t}#f(t,e){e.stopPropagation(),this.#a.dispatch("switchannotationeditorparams",{source:this,type:St.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#p(t);return}const e=t.target.getAttribute("data-color");e&&this.#f(e,t)}_moveToNext(t){if(!this.#g){this.#p(t);return}if(t.target===this.#t){this.#i.firstChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#i?.firstChild||t.target===this.#t){this.#g&&this._hideDropdownFromKeyboard();return}this.#g||this.#p(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#g){this.#p(t);return}this.#i.firstChild?.focus()}_moveToEnd(t){if(!this.#g){this.#p(t);return}this.#i.lastChild?.focus()}#m(t){ti._keyboardManager.exec(this,t)}#p(t){if(this.#g){this.hideDropdown();return}if(this.#o=t.detail===0,this.#h||(this.#h=new AbortController,window.addEventListener("pointerdown",this.#c.bind(this),{signal:this.#l.combinedSignal(this.#h)})),this.#t.ariaExpanded="true",this.#i){this.#i.classList.remove("hidden");return}const e=this.#i=this.#d();this.#t.append(e)}#c(t){this.#i?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#i?.classList.add("hidden"),this.#t.ariaExpanded="false",this.#h?.abort(),this.#h=null}get#g(){return this.#i&&!this.#i.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#s){if(!this.#g){this.#r?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#o})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#i)return;const e=this.#l.highlightColors.values();for(const i of this.#i.children)i.ariaSelected=e.next().value===t.toUpperCase()}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#i?.remove(),this.#i=null}}class cs{#t=null;#e=null;#n=null;static#i=null;constructor(t){this.#e=t,this.#n=t._uiManager,cs.#i||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#t)return this.#t;const{editorType:t,colorType:e,colorValue:i}=this.#e,n=this.#t=document.createElement("input");return n.type="color",n.value=i||"#000000",n.className="basicColorPicker",n.tabIndex=0,n.setAttribute("data-l10n-id",cs.#i[t]),n.addEventListener("input",()=>{this.#n.updateParams(e,n.value)},{signal:this.#n._signal}),n}update(t){this.#t&&(this.#t.value=t)}destroy(){this.#t?.remove(),this.#t=null}hideDropdown(){}}function Ha(a){return Math.floor(Math.max(0,Math.min(1,a))*255).toString(16).padStart(2,"0")}function zn(a){return Math.max(0,Math.min(255,255*a))}class ja{static CMYK_G([t,e,i,n]){return["G",1-Math.min(1,.3*t+.59*i+.11*e+n)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=zn(t),[t,t,t]}static G_HTML([t]){const e=Ha(t);return`#${e}${e}${e}`}static RGB_G([t,e,i]){return["G",.3*t+.59*e+.11*i]}static RGB_rgb(t){return t.map(zn)}static RGB_HTML(t){return`#${t.map(Ha).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,i,n]){return["RGB",1-Math.min(1,t+n),1-Math.min(1,i+n),1-Math.min(1,e+n)]}static CMYK_rgb([t,e,i,n]){return[zn(1-Math.min(1,t+n)),zn(1-Math.min(1,i+n)),zn(1-Math.min(1,e+n))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,i]){const n=1-t,s=1-e,r=1-i,o=Math.min(n,s,r);return["CMYK",n,s,r,o]}}class uu{create(t,e,i=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const n=this._createSVG("svg:svg");return n.setAttribute("version","1.1"),i||(n.setAttribute("width",`${t}px`),n.setAttribute("height",`${e}px`)),n.setAttribute("preserveAspectRatio","none"),n.setAttribute("viewBox",`0 0 ${t} ${e}`),n}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){It("Abstract method `_createSVG` called.")}}class er extends uu{_createSVG(t){return document.createElementNS(_i,t)}}const fu=9,rn=new WeakSet,pu=new Date().getTimezoneOffset()*60*1e3;class za{static create(t){switch(t.data.annotationType){case re.LINK:return new Oo(t);case re.TEXT:return new mu(t);case re.WIDGET:switch(t.data.fieldType){case"Tx":return new yu(t);case"Btn":return t.data.radioButton?new sh(t):t.data.checkBox?new wu(t):new vu(t);case"Ch":return new Au(t);case"Sig":return new bu(t)}return new ln(t);case re.POPUP:return new fo(t);case re.FREETEXT:return new rh(t);case re.LINE:return new Su(t);case re.SQUARE:return new xu(t);case re.CIRCLE:return new Cu(t);case re.POLYLINE:return new oh(t);case re.CARET:return new Tu(t);case re.INK:return new No(t);case re.POLYGON:return new _u(t);case re.HIGHLIGHT:return new ah(t);case re.UNDERLINE:return new Pu(t);case re.SQUIGGLY:return new ku(t);case re.STRIKEOUT:return new Du(t);case re.STAMP:return new lh(t);case re.FILEATTACHMENT:return new Lu(t);default:return new Vt(t)}}}class Vt{#t=null;#e=!1;#n=null;constructor(t,{isRenderable:e=!1,ignoreBorder:i=!1,createQuadrilaterals:n=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableComment=t.enableComment,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(i)),n&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t?.str||e?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Vt._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:t}=this,e=this.annotationStorage?.getEditor(t.id);return e?e.getData():t}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const t=this.annotationStorage?.getEditor(this.data.id);if(t)return t.commentButtonPositionInPage;const{quadPoints:e,inkLists:i,rect:n}=this.data;let s=-1/0,r=-1/0;if(e?.length>=8){for(let o=0;o<e.length;o+=8)e[o+1]>r?(r=e[o+1],s=e[o+2]):e[o+1]===r&&(s=Math.max(s,e[o+2]));return[s,r]}if(i?.length>=1){for(const o of i)for(let l=0,d=o.length;l<d;l+=2)o[l+1]>r?(r=o[l+1],s=o[l]):o[l+1]===r&&(s=Math.max(s,o[l]));if(s!==1/0)return[s,r]}return n?[n[2],n[3]]:null}_normalizePoint(t){const{page:{view:e},viewport:{rawDims:{pageWidth:i,pageHeight:n,pageX:s,pageY:r}}}=this.parent;return t[1]=e[3]-t[1]+e[1],t[0]=100*(t[0]-s)/i,t[1]=100*(t[1]-r)/n,t}get commentText(){const{data:t}=this;return this.annotationStorage.getRawValue(`${os}${t.id}`)?.popup?.contents||t.contentsObj?.str||""}set commentText(t){const{data:e}=this,i={deleted:!t,contents:t||""};this.annotationStorage.updateEditor(e.id,{popup:i})||this.annotationStorage.setValue(`${os}${e.id}`,{id:e.id,annotationType:e.annotationType,pageIndex:this.parent.page._pageIndex,popup:i,popupRef:e.popupRef,modificationDate:new Date}),t||this.removePopup()}removePopup(){(this.#n?.popup||this.popup)?.remove(),this.#n=this.popup=null}updateEdited(t){if(!this.container)return;t.rect&&(this.#t||={rect:this.data.rect.slice(0)});const{rect:e,popup:i}=t;e&&this.#i(e);let n=this.#n?.popup||this.popup;!n&&i?.text&&(this._createPopup(i),n=this.#n.popup),n&&(n.updateEdited(t),i?.deleted&&(n.remove(),this.#n=null,this.popup=null))}resetEdited(){this.#t&&(this.#i(this.#t.rect),this.#n?.popup.resetEdited(),this.#t=null)}#i(t){const{container:{style:e},data:{rect:i,rotation:n},parent:{viewport:{rawDims:{pageWidth:s,pageHeight:r,pageX:o,pageY:l}}}}=this;i?.splice(0,4,...t),e.left=`${100*(t[0]-o)/s}%`,e.top=`${100*(r-t[3]+l)/r}%`,n===0?(e.width=`${100*(t[2]-t[0])/s}%`,e.height=`${100*(t[3]-t[1])/r}%`):this.setRotation(n)}_createContainer(t){const{data:e,parent:{page:i,viewport:n}}=this,s=document.createElement("section");s.setAttribute("data-annotation-id",e.id),!(this instanceof ln)&&!(this instanceof Oo)&&(s.tabIndex=0);const{style:r}=s;if(r.zIndex=this.parent.zIndex,this.parent.zIndex+=2,e.alternativeText&&(s.title=e.alternativeText),e.noRotate&&s.classList.add("norotate"),!e.rect||this instanceof fo){const{rotation:w}=e;return!e.hasOwnCanvas&&w!==0&&this.setRotation(w,s),s}const{width:o,height:l}=this;if(!t&&e.borderStyle.width>0){r.borderWidth=`${e.borderStyle.width}px`;const w=e.borderStyle.horizontalCornerRadius,x=e.borderStyle.verticalCornerRadius;if(w>0||x>0){const P=`calc(${w}px * var(--total-scale-factor)) / calc(${x}px * var(--total-scale-factor))`;r.borderRadius=P}else if(this instanceof sh){const P=`calc(${o}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;r.borderRadius=P}switch(e.borderStyle.style){case wn.SOLID:r.borderStyle="solid";break;case wn.DASHED:r.borderStyle="dashed";break;case wn.BEVELED:ut("Unimplemented border style: beveled");break;case wn.INSET:ut("Unimplemented border style: inset");break;case wn.UNDERLINE:r.borderBottomStyle="solid";break}const S=e.borderColor||null;S?(this.#e=!0,r.borderColor=tt.makeHexColor(S[0]|0,S[1]|0,S[2]|0)):r.borderWidth=0}const d=tt.normalizeRect([e.rect[0],i.view[3]-e.rect[1]+i.view[1],e.rect[2],i.view[3]-e.rect[3]+i.view[1]]),{pageWidth:c,pageHeight:u,pageX:p,pageY:y}=n.rawDims;r.left=`${100*(d[0]-p)/c}%`,r.top=`${100*(d[1]-y)/u}%`;const{rotation:v}=e;return e.hasOwnCanvas||v===0?(r.width=`${100*o/c}%`,r.height=`${100*l/u}%`):this.setRotation(v,s),s}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:i,pageHeight:n}=this.parent.viewport.rawDims;let{width:s,height:r}=this;t%180!==0&&([s,r]=[r,s]),e.style.width=`${100*s/i}%`,e.style.height=`${100*r/n}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,i,n)=>{const s=n.detail[e],r=s[0],o=s.slice(1);n.target.style[i]=ja[`${r}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[i]:ja[`${r}_rgb`](o)})};return yt(this,"_commonActions",{display:e=>{const{display:i}=e.detail,n=i%2===1;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:n,noPrint:i===1||i===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:i}=e.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const i=e.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(t,e){const i=this._commonActions;for(const n of Object.keys(e.detail))(t[n]||i[n])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const i=this._commonActions;for(const[n,s]of Object.entries(e)){const r=i[n];if(r){const o={detail:{[n]:s},target:t};r(o),delete e[n]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,i,n,s]=this.data.rect.map(w=>Math.fround(w));if(t.length===8){const[w,x,S,P]=t.subarray(2,6);if(n===w&&s===x&&e===S&&i===P)return}const{style:r}=this.container;let o;if(this.#e){const{borderColor:w,borderWidth:x}=r;r.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${w}" stroke-width="${x}">`],this.container.classList.add("hasBorder")}const l=n-e,d=s-i,{svgFactory:c}=this,u=c.createElement("svg");u.classList.add("quadrilateralsContainer"),u.setAttribute("width",0),u.setAttribute("height",0),u.role="none";const p=c.createElement("defs");u.append(p);const y=c.createElement("clipPath"),v=`clippath_${this.data.id}`;y.setAttribute("id",v),y.setAttribute("clipPathUnits","objectBoundingBox"),p.append(y);for(let w=2,x=t.length;w<x;w+=8){const S=t[w],P=t[w+1],k=t[w+2],D=t[w+3],M=c.createElement("rect"),R=(k-e)/l,N=(s-P)/d,F=(S-k)/l,O=(P-D)/d;M.setAttribute("x",R),M.setAttribute("y",N),M.setAttribute("width",F),M.setAttribute("height",O),y.append(M),o?.push(`<rect vector-effect="non-scaling-stroke" x="${R}" y="${N}" width="${F}" height="${O}"/>`)}this.#e&&(o.push("</g></svg>')"),r.backgroundImage=o.join("")),this.container.append(u),this.container.style.clipPath=`url(#${v})`}_createPopup(t=null){const{data:e}=this;let i,n;t?(i={str:t.text},n=t.date):(i=e.contentsObj,n=e.modificationDate);const s=this.#n=new fo({data:{color:e.color,titleObj:e.titleObj,modificationDate:n,contentsObj:i,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]});this.parent._commentManager||this.parent.div.append(s.render())}get hasPopupElement(){return!!(this.#n||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#n}render(){It("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const i=[];if(this._fieldObjects){const n=this._fieldObjects[t];if(n)for(const{page:s,id:r,exportValues:o}of n){if(s===-1||r===e)continue;const l=typeof o=="string"?o:null,d=document.querySelector(`[data-element-id="${r}"]`);if(d&&!rn.has(d)){ut(`_getElementsByName - element not allowed: ${r}`);continue}i.push({id:r,exportValue:l,domElement:d})}return i}for(const n of document.getElementsByName(t)){const{exportValue:s}=n,r=n.getAttribute("data-element-id");r!==e&&rn.has(n)&&i.push({id:r,exportValue:s,domElement:n})}return i}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class gu extends Vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.editor=t.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:t}=this;t.hasComment&&(this._createPopup(t.comment),this.extraPopupElement.popup.renderCommentButton())}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(t){this.editor.comment=t,t||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.container.remove(),this.container=null,this.removePopup()}}class Oo extends Vt{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let n=!1;return t.url?(e.addLinkAttributes(i,t.url,t.newWindow),n=!0):t.action?(this._bindNamedAction(i,t.action,t.overlaidText),n=!0):t.attachment?(this.#e(i,t.attachment,t.overlaidText,t.attachmentDest),n=!0):t.setOCGState?(this.#n(i,t.setOCGState,t.overlaidText),n=!0):t.dest?(this._bindLink(i,t.dest,t.overlaidText),n=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),n=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(i,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&this.container.append(i),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e,i=""){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t(),i&&(t.title=i)}_bindNamedAction(t,e,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),i&&(t.title=i),this.#t()}#e(t,e,i="",n=null){t.href=this.linkService.getAnchorUrl(""),e.description?t.title=e.description:i&&(t.title=i),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,n),!1),this.#t()}#n(t,e,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),i&&(t.title=i),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(e.actions)){const s=i.get(n);s&&(t[s]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:n}}),!1))}e.overlaidText&&(t.title=e.overlaidText),t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){const i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){ut('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{i?.();const{fields:n,refs:s,include:r}=e,o=[];if(n.length!==0||s.length!==0){const c=new Set(s);for(const u of n){const p=this._fieldObjects[u]||[];for(const{id:y}of p)c.add(y)}for(const u of Object.values(this._fieldObjects))for(const p of u)c.has(p.id)===r&&o.push(p)}else for(const c of Object.values(this._fieldObjects))o.push(...c);const l=this.annotationStorage,d=[];for(const c of o){const{id:u}=c;switch(d.push(u),c.type){case"text":{const y=c.defaultValue||"";l.setValue(u,{value:y});break}case"checkbox":case"radiobutton":{const y=c.defaultValue===c.exportValues;l.setValue(u,{value:y});break}case"combobox":case"listbox":{const y=c.defaultValue||"";l.setValue(u,{value:y});break}default:continue}const p=document.querySelector(`[data-element-id="${u}"]`);if(p){if(!rn.has(p)){ut(`_bindResetFormAction - element not allowed: ${u}`);continue}}else continue;p.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:d,name:"ResetForm"}}),!1}}}class mu extends Vt{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class ln extends Vt{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return ve.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,i,n,s){i.includes("mouse")?t.addEventListener(i,r=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:s(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):t.addEventListener(i,r=>{if(i==="blur"){if(!e.focused||!r.relatedTarget)return;e.focused=!1}else if(i==="focus"){if(e.focused)return;e.focused=!0}s&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:s(r)}})})}_setEventListeners(t,e,i,n){for(const[s,r]of i)(r==="Action"||this.data.actions?.[r])&&((r==="Focus"||r==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,s,r,n),r==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):r==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":tt.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,n=this.data.defaultAppearanceData.fontSize||fu,s=t.style;let r;const o=2,l=d=>Math.round(10*d)/10;if(this.data.multiLine){const d=Math.abs(this.data.rect[3]-this.data.rect[1]-o),c=Math.round(d/(Rr*n))||1,u=d/c;r=Math.min(n,l(u/Rr))}else{const d=Math.abs(this.data.rect[3]-this.data.rect[1]-o);r=Math.min(n,l(d/Rr))}s.fontSize=`calc(${r}px * var(--total-scale-factor))`,s.color=tt.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(s.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class yu extends ln{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,i,n){const s=this.annotationStorage;for(const r of this._getElementsByName(t.name,t.id))r.domElement&&(r.domElement[e]=i),s.setValue(r.id,{[n]:i})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){const n=t.getValue(e,{value:this.data.fieldValue});let s=n.value||"";const r=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;r&&s.length>r&&(s=s.slice(0,r));let o=n.formattedValue||this.data.textContent?.join(`
`)||null;o&&this.data.comb&&(o=o.replaceAll(/\s+/g,""));const l={userValue:s,formattedValue:o,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=o??s,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type=this.data.password?"password":"text",i.setAttribute("value",o??s),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),rn.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=0;const{datetimeFormat:d,datetimeType:c,timeStep:u}=this.data,p=!!c&&this.enableScripting;d&&(i.title=d),this._setRequired(i,this.data.required),r&&(i.maxLength=r),i.addEventListener("input",v=>{t.setValue(e,{value:v.target.value}),this.setPropertyOnSiblings(i,"value",v.target.value,"value"),l.formattedValue=null}),i.addEventListener("resetform",v=>{const w=this.data.defaultFieldValue??"";i.value=l.userValue=w,l.formattedValue=null});let y=v=>{const{formattedValue:w}=l;w!=null&&(v.target.value=w),v.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",w=>{if(l.focused)return;const{target:x}=w;if(p&&(x.type=c,u&&(x.step=u)),l.userValue){const S=l.userValue;if(p)if(c==="time"){const P=new Date(S),k=[P.getHours(),P.getMinutes(),P.getSeconds()];x.value=k.map(D=>D.toString().padStart(2,"0")).join(":")}else x.value=new Date(S-pu).toISOString().split(c==="date"?"T":".",1)[0];else x.value=S}l.lastCommittedValue=x.value,l.commitKey=1,this.data.actions?.Focus||(l.focused=!0)}),i.addEventListener("updatefromsandbox",w=>{this.showElementAndHideCanvas(w.target);const x={value(S){l.userValue=S.detail.value??"",p||t.setValue(e,{value:l.userValue.toString()}),S.target.value=l.userValue},formattedValue(S){const{formattedValue:P}=S.detail;l.formattedValue=P,P!=null&&S.target!==document.activeElement&&(S.target.value=P);const k={formattedValue:P};p&&(k.value=P),t.setValue(e,k)},selRange(S){S.target.setSelectionRange(...S.detail.selRange)},charLimit:S=>{const{charLimit:P}=S.detail,{target:k}=S;if(P===0){k.removeAttribute("maxLength");return}k.setAttribute("maxLength",P);let D=l.userValue;!D||D.length<=P||(D=D.slice(0,P),k.value=l.userValue=D,t.setValue(e,{value:D}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:D,willCommit:!0,commitKey:1,selStart:k.selectionStart,selEnd:k.selectionEnd}}))}};this._dispatchEventFromSandbox(x,w)}),i.addEventListener("keydown",w=>{l.commitKey=1;let x=-1;if(w.key==="Escape"?x=0:w.key==="Enter"&&!this.data.multiLine?x=2:w.key==="Tab"&&(l.commitKey=3),x===-1)return;const{value:S}=w.target;l.lastCommittedValue!==S&&(l.lastCommittedValue=S,l.userValue=S,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:S,willCommit:!0,commitKey:x,selStart:w.target.selectionStart,selEnd:w.target.selectionEnd}}))});const v=y;y=null,i.addEventListener("blur",w=>{if(!l.focused||!w.relatedTarget)return;this.data.actions?.Blur||(l.focused=!1);const{target:x}=w;let{value:S}=x;if(p){if(S&&c==="time"){const P=S.split(":").map(k=>parseInt(k,10));S=new Date(2e3,0,1,P[0],P[1],P[2]||0).valueOf(),x.step=""}else S.includes("T")||(S=`${S}T00:00`),S=new Date(S).valueOf();x.type="text"}l.userValue=S,l.lastCommittedValue!==S&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:S,willCommit:!0,commitKey:l.commitKey,selStart:w.target.selectionStart,selEnd:w.target.selectionEnd}}),v(w)}),this.data.actions?.Keystroke&&i.addEventListener("beforeinput",w=>{l.lastCommittedValue=null;const{data:x,target:S}=w,{value:P,selectionStart:k,selectionEnd:D}=S;let M=k,R=D;switch(w.inputType){case"deleteWordBackward":{const N=P.substring(0,k).match(/\w*[^\w]*$/);N&&(M-=N[0].length);break}case"deleteWordForward":{const N=P.substring(k).match(/^[^\w]*\w*/);N&&(R+=N[0].length);break}case"deleteContentBackward":k===D&&(M-=1);break;case"deleteContentForward":k===D&&(R+=1);break}w.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:P,change:x||"",willCommit:!1,selStart:M,selEnd:R}})}),this._setEventListeners(i,l,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],w=>w.target.value)}if(y&&i.addEventListener("blur",y),this.data.comb){const w=(this.data.rect[2]-this.data.rect[0])/r;i.classList.add("comb"),i.style.letterSpacing=`calc(${w}px * var(--total-scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class bu extends ln{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class wu extends ln{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,i=e.id;let n=t.getValue(i,{value:e.exportValue===e.fieldValue}).value;typeof n=="string"&&(n=n!=="Off",t.setValue(i,{value:n})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const s=document.createElement("input");return rn.add(s),s.setAttribute("data-element-id",i),s.disabled=e.readOnly,this._setRequired(s,this.data.required),s.type="checkbox",s.name=e.fieldName,n&&s.setAttribute("checked",!0),s.setAttribute("exportValue",e.exportValue),s.tabIndex=0,s.addEventListener("change",r=>{const{name:o,checked:l}=r.target;for(const d of this._getElementsByName(o,i)){const c=l&&d.exportValue===e.exportValue;d.domElement&&(d.domElement.checked=c),t.setValue(d.id,{value:c})}t.setValue(i,{value:l})}),s.addEventListener("resetform",r=>{const o=e.defaultFieldValue||"Off";r.target.checked=o===e.exportValue}),this.enableScripting&&this.hasJSActions&&(s.addEventListener("updatefromsandbox",r=>{const o={value(l){l.target.checked=l.detail.value!=="Off",t.setValue(i,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,r)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class sh extends ln{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,i=e.id;let n=t.getValue(i,{value:e.fieldValue===e.buttonValue}).value;if(typeof n=="string"&&(n=n!==e.buttonValue,t.setValue(i,{value:n})),n)for(const r of this._getElementsByName(e.fieldName,i))t.setValue(r.id,{value:!1});const s=document.createElement("input");if(rn.add(s),s.setAttribute("data-element-id",i),s.disabled=e.readOnly,this._setRequired(s,this.data.required),s.type="radio",s.name=e.fieldName,n&&s.setAttribute("checked",!0),s.tabIndex=0,s.addEventListener("change",r=>{const{name:o,checked:l}=r.target;for(const d of this._getElementsByName(o,i))t.setValue(d.id,{value:!1});t.setValue(i,{value:l})}),s.addEventListener("resetform",r=>{const o=e.defaultFieldValue;r.target.checked=o!=null&&o===e.buttonValue}),this.enableScripting&&this.hasJSActions){const r=e.buttonValue;s.addEventListener("updatefromsandbox",o=>{const l={value:d=>{const c=r===d.detail.value;for(const u of this._getElementsByName(d.target.name)){const p=c&&u.id===i;u.domElement&&(u.domElement.checked=p),t.setValue(u.id,{value:p})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class vu extends Oo{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),t}}class Au extends ln{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,i=t.getValue(e,{value:this.data.fieldValue}),n=document.createElement("select");rn.add(n),n.setAttribute("data-element-id",e),n.disabled=this.data.readOnly,this._setRequired(n,this.data.required),n.name=this.data.fieldName,n.tabIndex=0;let s=this.data.combo&&this.data.options.length>0;this.data.combo||(n.size=this.data.options.length,this.data.multiSelect&&(n.multiple=!0)),n.addEventListener("resetform",c=>{const u=this.data.defaultFieldValue;for(const p of n.options)p.selected=p.value===u});for(const c of this.data.options){const u=document.createElement("option");u.textContent=c.displayValue,u.value=c.exportValue,i.value.includes(c.exportValue)&&(u.setAttribute("selected",!0),s=!1),n.append(u)}let r=null;if(s){const c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),n.prepend(c),r=()=>{c.remove(),n.removeEventListener("input",r),r=null},n.addEventListener("input",r)}const o=c=>{const u=c?"value":"textContent",{options:p,multiple:y}=n;return y?Array.prototype.filter.call(p,v=>v.selected).map(v=>v[u]):p.selectedIndex===-1?null:p[p.selectedIndex][u]};let l=o(!1);const d=c=>{const u=c.target.options;return Array.prototype.map.call(u,p=>({displayValue:p.textContent,exportValue:p.value}))};return this.enableScripting&&this.hasJSActions?(n.addEventListener("updatefromsandbox",c=>{const u={value(p){r?.();const y=p.detail.value,v=new Set(Array.isArray(y)?y:[y]);for(const w of n.options)w.selected=v.has(w.value);t.setValue(e,{value:o(!0)}),l=o(!1)},multipleSelection(p){n.multiple=!0},remove(p){const y=n.options,v=p.detail.remove;y[v].selected=!1,n.remove(v),y.length>0&&Array.prototype.findIndex.call(y,x=>x.selected)===-1&&(y[0].selected=!0),t.setValue(e,{value:o(!0),items:d(p)}),l=o(!1)},clear(p){for(;n.length!==0;)n.remove(0);t.setValue(e,{value:null,items:[]}),l=o(!1)},insert(p){const{index:y,displayValue:v,exportValue:w}=p.detail.insert,x=n.children[y],S=document.createElement("option");S.textContent=v,S.value=w,x?x.before(S):n.append(S),t.setValue(e,{value:o(!0),items:d(p)}),l=o(!1)},items(p){const{items:y}=p.detail;for(;n.length!==0;)n.remove(0);for(const v of y){const{displayValue:w,exportValue:x}=v,S=document.createElement("option");S.textContent=w,S.value=x,n.append(S)}n.options.length>0&&(n.options[0].selected=!0),t.setValue(e,{value:o(!0),items:d(p)}),l=o(!1)},indices(p){const y=new Set(p.detail.indices);for(const v of p.target.options)v.selected=y.has(v.index);t.setValue(e,{value:o(!0)}),l=o(!1)},editable(p){p.target.disabled=!p.detail.editable}};this._dispatchEventFromSandbox(u,c)}),n.addEventListener("input",c=>{const u=o(!0),p=o(!1);t.setValue(e,{value:u}),c.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:l,change:p,changeEx:u,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(n,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],c=>c.target.value)):n.addEventListener("input",function(c){t.setValue(e,{value:o(!0)})}),this.data.combo&&this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class fo extends Vt{constructor(t){const{data:e,elements:i,parent:n}=t,s=!!n._commentManager;if(super(t,{isRenderable:!s&&Vt._hasPopupData(e)}),this.elements=i,s&&Vt._hasPopupData(e)){const r=this.popup=this.#t();for(const o of i)o.popup=r}else this.popup=null}#t(){return new Eu({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=this.#t(),i=[];for(const n of this.elements)n.popup=e,n.container.ariaHasPopup="dialog",i.push(n.data.id),n.addHighlightArea();return this.container.setAttribute("aria-controls",i.map(n=>`${_o}${n}`).join(",")),this.container}}class Eu{#t=null;#e=this.#G.bind(this);#n=this.#U.bind(this);#i=this.#M.bind(this);#o=this.#A.bind(this);#s=null;#r=null;#a=null;#h=null;#l=null;#u=null;#d=null;#f=!1;#m=null;#p=null;#c=null;#g=null;#y=null;#w=null;#b=null;#C=null;#S=null;#v=null;#T=!1;#E=null;#x=null;constructor({container:t,color:e,elements:i,titleObj:n,modificationDate:s,contentsObj:r,richText:o,parent:l,rect:d,parentRect:c,open:u,commentManager:p=null}){this.#r=t,this.#S=n,this.#a=r,this.#C=o,this.#u=l,this.#s=e,this.#b=d,this.#d=c,this.#l=i,this.#t=p,this.#E=i[0],this.#h=ro.toDateObject(s),this.trigger=i.flatMap(y=>y.getElementsToTriggerPopup()),p?this.renderCommentButton():(this.#D(),this.#r.hidden=!0,u&&this.#A())}#D(){if(this.#p)return;this.#p=new AbortController;const{signal:t}=this.#p;for(const e of this.trigger)e.addEventListener("click",this.#o,{signal:t}),e.addEventListener("pointerenter",this.#i,{signal:t}),e.addEventListener("pointerleave",this.#n,{signal:t}),e.classList.add("popupTriggerArea");for(const e of this.#l)e.container?.addEventListener("keydown",this.#e,{signal:t})}#P(){const t=this.#l.find(e=>e.hasCommentButton);t&&(this.#y=t._normalizePoint(t.commentButtonPosition))}renderCommentButton(){if(this.#g||(this.#y||this.#P(),!this.#y))return;const{signal:t}=this.#p=new AbortController,e=!!this.#E.extraPopupElement,i=()=>{this.#t.toggleCommentPopup(this,!0,void 0,!e)},n=()=>{this.#t.toggleCommentPopup(this,!1,!0,!e)},s=()=>{this.#t.toggleCommentPopup(this,!1,!1)};if(e){this.#g=this.#E.container;for(const r of this.trigger)r.ariaHasPopup="dialog",r.ariaControls="commentPopup",r.addEventListener("keydown",this.#e,{signal:t}),r.addEventListener("click",i,{signal:t}),r.addEventListener("pointerenter",n,{signal:t}),r.addEventListener("pointerleave",s,{signal:t}),r.classList.add("popupTriggerArea")}else{const r=this.#g=document.createElement("button");r.className="annotationCommentButton";const o=this.#E.container;r.style.zIndex=o.style.zIndex+1,r.tabIndex=0,r.ariaHasPopup="dialog",r.ariaControls="commentPopup",r.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#N(),this.#k(),r.addEventListener("keydown",this.#e,{signal:t}),r.addEventListener("click",i,{signal:t}),r.addEventListener("pointerenter",n,{signal:t}),r.addEventListener("pointerleave",s,{signal:t}),o.after(r)}}#k(){if(this.#E.extraPopupElement&&!this.#E.editor)return;this.renderCommentButton();const[t,e]=this.#y,{style:i}=this.#g;i.left=`calc(${t}%)`,i.top=`calc(${e}% - var(--comment-button-dim))`}#N(){this.#E.extraPopupElement||(this.renderCommentButton(),this.#g.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:t,opacity:e}=this.#E.commentData;return t?this.#u._commentManager.makeCommentColor(t,e):null}focusCommentButton(){setTimeout(()=>{this.#g?.focus()},0)}getData(){const{richText:t,color:e,opacity:i,creationDate:n,modificationDate:s}=this.#E.commentData;return{contentsObj:{str:this.comment},richText:t,color:e,opacity:i,creationDate:n,modificationDate:s}}get elementBeforePopup(){return this.#g}get comment(){return this.#x||=this.#E.commentText,this.#x}set comment(t){t!==this.comment&&(this.#E.commentText=this.#x=t)}get parentBoundingClientRect(){return this.#E.layer.getBoundingClientRect()}setCommentButtonStates({selected:t,hasPopup:e}){this.#g&&(this.#g.classList.toggle("selected",t),this.#g.ariaExpanded=e)}setSelectedCommentButton(t){this.#g.classList.toggle("selected",t)}get commentPopupPosition(){if(this.#w)return this.#w;const{x:t,y:e,height:i}=this.#g.getBoundingClientRect(),{x:n,y:s,width:r,height:o}=this.#E.layer.getBoundingClientRect();return[(t-n)/r,(e+i-s)/o]}set commentPopupPosition(t){this.#w=t}hasDefaultPopupPosition(){return this.#w===null}get commentButtonPosition(){return this.#y}get commentButtonWidth(){return this.#g.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(t){const[e,i]=this.#w||this.commentButtonPosition.map(d=>d/100),n=this.parentBoundingClientRect,{x:s,y:r,width:o,height:l}=n;this.#t.showDialog(null,this,s+e*o,r+i*l,{...t,parentDimensions:n})}render(){if(this.#m)return;const t=this.#m=document.createElement("div");if(t.className="popup",this.#s){const i=t.style.outlineColor=tt.makeHexColor(...this.#s);t.style.backgroundColor=`color-mix(in srgb, ${i} 30%, white)`}const e=document.createElement("span");if(e.className="header",this.#S?.str){const i=document.createElement("span");i.className="title",e.append(i),{dir:i.dir,str:i.textContent}=this.#S}if(t.append(e),this.#h){const i=document.createElement("time");i.className="popupDate",i.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),i.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#h.valueOf()})),i.dateTime=this.#h.toISOString(),e.append(i)}Bl({html:this.#I||this.#a.str,dir:this.#a?.dir,className:"popupContent"},t),this.#r.append(t)}get#I(){const t=this.#C,e=this.#a;return t?.str&&(!e?.str||e.str===t.str)&&this.#C.html||null}get#R(){return this.#I?.attributes?.style?.fontSize||0}get#B(){return this.#I?.attributes?.style?.color||null}#F(t){const e=[],i={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},n={style:{color:this.#B,fontSize:this.#R?`calc(${this.#R}px * var(--total-scale-factor))`:""}};for(const s of t.split(`
`))e.push({name:"span",value:s,attributes:n});return i}#G(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#f)&&this.#A()}updateEdited({rect:t,popup:e,deleted:i}){if(this.#t){i?(this.remove(),this.#x=null):e&&(e.deleted?this.remove():(this.#N(),this.#x=e.text)),t&&(this.#y=null,this.#P(),this.#k());return}if(i||e?.deleted){this.remove();return}this.#D(),this.#v||={contentsObj:this.#a,richText:this.#C},t&&(this.#c=null),e&&e.text&&(this.#C=this.#F(e.text),this.#h=ro.toDateObject(e.date),this.#a=null),this.#m?.remove(),this.#m=null}resetEdited(){this.#v&&({contentsObj:this.#a,richText:this.#C}=this.#v,this.#v=null,this.#m?.remove(),this.#m=null,this.#c=null)}remove(){if(this.#p?.abort(),this.#p=null,this.#m?.remove(),this.#m=null,this.#T=!1,this.#f=!1,this.#g?.remove(),this.#g=null,this.trigger)for(const t of this.trigger)t.classList.remove("popupTriggerArea")}#_(){if(this.#c!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:i,pageX:n,pageY:s}}}=this.#u;let r=!!this.#d,o=r?this.#d:this.#b;for(const v of this.#l)if(!o||tt.intersect(v.data.rect,o)!==null){o=v.data.rect,r=!0;break}const l=tt.normalizeRect([o[0],t[3]-o[1]+t[1],o[2],t[3]-o[3]+t[1]]),c=r?o[2]-o[0]+5:0,u=l[0]+c,p=l[1];this.#c=[100*(u-n)/e,100*(p-s)/i];const{style:y}=this.#r;y.left=`${this.#c[0]}%`,y.top=`${this.#c[1]}%`}#A(){if(this.#t){this.#t.toggleCommentPopup(this,!1);return}this.#f=!this.#f,this.#f?(this.#M(),this.#r.addEventListener("click",this.#o),this.#r.addEventListener("keydown",this.#e)):(this.#U(),this.#r.removeEventListener("click",this.#o),this.#r.removeEventListener("keydown",this.#e))}#M(){this.#m||this.render(),this.isVisible?this.#f&&this.#r.classList.add("focused"):(this.#_(),this.#r.hidden=!1,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)+1e3)}#U(){this.#r.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#r.hidden=!0,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)-1e3)}forceHide(){this.#T=this.isVisible,this.#T&&(this.#r.hidden=!0)}maybeShow(){this.#t||(this.#D(),this.#T&&(this.#m||this.#M(),this.#T=!1,this.#r.hidden=!1))}get isVisible(){return this.#t?!1:this.#r.hidden===!1}}class rh extends Vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=ft.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const i=document.createElement("span");i.textContent=e,t.append(i)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class Su extends Vt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:i}=this,n=this.svgFactory.create(e,i,!0),s=this.#t=this.svgFactory.createElement("svg:line");return s.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),s.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),s.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),s.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),s.setAttribute("stroke-width",t.borderStyle.width||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),n.append(s),this.container.append(n),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class xu extends Vt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:i}=this,n=this.svgFactory.create(e,i,!0),s=t.borderStyle.width,r=this.#t=this.svgFactory.createElement("svg:rect");return r.setAttribute("x",s/2),r.setAttribute("y",s/2),r.setAttribute("width",e-s),r.setAttribute("height",i-s),r.setAttribute("stroke-width",s||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),n.append(r),this.container.append(n),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Cu extends Vt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:i}=this,n=this.svgFactory.create(e,i,!0),s=t.borderStyle.width,r=this.#t=this.svgFactory.createElement("svg:ellipse");return r.setAttribute("cx",e/2),r.setAttribute("cy",i/2),r.setAttribute("rx",e/2-s/2),r.setAttribute("ry",i/2-s/2),r.setAttribute("stroke-width",s||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),n.append(r),this.container.append(n),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class oh extends Vt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:i,popupRef:n},width:s,height:r}=this;if(!e)return this.container;const o=this.svgFactory.create(s,r,!0);let l=[];for(let c=0,u=e.length;c<u;c+=2){const p=e[c]-t[0],y=t[3]-e[c+1];l.push(`${p},${y}`)}l=l.join(" ");const d=this.#t=this.svgFactory.createElement(this.svgElementName);return d.setAttribute("points",l),d.setAttribute("stroke-width",i.width||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),o.append(d),this.container.append(o),!n&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class _u extends oh{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Tu extends Vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class No extends Vt{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?ft.HIGHLIGHT:ft.INK}#n(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:i,borderStyle:n,popupRef:s}}=this,{transform:r,width:o,height:l}=this.#n(e,t),d=this.svgFactory.create(o,l,!0),c=this.#t=this.svgFactory.createElement("svg:g");d.append(c),c.setAttribute("stroke-width",n.width||1),c.setAttribute("stroke-linecap","round"),c.setAttribute("stroke-linejoin","round"),c.setAttribute("stroke-miterlimit",10),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),c.setAttribute("transform",r);for(let u=0,p=i.length;u<p;u++){const y=this.svgFactory.createElement(this.svgElementName);this.#e.push(y),y.setAttribute("points",i[u].join(",")),c.append(y)}return!s&&this.hasPopupData&&this._createPopup(),this.container.append(d),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:i,rect:n}=t,s=this.#t;if(e>=0&&s.setAttribute("stroke-width",e||1),i)for(let r=0,o=this.#e.length;r<o;r++)this.#e[r].setAttribute("points",i[r].join(","));if(n){const{transform:r,width:o,height:l}=this.#n(this.data.rotation,n);s.parentElement.setAttribute("viewBox",`0 0 ${o} ${l}`),s.setAttribute("transform",r)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class ah extends Vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=ft.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const i=document.createElement("mark");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class Pu extends Vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),t){const i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class ku extends Vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),t){const i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class Du extends Vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),t){const i=document.createElement("s");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class lh extends Vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=ft.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class Lu extends Vt{#t=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let i;e.hasAppearance||e.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),i.addEventListener("dblclick",this.#e.bind(this)),this.#t=i;const{isMac:n}=ve.platform;return t.addEventListener("keydown",s=>{s.key==="Enter"&&(n?s.metaKey:s.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class Bo{#t=null;#e=null;#n=null;#i=new Map;#o=null;#s=null;constructor({div:t,accessibilityManager:e,annotationCanvasMap:i,annotationEditorUIManager:n,page:s,viewport:r,structTreeLayer:o,commentManager:l,linkService:d,annotationStorage:c}){this.div=t,this.#t=e,this.#e=i,this.#o=o||null,this.#s=d||null,this.#n=c||new Lo,this.page=s,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=n,this._commentManager=l||null}hasEditableAnnotations(){return this.#i.size>0}async#r(t,e,i){const n=t.firstChild||t,s=n.id=`${_o}${e}`,r=await this.#o?.getAriaAttributes(s);if(r)for(const[o,l]of r)n.setAttribute(o,l);i?i.at(-1).container.after(t):(this.div.append(t),this.#t?.moveElementInDOM(this.div,t,n,!1))}async render(t){const{annotations:e}=t,i=this.div;sn(i,this.viewport);const n=new Map,s={data:null,layer:i,linkService:this.#s,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new er,annotationStorage:this.#n,enableComment:t.enableComment===!0,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const r of e){if(r.noHTML)continue;const o=r.annotationType===re.POPUP;if(o){const c=n.get(r.id);if(!c)continue;s.elements=c}else if(r.rect[2]===r.rect[0]||r.rect[3]===r.rect[1])continue;s.data=r;const l=za.create(s);if(!l.isRenderable)continue;if(!o&&r.popupRef){const c=n.get(r.popupRef);c?c.push(l):n.set(r.popupRef,[l])}const d=l.render();r.hidden&&(d.style.visibility="hidden"),await this.#r(d,r.id,s.elements),l.extraPopupElement?.popup?.renderCommentButton(),l._isEditable&&(this.#i.set(l.data.id,l),this._annotationEditorUIManager?.renderAnnotationElement(l))}this.#a()}async addLinkAnnotations(t){const e={data:null,layer:this.div,linkService:this.#s,svgFactory:new er,parent:this};for(const i of t){i.borderStyle||=Bo._defaultBorderStyle,e.data=i;const n=za.create(e);if(!n.isRenderable)continue;const s=n.render();await this.#r(s,i.id,null)}}update({viewport:t}){const e=this.div;this.viewport=t,sn(e,{rotation:t.rotation}),this.#a(),e.hidden=!1}#a(){if(!this.#e)return;const t=this.div;for(const[e,i]of this.#e){const n=t.querySelector(`[data-annotation-id="${e}"]`);if(!n)continue;i.className="annotationContent";const{firstChild:s}=n;s?s.nodeName==="CANVAS"?s.replaceWith(i):s.classList.contains("annotationContent")?s.after(i):s.before(i):n.append(i);const r=this.#i.get(e);r&&(r._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(e,n.id,i),r._hasNoCanvas=!1):r.canvas=i)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#i.values())}getEditableAnnotation(t){return this.#i.get(t)}addFakeAnnotation(t){const{div:e}=this,{id:i,rotation:n}=t,s=new gu({data:{id:i,rect:t.getPDFRect(),rotation:n},editor:t,layer:e,parent:this,enableComment:!!this._commentManager,linkService:this.#s,annotationStorage:this.#n}),r=s.render();return e.append(r),this.#t?.moveElementInDOM(e,r,r,!1),s.createOrUpdatePopup(),s}static get _defaultBorderStyle(){return yt(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:wn.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const Os=/\r\n?|\n/g;class de extends nt{#t="";#e=`${this.id}-editor`;#n=null;#i;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=de.prototype,e=s=>s.isEmpty(),i=Gi.TRANSLATE_SMALL,n=Gi.TRANSLATE_BIG;return yt(this,"_keyboardManager",new bs([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-n,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[n,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-n],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,n],checker:e}]]))}static _type="freetext";static _editorType=ft.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.color=t.color||de._defaultColor||nt._defaultLineColor,this.#i=t.fontSize||de._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static initialize(t,e){nt.initialize(t,e);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case St.FREETEXT_SIZE:de._defaultFontSize=e;break;case St.FREETEXT_COLOR:de._defaultColor=e;break}}updateParams(t,e){switch(t){case St.FREETEXT_SIZE:this.#o(e);break;case St.FREETEXT_COLOR:this.#s(e);break}}static get defaultPropertiesToUpdate(){return[[St.FREETEXT_SIZE,de._defaultFontSize],[St.FREETEXT_COLOR,de._defaultColor||nt._defaultLineColor]]}get propertiesToUpdate(){return[[St.FREETEXT_SIZE,this.#i],[St.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new cs(this),[["colorPicker",this._colorPicker]]}get colorType(){return St.FREETEXT_COLOR}#o(t){const e=n=>{this.editorDiv.style.fontSize=`calc(${n}px * var(--total-scale-factor))`,this.translate(0,-(n-this.#i)*this.parentScale),this.#i=n,this.#a()},i=this.#i;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:St.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#s(t){const e=n=>{this.color=n,this.onUpdatedColor()},i=this.color;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:St.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-de._internalPadding*t,-(de._internalPadding+this.#i)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#n=new AbortController;const t=this._uiManager.combinedSignal(this.#n);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#e),this._isDraggable=!0,this.#n?.abort(),this.#n=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#r(){const t=[];this.editorDiv.normalize();let e=null;for(const i of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&i.nodeName==="BR"||(t.push(de.#h(i)),e=i);return t.join(`
`)}#a(){const[t,e]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:n,div:s}=this,r=s.style.display,o=s.classList.contains("hidden");s.classList.remove("hidden"),s.style.display="hidden",n.div.append(this.div),i=s.getBoundingClientRect(),s.remove(),s.style.display=r,s.classList.toggle("hidden",o)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/e):(this.width=i.height/t,this.height=i.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#t,e=this.#t=this.#r().trimEnd();if(t===e)return;const i=n=>{if(this.#t=n,!n){this.remove();return}this.#l(),this._uiManager.rebuild(this),this.#a()};this.addCommands({cmd:()=>{i(e)},undo:()=>{i(t)},mustExec:!1}),this.#a()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){de._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#e),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${this.#i}px * var(--total-scale-factor))`,i.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[n,s]=this.parentDimensions;if(this.annotationElementId){const{position:r}=this._initialData;let[o,l]=this.getInitialTranslation();[o,l]=this.pageTranslationToScreen(o,l);const[d,c]=this.pageDimensions,[u,p]=this.pageTranslation;let y,v;switch(this.rotation){case 0:y=t+(r[0]-u)/d,v=e+this.height-(r[1]-p)/c;break;case 90:y=t+(r[0]-u)/d,v=e-(r[1]-p)/c,[o,l]=[l,-o];break;case 180:y=t-this.width+(r[0]-u)/d,v=e-(r[1]-p)/c,[o,l]=[-o,-l];break;case 270:y=t+(r[0]-u-this.height*c)/d,v=e+(r[1]-p-this.width*d)/c,[o,l]=[-l,o];break}this.setAt(y*n,v*s,o,l)}else this._moveAfterPaste(t,e);this.#l(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#h(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Os,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:i}=e;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();const n=de.#d(e.getData("text")||"").replaceAll(Os,`
`);if(!n)return;const s=window.getSelection();if(!s.rangeCount)return;this.editorDiv.normalize(),s.deleteFromDocument();const r=s.getRangeAt(0);if(!n.includes(`
`)){r.insertNode(document.createTextNode(n)),this.editorDiv.normalize(),s.collapseToStart();return}const{startContainer:o,startOffset:l}=r,d=[],c=[];if(o.nodeType===Node.TEXT_NODE){const y=o.parentElement;if(c.push(o.nodeValue.slice(l).replaceAll(Os,"")),y!==this.editorDiv){let v=d;for(const w of this.editorDiv.childNodes){if(w===y){v=c;continue}v.push(de.#h(w))}}d.push(o.nodeValue.slice(0,l).replaceAll(Os,""))}else if(o===this.editorDiv){let y=d,v=0;for(const w of this.editorDiv.childNodes)v++===l&&(y=c),y.push(de.#h(w))}this.#t=`${d.join(`
`)}${n}${c.join(`
`)}`,this.#l();const u=new Range;let p=Math.sumPrecise(d.map(y=>y.length));for(const{firstChild:y}of this.editorDiv.childNodes)if(y.nodeType===Node.TEXT_NODE){const v=y.nodeValue.length;if(p<=v){u.setStart(y,p),u.setEnd(y,p);break}p-=v}s.removeAllRanges(),s.addRange(u)}#l(){if(this.editorDiv.replaceChildren(),!!this.#t)for(const t of this.#t.split(`
`)){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#u(){return this.#t.replaceAll(""," ")}static#d(t){return t.replaceAll(" ","")}get contentDiv(){return this.editorDiv}getPDFRect(){const t=de._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,e,i){let n=null;if(t instanceof rh){const{data:{defaultAppearanceData:{fontSize:r,fontColor:o},rect:l,rotation:d,id:c,popupRef:u,richText:p,contentsObj:y,creationDate:v,modificationDate:w},textContent:x,textPosition:S,parent:{page:{pageNumber:P}}}=t;if(!x||x.length===0)return null;n=t={annotationType:ft.FREETEXT,color:Array.from(o),fontSize:r,value:x.join(`
`),position:S,pageIndex:P-1,rect:l.slice(0),rotation:d,annotationElementId:c,id:c,deleted:!1,popupRef:u,comment:y?.str||null,richText:p,creationDate:v,modificationDate:w}}const s=await super.deserialize(t,e,i);return s.#i=t.fontSize,s.color=tt.makeHexColor(...t.color),s.#t=de.#d(t.value),s._initialData=n,t.comment&&s.setCommentData(t),s}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=nt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),i=Object.assign(super.serialize(t),{color:e,fontSize:this.#i,value:this.#u()});return this.addComment(i),t?(i.isCopy=!0,i):this.annotationElementId&&!this.#f(i)?null:(i.id=this.annotationElementId,i)}#f(t){const{value:e,fontSize:i,color:n,pageIndex:s}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==e||t.fontSize!==i||t.color.some((r,o)=>r!==n[o])||t.pageIndex!==s}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(!e)return null;const{style:i}=e;i.fontSize=`calc(${this.#i}px * var(--total-scale-factor))`,i.color=this.color,e.replaceChildren();for(const n of this.#t.split(`
`)){const s=document.createElement("div");s.append(n?document.createTextNode(n):document.createElement("br")),e.append(s)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#t}}),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class Z{static PRECISION=1e-4;toSVGPath(){It("Abstract method `toSVGPath` must be implemented.")}get box(){It("Abstract getter `box` must be implemented.")}serialize(t,e){It("Abstract method `serialize` must be implemented.")}static _rescale(t,e,i,n,s,r){r||=new Float32Array(t.length);for(let o=0,l=t.length;o<l;o+=2)r[o]=e+t[o]*n,r[o+1]=i+t[o+1]*s;return r}static _rescaleAndSwap(t,e,i,n,s,r){r||=new Float32Array(t.length);for(let o=0,l=t.length;o<l;o+=2)r[o]=e+t[o+1]*n,r[o+1]=i+t[o]*s;return r}static _translate(t,e,i,n){n||=new Float32Array(t.length);for(let s=0,r=t.length;s<r;s+=2)n[s]=e+t[s],n[s+1]=i+t[s+1];return n}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,i,n,s){switch(s){case 90:return[1-e/i,t/n];case 180:return[1-t/i,1-e/n];case 270:return[e/i,1-t/n];default:return[t/i,e/n]}}static _normalizePagePoint(t,e,i){switch(i){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,i,n,s,r){return[(t+5*i)/6,(e+5*n)/6,(5*i+s)/6,(5*n+r)/6,(i+s)/2,(n+r)/2]}}class Zi{#t;#e=[];#n;#i;#o=[];#s=new Float32Array(18);#r;#a;#h;#l;#u;#d;#f=[];static#m=8;static#p=2;static#c=Zi.#m+Zi.#p;constructor({x:t,y:e},i,n,s,r,o=0){this.#t=i,this.#d=s*n,this.#i=r,this.#s.set([NaN,NaN,NaN,NaN,t,e],6),this.#n=o,this.#l=Zi.#m*n,this.#h=Zi.#c*n,this.#u=n,this.#f.push(t,e)}isEmpty(){return isNaN(this.#s[8])}#g(){const t=this.#s.subarray(4,6),e=this.#s.subarray(16,18),[i,n,s,r]=this.#t;return[(this.#r+(t[0]-e[0])/2-i)/s,(this.#a+(t[1]-e[1])/2-n)/r,(this.#r+(e[0]-t[0])/2-i)/s,(this.#a+(e[1]-t[1])/2-n)/r]}add({x:t,y:e}){this.#r=t,this.#a=e;const[i,n,s,r]=this.#t;let[o,l,d,c]=this.#s.subarray(8,12);const u=t-d,p=e-c,y=Math.hypot(u,p);if(y<this.#h)return!1;const v=y-this.#l,w=v/y,x=w*u,S=w*p;let P=o,k=l;o=d,l=c,d+=x,c+=S,this.#f?.push(t,e);const D=-S/v,M=x/v,R=D*this.#d,N=M*this.#d;return this.#s.set(this.#s.subarray(2,8),0),this.#s.set([d+R,c+N],4),this.#s.set(this.#s.subarray(14,18),12),this.#s.set([d-R,c-N],16),isNaN(this.#s[6])?(this.#o.length===0&&(this.#s.set([o+R,l+N],2),this.#o.push(NaN,NaN,NaN,NaN,(o+R-i)/s,(l+N-n)/r),this.#s.set([o-R,l-N],14),this.#e.push(NaN,NaN,NaN,NaN,(o-R-i)/s,(l-N-n)/r)),this.#s.set([P,k,o,l,d,c],6),!this.isEmpty()):(this.#s.set([P,k,o,l,d,c],6),Math.abs(Math.atan2(k-l,P-o)-Math.atan2(S,x))<Math.PI/2?([o,l,d,c]=this.#s.subarray(2,6),this.#o.push(NaN,NaN,NaN,NaN,((o+d)/2-i)/s,((l+c)/2-n)/r),[o,l,P,k]=this.#s.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((P+o)/2-i)/s,((k+l)/2-n)/r),!0):([P,k,o,l,d,c]=this.#s.subarray(0,6),this.#o.push(((P+5*o)/6-i)/s,((k+5*l)/6-n)/r,((5*o+d)/6-i)/s,((5*l+c)/6-n)/r,((o+d)/2-i)/s,((l+c)/2-n)/r),[d,c,o,l,P,k]=this.#s.subarray(12,18),this.#e.push(((P+5*o)/6-i)/s,((k+5*l)/6-n)/r,((5*o+d)/6-i)/s,((5*l+c)/6-n)/r,((o+d)/2-i)/s,((l+c)/2-n)/r),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#o,e=this.#e;if(isNaN(this.#s[6])&&!this.isEmpty())return this.#y();const i=[];i.push(`M${t[4]} ${t[5]}`);for(let n=6;n<t.length;n+=6)isNaN(t[n])?i.push(`L${t[n+4]} ${t[n+5]}`):i.push(`C${t[n]} ${t[n+1]} ${t[n+2]} ${t[n+3]} ${t[n+4]} ${t[n+5]}`);this.#b(i);for(let n=e.length-6;n>=6;n-=6)isNaN(e[n])?i.push(`L${e[n+4]} ${e[n+5]}`):i.push(`C${e[n]} ${e[n+1]} ${e[n+2]} ${e[n+3]} ${e[n+4]} ${e[n+5]}`);return this.#w(i),i.join(" ")}#y(){const[t,e,i,n]=this.#t,[s,r,o,l]=this.#g();return`M${(this.#s[2]-t)/i} ${(this.#s[3]-e)/n} L${(this.#s[4]-t)/i} ${(this.#s[5]-e)/n} L${s} ${r} L${o} ${l} L${(this.#s[16]-t)/i} ${(this.#s[17]-e)/n} L${(this.#s[14]-t)/i} ${(this.#s[15]-e)/n} Z`}#w(t){const e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#b(t){const[e,i,n,s]=this.#t,r=this.#s.subarray(4,6),o=this.#s.subarray(16,18),[l,d,c,u]=this.#g();t.push(`L${(r[0]-e)/n} ${(r[1]-i)/s} L${l} ${d} L${c} ${u} L${(o[0]-e)/n} ${(o[1]-i)/s}`)}newFreeDrawOutline(t,e,i,n,s,r){return new hh(t,e,i,n,s,r)}getOutlines(){const t=this.#o,e=this.#e,i=this.#s,[n,s,r,o]=this.#t,l=new Float32Array((this.#f?.length??0)+2);for(let u=0,p=l.length-2;u<p;u+=2)l[u]=(this.#f[u]-n)/r,l[u+1]=(this.#f[u+1]-s)/o;if(l[l.length-2]=(this.#r-n)/r,l[l.length-1]=(this.#a-s)/o,isNaN(i[6])&&!this.isEmpty())return this.#C(l);const d=new Float32Array(this.#o.length+24+this.#e.length);let c=t.length;for(let u=0;u<c;u+=2){if(isNaN(t[u])){d[u]=d[u+1]=NaN;continue}d[u]=t[u],d[u+1]=t[u+1]}c=this.#v(d,c);for(let u=e.length-6;u>=6;u-=6)for(let p=0;p<6;p+=2){if(isNaN(e[u+p])){d[c]=d[c+1]=NaN,c+=2;continue}d[c]=e[u+p],d[c+1]=e[u+p+1],c+=2}return this.#S(d,c),this.newFreeDrawOutline(d,l,this.#t,this.#u,this.#n,this.#i)}#C(t){const e=this.#s,[i,n,s,r]=this.#t,[o,l,d,c]=this.#g(),u=new Float32Array(36);return u.set([NaN,NaN,NaN,NaN,(e[2]-i)/s,(e[3]-n)/r,NaN,NaN,NaN,NaN,(e[4]-i)/s,(e[5]-n)/r,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,d,c,NaN,NaN,NaN,NaN,(e[16]-i)/s,(e[17]-n)/r,NaN,NaN,NaN,NaN,(e[14]-i)/s,(e[15]-n)/r],0),this.newFreeDrawOutline(u,t,this.#t,this.#u,this.#n,this.#i)}#S(t,e){const i=this.#e;return t.set([NaN,NaN,NaN,NaN,i[4],i[5]],e),e+=6}#v(t,e){const i=this.#s.subarray(4,6),n=this.#s.subarray(16,18),[s,r,o,l]=this.#t,[d,c,u,p]=this.#g();return t.set([NaN,NaN,NaN,NaN,(i[0]-s)/o,(i[1]-r)/l,NaN,NaN,NaN,NaN,d,c,NaN,NaN,NaN,NaN,u,p,NaN,NaN,NaN,NaN,(n[0]-s)/o,(n[1]-r)/l],e),e+=24}}class hh extends Z{#t;#e=new Float32Array(4);#n;#i;#o;#s;#r;constructor(t,e,i,n,s,r){super(),this.#r=t,this.#o=e,this.#t=i,this.#s=n,this.#n=s,this.#i=r,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#a(r);const[o,l,d,c]=this.#e;for(let u=0,p=t.length;u<p;u+=2)t[u]=(t[u]-o)/d,t[u+1]=(t[u+1]-l)/c;for(let u=0,p=e.length;u<p;u+=2)e[u]=(e[u]-o)/d,e[u+1]=(e[u+1]-l)/c}toSVGPath(){const t=[`M${this.#r[4]} ${this.#r[5]}`];for(let e=6,i=this.#r.length;e<i;e+=6){if(isNaN(this.#r[e])){t.push(`L${this.#r[e+4]} ${this.#r[e+5]}`);continue}t.push(`C${this.#r[e]} ${this.#r[e+1]} ${this.#r[e+2]} ${this.#r[e+3]} ${this.#r[e+4]} ${this.#r[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,i,n],s){const r=i-t,o=n-e;let l,d;switch(s){case 0:l=Z._rescale(this.#r,t,n,r,-o),d=Z._rescale(this.#o,t,n,r,-o);break;case 90:l=Z._rescaleAndSwap(this.#r,t,e,r,o),d=Z._rescaleAndSwap(this.#o,t,e,r,o);break;case 180:l=Z._rescale(this.#r,i,e,-r,o),d=Z._rescale(this.#o,i,e,-r,o);break;case 270:l=Z._rescaleAndSwap(this.#r,i,n,-r,-o),d=Z._rescaleAndSwap(this.#o,i,n,-r,-o);break}return{outline:Array.from(l),points:[Array.from(d)]}}#a(t){const e=this.#r;let i=e[4],n=e[5];const s=[i,n,i,n];let r=i,o=n,l=i,d=n;const c=t?Math.max:Math.min,u=new Float32Array(4);for(let y=6,v=e.length;y<v;y+=6){const w=e[y+4],x=e[y+5];isNaN(e[y])?(tt.pointBoundingBox(w,x,s),o>x?(r=w,o=x):o===x&&(r=c(r,w)),d<x?(l=w,d=x):d===x&&(l=c(l,w))):(u[0]=u[1]=1/0,u[2]=u[3]=-1/0,tt.bezierBoundingBox(i,n,...e.slice(y,y+6),u),tt.rectBoundingBox(u[0],u[1],u[2],u[3],s),o>u[1]?(r=u[0],o=u[1]):o===u[1]&&(r=c(r,u[0])),d<u[3]?(l=u[2],d=u[3]):d===u[3]&&(l=c(l,u[2]))),i=w,n=x}const p=this.#e;p[0]=s[0]-this.#n,p[1]=s[1]-this.#n,p[2]=s[2]-s[0]+2*this.#n,p[3]=s[3]-s[1]+2*this.#n,this.firstPoint=[r,o],this.lastPoint=[l,d]}get box(){return this.#e}newOutliner(t,e,i,n,s,r=0){return new Zi(t,e,i,n,s,r)}getNewOutline(t,e){const[i,n,s,r]=this.#e,[o,l,d,c]=this.#t,u=s*d,p=r*c,y=i*d+o,v=n*c+l,w=this.newOutliner({x:this.#o[0]*u+y,y:this.#o[1]*p+v},this.#t,this.#s,t,this.#i,e??this.#n);for(let x=2;x<this.#o.length;x+=2)w.add({x:this.#o[x]*u+y,y:this.#o[x+1]*p+v});return w.getOutlines()}}class po{#t;#e;#n;#i=[];#o=[];constructor(t,e=0,i=0,n=!0){const s=[1/0,1/0,-1/0,-1/0],r=10**-4;for(const{x:w,y:x,width:S,height:P}of t){const k=Math.floor((w-e)/r)*r,D=Math.ceil((w+S+e)/r)*r,M=Math.floor((x-e)/r)*r,R=Math.ceil((x+P+e)/r)*r,N=[k,M,R,!0],F=[D,M,R,!1];this.#i.push(N,F),tt.rectBoundingBox(k,M,D,R,s)}const o=s[2]-s[0]+2*i,l=s[3]-s[1]+2*i,d=s[0]-i,c=s[1]-i;let u=n?-1/0:1/0,p=1/0;const y=this.#i.at(n?-1:-2),v=[y[0],y[2]];for(const w of this.#i){const[x,S,P,k]=w;!k&&n?S<p?(p=S,u=x):S===p&&(u=Math.max(u,x)):k&&!n&&(S<p?(p=S,u=x):S===p&&(u=Math.min(u,x))),w[0]=(x-d)/o,w[1]=(S-c)/l,w[2]=(P-c)/l}this.#t=new Float32Array([d,c,o,l]),this.#e=[u,p],this.#n=v}getOutlines(){this.#i.sort((e,i)=>e[0]-i[0]||e[1]-i[1]||e[2]-i[2]);const t=[];for(const e of this.#i)e[3]?(t.push(...this.#l(e)),this.#a(e)):(this.#h(e),t.push(...this.#l(e)));return this.#s(t)}#s(t){const e=[],i=new Set;for(const r of t){const[o,l,d]=r;e.push([o,l,r],[o,d,r])}e.sort((r,o)=>r[1]-o[1]||r[0]-o[0]);for(let r=0,o=e.length;r<o;r+=2){const l=e[r][2],d=e[r+1][2];l.push(d),d.push(l),i.add(l),i.add(d)}const n=[];let s;for(;i.size>0;){const r=i.values().next().value;let[o,l,d,c,u]=r;i.delete(r);let p=o,y=l;for(s=[o,d],n.push(s);;){let v;if(i.has(c))v=c;else if(i.has(u))v=u;else break;i.delete(v),[o,l,d,c,u]=v,p!==o&&(s.push(p,y,o,y===l?l:d),p=o),y=y===l?d:l}s.push(p,y)}return new Iu(n,this.#t,this.#e,this.#n)}#r(t){const e=this.#o;let i=0,n=e.length-1;for(;i<=n;){const s=i+n>>1,r=e[s][0];if(r===t)return s;r<t?i=s+1:n=s-1}return n+1}#a([,t,e]){const i=this.#r(t);this.#o.splice(i,0,[t,e])}#h([,t,e]){const i=this.#r(t);for(let n=i;n<this.#o.length;n++){const[s,r]=this.#o[n];if(s!==t)break;if(s===t&&r===e){this.#o.splice(n,1);return}}for(let n=i-1;n>=0;n--){const[s,r]=this.#o[n];if(s!==t)break;if(s===t&&r===e){this.#o.splice(n,1);return}}}#l(t){const[e,i,n]=t,s=[[e,i,n]],r=this.#r(n);for(let o=0;o<r;o++){const[l,d]=this.#o[o];for(let c=0,u=s.length;c<u;c++){const[,p,y]=s[c];if(!(d<=p||y<=l)){if(p>=l){if(y>d)s[c][1]=d;else{if(u===1)return[];s.splice(c,1),c--,u--}continue}s[c][2]=l,y>d&&s.push([e,d,y])}}}return s}}class Iu extends Z{#t;#e;constructor(t,e,i,n){super(),this.#e=t,this.#t=e,this.firstPoint=i,this.lastPoint=n}toSVGPath(){const t=[];for(const e of this.#e){let[i,n]=e;t.push(`M${i} ${n}`);for(let s=2;s<e.length;s+=2){const r=e[s],o=e[s+1];r===i?(t.push(`V${o}`),n=o):o===n&&(t.push(`H${r}`),i=r)}t.push("Z")}return t.join(" ")}serialize([t,e,i,n],s){const r=[],o=i-t,l=n-e;for(const d of this.#e){const c=new Array(d.length);for(let u=0;u<d.length;u+=2)c[u]=t+d[u]*o,c[u+1]=n-d[u+1]*l;r.push(c)}return r}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}}class go extends Zi{newFreeDrawOutline(t,e,i,n,s,r){return new Mu(t,e,i,n,s,r)}}class Mu extends hh{newOutliner(t,e,i,n,s,r=0){return new go(t,e,i,n,s,r)}}class te extends nt{#t=null;#e=0;#n;#i=null;#o=null;#s=null;#r=null;#a=0;#h=null;#l=null;#u=null;#d=!1;#f=null;#m=null;#p=null;#c="";#g;#y="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=ft.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=te.prototype;return yt(this,"_keyboardManager",new bs([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||te._defaultColor,this.#g=t.thickness||te._defaultThickness,this.opacity=t.opacity||te._defaultOpacity,this.#n=t.boxes||null,this.#y=t.methodOfCreation||"",this.#c=t.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(this.#d=!0,this.#b(t),this.#E()):this.#n&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#r=t.focusNode,this.#a=t.focusOffset,this.#w(),this.#E(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#d?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#g,methodOfCreation:this.#y}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#w(){const t=new po(this.#n,.001);this.#l=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;const e=new po(this.#n,.0025,.001,this._uiManager.direction==="ltr");this.#s=e.getOutlines();const{firstPoint:i}=this.#l;this.#f=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height];const{lastPoint:n}=this.#s;this.#m=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height]}#b({highlightOutlines:t,highlightId:e,clipPathId:i}){this.#l=t;const n=1.5;if(this.#s=t.getNewOutline(this.#g/2+n,.0025),e>=0)this.#u=e,this.#i=i,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#p=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},!0);else if(this.parent){const u=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#u,{bbox:te.#x(this.#l.box,(u-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#p,{bbox:te.#x(this.#s.box,u),path:{d:this.#s.toSVGPath()}})}const[s,r,o,l]=t.box;switch(this.rotation){case 0:this.x=s,this.y=r,this.width=o,this.height=l;break;case 90:{const[u,p]=this.parentDimensions;this.x=r,this.y=1-s,this.width=o*p/u,this.height=l*u/p;break}case 180:this.x=1-s,this.y=1-r,this.width=o,this.height=l;break;case 270:{const[u,p]=this.parentDimensions;this.x=1-r,this.y=s,this.width=o*p/u,this.height=l*u/p;break}}const{firstPoint:d}=t;this.#f=[(d[0]-s)/o,(d[1]-r)/l];const{lastPoint:c}=this.#s;this.#m=[(c[0]-s)/o,(c[1]-r)/l]}static initialize(t,e){nt.initialize(t,e),te._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case St.HIGHLIGHT_COLOR:te._defaultColor=e;break;case St.HIGHLIGHT_THICKNESS:te._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#m}get commentButtonPosition(){return this.#f}updateParams(t,e){switch(t){case St.HIGHLIGHT_COLOR:this.#C(e);break;case St.HIGHLIGHT_THICKNESS:this.#S(e);break}}static get defaultPropertiesToUpdate(){return[[St.HIGHLIGHT_COLOR,te._defaultColor],[St.HIGHLIGHT_THICKNESS,te._defaultThickness]]}get propertiesToUpdate(){return[[St.HIGHLIGHT_COLOR,this.color||te._defaultColor],[St.HIGHLIGHT_THICKNESS,this.#g||te._defaultThickness],[St.HIGHLIGHT_FREE,this.#d]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#u,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#o?.updateColor(this.color),super.onUpdatedColor()}#C(t){const e=(s,r)=>{this.color=s,this.opacity=r,this.onUpdatedColor()},i=this.color,n=this.opacity;this.addCommands({cmd:e.bind(this,t,te._defaultOpacity),undo:e.bind(this,i,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:St.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)}#S(t){const e=this.#g,i=n=>{this.#g=n,this.#v(n)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:St.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#o=new ti({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#k())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#k())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#T(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#E(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#T():t&&(this.#E(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#v(t){this.#d&&(this.#b({highlightOutlines:this.#l.getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims(this.width,this.height))}#T(){this.#u===null||!this.parent||(this.parent.drawLayer.remove(this.#u),this.#u=null,this.parent.drawLayer.remove(this.#p),this.#p=null)}#E(t=this.parent){this.#u===null&&({id:this.#u,clipPathId:this.#i}=t.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#d},path:{d:this.#l.toSVGPath()}},!1,!0),this.#p=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#d},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},this.#d),this.#h&&(this.#h.style.clipPath=this.#i))}static#x([t,e,i,n],s){switch(s){case 90:return[1-e-n,t,n,i];case 180:return[1-t-i,1-e-n,i,n];case 270:return[e,1-t-i,n,i]}return[t,e,i,n]}rotate(t){const{drawLayer:e}=this.parent;let i;this.#d?(t=(t-this.rotation+360)%360,i=te.#x(this.#l.box,t)):i=te.#x([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#u,{bbox:i,root:{"data-main-rotation":t}}),e.updateProperties(this.#p,{bbox:te.#x(this.#s.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#c&&(t.setAttribute("aria-label",this.#c),t.setAttribute("role","mark")),this.#d?t.classList.add("free"):this.div.addEventListener("keydown",this.#D.bind(this),{signal:this._uiManager._signal});const e=this.#h=document.createElement("div");return t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#i,this.setDims(this.width,this.height),Ul(this,this.#h,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1}})}#D(t){te._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#P(!0);break;case 1:case 3:this.#P(!1);break}}#P(t){if(!this.#t)return;const e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#r,this.#a)}select(){super.select(),this.#p&&this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#p&&(this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{selected:!1}}),this.#d||this.#P(!1))}get _mustFixPosition(){return!this.#d}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#u,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#p,{rootClass:{hidden:!t}}))}#k(){return this.#d?this.rotation:0}#N(){if(this.#d)return null;const[t,e]=this.pageDimensions,[i,n]=this.pageTranslation,s=this.#n,r=new Float32Array(s.length*8);let o=0;for(const{x:l,y:d,width:c,height:u}of s){const p=l*t+i,y=(1-d)*e+n;r[o]=r[o+4]=p,r[o+1]=r[o+3]=y,r[o+2]=r[o+6]=p+c*t,r[o+5]=r[o+7]=y-u*e,o+=8}return r}#I(t){return this.#l.serialize(t,this.#k())}static startHighlighting(t,e,{target:i,x:n,y:s}){const{x:r,y:o,width:l,height:d}=i.getBoundingClientRect(),c=new AbortController,u=t.combinedSignal(c),p=y=>{c.abort(),this.#B(t,y)};window.addEventListener("blur",p,{signal:u}),window.addEventListener("pointerup",p,{signal:u}),window.addEventListener("pointerdown",Qt,{capture:!0,passive:!1,signal:u}),window.addEventListener("contextmenu",ii,{signal:u}),i.addEventListener("pointermove",this.#R.bind(this,t),{signal:u}),this._freeHighlight=new go({x:n,y:s},[r,o,l,d],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#R(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#B(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,i){let n=null;if(t instanceof ah){const{data:{quadPoints:v,rect:w,rotation:x,id:S,color:P,opacity:k,popupRef:D,richText:M,contentsObj:R,creationDate:N,modificationDate:F},parent:{page:{pageNumber:O}}}=t;n=t={annotationType:ft.HIGHLIGHT,color:Array.from(P),opacity:k,quadPoints:v,boxes:null,pageIndex:O-1,rect:w.slice(0),rotation:x,annotationElementId:S,id:S,deleted:!1,popupRef:D,richText:M,comment:R?.str||null,creationDate:N,modificationDate:F}}else if(t instanceof No){const{data:{inkLists:v,rect:w,rotation:x,id:S,color:P,borderStyle:{rawWidth:k},popupRef:D,richText:M,contentsObj:R,creationDate:N,modificationDate:F},parent:{page:{pageNumber:O}}}=t;n=t={annotationType:ft.HIGHLIGHT,color:Array.from(P),thickness:k,inkLists:v,boxes:null,pageIndex:O-1,rect:w.slice(0),rotation:x,annotationElementId:S,id:S,deleted:!1,popupRef:D,richText:M,comment:R?.str||null,creationDate:N,modificationDate:F}}const{color:s,quadPoints:r,inkLists:o,opacity:l}=t,d=await super.deserialize(t,e,i);d.color=tt.makeHexColor(...s),d.opacity=l||1,o&&(d.#g=t.thickness),d._initialData=n,t.comment&&d.setCommentData(t);const[c,u]=d.pageDimensions,[p,y]=d.pageTranslation;if(r){const v=d.#n=[];for(let w=0;w<r.length;w+=8)v.push({x:(r[w]-p)/c,y:1-(r[w+1]-y)/u,width:(r[w+2]-r[w])/c,height:(r[w+1]-r[w+5])/u});d.#w(),d.#E(),d.rotate(d.rotation)}else if(o){d.#d=!0;const v=o[0],w={x:v[0]-p,y:u-(v[1]-y)},x=new go(w,[0,0,c,u],1,d.#g/2,!0,.001);for(let k=0,D=v.length;k<D;k+=2)w.x=v[k]-p,w.y=u-(v[k+1]-y),x.add(w);const{id:S,clipPathId:P}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:d.color,"fill-opacity":d._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:x.toSVGPath()}},!0,!0);d.#b({highlightOutlines:x.getOutlines(),highlightId:S,clipPathId:P}),d.#E(),d.rotate(d.parentRotation)}return d}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=nt._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),i=super.serialize(t);return Object.assign(i,{color:e,opacity:this.opacity,thickness:this.#g,quadPoints:this.#N(),outlines:this.#I(i.rect)}),this.addComment(i),this.annotationElementId&&!this.#F(i)?null:(i.id=this.annotationElementId,i)}#F(t){const{color:e}=this._initialData;return this.hasEditedComment||t.color.some((i,n)=>i!==e[n])}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class ch{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,i]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,i)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){const t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){It("Not implemented")}}class rt extends nt{#t=null;#e;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#n=null;static#i=null;static#o=null;static#s=NaN;static#r=null;static#a=null;static#h=NaN;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,this._addOutlines(t)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(this.#l(t),this.#f())}#l({drawOutlines:t,drawId:e,drawingOptions:i}){this.#t=t,this._drawingOptions||=i,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),e>=0?(this._drawId=e,this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)):this._drawId=this.#u(t,this.parent),this.#c(t.box)}#u(t,e){const{id:i}=e.drawLayer.draw(rt._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i}static _mergeSVGProperties(t,e){const i=new Set(Object.keys(t));for(const[n,s]of Object.entries(e))i.has(n)?Object.assign(t[n],s):t[n]=s;return t}static getDefaultDrawingOptions(t){It("Not implemented")}static get typesMap(){It("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,e),this._currentParent&&(rt.#n.updateProperty(i,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[i,n]of this.typesMap)t.push([i,e[n]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[i,n]of this.constructor.typesMap)t.push([i,e[n]]);return t}_updateProperty(t,e,i){const n=this._drawingOptions,s=n[e],r=o=>{n.updateProperty(e,o);const l=this.#t.updateProperty(e,o);l&&this.#c(l),this.parent?.drawLayer.updateProperties(this._drawId,n.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:r.bind(this,i),undo:r.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,rt._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#p()),{bbox:this.#g()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,rt._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#p()),{bbox:this.#g()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#g()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,rt._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#p(),this.parentDimensions),{bbox:this.#g()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#d(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#f(),this.#c(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#d()):t&&(this._uiManager.addShouldRescale(this),this.#f(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#d(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#f(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#u(this.#t,t)}}#m([t,e,i,n]){const{parentDimensions:[s,r],rotation:o}=this;switch(o){case 90:return[e,1-t,i*(r/s),n*(s/r)];case 180:return[1-t,1-e,i,n];case 270:return[1-e,t,i*(r/s),n*(s/r)];default:return[t,e,i,n]}}#p(){const{x:t,y:e,width:i,height:n,parentDimensions:[s,r],rotation:o}=this;switch(o){case 90:return[1-e,t,i*(s/r),n*(r/s)];case 180:return[1-t,1-e,i,n];case 270:return[e,1-t,i*(s/r),n*(r/s)];default:return[t,e,i,n]}}#c(t){[this.x,this.y,this.width,this.height]=this.#m(t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#g(){const{x:t,y:e,width:i,height:n,rotation:s,parentRotation:r,parentDimensions:[o,l]}=this;switch((s*4+r)/90){case 1:return[1-e-n,t,n,i];case 2:return[1-t-i,1-e-n,i,n];case 3:return[e,1-t-i,n,i];case 4:return[t,e-i*(o/l),n*(l/o),i*(o/l)];case 5:return[1-e,t,i*(o/l),n*(l/o)];case 6:return[1-t-n*(l/o),1-e,n*(l/o),i*(o/l)];case 7:return[e-i*(o/l),1-t-n*(l/o),i*(o/l),n*(l/o)];case 8:return[t-i,e-n,i,n];case 9:return[1-e,t-i,n,i];case 10:return[1-t,1-e,i,n];case 11:return[e-n,1-t,n,i];case 12:return[t-n*(l/o),e,n*(l/o),i*(o/l)];case 13:return[1-e-i*(o/l),t-n*(l/o),i*(o/l),n*(l/o)];case 14:return[1-t,1-e-i*(o/l),n*(l/o),i*(o/l)];case 15:return[e,1-t,i*(o/l),n*(l/o)];default:return[t,e,i,n]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,rt._mergeSVGProperties({bbox:this.#g()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#c(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const i=super.render();i.classList.add("draw");const n=document.createElement("div");return i.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),i}static createDrawerInstance(t,e,i,n,s){It("Not implemented")}static startDrawing(t,e,i,n){const{target:s,offsetX:r,offsetY:o,pointerId:l,pointerType:d}=n;if(rt.#r&&rt.#r!==d)return;const{viewport:{rotation:c}}=t,{width:u,height:p}=s.getBoundingClientRect(),y=rt.#i=new AbortController,v=t.combinedSignal(y);if(rt.#s||=l,rt.#r??=d,window.addEventListener("pointerup",w=>{rt.#s===w.pointerId?this._endDraw(w):rt.#a?.delete(w.pointerId)},{signal:v}),window.addEventListener("pointercancel",w=>{rt.#s===w.pointerId?this._currentParent.endDrawingSession():rt.#a?.delete(w.pointerId)},{signal:v}),window.addEventListener("pointerdown",w=>{rt.#r===w.pointerType&&((rt.#a||=new Set).add(w.pointerId),rt.#n.isCancellable()&&(rt.#n.removeLastElement(),rt.#n.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:v}),window.addEventListener("contextmenu",ii,{signal:v}),s.addEventListener("pointermove",this._drawMove.bind(this),{signal:v}),s.addEventListener("touchmove",w=>{w.timeStamp===rt.#h&&Qt(w)},{signal:v}),t.toggleDrawing(),e._editorUndoBar?.hide(),rt.#n){t.drawLayer.updateProperties(this._currentDrawId,rt.#n.startNew(r,o,u,p,c));return}e.updateUIForDefaultProperties(this),rt.#n=this.createDrawerInstance(r,o,u,p,c),rt.#o=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(rt.#o.toSVGProperties(),rt.#n.defaultSVGProperties),!0,!1)}static _drawMove(t){if(rt.#h=-1,!rt.#n)return;const{offsetX:e,offsetY:i,pointerId:n}=t;if(rt.#s===n){if(rt.#a?.size>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,rt.#n.add(e,i)),rt.#h=t.timeStamp,Qt(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,rt.#n=null,rt.#o=null,rt.#r=null,rt.#h=NaN),rt.#i&&(rt.#i.abort(),rt.#i=null,rt.#s=NaN,rt.#a=null)}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t?.target===e.div&&e.drawLayer.updateProperties(this._currentDrawId,rt.#n.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const i=rt.#n,n=this._currentDrawId,s=i.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(n,i.setLastElement(s))},undo:()=>{e.drawLayer.updateProperties(n,i.removeLastElement())},mustExec:!1,type:St.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(St.DRAW_STEP),!rt.#n.isEmpty()){const{pageDimensions:[i,n],scale:s}=e,r=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:rt.#n.getOutlines(i*s,n*s,s,this._INNER_MARGIN),drawingOptions:rt.#o,mustBeCommitted:!t});return this._cleanup(!0),r}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,i,n,s,r){It("Not implemented")}static async deserialize(t,e,i){const{rawDims:{pageWidth:n,pageHeight:s,pageX:r,pageY:o}}=e.viewport,l=this.deserializeDraw(r,o,n,s,this._INNER_MARGIN,t),d=await super.deserialize(t,e,i);return d.createDrawingOptions(t),d.#l({drawOutlines:l}),d.#f(),d.onScaleChanging(),d.rotate(),d}serializeDraw(t){const[e,i]=this.pageTranslation,[n,s]=this.pageDimensions;return this.#t.serialize([e,i,n,s],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class Ru{#t=new Float64Array(6);#e;#n;#i;#o;#s;#r="";#a=0;#h=new vs;#l;#u;constructor(t,e,i,n,s,r){this.#l=i,this.#u=n,this.#i=s,this.#o=r,[t,e]=this.#d(t,e);const o=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#s=[t,e],this.#n=[{line:o,points:this.#s}],this.#t.set(o,0)}updateProperty(t,e){t==="stroke-width"&&(this.#o=e)}#d(t,e){return Z._normalizePoint(t,e,this.#l,this.#u,this.#i)}isEmpty(){return!this.#n||this.#n.length===0}isCancellable(){return this.#s.length<=10}add(t,e){[t,e]=this.#d(t,e);const[i,n,s,r]=this.#t.subarray(2,6),o=t-s,l=e-r;return Math.hypot(this.#l*o,this.#u*l)<=2?null:(this.#s.push(t,e),isNaN(i)?(this.#t.set([s,r,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([i,n,s,r,t,e],0),this.#e.push(...Z.createBezierPoints(i,n,s,r,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const i=this.add(t,e);return i||(this.#s.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,i,n,s){this.#l=i,this.#u=n,this.#i=s,[t,e]=this.#d(t,e);const r=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#s=[t,e];const o=this.#n.at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),this.#n.push({line:r,points:this.#s}),this.#t.set(r,0),this.#a=0,this.toSVGPath(),null}getLastElement(){return this.#n.at(-1)}setLastElement(t){return this.#n?(this.#n.push(t),this.#e=t.line,this.#s=t.points,this.#a=0,{path:{d:this.toSVGPath()}}):this.#h.setLastElement(t)}removeLastElement(){if(!this.#n)return this.#h.removeLastElement();this.#n.pop(),this.#r="";for(let t=0,e=this.#n.length;t<e;t++){const{line:i,points:n}=this.#n[t];this.#e=i,this.#s=n,this.#a=0,this.toSVGPath()}return{path:{d:this.#r}}}toSVGPath(){const t=Z.svgRound(this.#e[4]),e=Z.svgRound(this.#e[5]);if(this.#s.length===2)return this.#r=`${this.#r} M ${t} ${e} Z`,this.#r;if(this.#s.length<=6){const n=this.#r.lastIndexOf("M");this.#r=`${this.#r.slice(0,n)} M ${t} ${e}`,this.#a=6}if(this.#s.length===4){const n=Z.svgRound(this.#e[10]),s=Z.svgRound(this.#e[11]);return this.#r=`${this.#r} L ${n} ${s}`,this.#a=12,this.#r}const i=[];this.#a===0&&(i.push(`M ${t} ${e}`),this.#a=6);for(let n=this.#a,s=this.#e.length;n<s;n+=6){const[r,o,l,d,c,u]=this.#e.slice(n,n+6).map(Z.svgRound);i.push(`C${r} ${o} ${l} ${d} ${c} ${u}`)}return this.#r+=i.join(" "),this.#a=this.#e.length,this.#r}getOutlines(t,e,i,n){const s=this.#n.at(-1);return s.line=new Float32Array(s.line),s.points=new Float32Array(s.points),this.#h.build(this.#n,t,e,i,this.#i,this.#o,n),this.#t=null,this.#e=null,this.#n=null,this.#r=null,this.#h}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class vs extends Z{#t;#e=0;#n;#i;#o;#s;#r;#a;#h;build(t,e,i,n,s,r,o){this.#o=e,this.#s=i,this.#r=n,this.#a=s,this.#h=r,this.#n=o??0,this.#i=t,this.#d()}get thickness(){return this.#h}setLastElement(t){return this.#i.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#i.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#i){if(t.push(`M${Z.svgRound(e[4])} ${Z.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12&&isNaN(e[6])){t.push(`L${Z.svgRound(e[10])} ${Z.svgRound(e[11])}`);continue}for(let i=6,n=e.length;i<n;i+=6){const[s,r,o,l,d,c]=e.subarray(i,i+6).map(Z.svgRound);t.push(`C${s} ${r} ${o} ${l} ${d} ${c}`)}}return t.join("")}serialize([t,e,i,n],s){const r=[],o=[],[l,d,c,u]=this.#u();let p,y,v,w,x,S,P,k,D;switch(this.#a){case 0:D=Z._rescale,p=t,y=e+n,v=i,w=-n,x=t+l*i,S=e+(1-d-u)*n,P=t+(l+c)*i,k=e+(1-d)*n;break;case 90:D=Z._rescaleAndSwap,p=t,y=e,v=i,w=n,x=t+d*i,S=e+l*n,P=t+(d+u)*i,k=e+(l+c)*n;break;case 180:D=Z._rescale,p=t+i,y=e,v=-i,w=n,x=t+(1-l-c)*i,S=e+d*n,P=t+(1-l)*i,k=e+(d+u)*n;break;case 270:D=Z._rescaleAndSwap,p=t+i,y=e+n,v=-i,w=-n,x=t+(1-d-u)*i,S=e+(1-l-c)*n,P=t+(1-d)*i,k=e+(1-l)*n;break}for(const{line:M,points:R}of this.#i)r.push(D(M,p,y,v,w,s?new Array(M.length):null)),o.push(D(R,p,y,v,w,s?new Array(R.length):null));return{lines:r,points:o,rect:[x,S,P,k]}}static deserialize(t,e,i,n,s,{paths:{lines:r,points:o},rotation:l,thickness:d}){const c=[];let u,p,y,v,w;switch(l){case 0:w=Z._rescale,u=-t/i,p=e/n+1,y=1/i,v=-1/n;break;case 90:w=Z._rescaleAndSwap,u=-e/n,p=-t/i,y=1/n,v=1/i;break;case 180:w=Z._rescale,u=t/i+1,p=-e/n,y=-1/i,v=1/n;break;case 270:w=Z._rescaleAndSwap,u=e/n+1,p=t/i+1,y=-1/n,v=-1/i;break}if(!r){r=[];for(const S of o){const P=S.length;if(P===2){r.push(new Float32Array([NaN,NaN,NaN,NaN,S[0],S[1]]));continue}if(P===4){r.push(new Float32Array([NaN,NaN,NaN,NaN,S[0],S[1],NaN,NaN,NaN,NaN,S[2],S[3]]));continue}const k=new Float32Array(3*(P-2));r.push(k);let[D,M,R,N]=S.subarray(0,4);k.set([NaN,NaN,NaN,NaN,D,M],0);for(let F=4;F<P;F+=2){const O=S[F],H=S[F+1];k.set(Z.createBezierPoints(D,M,R,N,O,H),(F-2)*3),[D,M,R,N]=[R,N,O,H]}}}for(let S=0,P=r.length;S<P;S++)c.push({line:w(r[S].map(k=>k??NaN),u,p,y,v),points:w(o[S].map(k=>k??NaN),u,p,y,v)});const x=new this.prototype.constructor;return x.build(c,i,n,1,l,d,s),x}#l(t=this.#h){const e=this.#n+t/2*this.#r;return this.#a%180===0?[e/this.#o,e/this.#s]:[e/this.#s,e/this.#o]}#u(){const[t,e,i,n]=this.#t,[s,r]=this.#l(0);return[t+s,e+r,i-2*s,n-2*r]}#d(){const t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:n}of this.#i){if(n.length<=12){for(let o=4,l=n.length;o<l;o+=6)tt.pointBoundingBox(n[o],n[o+1],t);continue}let s=n[4],r=n[5];for(let o=6,l=n.length;o<l;o+=6){const[d,c,u,p,y,v]=n.subarray(o,o+6);tt.bezierBoundingBox(s,r,d,c,u,p,y,v,t),s=y,r=v}}const[e,i]=this.#l();t[0]=Ie(t[0]-e,0,1),t[1]=Ie(t[1]-i,0,1),t[2]=Ie(t[2]+e,0,1),t[3]=Ie(t[3]+i,0,1),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#f(e):null}#f(t){const[e,i]=this.#l();this.#h=t;const[n,s]=this.#l(),[r,o]=[n-e,s-i],l=this.#t;return l[0]-=r,l[1]-=o,l[2]+=2*r,l[3]+=2*o,l}updateParentDimensions([t,e],i){const[n,s]=this.#l();this.#o=t,this.#s=e,this.#r=i;const[r,o]=this.#l(),l=r-n,d=o-s,c=this.#t;return c[0]-=l,c[1]-=d,c[2]+=2*l,c[3]+=2*d,c}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(Z.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Z.svgRound(t)} ${Z.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#t;let i=0,n=0,s=0,r=0,o=0,l=0;switch(this.#e){case 90:n=e/t,s=-t/e,o=t;break;case 180:i=-1,r=-1,o=t,l=e;break;case 270:n=-e/t,s=t/e,l=e;break;default:return""}return`matrix(${i} ${n} ${s} ${r} ${Z.svgRound(o)} ${Z.svgRound(l)})`}getPathResizingSVGProperties([t,e,i,n]){const[s,r]=this.#l(),[o,l,d,c]=this.#t;if(Math.abs(d-s)<=Z.PRECISION||Math.abs(c-r)<=Z.PRECISION){const w=t+i/2-(o+d/2),x=e+n/2-(l+c/2);return{path:{"transform-origin":`${Z.svgRound(t)} ${Z.svgRound(e)}`,transform:`${this.rotationTransform} translate(${w} ${x})`}}}const u=(i-2*s)/(d-2*s),p=(n-2*r)/(c-2*r),y=d/i,v=c/n;return{path:{"transform-origin":`${Z.svgRound(o)} ${Z.svgRound(l)}`,transform:`${this.rotationTransform} scale(${y} ${v}) translate(${Z.svgRound(s)} ${Z.svgRound(r)}) scale(${u} ${p}) translate(${Z.svgRound(-s)} ${Z.svgRound(-r)})`}}}getPathResizedSVGProperties([t,e,i,n]){const[s,r]=this.#l(),o=this.#t,[l,d,c,u]=o;if(o[0]=t,o[1]=e,o[2]=i,o[3]=n,Math.abs(c-s)<=Z.PRECISION||Math.abs(u-r)<=Z.PRECISION){const x=t+i/2-(l+c/2),S=e+n/2-(d+u/2);for(const{line:P,points:k}of this.#i)Z._translate(P,x,S,P),Z._translate(k,x,S,k);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Z.svgRound(t)} ${Z.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(i-2*s)/(c-2*s),y=(n-2*r)/(u-2*r),v=-p*(l+s)+t+s,w=-y*(d+r)+e+r;if(p!==1||y!==1||v!==0||w!==0)for(const{line:x,points:S}of this.#i)Z._rescale(x,v,w,p,y,x),Z._rescale(S,v,w,p,y,S);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Z.svgRound(t)} ${Z.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],i){const[n,s]=i,r=this.#t,o=t-r[0],l=e-r[1];if(this.#o===n&&this.#s===s)for(const{line:d,points:c}of this.#i)Z._translate(d,o,l,d),Z._translate(c,o,l,c);else{const d=this.#o/n,c=this.#s/s;this.#o=n,this.#s=s;for(const{line:u,points:p}of this.#i)Z._rescale(u,o,l,d,c,u),Z._rescale(p,o,l,d,c,p);r[2]*=d,r[3]*=c}return r[0]=t,r[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${Z.svgRound(t)} ${Z.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${Z.svgRound(t[0])} ${Z.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class wr extends ch{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:nt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new wr(this._viewParameters);return t.updateAll(this),t}}class Uo extends rt{static _type="ink";static _editorType=ft.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){nt.initialize(t,e),this._defaultDrawingOptions=new wr(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return yt(this,"typesMap",new Map([[St.INK_THICKNESS,"stroke-width"],[St.INK_COLOR,"stroke"],[St.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,i,n,s){return new Ru(t,e,i,n,s,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,i,n,s,r){return vs.deserialize(t,e,i,n,s,r)}static async deserialize(t,e,i){let n=null;if(t instanceof No){const{data:{inkLists:r,rect:o,rotation:l,id:d,color:c,opacity:u,borderStyle:{rawWidth:p},popupRef:y,richText:v,contentsObj:w,creationDate:x,modificationDate:S},parent:{page:{pageNumber:P}}}=t;n=t={annotationType:ft.INK,color:Array.from(c),thickness:p,opacity:u,paths:{points:r},boxes:null,pageIndex:P-1,rect:o.slice(0),rotation:l,annotationElementId:d,id:d,deleted:!1,popupRef:y,richText:v,comment:w?.str||null,creationDate:x,modificationDate:S}}const s=await super.deserialize(t,e,i);return s._initialData=n,t.comment&&s.setCommentData(t),s}get toolbarButtons(){return this._colorPicker||=new cs(this),[["colorPicker",this._colorPicker]]}get colorType(){return St.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:i}=this;e.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:i}){this._drawingOptions=Uo.getDefaultDrawingOptions({stroke:tt.makeHexColor(...t),"stroke-width":e,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:i}=this.serializeDraw(t),{_drawingOptions:{stroke:n,"stroke-opacity":s,"stroke-width":r}}=this,o=Object.assign(super.serialize(t),{color:nt._colorManager.convert(n),opacity:s,thickness:r,paths:{lines:e,points:i}});return this.addComment(o),t?(o.isCopy=!0,o):this.annotationElementId&&!this.#t(o)?null:(o.id=this.annotationElementId,o)}#t(t){const{color:e,thickness:i,opacity:n,pageIndex:s}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((r,o)=>r!==e[o])||t.thickness!==i||t.opacity!==n||t.pageIndex!==s}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:e,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:e,popup:this.comment}),null}}class mo extends vs{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const Ns=8,Gn=3;class An{static#t={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#e(t,e,i,n){return i-=t,n-=e,i===0?n>0?0:4:i===1?n+6:2-n}static#n=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#i(t,e,i,n,s,r,o){const l=this.#e(i,n,s,r);for(let d=0;d<8;d++){const c=(-d+l-o+16)%8,u=this.#n[2*c],p=this.#n[2*c+1];if(t[(i+u)*e+(n+p)]!==0)return c}return-1}static#o(t,e,i,n,s,r,o){const l=this.#e(i,n,s,r);for(let d=0;d<8;d++){const c=(d+l+o+16)%8,u=this.#n[2*c],p=this.#n[2*c+1];if(t[(i+u)*e+(n+p)]!==0)return c}return-1}static#s(t,e,i,n){const s=t.length,r=new Int32Array(s);for(let c=0;c<s;c++)r[c]=t[c]<=n?1:0;for(let c=1;c<i-1;c++)r[c*e]=r[c*e+e-1]=0;for(let c=0;c<e;c++)r[c]=r[e*i-1-c]=0;let o=1,l;const d=[];for(let c=1;c<i-1;c++){l=1;for(let u=1;u<e-1;u++){const p=c*e+u,y=r[p];if(y===0)continue;let v=c,w=u;if(y===1&&r[p-1]===0)o+=1,w-=1;else if(y>=1&&r[p+1]===0)o+=1,w+=1,y>1&&(l=y);else{y!==1&&(l=Math.abs(y));continue}const x=[u,c],S=w===u+1,P={isHole:S,points:x,id:o,parent:0};d.push(P);let k;for(const U of d)if(U.id===l){k=U;break}k?k.isHole?P.parent=S?k.parent:l:P.parent=S?l:k.parent:P.parent=S?l:0;const D=this.#i(r,e,c,u,v,w,0);if(D===-1){r[p]=-o,r[p]!==1&&(l=Math.abs(r[p]));continue}let M=this.#n[2*D],R=this.#n[2*D+1];const N=c+M,F=u+R;v=N,w=F;let O=c,H=u;for(;;){const U=this.#o(r,e,O,H,v,w,1);M=this.#n[2*U],R=this.#n[2*U+1];const K=O+M,z=H+R;x.push(z,K);const G=O*e+H;if(r[G+1]===0?r[G]=-o:r[G]===1&&(r[G]=o),K===c&&z===u&&O===N&&H===F){r[p]!==1&&(l=Math.abs(r[p]));break}else v=O,w=H,O=K,H=z}}}return d}static#r(t,e,i,n){if(i-e<=4){for(let N=e;N<i-2;N+=2)n.push(t[N],t[N+1]);return}const s=t[e],r=t[e+1],o=t[i-4]-s,l=t[i-3]-r,d=Math.hypot(o,l),c=o/d,u=l/d,p=c*r-u*s,y=l/o,v=1/d,w=Math.atan(y),x=Math.cos(w),S=Math.sin(w),P=v*(Math.abs(x)+Math.abs(S)),k=v*(1-P+P**2),D=Math.max(Math.atan(Math.abs(S+x)*k),Math.atan(Math.abs(S-x)*k));let M=0,R=e;for(let N=e+2;N<i-2;N+=2){const F=Math.abs(p-c*t[N+1]+u*t[N]);F>M&&(R=N,M=F)}M>(d*D)**2?(this.#r(t,e,R+2,n),this.#r(t,R,i,n)):n.push(s,r)}static#a(t){const e=[],i=t.length;return this.#r(t,0,i,e),e.push(t[i-2],t[i-1]),e.length<=4?null:e}static#h(t,e,i,n,s,r){const o=new Float32Array(r**2),l=-2*n**2,d=r>>1;for(let w=0;w<r;w++){const x=(w-d)**2;for(let S=0;S<r;S++)o[w*r+S]=Math.exp((x+(S-d)**2)/l)}const c=new Float32Array(256),u=-2*s**2;for(let w=0;w<256;w++)c[w]=Math.exp(w**2/u);const p=t.length,y=new Uint8Array(p),v=new Uint32Array(256);for(let w=0;w<i;w++)for(let x=0;x<e;x++){const S=w*e+x,P=t[S];let k=0,D=0;for(let R=0;R<r;R++){const N=w+R-d;if(!(N<0||N>=i))for(let F=0;F<r;F++){const O=x+F-d;if(O<0||O>=e)continue;const H=t[N*e+O],U=o[R*r+F]*c[Math.abs(H-P)];k+=H*U,D+=U}}const M=y[S]=Math.round(k/D);v[M]++}return[y,v]}static#l(t){const e=new Uint32Array(256);for(const i of t)e[i]++;return e}static#u(t){const e=t.length,i=new Uint8ClampedArray(e>>2);let n=-1/0,s=1/0;for(let o=0,l=i.length;o<l;o++){const d=i[o]=t[o<<2];n=Math.max(n,d),s=Math.min(s,d)}const r=255/(n-s);for(let o=0,l=i.length;o<l;o++)i[o]=(i[o]-s)*r;return i}static#d(t){let e,i=-1/0,n=-1/0;const s=t.findIndex(l=>l!==0);let r=s,o=s;for(e=s;e<256;e++){const l=t[e];l>i&&(e-r>n&&(n=e-r,o=e-1),i=l,r=e)}for(e=o-1;e>=0&&!(t[e]>t[e+1]);e--);return e}static#f(t){const e=t,{width:i,height:n}=t,{maxDim:s}=this.#t;let r=i,o=n;if(i>s||n>s){let p=i,y=n,v=Math.log2(Math.max(i,n)/s);const w=Math.floor(v);v=v===w?w-1:w;for(let S=0;S<v;S++){r=Math.ceil(p/2),o=Math.ceil(y/2);const P=new OffscreenCanvas(r,o);P.getContext("2d").drawImage(t,0,0,p,y,0,0,r,o),p=r,y=o,t!==e&&t.close(),t=P.transferToImageBitmap()}const x=Math.min(s/r,s/o);r=Math.round(r*x),o=Math.round(o*x)}const d=new OffscreenCanvas(r,o).getContext("2d",{willReadFrequently:!0});d.fillStyle="white",d.fillRect(0,0,r,o),d.filter="grayscale(1)",d.drawImage(t,0,0,t.width,t.height,0,0,r,o);const c=d.getImageData(0,0,r,o).data;return[this.#u(c),r,o]}static extractContoursFromText(t,{fontFamily:e,fontStyle:i,fontWeight:n},s,r,o,l){let d=new OffscreenCanvas(1,1),c=d.getContext("2d",{alpha:!1});const u=200,p=c.font=`${i} ${n} ${u}px ${e}`,{actualBoundingBoxLeft:y,actualBoundingBoxRight:v,actualBoundingBoxAscent:w,actualBoundingBoxDescent:x,fontBoundingBoxAscent:S,fontBoundingBoxDescent:P,width:k}=c.measureText(t),D=1.5,M=Math.ceil(Math.max(Math.abs(y)+Math.abs(v)||0,k)*D),R=Math.ceil(Math.max(Math.abs(w)+Math.abs(x)||u,Math.abs(S)+Math.abs(P)||u)*D);d=new OffscreenCanvas(M,R),c=d.getContext("2d",{alpha:!0,willReadFrequently:!0}),c.font=p,c.filter="grayscale(1)",c.fillStyle="white",c.fillRect(0,0,M,R),c.fillStyle="black",c.fillText(t,M*(D-1)/2,R*(3-D)/2);const N=this.#u(c.getImageData(0,0,M,R).data),F=this.#l(N),O=this.#d(F),H=this.#s(N,M,R,O);return this.processDrawnLines({lines:{curves:H,width:M,height:R},pageWidth:s,pageHeight:r,rotation:o,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(t,e,i,n,s){const[r,o,l]=this.#f(t),[d,c]=this.#h(r,o,l,Math.hypot(o,l)*this.#t.sigmaSFactor,this.#t.sigmaR,this.#t.kernelSize),u=this.#d(c),p=this.#s(d,o,l,u);return this.processDrawnLines({lines:{curves:p,width:o,height:l},pageWidth:e,pageHeight:i,rotation:n,innerMargin:s,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:i,rotation:n,innerMargin:s,mustSmooth:r,areContours:o}){n%180!==0&&([e,i]=[i,e]);const{curves:l,width:d,height:c}=t,u=t.thickness??0,p=[],y=Math.min(e/d,i/c),v=y/e,w=y/i,x=[];for(const{points:P}of l){const k=r?this.#a(P):P;if(!k)continue;x.push(k);const D=k.length,M=new Float32Array(D),R=new Float32Array(3*(D===2?2:D-2));if(p.push({line:R,points:M}),D===2){M[0]=k[0]*v,M[1]=k[1]*w,R.set([NaN,NaN,NaN,NaN,M[0],M[1]],0);continue}let[N,F,O,H]=k;N*=v,F*=w,O*=v,H*=w,M.set([N,F,O,H],0),R.set([NaN,NaN,NaN,NaN,N,F],0);for(let U=4;U<D;U+=2){const K=M[U]=k[U]*v,z=M[U+1]=k[U+1]*w;R.set(Z.createBezierPoints(N,F,O,H,K,z),(U-2)*3),[N,F,O,H]=[O,H,K,z]}}if(p.length===0)return null;const S=o?new mo:new vs;return S.build(p,e,i,1,n,o?0:u,s),{outline:S,newCurves:x,areContours:o,thickness:u,width:d,height:c}}static async compressSignature({outlines:t,areContours:e,thickness:i,width:n,height:s}){let r=1/0,o=-1/0,l=0;for(const k of t){l+=k.length;for(let D=2,M=k.length;D<M;D++){const R=k[D]-k[D-2];r=Math.min(r,R),o=Math.max(o,R)}}let d;r>=-128&&o<=127?d=Int8Array:r>=-32768&&o<=32767?d=Int16Array:d=Int32Array;const c=t.length,u=Ns+Gn*c,p=new Uint32Array(u);let y=0;p[y++]=u*Uint32Array.BYTES_PER_ELEMENT+(l-2*c)*d.BYTES_PER_ELEMENT,p[y++]=0,p[y++]=n,p[y++]=s,p[y++]=e?0:1,p[y++]=Math.max(0,Math.floor(i??0)),p[y++]=c,p[y++]=d.BYTES_PER_ELEMENT;for(const k of t)p[y++]=k.length-2,p[y++]=k[0],p[y++]=k[1];const v=new CompressionStream("deflate-raw"),w=v.writable.getWriter();await w.ready,w.write(p);const x=d.prototype.constructor;for(const k of t){const D=new x(k.length-2);for(let M=2,R=k.length;M<R;M++)D[M-2]=k[M]-k[M-2];w.write(D)}w.close();const S=await new Response(v.readable).arrayBuffer(),P=new Uint8Array(S);return Ol(P)}static async decompressSignature(t){try{const e=Kc(t),{readable:i,writable:n}=new DecompressionStream("deflate-raw"),s=n.getWriter();await s.ready,s.write(e).then(async()=>{await s.ready,await s.close()}).catch(()=>{});let r=null,o=0;for await(const k of i)r||=new Uint8Array(new Uint32Array(k.buffer,0,4)[0]),r.set(k,o),o+=k.length;const l=new Uint32Array(r.buffer,0,r.length>>2),d=l[1];if(d!==0)throw new Error(`Invalid version: ${d}`);const c=l[2],u=l[3],p=l[4]===0,y=l[5],v=l[6],w=l[7],x=[],S=(Ns+Gn*v)*Uint32Array.BYTES_PER_ELEMENT;let P;switch(w){case Int8Array.BYTES_PER_ELEMENT:P=new Int8Array(r.buffer,S);break;case Int16Array.BYTES_PER_ELEMENT:P=new Int16Array(r.buffer,S);break;case Int32Array.BYTES_PER_ELEMENT:P=new Int32Array(r.buffer,S);break}o=0;for(let k=0;k<v;k++){const D=l[Gn*k+Ns],M=new Float32Array(D+2);x.push(M);for(let R=0;R<Gn-1;R++)M[R]=l[Gn*k+Ns+R+1];for(let R=0;R<D;R++)M[R+2]=M[R]+P[o++]}return{areContours:p,thickness:y,outlines:x,width:c,height:u}}catch(e){return ut(`decompressSignature: ${e}`),null}}}class $o extends ch{constructor(){super(),super.updateProperties({fill:nt._defaultLineColor,"stroke-width":0})}clone(){const t=new $o;return t.updateAll(this),t}}class Ho extends wr{constructor(t){super(t),super.updateProperties({stroke:nt._defaultLineColor,"stroke-width":1})}clone(){const t=new Ho(this._viewParameters);return t.updateAll(this),t}}class gi extends rt{#t=!1;#e=null;#n=null;#i=null;static _type="signature";static _editorType=ft.SIGNATURE;static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#n=t.signatureData||null,this.#e=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){nt.initialize(t,e),this._defaultDrawingOptions=new $o,this._defaultDrawnSignatureOptions=new Ho(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return yt(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#e}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),this._drawId===null)if(this.#n){const{lines:n,mustSmooth:s,areContours:r,description:o,uuid:l,heightInPage:d}=this.#n,{rawDims:{pageWidth:c,pageHeight:u},rotation:p}=this.parent.viewport,y=An.processDrawnLines({lines:n,pageWidth:c,pageHeight:u,rotation:p,innerMargin:gi._INNER_MARGIN,mustSmooth:s,areContours:r});this.addSignature(y,d,o,l)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#e||""}));return i&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){this.#i=t,this.addEditToolbar()}getUuid(){return this.#i}get description(){return this.#e}set description(t){this.#e=t,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(e=>{e?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:i,width:n,height:s}=this.#n,r=Math.max(n,s),o=An.processDrawnLines({lines:{curves:t.map(l=>({points:l})),thickness:i,width:n,height:s},pageWidth:r,pageHeight:r,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e});return{areContours:e,outline:o.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,e,i,n){const{x:s,y:r}=this,{outline:o}=this.#n=t;this.#t=o instanceof mo,this.description=i;let l;this.#t?l=gi.getDefaultDrawingOptions():(l=gi._defaultDrawnSignatureOptions.clone(),l.updateProperties({"stroke-width":o.thickness})),this._addOutlines({drawOutlines:o,drawingOptions:l});const[,d]=this.pageDimensions;let c=e/d;c=c>=1?.5:c,this.width*=c/this.height,this.width>=1&&(c*=.9/this.width,this.width=.9),this.height=c,this.setDims(),this.x=s,this.y=r,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(n),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!n,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:i},rotation:n}=this.parent.viewport;return An.process(t,e,i,n,gi._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:i,pageHeight:n},rotation:s}=this.parent.viewport;return An.extractContoursFromText(t,e,i,n,s,gi._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:i},rotation:n}=this.parent.viewport;return An.processDrawnLines({lines:t,pageWidth:e,pageHeight:i,rotation:n,innerMargin:gi._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:e}){t?this._drawingOptions=gi.getDefaultDrawingOptions():(this._drawingOptions=gi._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":e}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:e,points:i}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":n}}=this,s=Object.assign(super.serialize(t),{isSignature:!0,areContours:this.#t,color:[0,0,0],thickness:this.#t?0:n});return this.addComment(s),t?(s.paths={lines:e,points:i},s.uuid=this.#i,s.isCopy=!0):s.lines=e,this.#e&&(s.accessibilityData={type:"Figure",alt:this.#e}),s}static deserializeDraw(t,e,i,n,s,r){return r.areContours?mo.deserialize(t,e,i,n,s,r):vs.deserialize(t,e,i,n,s,r)}static async deserialize(t,e,i){const n=await super.deserialize(t,e,i);return n.#t=t.areContours,n.description=t.accessibilityData?.alt||"",n.#i=t.uuid,n}}class Fu extends nt{#t=null;#e=null;#n=null;#i=null;#o=null;#s="";#r=null;#a=!1;#h=null;#l=!1;#u=!1;static _type="stamp";static _editorType=ft.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#i=t.bitmapUrl,this.#o=t.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){nt.initialize(t,e)}static isHandlingMimeForPasting(t){return oo.includes(t)}static paste(t,e){e.pasteEditor({mode:ft.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#d(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#l=t.isSvg),t.file&&(this.#s=t.file.name),this.#p()}#f(){if(this.#n=null,this._uiManager.enableWaiting(!1),!!this.#r){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:n,width:s,height:r}=t||this.copyCanvas(null,null,!0).imageData,o=await i.guess({name:"altText",request:{data:n,width:s,height:r,channels:n.length/(s*r)}});if(!o)throw new Error("No response from the AI service.");if(o.error)throw new Error("Error from the AI service.");if(o.cancel)return null;if(!o.output)throw new Error("No valid response from the AI service.");const l=o.output;return await this.setGuessedAltText(l),e&&!this.hasAltTextData()&&(this.altTextData={alt:l,decorative:!1}),l}#m(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(i=>this.#d(i,!0)).finally(()=>this.#f());return}if(this.#i){const i=this.#i;this.#i=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromUrl(i).then(n=>this.#d(n)).finally(()=>this.#f());return}if(this.#o){const i=this.#o;this.#o=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromFile(i).then(n=>this.#d(n)).finally(()=>this.#f());return}const t=document.createElement("input");t.type="file",t.accept=oo.join(",");const e=this._uiManager._signal;this.#n=new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const n=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#d(n)}i()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:e})}).finally(()=>this.#f()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#r?.remove(),this.#r=null,this.#h&&(clearTimeout(this.#h),this.#h=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#m();return}super.rebuild(),this.div!==null&&(this.#e&&this.#r===null&&this.#m(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#n||this.#t||this.#i||this.#o||this.#e||this.#a)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#a||(this.#t?this.#p():this.#m()),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:i,bitmap:n}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(this.#e=i,n&&(this.#t=n),this.#a=!1,this.#p())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#h!==null&&clearTimeout(this.#h);const t=200;this.#h=setTimeout(()=>{this.#h=null,this.#g()},t)}#p(){const{div:t}=this;let{width:e,height:i}=this.#t;const[n,s]=this.pageDimensions,r=.75;if(this.width)e=this.width*n,i=this.height*s;else if(e>r*n||i>r*s){const l=Math.min(r*n/e,r*s/i);e*=l,i*=l}this._uiManager.enableWaiting(!1);const o=this.#r=document.createElement("canvas");o.setAttribute("role","img"),this.addContainer(o),this.width=e/n,this.height=i/s,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#g(),this.#u||(this.parent.addUndoableEditor(this),this.#u=!0),this._reportTelemetry({action:"inserted_image"}),this.#s&&this.div.setAttribute("aria-description",this.#s),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(t,e,i=!1){t||(t=224);const{width:n,height:s}=this.#t,r=new Ei;let o=this.#t,l=n,d=s,c=null;if(e){if(n>e||s>e){const R=Math.min(e/n,e/s);l=Math.floor(n*R),d=Math.floor(s*R)}c=document.createElement("canvas");const p=c.width=Math.ceil(l*r.sx),y=c.height=Math.ceil(d*r.sy);this.#l||(o=this.#c(p,y));const v=c.getContext("2d");v.filter=this._uiManager.hcmFilter;let w="white",x="#cfcfd8";this._uiManager.hcmFilter!=="none"?x="black":id.isDarkMode&&(w="#8f8f9d",x="#42414d");const S=15,P=S*r.sx,k=S*r.sy,D=new OffscreenCanvas(P*2,k*2),M=D.getContext("2d");M.fillStyle=w,M.fillRect(0,0,P*2,k*2),M.fillStyle=x,M.fillRect(0,0,P,k),M.fillRect(P,k,P,k),v.fillStyle=v.createPattern(D,"repeat"),v.fillRect(0,0,p,y),v.drawImage(o,0,0,o.width,o.height,0,0,p,y)}let u=null;if(i){let p,y;if(r.symmetric&&o.width<t&&o.height<t)p=o.width,y=o.height;else if(o=this.#t,n>t||s>t){const x=Math.min(t/n,t/s);p=Math.floor(n*x),y=Math.floor(s*x),this.#l||(o=this.#c(p,y))}const w=new OffscreenCanvas(p,y).getContext("2d",{willReadFrequently:!0});w.drawImage(o,0,0,o.width,o.height,0,0,p,y),u={width:p,height:y,data:w.getImageData(0,0,p,y).data}}return{canvas:c,width:l,height:d,imageData:u}}#c(t,e){const{width:i,height:n}=this.#t;let s=i,r=n,o=this.#t;for(;s>2*t||r>2*e;){const l=s,d=r;s>2*t&&(s=s>=16384?Math.floor(s/2)-1:Math.ceil(s/2)),r>2*e&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2));const c=new OffscreenCanvas(s,r);c.getContext("2d").drawImage(o,0,0,l,d,0,0,s,r),o=c.transferToImageBitmap()}return o}#g(){const[t,e]=this.parentDimensions,{width:i,height:n}=this,s=new Ei,r=Math.ceil(i*t*s.sx),o=Math.ceil(n*e*s.sy),l=this.#r;if(!l||l.width===r&&l.height===o)return;l.width=r,l.height=o;const d=this.#l?this.#t:this.#c(r,o),c=l.getContext("2d");c.filter=this._uiManager.hcmFilter,c.drawImage(d,0,0,d.width,d.height,0,0,r,o)}#y(t){if(t){if(this.#l){const n=this._uiManager.imageManager.getSvgUrl(this.#e);if(n)return n}const e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#l){const[e,i]=this.pageDimensions,n=Math.round(this.width*e*Mn.PDF_TO_CSS_UNITS),s=Math.round(this.height*i*Mn.PDF_TO_CSS_UNITS),r=new OffscreenCanvas(n,s);return r.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,n,s),r.transferToImageBitmap()}return structuredClone(this.#t)}static async deserialize(t,e,i){let n=null,s=!1;if(t instanceof lh){const{data:{rect:w,rotation:x,id:S,structParent:P,popupRef:k,richText:D,contentsObj:M,creationDate:R,modificationDate:N},container:F,parent:{page:{pageNumber:O}},canvas:H}=t;let U,K;H?(delete t.canvas,{id:U,bitmap:K}=i.imageManager.getFromCanvas(F.id,H),H.remove()):(s=!0,t._hasNoCanvas=!0);const z=(await e._structTree.getAriaAttributes(`${_o}${S}`))?.get("aria-label")||"";n=t={annotationType:ft.STAMP,bitmapId:U,bitmap:K,pageIndex:O-1,rect:w.slice(0),rotation:x,annotationElementId:S,id:S,deleted:!1,accessibilityData:{decorative:!1,altText:z},isSvg:!1,structParent:P,popupRef:k,richText:D,comment:M?.str||null,creationDate:R,modificationDate:N}}const r=await super.deserialize(t,e,i),{rect:o,bitmap:l,bitmapUrl:d,bitmapId:c,isSvg:u,accessibilityData:p}=t;s?(i.addMissingCanvas(t.id,r),r.#a=!0):c&&i.imageManager.isValidId(c)?(r.#e=c,l&&(r.#t=l)):r.#i=d,r.#l=u;const[y,v]=r.pageDimensions;return r.width=(o[2]-o[0])/y,r.height=(o[3]-o[1])/v,p&&(r.altTextData=p),r._initialData=n,t.comment&&r.setCommentData(t),r.#u=!!n,r}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=Object.assign(super.serialize(t),{bitmapId:this.#e,isSvg:this.#l});if(this.addComment(i),t)return i.bitmapUrl=this.#y(!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:n,altText:s}=this.serializeAltText(!1);if(!n&&s&&(i.accessibilityData={type:"Figure",alt:s}),this.annotationElementId){const o=this.#w(i);return o.isSame?null:(o.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1,i.id=this.annotationElementId,delete i.bitmapId,i)}if(e===null)return i;e.stamps||=new Map;const r=this.#l?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:r,serialized:i}),i.bitmap=this.#y(!1);else if(this.#l){const o=e.stamps.get(this.#e);r>o.area&&(o.area=r,o.serialized.bitmap.close(),o.serialized.bitmap=this.#y(!1))}return i}#w(t){const{pageIndex:e,accessibilityData:{altText:i}}=this._initialData,n=t.pageIndex===e,s=(t.accessibilityData?.alt||"")===i;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&n&&s,isSameAltText:s}}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class Ti{#t;#e=!1;#n=null;#i=null;#o=null;#s=new Map;#r=!1;#a=!1;#h=!1;#l=null;#u=null;#d=null;#f=null;#m=null;#p=-1;#c;static _initialized=!1;static#g=new Map([de,Uo,Fu,te,gi].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:i,structTreeLayer:n,accessibilityManager:s,annotationLayer:r,drawLayer:o,textLayer:l,viewport:d,l10n:c}){const u=[...Ti.#g.values()];if(!Ti._initialized){Ti._initialized=!0;for(const p of u)p.initialize(c,t)}t.registerEditorTypes(u),this.#c=t,this.pageIndex=e,this.div=i,this.#t=s,this.#n=r,this.viewport=d,this.#d=l,this.drawLayer=o,this._structTree=n,this.#c.addLayer(this)}get isEmpty(){return this.#s.size===0}get isInvisible(){return this.isEmpty&&this.#c.getMode()===ft.NONE}updateToolbar(t){this.#c.updateToolbar(t)}updateMode(t=this.#c.getMode()){switch(this.#v(),t){case ft.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case ft.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case ft.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;if(e.toggle("nonEditing",!1),t===ft.POPUP)e.toggle("commentEditing",!0);else{e.toggle("commentEditing",!1);for(const i of Ti.#g.values())e.toggle(`${i._type}Editing`,t===i._editorType)}this.div.hidden=!1}hasTextLayer(t){return t===this.#d?.div}setEditingState(t){this.#c.setEditingState(t)}addCommands(t){this.#c.addCommands(t)}cleanUndoStack(t){this.#c.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#n?.div.classList.toggle("disabled",!t)}get#y(){return this.#s.size!==0?this.#s.values():this.#c.getEditors(this.pageIndex)}async enable(){this.#h=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#m?.abort(),this.#m=null;const t=new Set;for(const i of this.#y)i.enableEditing(),i.show(!0),i.annotationElementId&&(this.#c.removeChangedExistingAnnotation(i),t.add(i.annotationElementId));const e=this.#n;if(e)for(const i of e.getEditableAnnotations()){if(i.hide(),this.#c.isDeletedAnnotationElement(i.data.id)||t.has(i.data.id))continue;const n=await this.deserialize(i);n&&(this.addOrRebuild(n),n.enableEditing())}this.#h=!1,this.#c._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#a=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#d&&!this.#m){this.#m=new AbortController;const i=this.#c.combinedSignal(this.#m);this.#d.div.addEventListener("pointerdown",n=>{const{clientX:r,clientY:o,timeStamp:l}=n,d=this.#p;if(l-d>500){this.#p=l;return}this.#p=-1;const{classList:c}=this.div;c.toggle("getElements",!0);const u=document.elementsFromPoint(r,o);if(c.toggle("getElements",!1),!this.div.contains(u[0]))return;let p;const y=new RegExp(`^${os}[0-9]+$`);for(const w of u)if(y.test(w.id)){p=w.id;break}if(!p)return;const v=this.#s.get(p);v?.annotationElementId===null&&(n.stopPropagation(),n.preventDefault(),v.dblclick(n))},{signal:i,capture:!0})}const t=this.#n;if(t){const i=new Map,n=new Map;for(const r of this.#y){if(r.disableEditing(),!r.annotationElementId){r.updateFakeAnnotationElement(t);continue}if(r.serialize()!==null){i.set(r.annotationElementId,r);continue}else n.set(r.annotationElementId,r);this.getEditableAnnotation(r.annotationElementId)?.show(),r.remove()}const s=t.getEditableAnnotations();for(const r of s){const{id:o}=r.data;if(this.#c.isDeletedAnnotationElement(o)){r.updateEdited({deleted:!0});continue}let l=n.get(o);if(l){l.resetAnnotationElement(r),l.show(!1),r.show();continue}l=i.get(o),l&&(this.#c.addChangedExistingAnnotation(l),l.renderAnnotationElement(r)&&l.show(!1)),r.show()}}this.#v(),this.isEmpty&&(this.div.hidden=!0);const{classList:e}=this.div;for(const i of Ti.#g.values())e.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#a=!1}getEditableAnnotation(t){return this.#n?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#c.getActive()!==t&&this.#c.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#d?.div&&!this.#f){this.#f=new AbortController;const t=this.#c.combinedSignal(this.#f);this.#d.div.addEventListener("pointerdown",this.#w.bind(this),{signal:t}),this.#d.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#d?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#d.div.classList.remove("highlighting"))}#w(t){this.#c.unselectAll();const{target:e}=t;if(e===this.#d.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#d.div.contains(e)){const{isMac:i}=ve.platform;if(t.button!==0||t.ctrlKey&&i)return;this.#c.showAllEditors("highlight",!0,!0),this.#d.div.classList.add("free"),this.toggleDrawing(),te.startHighlighting(this,this.#c.direction==="ltr",{target:this.#d.div,x:t.x,y:t.y}),this.#d.div.addEventListener("pointerup",()=>{this.#d.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#c._signal}),t.preventDefault()}}enableClick(){if(this.#i)return;this.#i=new AbortController;const t=this.#c.combinedSignal(this.#i);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#i?.abort(),this.#i=null}attach(t){this.#s.set(t.id,t);const{annotationElementId:e}=t;e&&this.#c.isDeletedAnnotationElement(e)&&this.#c.removeDeletedAnnotationElement(t)}detach(t){this.#s.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#a&&t.annotationElementId&&this.#c.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#c.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#c.addDeletedAnnotationElement(t.annotationElementId),nt.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#c.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#h),this.#c.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#o&&(t._focusEventsAllowed=!1,this.#o=setTimeout(()=>{this.#o=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#c._signal}),e.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),i=()=>{t.remove()};this.addCommands({cmd:e,undo:i,mustExec:!1})}getEditorByUID(t){for(const e of this.#s.values())if(e.uid===t)return e;return null}getNextId(){return this.#c.getId()}get#b(){return Ti.#g.get(this.#c.getMode())}combinedSignal(t){return this.#c.combinedSignal(t)}#C(t){const e=this.#b;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#b?.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await this.#c.updateMode(t.mode);const{offsetX:i,offsetY:n}=this.#S(),s=this.getNextId(),r=this.#C({parent:this,id:s,x:i,y:n,uiManager:this.#c,isCentered:!0,...e});r&&this.add(r)}async deserialize(t){return await Ti.#g.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#c)||null}createAndAddNewEditor(t,e,i={}){const n=this.getNextId(),s=this.#C({parent:this,id:n,x:t.offsetX,y:t.offsetY,uiManager:this.#c,isCentered:e,...i});return s&&this.add(s),s}get boundingClientRect(){return this.div.getBoundingClientRect()}#S(){const{x:t,y:e,width:i,height:n}=this.boundingClientRect,s=Math.max(0,t),r=Math.max(0,e),o=Math.min(window.innerWidth,t+i),l=Math.min(window.innerHeight,e+n),d=(s+o)/2-t,c=(r+l)/2-e,[u,p]=this.viewport.rotation%180===0?[d,c]:[c,d];return{offsetX:u,offsetY:p}}addNewEditor(t={}){this.createAndAddNewEditor(this.#S(),!0,t)}setSelected(t){this.#c.setSelected(t)}toggleSelected(t){this.#c.toggleSelected(t)}unselect(t){this.#c.unselect(t)}pointerup(t){const{isMac:e}=ve.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!this.#r||(this.#r=!1,this.#b?.isDrawer&&this.#b.supportMultipleDrawings))return;if(!this.#e){this.#e=!0;return}const i=this.#c.getMode();if(i===ft.STAMP||i===ft.SIGNATURE){this.#c.unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){if(this.#c.getMode()===ft.HIGHLIGHT&&this.enableTextSelection(),this.#r){this.#r=!1;return}const{isMac:e}=ve.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(this.#r=!0,this.#b?.isDrawer){this.startDrawingSession(t);return}const i=this.#c.getActive();this.#e=!i||i.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#l){this.#b.startDrawing(this,this.#c,!1,t);return}this.#c.setCurrentDrawingSession(this),this.#l=new AbortController;const e=this.#c.combinedSignal(this.#l);this.div.addEventListener("blur",({relatedTarget:i})=>{i&&!this.div.contains(i)&&(this.#u=null,this.commitOrRemove())},{signal:e}),this.#b.startDrawing(this,this.#c,!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&(this.#u=e);return}this.#u&&setTimeout(()=>{this.#u?.focus(),this.#u=null},0)}endDrawingSession(t=!1){return this.#l?(this.#c.setCurrentDrawingSession(null),this.#l.abort(),this.#l=null,this.#u=null,this.#b.endDrawing(t)):null}findNewParent(t,e,i){const n=this.#c.findParent(e,i);return n===null||n===this?!1:(n.changeParent(t),!0)}commitOrRemove(){return this.#l?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#l&&this.#b.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#c.getActive()?.parent===this&&(this.#c.commitOrRemove(),this.#c.setActiveEditor(null)),this.#o&&(clearTimeout(this.#o),this.#o=null);for(const t of this.#s.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#s.clear(),this.#c.removeLayer(this)}#v(){for(const t of this.#s.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,sn(this.div,t);for(const e of this.#c.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){this.#c.commitOrRemove(),this.#v();const e=this.viewport.rotation,i=t.rotation;if(this.viewport=t,sn(this.div,{rotation:i}),e!==i)for(const n of this.#s.values())n.rotate(i)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#c.viewParameters.realScale}}class ye{#t=null;#e=new Map;#n=new Map;static#i=0;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#e.size>0)for(const e of this.#e.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return yt(this,"_svgFactory",new er)}static#o(t,[e,i,n,s]){const{style:r}=t;r.top=`${100*i}%`,r.left=`${100*e}%`,r.width=`${100*n}%`,r.height=`${100*s}%`}#s(){const t=ye._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#r(t,e){const i=ye._svgFactory.createElement("clipPath");t.append(i);const n=`clip_${e}`;i.setAttribute("id",n),i.setAttribute("clipPathUnits","objectBoundingBox");const s=ye._svgFactory.createElement("use");return i.append(s),s.setAttribute("href",`#${e}`),s.classList.add("clip"),n}#a(t,e){for(const[i,n]of Object.entries(e))n===null?t.removeAttribute(i):t.setAttribute(i,n)}draw(t,e=!1,i=!1){const n=ye.#i++,s=this.#s(),r=ye._svgFactory.createElement("defs");s.append(r);const o=ye._svgFactory.createElement("path");r.append(o);const l=`path_p${this.pageIndex}_${n}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#n.set(n,o);const d=i?this.#r(r,l):null,c=ye._svgFactory.createElement("use");return s.append(c),c.setAttribute("href",`#${l}`),this.updateProperties(s,t),this.#e.set(n,s),{id:n,clipPathId:`url(#${d})`}}drawOutline(t,e){const i=ye.#i++,n=this.#s(),s=ye._svgFactory.createElement("defs");n.append(s);const r=ye._svgFactory.createElement("path");s.append(r);const o=`path_p${this.pageIndex}_${i}`;r.setAttribute("id",o),r.setAttribute("vector-effect","non-scaling-stroke");let l;if(e){const u=ye._svgFactory.createElement("mask");s.append(u),l=`mask_p${this.pageIndex}_${i}`,u.setAttribute("id",l),u.setAttribute("maskUnits","objectBoundingBox");const p=ye._svgFactory.createElement("rect");u.append(p),p.setAttribute("width","1"),p.setAttribute("height","1"),p.setAttribute("fill","white");const y=ye._svgFactory.createElement("use");u.append(y),y.setAttribute("href",`#${o}`),y.setAttribute("stroke","none"),y.setAttribute("fill","black"),y.setAttribute("fill-rule","nonzero"),y.classList.add("mask")}const d=ye._svgFactory.createElement("use");n.append(d),d.setAttribute("href",`#${o}`),l&&d.setAttribute("mask",`url(#${l})`);const c=d.cloneNode();return n.append(c),d.classList.add("mainOutline"),c.classList.add("secondaryOutline"),this.updateProperties(n,t),this.#e.set(i,n),i}finalizeDraw(t,e){this.#n.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:i,bbox:n,rootClass:s,path:r}=e,o=typeof t=="number"?this.#e.get(t):t;if(o){if(i&&this.#a(o,i),n&&ye.#o(o,n),s){const{classList:l}=o;for(const[d,c]of Object.entries(s))l.toggle(d,c)}if(r){const d=o.firstChild.firstChild;this.#a(d,r)}}}updateParent(t,e){if(e===this)return;const i=this.#e.get(t);i&&(e.#t.append(i),this.#e.delete(t),e.#e.set(t,i))}remove(t){this.#n.delete(t),this.#t!==null&&(this.#e.get(t).remove(),this.#e.delete(t))}destroy(){this.#t=null;for(const t of this.#e.values())t.remove();this.#e.clear(),this.#n.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:po};globalThis.pdfjsLib={AbortException:zi,AnnotationEditorLayer:Ti,AnnotationEditorParamsType:St,AnnotationEditorType:ft,AnnotationEditorUIManager:Gi,AnnotationLayer:Bo,AnnotationMode:Bi,AnnotationType:re,applyOpacity:sd,build:du,ColorPicker:ti,createValidAbsoluteUrl:Il,CSSConstants:nd,DOMSVGFactory:er,DrawLayer:ye,FeatureTest:ve,fetchData:gs,findContrastColor:rd,getDocument:th,getFilenameFromUrl:Jc,getPdfFilenameFromUrl:Qc,getRGB:ys,getUuid:Fl,getXfaPageViewport:td,GlobalWorkerOptions:ji,ImageKind:Vs,InvalidPDFException:so,isDataScheme:mr,isPdfFile:Po,isValidExplicitDest:gd,MathClamp:Ie,noContextMenu:ii,normalizeUnicode:Xc,OPS:as,OutputScale:Ei,PasswordResponses:Uc,PDFDataRangeTransport:eh,PDFDateString:ro,PDFWorker:hs,PermissionFlag:Bc,PixelsPerInch:Mn,RenderingCancelledException:To,renderRichText:Bl,ResponseException:Zs,setLayerDimensions:sn,shadow:yt,SignatureExtractor:An,stopEvent:Qt,SupportedImageMimeTypes:oo,TextLayer:De,TouchManager:yr,updateUrlHash:Ml,Util:tt,VerbosityLevel:fr,version:cu,XfaLayer:Nl};const Ou={A4:{width:595.28,height:841.89},Letter:{width:612,height:792},Legal:{width:612,height:1008},Tabloid:{width:792,height:1224},A3:{width:841.89,height:1190.55},A5:{width:419.53,height:595.28}};function xp(a,t){for(const[i,n]of Object.entries(Ou))if(Math.abs(a-n.width)<1&&Math.abs(t-n.height)<1||Math.abs(a-n.height)<1&&Math.abs(t-n.width)<1)return i;return"Custom"}function Cp(a,t){let e=0;switch(t){case"in":e=a/72;break;case"mm":e=a/72*25.4;break;case"px":e=a*(96/72);break;default:e=a;break}return e.toFixed(2)}function _p(a){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:{r:0,g:0,b:0}}const Nu=(a,t=1)=>{if(a===0)return"0 Bytes";const e=1024,i=t<0?0:t,n=["Bytes","KB","MB","GB","TB"],s=Math.floor(Math.log(a)/Math.log(e));return parseFloat((a/Math.pow(e,s)).toFixed(i))+" "+n[s]},Tp=(a,t)=>{const e=URL.createObjectURL(a),i=document.createElement("a");i.href=e,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(e)},Pp=a=>new Promise((t,e)=>{const i=new FileReader;i.onload=()=>t(i.result),i.onerror=n=>e(n),i.readAsArrayBuffer(a)});function kp(a,t){if(!a||a.trim()==="")return Array.from({length:t},(n,s)=>s);const e=new Set,i=a.split(",");for(const n of i){const s=n.trim();if(s)if(s.includes("-")){const[r,o]=s.split("-").map(Number);if(isNaN(r)||isNaN(o)||r<1||o>t||r>o){console.warn(`Invalid range skipped: ${s}`);continue}for(let l=r;l<=o;l++)e.add(l-1)}else{const r=Number(s);if(isNaN(r)||r<1||r>t){console.warn(`Invalid page number skipped: ${s}`);continue}e.add(r-1)}}return Array.from(e).sort((n,s)=>n-s)}function Dp(a){if(!a||typeof a!="string")return a;try{const t=new Date(a);return isNaN(t.getTime())?a:t.toLocaleString()}catch(t){return console.error("Could not parse ISO date:",t),a}}let Bs=null;async function Lp(){if(Bs)return Bs;pf("Initializing PDF engine...");try{Bs=await Nc({locateFile:()=>"/qpdf.wasm"})}catch(a){throw console.error("Failed to initialize qpdf-wasm:",a),mf("Initialization Error","Could not load the PDF engine. Please refresh the page and try again."),a}finally{gf()}return Bs}function Bu(a){return a>=1e3?(a/1e3).toFixed(1)+"K":a.toLocaleString()}function Ip(a,t=25){if(a.length<=t)return a;const e=a.lastIndexOf("."),i=e!==-1?a.substring(e):"",n=e!==-1?a.substring(0,e):a,s=t-i.length-3;return s<=0?a.substring(0,t-3)+"...":n.substring(0,s)+"..."+i}function Oi(a,t){return a?a.replace("mod",t?"":"Ctrl").replace("ctrl",t?"^":"Ctrl").replace("alt",t?"":"Alt").replace("shift","Shift").split("+").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(t?"":"+"):""}function Mp(a){let t=a;return typeof a=="string"?t={url:a}:(a instanceof Uint8Array||a instanceof ArrayBuffer)&&(t={data:a}),(typeof t!="object"||t===null)&&(t={}),th({...t,wasmUrl:"/pdfjs-viewer/wasm/"})}ji.workerSrc=new URL("/assets/pdf.worker.min-qwK7q_zL.mjs",import.meta.url).toString();const Ht={observer:null,pendingTasks:new Map,isRendering:!1,eagerLoadQueue:[],nextEagerIndex:0};function Uu(a,t){const e=document.createElement("div");e.className="page-thumbnail relative cursor-move flex flex-col items-center gap-1 p-2 border-2 border-gray-600 rounded-lg bg-gray-800 transition-colors",e.dataset.pageNumber=a.toString(),e.dataset.lazyLoad="true";const i=document.createElement("div");i.className="relative w-full h-36 bg-gray-700 rounded-md animate-pulse flex items-center justify-center";const n=document.createElement("span");return n.className="text-gray-500 text-xs",n.textContent="Loading...",i.appendChild(n),e.appendChild(i),e}async function $u(a,t,e=.5){const i=await a.getPage(t),n=i.getViewport({scale:e}),s=document.createElement("canvas");s.height=n.height,s.width=n.width;const r=s.getContext("2d");return await i.render({canvasContext:r,canvas:s,viewport:n}).promise,s}async function jo(a,t){const e=a.map(async i=>{try{const n=await $u(i.pdfjsDoc,i.pageNumber,i.scale||.5),s=i.createWrapper(n,i.pageNumber,i.fileName),r=i.container.querySelector(`[data-page-number="${i.pageNumber}"][data-lazy-load="true"]`);return r?i.container.replaceChild(s,r):(console.warn(`No placeholder found for page ${i.pageNumber}, appending instead`),i.container.appendChild(s)),s}catch(n){return console.error(`Error rendering page ${i.pageNumber}:`,n),null}});await Promise.all(e)}function Hu(a,t){const e={root:a.closest(".overflow-auto")||null,rootMargin:t.lazyLoadMargin||"200px",threshold:.01},i=new IntersectionObserver(n=>{n.forEach(s=>{if(s.isIntersecting){const r=s.target,o=Ht.pendingTasks.get(r);o&&(i.unobserve(r),Ht.pendingTasks.delete(r),jo([o],t.onProgress).then(()=>{t.onBatchComplete&&t.onBatchComplete(),Ht.pendingTasks.size===0&&Ht.observer&&(Ht.observer.disconnect(),Ht.observer=null)}).catch(l=>{console.error(`Error lazy loading page ${o.pageNumber}:`,l)}))}})},e);return Ht.observer=i,i}function dh(a){"requestIdleCallback"in window?requestIdleCallback(a):setTimeout(a,16)}async function Rp(a,t,e,i={}){const{batchSize:n=8,useLazyLoading:s=!0,eagerLoadBatches:r=2,onProgress:o,onBatchComplete:l}=i,d=a.numPages,c=s?Math.min(20,d):d,u=[];for(let v=1;v<=d;v++){const w=Uu(v);t.appendChild(w),u.push(w)}const p=[];for(let v=1;v<=d;v++)p.push({pageNumber:v,pdfjsDoc:a,container:t,scale:i.useLazyLoading?.3:.5,createWrapper:e});if(s&&d>c){const v=Hu(t,i);for(let S=c+1;S<=d;S++){const P=u[S-1];Ht.pendingTasks.set(P,p[S-1]),v.observe(P)}const w=c,x=Math.min(w+r*n,d);Ht.eagerLoadQueue=p.slice(w,x),Ht.nextEagerIndex=0}const y=p.slice(0,c);for(let v=0;v<y.length;v+=n){if(i.shouldCancel?.())return;const w=y.slice(v,v+n);await new Promise(x=>{dh(async()=>{await jo(w),o&&o(Math.min(v+n,c),d),l&&l(),x()})})}s&&r>0&&d>c&&uh(i)}function uh(a){const{eagerLoadBatches:t=2,batchSize:e=8}=a;if(t<=0||Ht.eagerLoadQueue.length===0||a.shouldCancel?.())return;const{nextEagerIndex:i,eagerLoadQueue:n}=Ht;if(i>=n.length)return;const s=Math.min(i+e,n.length),r=n.slice(i,s);dh(async()=>{if(a.shouldCancel?.())return;r.forEach(l=>{const d=Array.from(Ht.pendingTasks.entries()).find(([c,u])=>u.pageNumber===l.pageNumber)?.[0];d&&Ht.observer&&(Ht.observer.unobserve(d),Ht.pendingTasks.delete(d))}),await jo(r,a.onProgress),a.onBatchComplete&&a.onBatchComplete(),Ht.nextEagerIndex=s;const o=Math.ceil((n.length-s)/e);o>0&&o<t&&uh(a)})}function Fp(){Ht.observer&&(Ht.observer.disconnect(),Ht.observer=null),Ht.pendingTasks.clear(),Ht.isRendering=!1,Ht.eagerLoadQueue=[],Ht.nextEagerIndex=0}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Ga(a,t){var e=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(a,n).enumerable})),e.push.apply(e,i)}return e}function Si(a){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Ga(Object(e),!0).forEach(function(i){ju(a,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(e)):Ga(Object(e)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(e,i))})}return a}function Xs(a){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Xs=function(t){return typeof t}:Xs=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xs(a)}function ju(a,t,e){return t in a?Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[t]=e,a}function Li(){return Li=Object.assign||function(a){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i])}return a},Li.apply(this,arguments)}function zu(a,t){if(a==null)return{};var e={},i=Object.keys(a),n,s;for(s=0;s<i.length;s++)n=i[s],!(t.indexOf(n)>=0)&&(e[n]=a[n]);return e}function Gu(a,t){if(a==null)return{};var e=zu(a,t),i,n;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);for(n=0;n<s.length;n++)i=s[n],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(a,i)&&(e[i]=a[i])}return e}var Vu="1.15.6";function Di(a){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(a)}var Mi=Di(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),As=Di(/Edge/i),Va=Di(/firefox/i),Zn=Di(/safari/i)&&!Di(/chrome/i)&&!Di(/android/i),zo=Di(/iP(ad|od|hone)/i),fh=Di(/chrome/i)&&Di(/android/i),ph={capture:!1,passive:!1};function Et(a,t,e){a.addEventListener(t,e,!Mi&&ph)}function At(a,t,e){a.removeEventListener(t,e,!Mi&&ph)}function ir(a,t){if(t){if(t[0]===">"&&(t=t.substring(1)),a)try{if(a.matches)return a.matches(t);if(a.msMatchesSelector)return a.msMatchesSelector(t);if(a.webkitMatchesSelector)return a.webkitMatchesSelector(t)}catch{return!1}return!1}}function gh(a){return a.host&&a!==document&&a.host.nodeType?a.host:a.parentNode}function li(a,t,e,i){if(a){e=e||document;do{if(t!=null&&(t[0]===">"?a.parentNode===e&&ir(a,t):ir(a,t))||i&&a===e)return a;if(a===e)break}while(a=gh(a))}return null}var Wa=/\s+/g;function Ge(a,t,e){if(a&&t)if(a.classList)a.classList[e?"add":"remove"](t);else{var i=(" "+a.className+" ").replace(Wa," ").replace(" "+t+" "," ");a.className=(i+(e?" "+t:"")).replace(Wa," ")}}function ot(a,t,e){var i=a&&a.style;if(i){if(e===void 0)return document.defaultView&&document.defaultView.getComputedStyle?e=document.defaultView.getComputedStyle(a,""):a.currentStyle&&(e=a.currentStyle),t===void 0?e:e[t];!(t in i)&&t.indexOf("webkit")===-1&&(t="-webkit-"+t),i[t]=e+(typeof e=="string"?"":"px")}}function Ln(a,t){var e="";if(typeof a=="string")e=a;else do{var i=ot(a,"transform");i&&i!=="none"&&(e=i+" "+e)}while(!t&&(a=a.parentNode));var n=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return n&&new n(e)}function mh(a,t,e){if(a){var i=a.getElementsByTagName(t),n=0,s=i.length;if(e)for(;n<s;n++)e(i[n],n);return i}return[]}function Ai(){var a=document.scrollingElement;return a||document.documentElement}function ae(a,t,e,i,n){if(!(!a.getBoundingClientRect&&a!==window)){var s,r,o,l,d,c,u;if(a!==window&&a.parentNode&&a!==Ai()?(s=a.getBoundingClientRect(),r=s.top,o=s.left,l=s.bottom,d=s.right,c=s.height,u=s.width):(r=0,o=0,l=window.innerHeight,d=window.innerWidth,c=window.innerHeight,u=window.innerWidth),(t||e)&&a!==window&&(n=n||a.parentNode,!Mi))do if(n&&n.getBoundingClientRect&&(ot(n,"transform")!=="none"||e&&ot(n,"position")!=="static")){var p=n.getBoundingClientRect();r-=p.top+parseInt(ot(n,"border-top-width")),o-=p.left+parseInt(ot(n,"border-left-width")),l=r+s.height,d=o+s.width;break}while(n=n.parentNode);if(i&&a!==window){var y=Ln(n||a),v=y&&y.a,w=y&&y.d;y&&(r/=w,o/=v,u/=v,c/=w,l=r+c,d=o+u)}return{top:r,left:o,bottom:l,right:d,width:u,height:c}}}function qa(a,t,e){for(var i=Hi(a,!0),n=ae(a)[t];i;){var s=ae(i)[e],r=void 0;if(r=n>=s,!r)return i;if(i===Ai())break;i=Hi(i,!1)}return!1}function Rn(a,t,e,i){for(var n=0,s=0,r=a.children;s<r.length;){if(r[s].style.display!=="none"&&r[s]!==lt.ghost&&(i||r[s]!==lt.dragged)&&li(r[s],e.draggable,a,!1)){if(n===t)return r[s];n++}s++}return null}function Go(a,t){for(var e=a.lastElementChild;e&&(e===lt.ghost||ot(e,"display")==="none"||t&&!ir(e,t));)e=e.previousElementSibling;return e||null}function ei(a,t){var e=0;if(!a||!a.parentNode)return-1;for(;a=a.previousElementSibling;)a.nodeName.toUpperCase()!=="TEMPLATE"&&a!==lt.clone&&(!t||ir(a,t))&&e++;return e}function Xa(a){var t=0,e=0,i=Ai();if(a)do{var n=Ln(a),s=n.a,r=n.d;t+=a.scrollLeft*s,e+=a.scrollTop*r}while(a!==i&&(a=a.parentNode));return[t,e]}function Wu(a,t){for(var e in a)if(a.hasOwnProperty(e)){for(var i in t)if(t.hasOwnProperty(i)&&t[i]===a[e][i])return Number(e)}return-1}function Hi(a,t){if(!a||!a.getBoundingClientRect)return Ai();var e=a,i=!1;do if(e.clientWidth<e.scrollWidth||e.clientHeight<e.scrollHeight){var n=ot(e);if(e.clientWidth<e.scrollWidth&&(n.overflowX=="auto"||n.overflowX=="scroll")||e.clientHeight<e.scrollHeight&&(n.overflowY=="auto"||n.overflowY=="scroll")){if(!e.getBoundingClientRect||e===document.body)return Ai();if(i||t)return e;i=!0}}while(e=e.parentNode);return Ai()}function qu(a,t){if(a&&t)for(var e in t)t.hasOwnProperty(e)&&(a[e]=t[e]);return a}function jr(a,t){return Math.round(a.top)===Math.round(t.top)&&Math.round(a.left)===Math.round(t.left)&&Math.round(a.height)===Math.round(t.height)&&Math.round(a.width)===Math.round(t.width)}var ts;function yh(a,t){return function(){if(!ts){var e=arguments,i=this;e.length===1?a.call(i,e[0]):a.apply(i,e),ts=setTimeout(function(){ts=void 0},t)}}}function Xu(){clearTimeout(ts),ts=void 0}function bh(a,t,e){a.scrollLeft+=t,a.scrollTop+=e}function wh(a){var t=window.Polymer,e=window.jQuery||window.Zepto;return t&&t.dom?t.dom(a).cloneNode(!0):e?e(a).clone(!0)[0]:a.cloneNode(!0)}function vh(a,t,e){var i={};return Array.from(a.children).forEach(function(n){var s,r,o,l;if(!(!li(n,t.draggable,a,!1)||n.animated||n===e)){var d=ae(n);i.left=Math.min((s=i.left)!==null&&s!==void 0?s:1/0,d.left),i.top=Math.min((r=i.top)!==null&&r!==void 0?r:1/0,d.top),i.right=Math.max((o=i.right)!==null&&o!==void 0?o:-1/0,d.right),i.bottom=Math.max((l=i.bottom)!==null&&l!==void 0?l:-1/0,d.bottom)}}),i.width=i.right-i.left,i.height=i.bottom-i.top,i.x=i.left,i.y=i.top,i}var $e="Sortable"+new Date().getTime();function Yu(){var a=[],t;return{captureAnimationState:function(){if(a=[],!!this.options.animation){var i=[].slice.call(this.el.children);i.forEach(function(n){if(!(ot(n,"display")==="none"||n===lt.ghost)){a.push({target:n,rect:ae(n)});var s=Si({},a[a.length-1].rect);if(n.thisAnimationDuration){var r=Ln(n,!0);r&&(s.top-=r.f,s.left-=r.e)}n.fromRect=s}})}},addAnimationState:function(i){a.push(i)},removeAnimationState:function(i){a.splice(Wu(a,{target:i}),1)},animateAll:function(i){var n=this;if(!this.options.animation){clearTimeout(t),typeof i=="function"&&i();return}var s=!1,r=0;a.forEach(function(o){var l=0,d=o.target,c=d.fromRect,u=ae(d),p=d.prevFromRect,y=d.prevToRect,v=o.rect,w=Ln(d,!0);w&&(u.top-=w.f,u.left-=w.e),d.toRect=u,d.thisAnimationDuration&&jr(p,u)&&!jr(c,u)&&(v.top-u.top)/(v.left-u.left)===(c.top-u.top)/(c.left-u.left)&&(l=Ju(v,p,y,n.options)),jr(u,c)||(d.prevFromRect=c,d.prevToRect=u,l||(l=n.options.animation),n.animate(d,v,u,l)),l&&(s=!0,r=Math.max(r,l),clearTimeout(d.animationResetTimer),d.animationResetTimer=setTimeout(function(){d.animationTime=0,d.prevFromRect=null,d.fromRect=null,d.prevToRect=null,d.thisAnimationDuration=null},l),d.thisAnimationDuration=l)}),clearTimeout(t),s?t=setTimeout(function(){typeof i=="function"&&i()},r):typeof i=="function"&&i(),a=[]},animate:function(i,n,s,r){if(r){ot(i,"transition",""),ot(i,"transform","");var o=Ln(this.el),l=o&&o.a,d=o&&o.d,c=(n.left-s.left)/(l||1),u=(n.top-s.top)/(d||1);i.animatingX=!!c,i.animatingY=!!u,ot(i,"transform","translate3d("+c+"px,"+u+"px,0)"),this.forRepaintDummy=Ku(i),ot(i,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),ot(i,"transform","translate3d(0,0,0)"),typeof i.animated=="number"&&clearTimeout(i.animated),i.animated=setTimeout(function(){ot(i,"transition",""),ot(i,"transform",""),i.animated=!1,i.animatingX=!1,i.animatingY=!1},r)}}}}function Ku(a){return a.offsetWidth}function Ju(a,t,e,i){return Math.sqrt(Math.pow(t.top-a.top,2)+Math.pow(t.left-a.left,2))/Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))*i.animation}var pn=[],zr={initializeByDefault:!0},Es={mount:function(t){for(var e in zr)zr.hasOwnProperty(e)&&!(e in t)&&(t[e]=zr[e]);pn.forEach(function(i){if(i.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")}),pn.push(t)},pluginEvent:function(t,e,i){var n=this;this.eventCanceled=!1,i.cancel=function(){n.eventCanceled=!0};var s=t+"Global";pn.forEach(function(r){e[r.pluginName]&&(e[r.pluginName][s]&&e[r.pluginName][s](Si({sortable:e},i)),e.options[r.pluginName]&&e[r.pluginName][t]&&e[r.pluginName][t](Si({sortable:e},i)))})},initializePlugins:function(t,e,i,n){pn.forEach(function(o){var l=o.pluginName;if(!(!t.options[l]&&!o.initializeByDefault)){var d=new o(t,e,t.options);d.sortable=t,d.options=t.options,t[l]=d,Li(i,d.defaults)}});for(var s in t.options)if(t.options.hasOwnProperty(s)){var r=this.modifyOption(t,s,t.options[s]);typeof r<"u"&&(t.options[s]=r)}},getEventProperties:function(t,e){var i={};return pn.forEach(function(n){typeof n.eventProperties=="function"&&Li(i,n.eventProperties.call(e[n.pluginName],t))}),i},modifyOption:function(t,e,i){var n;return pn.forEach(function(s){t[s.pluginName]&&s.optionListeners&&typeof s.optionListeners[e]=="function"&&(n=s.optionListeners[e].call(t[s.pluginName],i))}),n}};function Qu(a){var t=a.sortable,e=a.rootEl,i=a.name,n=a.targetEl,s=a.cloneEl,r=a.toEl,o=a.fromEl,l=a.oldIndex,d=a.newIndex,c=a.oldDraggableIndex,u=a.newDraggableIndex,p=a.originalEvent,y=a.putSortable,v=a.extraEventProperties;if(t=t||e&&e[$e],!!t){var w,x=t.options,S="on"+i.charAt(0).toUpperCase()+i.substr(1);window.CustomEvent&&!Mi&&!As?w=new CustomEvent(i,{bubbles:!0,cancelable:!0}):(w=document.createEvent("Event"),w.initEvent(i,!0,!0)),w.to=r||e,w.from=o||e,w.item=n||e,w.clone=s,w.oldIndex=l,w.newIndex=d,w.oldDraggableIndex=c,w.newDraggableIndex=u,w.originalEvent=p,w.pullMode=y?y.lastPutMode:void 0;var P=Si(Si({},v),Es.getEventProperties(i,t));for(var k in P)w[k]=P[k];e&&e.dispatchEvent(w),x[S]&&x[S].call(t,w)}}var Zu=["evt"],Oe=function(t,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=i.evt,s=Gu(i,Zu);Es.pluginEvent.bind(lt)(t,e,Si({dragEl:X,parentEl:Kt,ghostEl:dt,rootEl:Bt,nextEl:Ji,lastDownEl:Ys,cloneEl:zt,cloneHidden:Ui,dragStarted:Yn,putSortable:be,activeSortable:lt.active,originalEvent:n,oldIndex:Cn,oldDraggableIndex:es,newIndex:Ve,newDraggableIndex:Ni,hideGhostForTarget:xh,unhideGhostForTarget:Ch,cloneNowHidden:function(){Ui=!0},cloneNowShown:function(){Ui=!1},dispatchSortableEvent:function(o){ke({sortable:e,name:o,originalEvent:n})}},s))};function ke(a){Qu(Si({putSortable:be,cloneEl:zt,targetEl:X,rootEl:Bt,oldIndex:Cn,oldDraggableIndex:es,newIndex:Ve,newDraggableIndex:Ni},a))}var X,Kt,dt,Bt,Ji,Ys,zt,Ui,Cn,Ve,es,Ni,Us,be,En=!1,nr=!1,sr=[],Yi,oi,Gr,Vr,Ya,Ka,Yn,gn,is,ns=!1,$s=!1,Ks,xe,Wr=[],yo=!1,rr=[],vr=typeof document<"u",Hs=zo,Ja=As||Mi?"cssFloat":"float",tf=vr&&!fh&&!zo&&"draggable"in document.createElement("div"),Ah=(function(){if(vr){if(Mi)return!1;var a=document.createElement("x");return a.style.cssText="pointer-events:auto",a.style.pointerEvents==="auto"}})(),Eh=function(t,e){var i=ot(t),n=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),s=Rn(t,0,e),r=Rn(t,1,e),o=s&&ot(s),l=r&&ot(r),d=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+ae(s).width,c=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+ae(r).width;if(i.display==="flex")return i.flexDirection==="column"||i.flexDirection==="column-reverse"?"vertical":"horizontal";if(i.display==="grid")return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(s&&o.float&&o.float!=="none"){var u=o.float==="left"?"left":"right";return r&&(l.clear==="both"||l.clear===u)?"vertical":"horizontal"}return s&&(o.display==="block"||o.display==="flex"||o.display==="table"||o.display==="grid"||d>=n&&i[Ja]==="none"||r&&i[Ja]==="none"&&d+c>n)?"vertical":"horizontal"},ef=function(t,e,i){var n=i?t.left:t.top,s=i?t.right:t.bottom,r=i?t.width:t.height,o=i?e.left:e.top,l=i?e.right:e.bottom,d=i?e.width:e.height;return n===o||s===l||n+r/2===o+d/2},nf=function(t,e){var i;return sr.some(function(n){var s=n[$e].options.emptyInsertThreshold;if(!(!s||Go(n))){var r=ae(n),o=t>=r.left-s&&t<=r.right+s,l=e>=r.top-s&&e<=r.bottom+s;if(o&&l)return i=n}}),i},Sh=function(t){function e(s,r){return function(o,l,d,c){var u=o.options.group.name&&l.options.group.name&&o.options.group.name===l.options.group.name;if(s==null&&(r||u))return!0;if(s==null||s===!1)return!1;if(r&&s==="clone")return s;if(typeof s=="function")return e(s(o,l,d,c),r)(o,l,d,c);var p=(r?o:l).options.group.name;return s===!0||typeof s=="string"&&s===p||s.join&&s.indexOf(p)>-1}}var i={},n=t.group;(!n||Xs(n)!="object")&&(n={name:n}),i.name=n.name,i.checkPull=e(n.pull,!0),i.checkPut=e(n.put),i.revertClone=n.revertClone,t.group=i},xh=function(){!Ah&&dt&&ot(dt,"display","none")},Ch=function(){!Ah&&dt&&ot(dt,"display","")};vr&&!fh&&document.addEventListener("click",function(a){if(nr)return a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.stopImmediatePropagation&&a.stopImmediatePropagation(),nr=!1,!1},!0);var Ki=function(t){if(X){t=t.touches?t.touches[0]:t;var e=nf(t.clientX,t.clientY);if(e){var i={};for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);i.target=i.rootEl=e,i.preventDefault=void 0,i.stopPropagation=void 0,e[$e]._onDragOver(i)}}},sf=function(t){X&&X.parentNode[$e]._isOutsideThisEl(t.target)};function lt(a,t){if(!(a&&a.nodeType&&a.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(a));this.el=a,this.options=t=Li({},t),a[$e]=this;var e={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(a.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Eh(a,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(r,o){r.setData("Text",o.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:lt.supportPointer!==!1&&"PointerEvent"in window&&(!Zn||zo),emptyInsertThreshold:5};Es.initializePlugins(this,a,e);for(var i in e)!(i in t)&&(t[i]=e[i]);Sh(t);for(var n in this)n.charAt(0)==="_"&&typeof this[n]=="function"&&(this[n]=this[n].bind(this));this.nativeDraggable=t.forceFallback?!1:tf,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?Et(a,"pointerdown",this._onTapStart):(Et(a,"mousedown",this._onTapStart),Et(a,"touchstart",this._onTapStart)),this.nativeDraggable&&(Et(a,"dragover",this),Et(a,"dragenter",this)),sr.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),Li(this,Yu())}lt.prototype={constructor:lt,_isOutsideThisEl:function(t){!this.el.contains(t)&&t!==this.el&&(gn=null)},_getDirection:function(t,e){return typeof this.options.direction=="function"?this.options.direction.call(this,t,e,X):this.options.direction},_onTapStart:function(t){if(t.cancelable){var e=this,i=this.el,n=this.options,s=n.preventOnFilter,r=t.type,o=t.touches&&t.touches[0]||t.pointerType&&t.pointerType==="touch"&&t,l=(o||t).target,d=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||l,c=n.filter;if(uf(i),!X&&!(/mousedown|pointerdown/.test(r)&&t.button!==0||n.disabled)&&!d.isContentEditable&&!(!this.nativeDraggable&&Zn&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=li(l,n.draggable,i,!1),!(l&&l.animated)&&Ys!==l)){if(Cn=ei(l),es=ei(l,n.draggable),typeof c=="function"){if(c.call(this,t,l,this)){ke({sortable:e,rootEl:d,name:"filter",targetEl:l,toEl:i,fromEl:i}),Oe("filter",e,{evt:t}),s&&t.preventDefault();return}}else if(c&&(c=c.split(",").some(function(u){if(u=li(d,u.trim(),i,!1),u)return ke({sortable:e,rootEl:u,name:"filter",targetEl:l,fromEl:i,toEl:i}),Oe("filter",e,{evt:t}),!0}),c)){s&&t.preventDefault();return}n.handle&&!li(d,n.handle,i,!1)||this._prepareDragStart(t,o,l)}}},_prepareDragStart:function(t,e,i){var n=this,s=n.el,r=n.options,o=s.ownerDocument,l;if(i&&!X&&i.parentNode===s){var d=ae(i);if(Bt=s,X=i,Kt=X.parentNode,Ji=X.nextSibling,Ys=i,Us=r.group,lt.dragged=X,Yi={target:X,clientX:(e||t).clientX,clientY:(e||t).clientY},Ya=Yi.clientX-d.left,Ka=Yi.clientY-d.top,this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,X.style["will-change"]="all",l=function(){if(Oe("delayEnded",n,{evt:t}),lt.eventCanceled){n._onDrop();return}n._disableDelayedDragEvents(),!Va&&n.nativeDraggable&&(X.draggable=!0),n._triggerDragStart(t,e),ke({sortable:n,name:"choose",originalEvent:t}),Ge(X,r.chosenClass,!0)},r.ignore.split(",").forEach(function(c){mh(X,c.trim(),qr)}),Et(o,"dragover",Ki),Et(o,"mousemove",Ki),Et(o,"touchmove",Ki),r.supportPointer?(Et(o,"pointerup",n._onDrop),!this.nativeDraggable&&Et(o,"pointercancel",n._onDrop)):(Et(o,"mouseup",n._onDrop),Et(o,"touchend",n._onDrop),Et(o,"touchcancel",n._onDrop)),Va&&this.nativeDraggable&&(this.options.touchStartThreshold=4,X.draggable=!0),Oe("delayStart",this,{evt:t}),r.delay&&(!r.delayOnTouchOnly||e)&&(!this.nativeDraggable||!(As||Mi))){if(lt.eventCanceled){this._onDrop();return}r.supportPointer?(Et(o,"pointerup",n._disableDelayedDrag),Et(o,"pointercancel",n._disableDelayedDrag)):(Et(o,"mouseup",n._disableDelayedDrag),Et(o,"touchend",n._disableDelayedDrag),Et(o,"touchcancel",n._disableDelayedDrag)),Et(o,"mousemove",n._delayedDragTouchMoveHandler),Et(o,"touchmove",n._delayedDragTouchMoveHandler),r.supportPointer&&Et(o,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(l,r.delay)}else l()}},_delayedDragTouchMoveHandler:function(t){var e=t.touches?t.touches[0]:t;Math.max(Math.abs(e.clientX-this._lastX),Math.abs(e.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){X&&qr(X),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;At(t,"mouseup",this._disableDelayedDrag),At(t,"touchend",this._disableDelayedDrag),At(t,"touchcancel",this._disableDelayedDrag),At(t,"pointerup",this._disableDelayedDrag),At(t,"pointercancel",this._disableDelayedDrag),At(t,"mousemove",this._delayedDragTouchMoveHandler),At(t,"touchmove",this._delayedDragTouchMoveHandler),At(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,e){e=e||t.pointerType=="touch"&&t,!this.nativeDraggable||e?this.options.supportPointer?Et(document,"pointermove",this._onTouchMove):e?Et(document,"touchmove",this._onTouchMove):Et(document,"mousemove",this._onTouchMove):(Et(X,"dragend",this),Et(Bt,"dragstart",this._onDragStart));try{document.selection?Js(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(t,e){if(En=!1,Bt&&X){Oe("dragStarted",this,{evt:e}),this.nativeDraggable&&Et(document,"dragover",sf);var i=this.options;!t&&Ge(X,i.dragClass,!1),Ge(X,i.ghostClass,!0),lt.active=this,t&&this._appendGhost(),ke({sortable:this,name:"start",originalEvent:e})}else this._nulling()},_emulateDragOver:function(){if(oi){this._lastX=oi.clientX,this._lastY=oi.clientY,xh();for(var t=document.elementFromPoint(oi.clientX,oi.clientY),e=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(oi.clientX,oi.clientY),t!==e);)e=t;if(X.parentNode[$e]._isOutsideThisEl(t),e)do{if(e[$e]){var i=void 0;if(i=e[$e]._onDragOver({clientX:oi.clientX,clientY:oi.clientY,target:t,rootEl:e}),i&&!this.options.dragoverBubble)break}t=e}while(e=gh(e));Ch()}},_onTouchMove:function(t){if(Yi){var e=this.options,i=e.fallbackTolerance,n=e.fallbackOffset,s=t.touches?t.touches[0]:t,r=dt&&Ln(dt,!0),o=dt&&r&&r.a,l=dt&&r&&r.d,d=Hs&&xe&&Xa(xe),c=(s.clientX-Yi.clientX+n.x)/(o||1)+(d?d[0]-Wr[0]:0)/(o||1),u=(s.clientY-Yi.clientY+n.y)/(l||1)+(d?d[1]-Wr[1]:0)/(l||1);if(!lt.active&&!En){if(i&&Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))<i)return;this._onDragStart(t,!0)}if(dt){r?(r.e+=c-(Gr||0),r.f+=u-(Vr||0)):r={a:1,b:0,c:0,d:1,e:c,f:u};var p="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");ot(dt,"webkitTransform",p),ot(dt,"mozTransform",p),ot(dt,"msTransform",p),ot(dt,"transform",p),Gr=c,Vr=u,oi=s}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!dt){var t=this.options.fallbackOnBody?document.body:Bt,e=ae(X,!0,Hs,!0,t),i=this.options;if(Hs){for(xe=t;ot(xe,"position")==="static"&&ot(xe,"transform")==="none"&&xe!==document;)xe=xe.parentNode;xe!==document.body&&xe!==document.documentElement?(xe===document&&(xe=Ai()),e.top+=xe.scrollTop,e.left+=xe.scrollLeft):xe=Ai(),Wr=Xa(xe)}dt=X.cloneNode(!0),Ge(dt,i.ghostClass,!1),Ge(dt,i.fallbackClass,!0),Ge(dt,i.dragClass,!0),ot(dt,"transition",""),ot(dt,"transform",""),ot(dt,"box-sizing","border-box"),ot(dt,"margin",0),ot(dt,"top",e.top),ot(dt,"left",e.left),ot(dt,"width",e.width),ot(dt,"height",e.height),ot(dt,"opacity","0.8"),ot(dt,"position",Hs?"absolute":"fixed"),ot(dt,"zIndex","100000"),ot(dt,"pointerEvents","none"),lt.ghost=dt,t.appendChild(dt),ot(dt,"transform-origin",Ya/parseInt(dt.style.width)*100+"% "+Ka/parseInt(dt.style.height)*100+"%")}},_onDragStart:function(t,e){var i=this,n=t.dataTransfer,s=i.options;if(Oe("dragStart",this,{evt:t}),lt.eventCanceled){this._onDrop();return}Oe("setupClone",this),lt.eventCanceled||(zt=wh(X),zt.removeAttribute("id"),zt.draggable=!1,zt.style["will-change"]="",this._hideClone(),Ge(zt,this.options.chosenClass,!1),lt.clone=zt),i.cloneId=Js(function(){Oe("clone",i),!lt.eventCanceled&&(i.options.removeCloneOnHide||Bt.insertBefore(zt,X),i._hideClone(),ke({sortable:i,name:"clone"}))}),!e&&Ge(X,s.dragClass,!0),e?(nr=!0,i._loopId=setInterval(i._emulateDragOver,50)):(At(document,"mouseup",i._onDrop),At(document,"touchend",i._onDrop),At(document,"touchcancel",i._onDrop),n&&(n.effectAllowed="move",s.setData&&s.setData.call(i,n,X)),Et(document,"drop",i),ot(X,"transform","translateZ(0)")),En=!0,i._dragStartId=Js(i._dragStarted.bind(i,e,t)),Et(document,"selectstart",i),Yn=!0,window.getSelection().removeAllRanges(),Zn&&ot(document.body,"user-select","none")},_onDragOver:function(t){var e=this.el,i=t.target,n,s,r,o=this.options,l=o.group,d=lt.active,c=Us===l,u=o.sort,p=be||d,y,v=this,w=!1;if(yo)return;function x(Q,Ct){Oe(Q,v,Si({evt:t,isOwner:c,axis:y?"vertical":"horizontal",revert:r,dragRect:n,targetRect:s,canSort:u,fromSortable:p,target:i,completed:P,onMove:function(pt,gt){return js(Bt,e,X,n,pt,ae(pt),t,gt)},changed:k},Ct))}function S(){x("dragOverAnimationCapture"),v.captureAnimationState(),v!==p&&p.captureAnimationState()}function P(Q){return x("dragOverCompleted",{insertion:Q}),Q&&(c?d._hideClone():d._showClone(v),v!==p&&(Ge(X,be?be.options.ghostClass:d.options.ghostClass,!1),Ge(X,o.ghostClass,!0)),be!==v&&v!==lt.active?be=v:v===lt.active&&be&&(be=null),p===v&&(v._ignoreWhileAnimating=i),v.animateAll(function(){x("dragOverAnimationComplete"),v._ignoreWhileAnimating=null}),v!==p&&(p.animateAll(),p._ignoreWhileAnimating=null)),(i===X&&!X.animated||i===e&&!i.animated)&&(gn=null),!o.dragoverBubble&&!t.rootEl&&i!==document&&(X.parentNode[$e]._isOutsideThisEl(t.target),!Q&&Ki(t)),!o.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),w=!0}function k(){Ve=ei(X),Ni=ei(X,o.draggable),ke({sortable:v,name:"change",toEl:e,newIndex:Ve,newDraggableIndex:Ni,originalEvent:t})}if(t.preventDefault!==void 0&&t.cancelable&&t.preventDefault(),i=li(i,o.draggable,e,!0),x("dragOver"),lt.eventCanceled)return w;if(X.contains(t.target)||i.animated&&i.animatingX&&i.animatingY||v._ignoreWhileAnimating===i)return P(!1);if(nr=!1,d&&!o.disabled&&(c?u||(r=Kt!==Bt):be===this||(this.lastPutMode=Us.checkPull(this,d,X,t))&&l.checkPut(this,d,X,t))){if(y=this._getDirection(t,i)==="vertical",n=ae(X),x("dragOverValid"),lt.eventCanceled)return w;if(r)return Kt=Bt,S(),this._hideClone(),x("revert"),lt.eventCanceled||(Ji?Bt.insertBefore(X,Ji):Bt.appendChild(X)),P(!0);var D=Go(e,o.draggable);if(!D||lf(t,y,this)&&!D.animated){if(D===X)return P(!1);if(D&&e===t.target&&(i=D),i&&(s=ae(i)),js(Bt,e,X,n,i,s,t,!!i)!==!1)return S(),D&&D.nextSibling?e.insertBefore(X,D.nextSibling):e.appendChild(X),Kt=e,k(),P(!0)}else if(D&&af(t,y,this)){var M=Rn(e,0,o,!0);if(M===X)return P(!1);if(i=M,s=ae(i),js(Bt,e,X,n,i,s,t,!1)!==!1)return S(),e.insertBefore(X,M),Kt=e,k(),P(!0)}else if(i.parentNode===e){s=ae(i);var R=0,N,F=X.parentNode!==e,O=!ef(X.animated&&X.toRect||n,i.animated&&i.toRect||s,y),H=y?"top":"left",U=qa(i,"top","top")||qa(X,"top","top"),K=U?U.scrollTop:void 0;gn!==i&&(N=s[H],ns=!1,$s=!O&&o.invertSwap||F),R=hf(t,i,s,y,O?1:o.swapThreshold,o.invertedSwapThreshold==null?o.swapThreshold:o.invertedSwapThreshold,$s,gn===i);var z;if(R!==0){var G=ei(X);do G-=R,z=Kt.children[G];while(z&&(ot(z,"display")==="none"||z===dt))}if(R===0||z===i)return P(!1);gn=i,is=R;var et=i.nextElementSibling,V=!1;V=R===1;var W=js(Bt,e,X,n,i,s,t,V);if(W!==!1)return(W===1||W===-1)&&(V=W===1),yo=!0,setTimeout(of,30),S(),V&&!et?e.appendChild(X):i.parentNode.insertBefore(X,V?et:i),U&&bh(U,0,K-U.scrollTop),Kt=X.parentNode,N!==void 0&&!$s&&(Ks=Math.abs(N-ae(i)[H])),k(),P(!0)}if(e.contains(X))return P(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){At(document,"mousemove",this._onTouchMove),At(document,"touchmove",this._onTouchMove),At(document,"pointermove",this._onTouchMove),At(document,"dragover",Ki),At(document,"mousemove",Ki),At(document,"touchmove",Ki)},_offUpEvents:function(){var t=this.el.ownerDocument;At(t,"mouseup",this._onDrop),At(t,"touchend",this._onDrop),At(t,"pointerup",this._onDrop),At(t,"pointercancel",this._onDrop),At(t,"touchcancel",this._onDrop),At(document,"selectstart",this)},_onDrop:function(t){var e=this.el,i=this.options;if(Ve=ei(X),Ni=ei(X,i.draggable),Oe("drop",this,{evt:t}),Kt=X&&X.parentNode,Ve=ei(X),Ni=ei(X,i.draggable),lt.eventCanceled){this._nulling();return}En=!1,$s=!1,ns=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),bo(this.cloneId),bo(this._dragStartId),this.nativeDraggable&&(At(document,"drop",this),At(e,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Zn&&ot(document.body,"user-select",""),ot(X,"transform",""),t&&(Yn&&(t.cancelable&&t.preventDefault(),!i.dropBubble&&t.stopPropagation()),dt&&dt.parentNode&&dt.parentNode.removeChild(dt),(Bt===Kt||be&&be.lastPutMode!=="clone")&&zt&&zt.parentNode&&zt.parentNode.removeChild(zt),X&&(this.nativeDraggable&&At(X,"dragend",this),qr(X),X.style["will-change"]="",Yn&&!En&&Ge(X,be?be.options.ghostClass:this.options.ghostClass,!1),Ge(X,this.options.chosenClass,!1),ke({sortable:this,name:"unchoose",toEl:Kt,newIndex:null,newDraggableIndex:null,originalEvent:t}),Bt!==Kt?(Ve>=0&&(ke({rootEl:Kt,name:"add",toEl:Kt,fromEl:Bt,originalEvent:t}),ke({sortable:this,name:"remove",toEl:Kt,originalEvent:t}),ke({rootEl:Kt,name:"sort",toEl:Kt,fromEl:Bt,originalEvent:t}),ke({sortable:this,name:"sort",toEl:Kt,originalEvent:t})),be&&be.save()):Ve!==Cn&&Ve>=0&&(ke({sortable:this,name:"update",toEl:Kt,originalEvent:t}),ke({sortable:this,name:"sort",toEl:Kt,originalEvent:t})),lt.active&&((Ve==null||Ve===-1)&&(Ve=Cn,Ni=es),ke({sortable:this,name:"end",toEl:Kt,originalEvent:t}),this.save()))),this._nulling()},_nulling:function(){Oe("nulling",this),Bt=X=Kt=dt=Ji=zt=Ys=Ui=Yi=oi=Yn=Ve=Ni=Cn=es=gn=is=be=Us=lt.dragged=lt.ghost=lt.clone=lt.active=null,rr.forEach(function(t){t.checked=!0}),rr.length=Gr=Vr=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":X&&(this._onDragOver(t),rf(t));break;case"selectstart":t.preventDefault();break}},toArray:function(){for(var t=[],e,i=this.el.children,n=0,s=i.length,r=this.options;n<s;n++)e=i[n],li(e,r.draggable,this.el,!1)&&t.push(e.getAttribute(r.dataIdAttr)||df(e));return t},sort:function(t,e){var i={},n=this.el;this.toArray().forEach(function(s,r){var o=n.children[r];li(o,this.options.draggable,n,!1)&&(i[s]=o)},this),e&&this.captureAnimationState(),t.forEach(function(s){i[s]&&(n.removeChild(i[s]),n.appendChild(i[s]))}),e&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,e){return li(t,e||this.options.draggable,this.el,!1)},option:function(t,e){var i=this.options;if(e===void 0)return i[t];var n=Es.modifyOption(this,t,e);typeof n<"u"?i[t]=n:i[t]=e,t==="group"&&Sh(i)},destroy:function(){Oe("destroy",this);var t=this.el;t[$e]=null,At(t,"mousedown",this._onTapStart),At(t,"touchstart",this._onTapStart),At(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(At(t,"dragover",this),At(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),sr.splice(sr.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!Ui){if(Oe("hideClone",this),lt.eventCanceled)return;ot(zt,"display","none"),this.options.removeCloneOnHide&&zt.parentNode&&zt.parentNode.removeChild(zt),Ui=!0}},_showClone:function(t){if(t.lastPutMode!=="clone"){this._hideClone();return}if(Ui){if(Oe("showClone",this),lt.eventCanceled)return;X.parentNode==Bt&&!this.options.group.revertClone?Bt.insertBefore(zt,X):Ji?Bt.insertBefore(zt,Ji):Bt.appendChild(zt),this.options.group.revertClone&&this.animate(X,zt),ot(zt,"display",""),Ui=!1}}};function rf(a){a.dataTransfer&&(a.dataTransfer.dropEffect="move"),a.cancelable&&a.preventDefault()}function js(a,t,e,i,n,s,r,o){var l,d=a[$e],c=d.options.onMove,u;return window.CustomEvent&&!Mi&&!As?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=t,l.from=a,l.dragged=e,l.draggedRect=i,l.related=n||t,l.relatedRect=s||ae(t),l.willInsertAfter=o,l.originalEvent=r,a.dispatchEvent(l),c&&(u=c.call(d,l,r)),u}function qr(a){a.draggable=!1}function of(){yo=!1}function af(a,t,e){var i=ae(Rn(e.el,0,e.options,!0)),n=vh(e.el,e.options,dt),s=10;return t?a.clientX<n.left-s||a.clientY<i.top&&a.clientX<i.right:a.clientY<n.top-s||a.clientY<i.bottom&&a.clientX<i.left}function lf(a,t,e){var i=ae(Go(e.el,e.options.draggable)),n=vh(e.el,e.options,dt),s=10;return t?a.clientX>n.right+s||a.clientY>i.bottom&&a.clientX>i.left:a.clientY>n.bottom+s||a.clientX>i.right&&a.clientY>i.top}function hf(a,t,e,i,n,s,r,o){var l=i?a.clientY:a.clientX,d=i?e.height:e.width,c=i?e.top:e.left,u=i?e.bottom:e.right,p=!1;if(!r){if(o&&Ks<d*n){if(!ns&&(is===1?l>c+d*s/2:l<u-d*s/2)&&(ns=!0),ns)p=!0;else if(is===1?l<c+Ks:l>u-Ks)return-is}else if(l>c+d*(1-n)/2&&l<u-d*(1-n)/2)return cf(t)}return p=p||r,p&&(l<c+d*s/2||l>u-d*s/2)?l>c+d/2?1:-1:0}function cf(a){return ei(X)<ei(a)?1:-1}function df(a){for(var t=a.tagName+a.className+a.src+a.href+a.textContent,e=t.length,i=0;e--;)i+=t.charCodeAt(e);return i.toString(36)}function uf(a){rr.length=0;for(var t=a.getElementsByTagName("input"),e=t.length;e--;){var i=t[e];i.checked&&rr.push(i)}}function Js(a){return setTimeout(a,0)}function bo(a){return clearTimeout(a)}vr&&Et(document,"touchmove",function(a){(lt.active||En)&&a.cancelable&&a.preventDefault()});lt.utils={on:Et,off:At,css:ot,find:mh,is:function(t,e){return!!li(t,e,t,!1)},extend:qu,throttle:yh,closest:li,toggleClass:Ge,clone:wh,index:ei,nextTick:Js,cancelNextTick:bo,detectDirection:Eh,getChild:Rn,expando:$e};lt.get=function(a){return a[$e]};lt.mount=function(){for(var a=arguments.length,t=new Array(a),e=0;e<a;e++)t[e]=arguments[e];t[0].constructor===Array&&(t=t[0]),t.forEach(function(i){if(!i.prototype||!i.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(i));i.utils&&(lt.utils=Si(Si({},lt.utils),i.utils)),Es.mount(i)})};lt.create=function(a,t){return new lt(a,t)};lt.version=Vu;var oe=[],Kn,wo,vo=!1,Xr,Yr,or,Jn;function ff(){function a(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var t in this)t.charAt(0)==="_"&&typeof this[t]=="function"&&(this[t]=this[t].bind(this))}return a.prototype={dragStarted:function(e){var i=e.originalEvent;this.sortable.nativeDraggable?Et(document,"dragover",this._handleAutoScroll):this.options.supportPointer?Et(document,"pointermove",this._handleFallbackAutoScroll):i.touches?Et(document,"touchmove",this._handleFallbackAutoScroll):Et(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var i=e.originalEvent;!this.options.dragOverBubble&&!i.rootEl&&this._handleAutoScroll(i)},drop:function(){this.sortable.nativeDraggable?At(document,"dragover",this._handleAutoScroll):(At(document,"pointermove",this._handleFallbackAutoScroll),At(document,"touchmove",this._handleFallbackAutoScroll),At(document,"mousemove",this._handleFallbackAutoScroll)),Qa(),Qs(),Xu()},nulling:function(){or=wo=Kn=vo=Jn=Xr=Yr=null,oe.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,i){var n=this,s=(e.touches?e.touches[0]:e).clientX,r=(e.touches?e.touches[0]:e).clientY,o=document.elementFromPoint(s,r);if(or=e,i||this.options.forceAutoScrollFallback||As||Mi||Zn){Kr(e,this.options,o,i);var l=Hi(o,!0);vo&&(!Jn||s!==Xr||r!==Yr)&&(Jn&&Qa(),Jn=setInterval(function(){var d=Hi(document.elementFromPoint(s,r),!0);d!==l&&(l=d,Qs()),Kr(e,n.options,d,i)},10),Xr=s,Yr=r)}else{if(!this.options.bubbleScroll||Hi(o,!0)===Ai()){Qs();return}Kr(e,this.options,Hi(o,!1),!1)}}},Li(a,{pluginName:"scroll",initializeByDefault:!0})}function Qs(){oe.forEach(function(a){clearInterval(a.pid)}),oe=[]}function Qa(){clearInterval(Jn)}var Kr=yh(function(a,t,e,i){if(t.scroll){var n=(a.touches?a.touches[0]:a).clientX,s=(a.touches?a.touches[0]:a).clientY,r=t.scrollSensitivity,o=t.scrollSpeed,l=Ai(),d=!1,c;wo!==e&&(wo=e,Qs(),Kn=t.scroll,c=t.scrollFn,Kn===!0&&(Kn=Hi(e,!0)));var u=0,p=Kn;do{var y=p,v=ae(y),w=v.top,x=v.bottom,S=v.left,P=v.right,k=v.width,D=v.height,M=void 0,R=void 0,N=y.scrollWidth,F=y.scrollHeight,O=ot(y),H=y.scrollLeft,U=y.scrollTop;y===l?(M=k<N&&(O.overflowX==="auto"||O.overflowX==="scroll"||O.overflowX==="visible"),R=D<F&&(O.overflowY==="auto"||O.overflowY==="scroll"||O.overflowY==="visible")):(M=k<N&&(O.overflowX==="auto"||O.overflowX==="scroll"),R=D<F&&(O.overflowY==="auto"||O.overflowY==="scroll"));var K=M&&(Math.abs(P-n)<=r&&H+k<N)-(Math.abs(S-n)<=r&&!!H),z=R&&(Math.abs(x-s)<=r&&U+D<F)-(Math.abs(w-s)<=r&&!!U);if(!oe[u])for(var G=0;G<=u;G++)oe[G]||(oe[G]={});(oe[u].vx!=K||oe[u].vy!=z||oe[u].el!==y)&&(oe[u].el=y,oe[u].vx=K,oe[u].vy=z,clearInterval(oe[u].pid),(K!=0||z!=0)&&(d=!0,oe[u].pid=setInterval((function(){i&&this.layer===0&&lt.active._onTouchMove(or);var et=oe[this.layer].vy?oe[this.layer].vy*o:0,V=oe[this.layer].vx?oe[this.layer].vx*o:0;typeof c=="function"&&c.call(lt.dragged.parentNode[$e],V,et,a,or,oe[this.layer].el)!=="continue"||bh(oe[this.layer].el,V,et)}).bind({layer:u}),24))),u++}while(t.bubbleScroll&&p!==l&&(p=Hi(p,!1)));vo=d}},30),_h=function(t){var e=t.originalEvent,i=t.putSortable,n=t.dragEl,s=t.activeSortable,r=t.dispatchSortableEvent,o=t.hideGhostForTarget,l=t.unhideGhostForTarget;if(e){var d=i||s;o();var c=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e,u=document.elementFromPoint(c.clientX,c.clientY);l(),d&&!d.el.contains(u)&&(r("spill"),this.onSpill({dragEl:n,putSortable:i}))}};function Vo(){}Vo.prototype={startIndex:null,dragStart:function(t){var e=t.oldDraggableIndex;this.startIndex=e},onSpill:function(t){var e=t.dragEl,i=t.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var n=Rn(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(e,n):this.sortable.el.appendChild(e),this.sortable.animateAll(),i&&i.animateAll()},drop:_h};Li(Vo,{pluginName:"revertOnSpill"});function Wo(){}Wo.prototype={onSpill:function(t){var e=t.dragEl,i=t.putSortable,n=i||this.sortable;n.captureAnimationState(),e.parentNode&&e.parentNode.removeChild(e),n.animateAll()},drop:_h};Li(Wo,{pluginName:"removeOnSpill"});lt.mount(new ff);lt.mount(Wo,Vo);ji.workerSrc=new URL("/assets/pdf.worker.min-qwK7q_zL.mjs",import.meta.url).toString();const Y={gridView:document.getElementById("grid-view"),toolGrid:document.getElementById("tool-grid"),toolInterface:document.getElementById("tool-interface"),toolContent:document.getElementById("tool-content"),backToGridBtn:document.getElementById("back-to-grid"),loaderModal:document.getElementById("loader-modal"),loaderText:document.getElementById("loader-text"),alertModal:document.getElementById("alert-modal"),alertTitle:document.getElementById("alert-title"),alertMessage:document.getElementById("alert-message"),alertOkBtn:document.getElementById("alert-ok"),heroSection:document.getElementById("hero-section"),featuresSection:document.getElementById("features-section"),toolsHeader:document.getElementById("tools-header"),dividers:document.querySelectorAll(".section-divider"),hideSections:document.querySelectorAll(".hide-section"),shortcutsModal:document.getElementById("shortcuts-modal"),closeShortcutsModalBtn:document.getElementById("close-shortcuts-modal"),shortcutsList:document.getElementById("shortcuts-list"),shortcutSearch:document.getElementById("shortcut-search"),resetShortcutsBtn:document.getElementById("reset-shortcuts-btn"),importShortcutsBtn:document.getElementById("import-shortcuts-btn"),exportShortcutsBtn:document.getElementById("export-shortcuts-btn"),openShortcutsBtn:document.getElementById("open-shortcuts-btn"),warningModal:document.getElementById("warning-modal"),warningTitle:document.getElementById("warning-title"),warningMessage:document.getElementById("warning-message"),warningCancelBtn:document.getElementById("warning-cancel-btn"),warningConfirmBtn:document.getElementById("warning-confirm-btn")},pf=(a="Processing...")=>{Y.loaderText&&(Y.loaderText.textContent=a),Y.loaderModal&&Y.loaderModal.classList.remove("hidden")},gf=()=>{Y.loaderModal&&Y.loaderModal.classList.add("hidden")},mf=(a,t,e="error",i)=>{if(Y.alertTitle&&(Y.alertTitle.textContent=a),Y.alertMessage&&(Y.alertMessage.textContent=t),Y.alertModal&&Y.alertModal.classList.remove("hidden"),Y.alertOkBtn){const n=Y.alertOkBtn.cloneNode(!0);Y.alertOkBtn.replaceWith(n),Y.alertOkBtn=n,n.addEventListener("click",()=>{Th(),i&&i()})}},Th=()=>{Y.alertModal&&Y.alertModal.classList.add("hidden")},yf=a=>{Y.gridView.classList.remove("hidden"),Y.toolInterface.classList.add("hidden"),Y.heroSection.classList.remove("hidden"),Y.featuresSection.classList.remove("hidden"),Y.toolsHeader.classList.remove("hidden"),Y.dividers.forEach(t=>{t.classList.remove("hidden")}),Y.hideSections.forEach(t=>{t.classList.remove("hidden")}),bc()},Op=(a,t)=>{a.textContent="",t.length>0&&t.forEach(e=>{const i=document.createElement("div");i.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const n=document.createElement("span");n.className="truncate font-medium text-gray-200",n.textContent=e.name;const s=document.createElement("span");s.className="flex-shrink-0 ml-4 text-gray-400",s.textContent=Nu(e.size),i.append(n,s),a.appendChild(i)})};class Ne{static STORAGE_KEY="bentopdf_shortcuts";static shortcuts=new Map;static defaultShortcuts=new Map;static getToolId(t){if(t.id)return t.id;if(t.href){const e=t.href.match(/\/([^/]+)\.html$/);return e?e[1]:t.href}return"unknown"}static init(){this.loadDefaults(),this.loadFromStorage(),this.setupGlobalListener()}static loadDefaults(){this.defaultShortcuts.set("merge","mod+shift+m"),this.defaultShortcuts.set("split","mod+shift+s"),this.defaultShortcuts.set("compress","mod+shift+c")}static loadFromStorage(){const t=localStorage.getItem(this.STORAGE_KEY);if(t)try{const e=JSON.parse(t);this.shortcuts=new Map(Object.entries(e));const n=_n.flatMap(s=>s.tools).map(s=>this.getToolId(s));for(const[s,r]of this.shortcuts.entries())n.includes(s)||this.shortcuts.delete(s);this.shortcuts.size!==Object.keys(e).length&&this.save()}catch(e){console.error("Failed to parse shortcuts from local storage",e),this.shortcuts=new Map(this.defaultShortcuts)}else this.shortcuts=new Map(this.defaultShortcuts)}static save(){const t=Object.fromEntries(this.shortcuts);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}static reset(){this.shortcuts=new Map(this.defaultShortcuts),this.save(),window.dispatchEvent(new CustomEvent("shortcuts-updated"))}static getShortcut(t){return this.shortcuts.get(t)}static findToolByShortcut(t){for(const[e,i]of this.shortcuts.entries())if(i===t)return e}static setShortcut(t,e){e?this.shortcuts.set(t,e):this.shortcuts.delete(t),this.save(),window.dispatchEvent(new CustomEvent("shortcuts-updated"))}static getAllShortcuts(){return this.shortcuts}static exportSettings(){const t={};_n.flatMap(s=>s.tools).forEach(s=>{const r=this.getToolId(s);t[r]=this.shortcuts.get(r)||""});const i="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t,null,2)),n=document.createElement("a");n.setAttribute("href",i),n.setAttribute("download","bentopdf_shortcuts.json"),document.body.appendChild(n),n.click(),n.remove()}static importSettings(t){try{const e=JSON.parse(t);for(const i in e)if(typeof e[i]!="string")throw new Error("Invalid shortcut format");return this.shortcuts=new Map(Object.entries(e)),this.save(),window.dispatchEvent(new CustomEvent("shortcuts-updated")),!0}catch(e){return console.error("Import failed",e),!1}}static setupGlobalListener(){window.addEventListener("keydown",t=>{const e=t.target;if(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable)return;const i=[];navigator.userAgent.toUpperCase().includes("MAC")?(t.metaKey&&i.push("mod"),t.ctrlKey&&i.push("ctrl")):(t.ctrlKey||t.metaKey)&&i.push("mod"),t.altKey&&i.push("alt"),t.shiftKey&&i.push("shift");let s=t.key.toLowerCase();t.altKey&&t.code&&(t.code.startsWith("Key")?s=t.code.slice(3).toLowerCase():t.code.startsWith("Digit")&&(s=t.code.slice(5))),["control","shift","alt","meta"].includes(s)||i.push(s);const r=i.join("+");for(const[o,l]of this.shortcuts.entries())if(l===r){t.preventDefault(),t.stopPropagation();const c=_n.flatMap(u=>u.tools).find(u=>this.getToolId(u)===o);if(c&&c.href){const u=c.href;window.location.href=u.startsWith("/")?u:`/${u}`}return}},{capture:!0})}}const ht=a=>typeof a=="string",Vn=()=>{let a,t;const e=new Promise((i,n)=>{a=i,t=n});return e.resolve=a,e.reject=t,e},Za=a=>a==null?"":""+a,bf=(a,t,e)=>{a.forEach(i=>{t[i]&&(e[i]=t[i])})},wf=/###/g,tl=a=>a&&a.indexOf("###")>-1?a.replace(wf,"."):a,el=a=>!a||ht(a),ss=(a,t,e)=>{const i=ht(t)?t.split("."):t;let n=0;for(;n<i.length-1;){if(el(a))return{};const s=tl(i[n]);!a[s]&&e&&(a[s]=new e),Object.prototype.hasOwnProperty.call(a,s)?a=a[s]:a={},++n}return el(a)?{}:{obj:a,k:tl(i[n])}},il=(a,t,e)=>{const{obj:i,k:n}=ss(a,t,Object);if(i!==void 0||t.length===1){i[n]=e;return}let s=t[t.length-1],r=t.slice(0,t.length-1),o=ss(a,r,Object);for(;o.obj===void 0&&r.length;)s=`${r[r.length-1]}.${s}`,r=r.slice(0,r.length-1),o=ss(a,r,Object),o?.obj&&typeof o.obj[`${o.k}.${s}`]<"u"&&(o.obj=void 0);o.obj[`${o.k}.${s}`]=e},vf=(a,t,e,i)=>{const{obj:n,k:s}=ss(a,t,Object);n[s]=n[s]||[],n[s].push(e)},ar=(a,t)=>{const{obj:e,k:i}=ss(a,t);if(e&&Object.prototype.hasOwnProperty.call(e,i))return e[i]},Af=(a,t,e)=>{const i=ar(a,e);return i!==void 0?i:ar(t,e)},Ph=(a,t,e)=>{for(const i in t)i!=="__proto__"&&i!=="constructor"&&(i in a?ht(a[i])||a[i]instanceof String||ht(t[i])||t[i]instanceof String?e&&(a[i]=t[i]):Ph(a[i],t[i],e):a[i]=t[i]);return a},mn=a=>a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var Ef={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const Sf=a=>ht(a)?a.replace(/[&<>"'\/]/g,t=>Ef[t]):a;class xf{constructor(t){this.capacity=t,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(t){const e=this.regExpMap.get(t);if(e!==void 0)return e;const i=new RegExp(t);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(t,i),this.regExpQueue.push(t),i}}const Cf=[" ",",","?","!",";"],_f=new xf(20),Tf=(a,t,e)=>{t=t||"",e=e||"";const i=Cf.filter(r=>t.indexOf(r)<0&&e.indexOf(r)<0);if(i.length===0)return!0;const n=_f.getRegExp(`(${i.map(r=>r==="?"?"\\?":r).join("|")})`);let s=!n.test(a);if(!s){const r=a.indexOf(e);r>0&&!n.test(a.substring(0,r))&&(s=!0)}return s},Ao=(a,t,e=".")=>{if(!a)return;if(a[t])return Object.prototype.hasOwnProperty.call(a,t)?a[t]:void 0;const i=t.split(e);let n=a;for(let s=0;s<i.length;){if(!n||typeof n!="object")return;let r,o="";for(let l=s;l<i.length;++l)if(l!==s&&(o+=e),o+=i[l],r=n[o],r!==void 0){if(["string","number","boolean"].indexOf(typeof r)>-1&&l<i.length-1)continue;s+=l-s+1;break}n=r}return n},ds=a=>a?.replace("_","-"),Pf={type:"logger",log(a){this.output("log",a)},warn(a){this.output("warn",a)},error(a){this.output("error",a)},output(a,t){console?.[a]?.apply?.(console,t)}};class lr{constructor(t,e={}){this.init(t,e)}init(t,e={}){this.prefix=e.prefix||"i18next:",this.logger=t||Pf,this.options=e,this.debug=e.debug}log(...t){return this.forward(t,"log","",!0)}warn(...t){return this.forward(t,"warn","",!0)}error(...t){return this.forward(t,"error","")}deprecate(...t){return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(t,e,i,n){return n&&!this.debug?null:(ht(t[0])&&(t[0]=`${i}${this.prefix} ${t[0]}`),this.logger[e](t))}create(t){return new lr(this.logger,{prefix:`${this.prefix}:${t}:`,...this.options})}clone(t){return t=t||this.options,t.prefix=t.prefix||this.prefix,new lr(this.logger,t)}}var vi=new lr;class Ar{constructor(){this.observers={}}on(t,e){return t.split(" ").forEach(i=>{this.observers[i]||(this.observers[i]=new Map);const n=this.observers[i].get(e)||0;this.observers[i].set(e,n+1)}),this}off(t,e){if(this.observers[t]){if(!e){delete this.observers[t];return}this.observers[t].delete(e)}}emit(t,...e){this.observers[t]&&Array.from(this.observers[t].entries()).forEach(([n,s])=>{for(let r=0;r<s;r++)n(...e)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([n,s])=>{for(let r=0;r<s;r++)n.apply(n,[t,...e])})}}class nl extends Ar{constructor(t,e={ns:["translation"],defaultNS:"translation"}){super(),this.data=t||{},this.options=e,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)}removeNamespaces(t){const e=this.options.ns.indexOf(t);e>-1&&this.options.ns.splice(e,1)}getResource(t,e,i,n={}){const s=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,r=n.ignoreJSONStructure!==void 0?n.ignoreJSONStructure:this.options.ignoreJSONStructure;let o;t.indexOf(".")>-1?o=t.split("."):(o=[t,e],i&&(Array.isArray(i)?o.push(...i):ht(i)&&s?o.push(...i.split(s)):o.push(i)));const l=ar(this.data,o);return!l&&!e&&!i&&t.indexOf(".")>-1&&(t=o[0],e=o[1],i=o.slice(2).join(".")),l||!r||!ht(i)?l:Ao(this.data?.[t]?.[e],i,s)}addResource(t,e,i,n,s={silent:!1}){const r=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator;let o=[t,e];i&&(o=o.concat(r?i.split(r):i)),t.indexOf(".")>-1&&(o=t.split("."),n=e,e=o[1]),this.addNamespaces(e),il(this.data,o,n),s.silent||this.emit("added",t,e,i,n)}addResources(t,e,i,n={silent:!1}){for(const s in i)(ht(i[s])||Array.isArray(i[s]))&&this.addResource(t,e,s,i[s],{silent:!0});n.silent||this.emit("added",t,e,i)}addResourceBundle(t,e,i,n,s,r={silent:!1,skipCopy:!1}){let o=[t,e];t.indexOf(".")>-1&&(o=t.split("."),n=i,i=e,e=o[1]),this.addNamespaces(e);let l=ar(this.data,o)||{};r.skipCopy||(i=JSON.parse(JSON.stringify(i))),n?Ph(l,i,s):l={...l,...i},il(this.data,o,l),r.silent||this.emit("added",t,e,i)}removeResourceBundle(t,e){this.hasResourceBundle(t,e)&&delete this.data[t][e],this.removeNamespaces(e),this.emit("removed",t,e)}hasResourceBundle(t,e){return this.getResource(t,e)!==void 0}getResourceBundle(t,e){return e||(e=this.options.defaultNS),this.getResource(t,e)}getDataByLanguage(t){return this.data[t]}hasLanguageSomeTranslations(t){const e=this.getDataByLanguage(t);return!!(e&&Object.keys(e)||[]).find(n=>e[n]&&Object.keys(e[n]).length>0)}toJSON(){return this.data}}var kh={processors:{},addPostProcessor(a){this.processors[a.name]=a},handle(a,t,e,i,n){return a.forEach(s=>{t=this.processors[s]?.process(t,e,i,n)??t}),t}};const Dh=Symbol("i18next/PATH_KEY");function kf(){const a=[],t=Object.create(null);let e;return t.get=(i,n)=>(e?.revoke?.(),n===Dh?a:(a.push(n),e=Proxy.revocable(i,t),e.proxy)),Proxy.revocable(Object.create(null),t).proxy}function Eo(a,t){const{[Dh]:e}=a(kf());return e.join(t?.keySeparator??".")}const sl={},Jr=a=>!ht(a)&&typeof a!="boolean"&&typeof a!="number";class hr extends Ar{constructor(t,e={}){super(),bf(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],t,this),this.options=e,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=vi.create("translator")}changeLanguage(t){t&&(this.language=t)}exists(t,e={interpolation:{}}){const i={...e};if(t==null)return!1;const n=this.resolve(t,i);if(n?.res===void 0)return!1;const s=Jr(n.res);return!(i.returnObjects===!1&&s)}extractFromKey(t,e){let i=e.nsSeparator!==void 0?e.nsSeparator:this.options.nsSeparator;i===void 0&&(i=":");const n=e.keySeparator!==void 0?e.keySeparator:this.options.keySeparator;let s=e.ns||this.options.defaultNS||[];const r=i&&t.indexOf(i)>-1,o=!this.options.userDefinedKeySeparator&&!e.keySeparator&&!this.options.userDefinedNsSeparator&&!e.nsSeparator&&!Tf(t,i,n);if(r&&!o){const l=t.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:t,namespaces:ht(s)?[s]:s};const d=t.split(i);(i!==n||i===n&&this.options.ns.indexOf(d[0])>-1)&&(s=d.shift()),t=d.join(n)}return{key:t,namespaces:ht(s)?[s]:s}}translate(t,e,i){let n=typeof e=="object"?{...e}:e;if(typeof n!="object"&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),typeof n=="object"&&(n={...n}),n||(n={}),t==null)return"";typeof t=="function"&&(t=Eo(t,{...this.options,...n})),Array.isArray(t)||(t=[String(t)]);const s=n.returnDetails!==void 0?n.returnDetails:this.options.returnDetails,r=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,{key:o,namespaces:l}=this.extractFromKey(t[t.length-1],n),d=l[l.length-1];let c=n.nsSeparator!==void 0?n.nsSeparator:this.options.nsSeparator;c===void 0&&(c=":");const u=n.lng||this.language,p=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(u?.toLowerCase()==="cimode")return p?s?{res:`${d}${c}${o}`,usedKey:o,exactUsedKey:o,usedLng:u,usedNS:d,usedParams:this.getUsedParamsDetails(n)}:`${d}${c}${o}`:s?{res:o,usedKey:o,exactUsedKey:o,usedLng:u,usedNS:d,usedParams:this.getUsedParamsDetails(n)}:o;const y=this.resolve(t,n);let v=y?.res;const w=y?.usedKey||o,x=y?.exactUsedKey||o,S=["[object Number]","[object Function]","[object RegExp]"],P=n.joinArrays!==void 0?n.joinArrays:this.options.joinArrays,k=!this.i18nFormat||this.i18nFormat.handleAsObject,D=n.count!==void 0&&!ht(n.count),M=hr.hasDefaultValue(n),R=D?this.pluralResolver.getSuffix(u,n.count,n):"",N=n.ordinal&&D?this.pluralResolver.getSuffix(u,n.count,{ordinal:!1}):"",F=D&&!n.ordinal&&n.count===0,O=F&&n[`defaultValue${this.options.pluralSeparator}zero`]||n[`defaultValue${R}`]||n[`defaultValue${N}`]||n.defaultValue;let H=v;k&&!v&&M&&(H=O);const U=Jr(H),K=Object.prototype.toString.apply(H);if(k&&H&&U&&S.indexOf(K)<0&&!(ht(P)&&Array.isArray(H))){if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const z=this.options.returnedObjectHandler?this.options.returnedObjectHandler(w,H,{...n,ns:l}):`key '${o} (${this.language})' returned an object instead of string.`;return s?(y.res=z,y.usedParams=this.getUsedParamsDetails(n),y):z}if(r){const z=Array.isArray(H),G=z?[]:{},et=z?x:w;for(const V in H)if(Object.prototype.hasOwnProperty.call(H,V)){const W=`${et}${r}${V}`;M&&!v?G[V]=this.translate(W,{...n,defaultValue:Jr(O)?O[V]:void 0,joinArrays:!1,ns:l}):G[V]=this.translate(W,{...n,joinArrays:!1,ns:l}),G[V]===W&&(G[V]=H[V])}v=G}}else if(k&&ht(P)&&Array.isArray(v))v=v.join(P),v&&(v=this.extendTranslation(v,t,n,i));else{let z=!1,G=!1;!this.isValidLookup(v)&&M&&(z=!0,v=O),this.isValidLookup(v)||(G=!0,v=o);const V=(n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&G?void 0:v,W=M&&O!==v&&this.options.updateMissing;if(G||z||W){if(this.logger.log(W?"updateKey":"missingKey",u,d,o,W?O:v),r){const pt=this.resolve(o,{...n,keySeparator:!1});pt&&pt.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let Q=[];const Ct=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if(this.options.saveMissingTo==="fallback"&&Ct&&Ct[0])for(let pt=0;pt<Ct.length;pt++)Q.push(Ct[pt]);else this.options.saveMissingTo==="all"?Q=this.languageUtils.toResolveHierarchy(n.lng||this.language):Q.push(n.lng||this.language);const Mt=(pt,gt,bt)=>{const ct=M&&bt!==v?bt:V;this.options.missingKeyHandler?this.options.missingKeyHandler(pt,d,gt,ct,W,n):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(pt,d,gt,ct,W,n),this.emit("missingKey",pt,d,gt,v)};this.options.saveMissing&&(this.options.saveMissingPlurals&&D?Q.forEach(pt=>{const gt=this.pluralResolver.getSuffixes(pt,n);F&&n[`defaultValue${this.options.pluralSeparator}zero`]&&gt.indexOf(`${this.options.pluralSeparator}zero`)<0&&gt.push(`${this.options.pluralSeparator}zero`),gt.forEach(bt=>{Mt([pt],o+bt,n[`defaultValue${bt}`]||O)})}):Mt(Q,o,O))}v=this.extendTranslation(v,t,n,y,i),G&&v===o&&this.options.appendNamespaceToMissingKey&&(v=`${d}${c}${o}`),(G||z)&&this.options.parseMissingKeyHandler&&(v=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${d}${c}${o}`:o,z?v:void 0,n))}return s?(y.res=v,y.usedParams=this.getUsedParamsDetails(n),y):v}extendTranslation(t,e,i,n,s){if(this.i18nFormat?.parse)t=this.i18nFormat.parse(t,{...this.options.interpolation.defaultVariables,...i},i.lng||this.language||n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!i.skipInterpolation){i.interpolation&&this.interpolator.init({...i,interpolation:{...this.options.interpolation,...i.interpolation}});const l=ht(t)&&(i?.interpolation?.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let d;if(l){const u=t.match(this.interpolator.nestingRegexp);d=u&&u.length}let c=i.replace&&!ht(i.replace)?i.replace:i;if(this.options.interpolation.defaultVariables&&(c={...this.options.interpolation.defaultVariables,...c}),t=this.interpolator.interpolate(t,c,i.lng||this.language||n.usedLng,i),l){const u=t.match(this.interpolator.nestingRegexp),p=u&&u.length;d<p&&(i.nest=!1)}!i.lng&&n&&n.res&&(i.lng=this.language||n.usedLng),i.nest!==!1&&(t=this.interpolator.nest(t,(...u)=>s?.[0]===u[0]&&!i.context?(this.logger.warn(`It seems you are nesting recursively key: ${u[0]} in key: ${e[0]}`),null):this.translate(...u,e),i)),i.interpolation&&this.interpolator.reset()}const r=i.postProcess||this.options.postProcess,o=ht(r)?[r]:r;return t!=null&&o?.length&&i.applyPostProcessor!==!1&&(t=kh.handle(o,t,e,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...n,usedParams:this.getUsedParamsDetails(i)},...i}:i,this)),t}resolve(t,e={}){let i,n,s,r,o;return ht(t)&&(t=[t]),t.forEach(l=>{if(this.isValidLookup(i))return;const d=this.extractFromKey(l,e),c=d.key;n=c;let u=d.namespaces;this.options.fallbackNS&&(u=u.concat(this.options.fallbackNS));const p=e.count!==void 0&&!ht(e.count),y=p&&!e.ordinal&&e.count===0,v=e.context!==void 0&&(ht(e.context)||typeof e.context=="number")&&e.context!=="",w=e.lngs?e.lngs:this.languageUtils.toResolveHierarchy(e.lng||this.language,e.fallbackLng);u.forEach(x=>{this.isValidLookup(i)||(o=x,!sl[`${w[0]}-${x}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(o)&&(sl[`${w[0]}-${x}`]=!0,this.logger.warn(`key "${n}" for languages "${w.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),w.forEach(S=>{if(this.isValidLookup(i))return;r=S;const P=[c];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(P,c,S,x,e);else{let D;p&&(D=this.pluralResolver.getSuffix(S,e.count,e));const M=`${this.options.pluralSeparator}zero`,R=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(p&&(e.ordinal&&D.indexOf(R)===0&&P.push(c+D.replace(R,this.options.pluralSeparator)),P.push(c+D),y&&P.push(c+M)),v){const N=`${c}${this.options.contextSeparator||"_"}${e.context}`;P.push(N),p&&(e.ordinal&&D.indexOf(R)===0&&P.push(N+D.replace(R,this.options.pluralSeparator)),P.push(N+D),y&&P.push(N+M))}}let k;for(;k=P.pop();)this.isValidLookup(i)||(s=k,i=this.getResource(S,x,k,e))}))})}),{res:i,usedKey:n,exactUsedKey:s,usedLng:r,usedNS:o}}isValidLookup(t){return t!==void 0&&!(!this.options.returnNull&&t===null)&&!(!this.options.returnEmptyString&&t==="")}getResource(t,e,i,n={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(t,e,i,n):this.resourceStore.getResource(t,e,i,n)}getUsedParamsDetails(t={}){const e=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],i=t.replace&&!ht(t.replace);let n=i?t.replace:t;if(i&&typeof t.count<"u"&&(n.count=t.count),this.options.interpolation.defaultVariables&&(n={...this.options.interpolation.defaultVariables,...n}),!i){n={...n};for(const s of e)delete n[s]}return n}static hasDefaultValue(t){const e="defaultValue";for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e===i.substring(0,e.length)&&t[i]!==void 0)return!0;return!1}}class rl{constructor(t){this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=vi.create("languageUtils")}getScriptPartFromCode(t){if(t=ds(t),!t||t.indexOf("-")<0)return null;const e=t.split("-");return e.length===2||(e.pop(),e[e.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(e.join("-"))}getLanguagePartFromCode(t){if(t=ds(t),!t||t.indexOf("-")<0)return t;const e=t.split("-");return this.formatLanguageCode(e[0])}formatLanguageCode(t){if(ht(t)&&t.indexOf("-")>-1){let e;try{e=Intl.getCanonicalLocales(t)[0]}catch{}return e&&this.options.lowerCaseLng&&(e=e.toLowerCase()),e||(this.options.lowerCaseLng?t.toLowerCase():t)}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}isSupportedCode(t){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}getBestMatchFromCodes(t){if(!t)return null;let e;return t.forEach(i=>{if(e)return;const n=this.formatLanguageCode(i);(!this.options.supportedLngs||this.isSupportedCode(n))&&(e=n)}),!e&&this.options.supportedLngs&&t.forEach(i=>{if(e)return;const n=this.getScriptPartFromCode(i);if(this.isSupportedCode(n))return e=n;const s=this.getLanguagePartFromCode(i);if(this.isSupportedCode(s))return e=s;e=this.options.supportedLngs.find(r=>{if(r===s)return r;if(!(r.indexOf("-")<0&&s.indexOf("-")<0)&&(r.indexOf("-")>0&&s.indexOf("-")<0&&r.substring(0,r.indexOf("-"))===s||r.indexOf(s)===0&&s.length>1))return r})}),e||(e=this.getFallbackCodes(this.options.fallbackLng)[0]),e}getFallbackCodes(t,e){if(!t)return[];if(typeof t=="function"&&(t=t(e)),ht(t)&&(t=[t]),Array.isArray(t))return t;if(!e)return t.default||[];let i=t[e];return i||(i=t[this.getScriptPartFromCode(e)]),i||(i=t[this.formatLanguageCode(e)]),i||(i=t[this.getLanguagePartFromCode(e)]),i||(i=t.default),i||[]}toResolveHierarchy(t,e){const i=this.getFallbackCodes((e===!1?[]:e)||this.options.fallbackLng||[],t),n=[],s=r=>{r&&(this.isSupportedCode(r)?n.push(r):this.logger.warn(`rejecting language code not found in supportedLngs: ${r}`))};return ht(t)&&(t.indexOf("-")>-1||t.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&s(this.formatLanguageCode(t)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&s(this.getScriptPartFromCode(t)),this.options.load!=="currentOnly"&&s(this.getLanguagePartFromCode(t))):ht(t)&&s(this.formatLanguageCode(t)),i.forEach(r=>{n.indexOf(r)<0&&s(this.formatLanguageCode(r))}),n}}const ol={zero:0,one:1,two:2,few:3,many:4,other:5},al={select:a=>a===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class Df{constructor(t,e={}){this.languageUtils=t,this.options=e,this.logger=vi.create("pluralResolver"),this.pluralRulesCache={}}addRule(t,e){this.rules[t]=e}clearCache(){this.pluralRulesCache={}}getRule(t,e={}){const i=ds(t==="dev"?"en":t),n=e.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:i,type:n});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];let r;try{r=new Intl.PluralRules(i,{type:n})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),al;if(!t.match(/-|_/))return al;const l=this.languageUtils.getLanguagePartFromCode(t);r=this.getRule(l,e)}return this.pluralRulesCache[s]=r,r}needsPlural(t,e={}){let i=this.getRule(t,e);return i||(i=this.getRule("dev",e)),i?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(t,e,i={}){return this.getSuffixes(t,i).map(n=>`${e}${n}`)}getSuffixes(t,e={}){let i=this.getRule(t,e);return i||(i=this.getRule("dev",e)),i?i.resolvedOptions().pluralCategories.sort((n,s)=>ol[n]-ol[s]).map(n=>`${this.options.prepend}${e.ordinal?`ordinal${this.options.prepend}`:""}${n}`):[]}getSuffix(t,e,i={}){const n=this.getRule(t,i);return n?`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${n.select(e)}`:(this.logger.warn(`no plural rule found for: ${t}`),this.getSuffix("dev",e,i))}}const ll=(a,t,e,i=".",n=!0)=>{let s=Af(a,t,e);return!s&&n&&ht(e)&&(s=Ao(a,e,i),s===void 0&&(s=Ao(t,e,i))),s},Qr=a=>a.replace(/\$/g,"$$$$");class hl{constructor(t={}){this.logger=vi.create("interpolator"),this.options=t,this.format=t?.interpolation?.format||(e=>e),this.init(t)}init(t={}){t.interpolation||(t.interpolation={escapeValue:!0});const{escape:e,escapeValue:i,useRawValueToEscape:n,prefix:s,prefixEscaped:r,suffix:o,suffixEscaped:l,formatSeparator:d,unescapeSuffix:c,unescapePrefix:u,nestingPrefix:p,nestingPrefixEscaped:y,nestingSuffix:v,nestingSuffixEscaped:w,nestingOptionsSeparator:x,maxReplaces:S,alwaysFormat:P}=t.interpolation;this.escape=e!==void 0?e:Sf,this.escapeValue=i!==void 0?i:!0,this.useRawValueToEscape=n!==void 0?n:!1,this.prefix=s?mn(s):r||"{{",this.suffix=o?mn(o):l||"}}",this.formatSeparator=d||",",this.unescapePrefix=c?"":u||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=p?mn(p):y||mn("$t("),this.nestingSuffix=v?mn(v):w||mn(")"),this.nestingOptionsSeparator=x||",",this.maxReplaces=S||1e3,this.alwaysFormat=P!==void 0?P:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const t=(e,i)=>e?.source===i?(e.lastIndex=0,e):new RegExp(i,"g");this.regexp=t(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=t(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=t(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(t,e,i,n){let s,r,o;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},d=y=>{if(y.indexOf(this.formatSeparator)<0){const S=ll(e,l,y,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(S,void 0,i,{...n,...e,interpolationkey:y}):S}const v=y.split(this.formatSeparator),w=v.shift().trim(),x=v.join(this.formatSeparator).trim();return this.format(ll(e,l,w,this.options.keySeparator,this.options.ignoreJSONStructure),x,i,{...n,...e,interpolationkey:w})};this.resetRegExp();const c=n?.missingInterpolationHandler||this.options.missingInterpolationHandler,u=n?.interpolation?.skipOnVariables!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:y=>Qr(y)},{regex:this.regexp,safeValue:y=>this.escapeValue?Qr(this.escape(y)):Qr(y)}].forEach(y=>{for(o=0;s=y.regex.exec(t);){const v=s[1].trim();if(r=d(v),r===void 0)if(typeof c=="function"){const x=c(t,s,n);r=ht(x)?x:""}else if(n&&Object.prototype.hasOwnProperty.call(n,v))r="";else if(u){r=s[0];continue}else this.logger.warn(`missed to pass in variable ${v} for interpolating ${t}`),r="";else!ht(r)&&!this.useRawValueToEscape&&(r=Za(r));const w=y.safeValue(r);if(t=t.replace(s[0],w),u?(y.regex.lastIndex+=r.length,y.regex.lastIndex-=s[0].length):y.regex.lastIndex=0,o++,o>=this.maxReplaces)break}}),t}nest(t,e,i={}){let n,s,r;const o=(l,d)=>{const c=this.nestingOptionsSeparator;if(l.indexOf(c)<0)return l;const u=l.split(new RegExp(`${c}[ ]*{`));let p=`{${u[1]}`;l=u[0],p=this.interpolate(p,r);const y=p.match(/'/g),v=p.match(/"/g);((y?.length??0)%2===0&&!v||v.length%2!==0)&&(p=p.replace(/'/g,'"'));try{r=JSON.parse(p),d&&(r={...d,...r})}catch(w){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,w),`${l}${c}${p}`}return r.defaultValue&&r.defaultValue.indexOf(this.prefix)>-1&&delete r.defaultValue,l};for(;n=this.nestingRegexp.exec(t);){let l=[];r={...i},r=r.replace&&!ht(r.replace)?r.replace:r,r.applyPostProcessor=!1,delete r.defaultValue;const d=/{.*}/.test(n[1])?n[1].lastIndexOf("}")+1:n[1].indexOf(this.formatSeparator);if(d!==-1&&(l=n[1].slice(d).split(this.formatSeparator).map(c=>c.trim()).filter(Boolean),n[1]=n[1].slice(0,d)),s=e(o.call(this,n[1].trim(),r),r),s&&n[0]===t&&!ht(s))return s;ht(s)||(s=Za(s)),s||(this.logger.warn(`missed to resolve ${n[1]} for nesting ${t}`),s=""),l.length&&(s=l.reduce((c,u)=>this.format(c,u,i.lng,{...i,interpolationkey:n[1].trim()}),s.trim())),t=t.replace(n[0],s),this.regexp.lastIndex=0}return t}}const Lf=a=>{let t=a.toLowerCase().trim();const e={};if(a.indexOf("(")>-1){const i=a.split("(");t=i[0].toLowerCase().trim();const n=i[1].substring(0,i[1].length-1);t==="currency"&&n.indexOf(":")<0?e.currency||(e.currency=n.trim()):t==="relativetime"&&n.indexOf(":")<0?e.range||(e.range=n.trim()):n.split(";").forEach(r=>{if(r){const[o,...l]=r.split(":"),d=l.join(":").trim().replace(/^'+|'+$/g,""),c=o.trim();e[c]||(e[c]=d),d==="false"&&(e[c]=!1),d==="true"&&(e[c]=!0),isNaN(d)||(e[c]=parseInt(d,10))}})}return{formatName:t,formatOptions:e}},cl=a=>{const t={};return(e,i,n)=>{let s=n;n&&n.interpolationkey&&n.formatParams&&n.formatParams[n.interpolationkey]&&n[n.interpolationkey]&&(s={...s,[n.interpolationkey]:void 0});const r=i+JSON.stringify(s);let o=t[r];return o||(o=a(ds(i),n),t[r]=o),o(e)}},If=a=>(t,e,i)=>a(ds(e),i)(t);class Mf{constructor(t={}){this.logger=vi.create("formatter"),this.options=t,this.init(t)}init(t,e={interpolation:{}}){this.formatSeparator=e.interpolation.formatSeparator||",";const i=e.cacheInBuiltFormats?cl:If;this.formats={number:i((n,s)=>{const r=new Intl.NumberFormat(n,{...s});return o=>r.format(o)}),currency:i((n,s)=>{const r=new Intl.NumberFormat(n,{...s,style:"currency"});return o=>r.format(o)}),datetime:i((n,s)=>{const r=new Intl.DateTimeFormat(n,{...s});return o=>r.format(o)}),relativetime:i((n,s)=>{const r=new Intl.RelativeTimeFormat(n,{...s});return o=>r.format(o,s.range||"day")}),list:i((n,s)=>{const r=new Intl.ListFormat(n,{...s});return o=>r.format(o)})}}add(t,e){this.formats[t.toLowerCase().trim()]=e}addCached(t,e){this.formats[t.toLowerCase().trim()]=cl(e)}format(t,e,i,n={}){const s=e.split(this.formatSeparator);if(s.length>1&&s[0].indexOf("(")>1&&s[0].indexOf(")")<0&&s.find(o=>o.indexOf(")")>-1)){const o=s.findIndex(l=>l.indexOf(")")>-1);s[0]=[s[0],...s.splice(1,o)].join(this.formatSeparator)}return s.reduce((o,l)=>{const{formatName:d,formatOptions:c}=Lf(l);if(this.formats[d]){let u=o;try{const p=n?.formatParams?.[n.interpolationkey]||{},y=p.locale||p.lng||n.locale||n.lng||i;u=this.formats[d](o,y,{...c,...n,...p})}catch(p){this.logger.warn(p)}return u}else this.logger.warn(`there was no format function for ${d}`);return o},t)}}const Rf=(a,t)=>{a.pending[t]!==void 0&&(delete a.pending[t],a.pendingCount--)};class Ff extends Ar{constructor(t,e,i,n={}){super(),this.backend=t,this.store=e,this.services=i,this.languageUtils=i.languageUtils,this.options=n,this.logger=vi.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=n.maxParallelReads||10,this.readingCalls=0,this.maxRetries=n.maxRetries>=0?n.maxRetries:5,this.retryTimeout=n.retryTimeout>=1?n.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(i,n.backend,n)}queueLoad(t,e,i,n){const s={},r={},o={},l={};return t.forEach(d=>{let c=!0;e.forEach(u=>{const p=`${d}|${u}`;!i.reload&&this.store.hasResourceBundle(d,u)?this.state[p]=2:this.state[p]<0||(this.state[p]===1?r[p]===void 0&&(r[p]=!0):(this.state[p]=1,c=!1,r[p]===void 0&&(r[p]=!0),s[p]===void 0&&(s[p]=!0),l[u]===void 0&&(l[u]=!0)))}),c||(o[d]=!0)}),(Object.keys(s).length||Object.keys(r).length)&&this.queue.push({pending:r,pendingCount:Object.keys(r).length,loaded:{},errors:[],callback:n}),{toLoad:Object.keys(s),pending:Object.keys(r),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(l)}}loaded(t,e,i){const n=t.split("|"),s=n[0],r=n[1];e&&this.emit("failedLoading",s,r,e),!e&&i&&this.store.addResourceBundle(s,r,i,void 0,void 0,{skipCopy:!0}),this.state[t]=e?-1:2,e&&i&&(this.state[t]=0);const o={};this.queue.forEach(l=>{vf(l.loaded,[s],r),Rf(l,t),e&&l.errors.push(e),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(d=>{o[d]||(o[d]={});const c=l.loaded[d];c.length&&c.forEach(u=>{o[d][u]===void 0&&(o[d][u]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(l=>!l.done)}read(t,e,i,n=0,s=this.retryTimeout,r){if(!t.length)return r(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:t,ns:e,fcName:i,tried:n,wait:s,callback:r});return}this.readingCalls++;const o=(d,c)=>{if(this.readingCalls--,this.waitingReads.length>0){const u=this.waitingReads.shift();this.read(u.lng,u.ns,u.fcName,u.tried,u.wait,u.callback)}if(d&&c&&n<this.maxRetries){setTimeout(()=>{this.read.call(this,t,e,i,n+1,s*2,r)},s);return}r(d,c)},l=this.backend[i].bind(this.backend);if(l.length===2){try{const d=l(t,e);d&&typeof d.then=="function"?d.then(c=>o(null,c)).catch(o):o(null,d)}catch(d){o(d)}return}return l(t,e,o)}prepareLoading(t,e,i={},n){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();ht(t)&&(t=this.languageUtils.toResolveHierarchy(t)),ht(e)&&(e=[e]);const s=this.queueLoad(t,e,i,n);if(!s.toLoad.length)return s.pending.length||n(),null;s.toLoad.forEach(r=>{this.loadOne(r)})}load(t,e,i){this.prepareLoading(t,e,{},i)}reload(t,e,i){this.prepareLoading(t,e,{reload:!0},i)}loadOne(t,e=""){const i=t.split("|"),n=i[0],s=i[1];this.read(n,s,"read",void 0,void 0,(r,o)=>{r&&this.logger.warn(`${e}loading namespace ${s} for language ${n} failed`,r),!r&&o&&this.logger.log(`${e}loaded namespace ${s} for language ${n}`,o),this.loaded(t,r,o)})}saveMissing(t,e,i,n,s,r={},o=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(e)){this.logger.warn(`did not save key "${i}" as the namespace "${e}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(i==null||i==="")){if(this.backend?.create){const l={...r,isUpdate:s},d=this.backend.create.bind(this.backend);if(d.length<6)try{let c;d.length===5?c=d(t,e,i,n,l):c=d(t,e,i,n),c&&typeof c.then=="function"?c.then(u=>o(null,u)).catch(o):o(null,c)}catch(c){o(c)}else d(t,e,i,n,o,l)}!t||!t[0]||this.store.addResource(t[0],e,i,n)}}}const dl=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:a=>{let t={};if(typeof a[1]=="object"&&(t=a[1]),ht(a[1])&&(t.defaultValue=a[1]),ht(a[2])&&(t.tDescription=a[2]),typeof a[2]=="object"||typeof a[3]=="object"){const e=a[3]||a[2];Object.keys(e).forEach(i=>{t[i]=e[i]})}return t},interpolation:{escapeValue:!0,format:a=>a,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),ul=a=>(ht(a.ns)&&(a.ns=[a.ns]),ht(a.fallbackLng)&&(a.fallbackLng=[a.fallbackLng]),ht(a.fallbackNS)&&(a.fallbackNS=[a.fallbackNS]),a.supportedLngs?.indexOf?.("cimode")<0&&(a.supportedLngs=a.supportedLngs.concat(["cimode"])),typeof a.initImmediate=="boolean"&&(a.initAsync=a.initImmediate),a),zs=()=>{},Of=a=>{Object.getOwnPropertyNames(Object.getPrototypeOf(a)).forEach(e=>{typeof a[e]=="function"&&(a[e]=a[e].bind(a))})};class rs extends Ar{constructor(t={},e){if(super(),this.options=ul(t),this.services={},this.logger=vi,this.modules={external:[]},Of(this),e&&!this.isInitialized&&!t.isClone){if(!this.options.initAsync)return this.init(t,e),this;setTimeout(()=>{this.init(t,e)},0)}}init(t={},e){this.isInitializing=!0,typeof t=="function"&&(e=t,t={}),t.defaultNS==null&&t.ns&&(ht(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const i=dl();this.options={...i,...this.options,...ul(t)},this.options.interpolation={...i.interpolation,...this.options.interpolation},t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator),typeof this.options.overloadTranslationOptionHandler!="function"&&(this.options.overloadTranslationOptionHandler=i.overloadTranslationOptionHandler);const n=d=>d?typeof d=="function"?new d:d:null;if(!this.options.isClone){this.modules.logger?vi.init(n(this.modules.logger),this.options):vi.init(null,this.options);let d;this.modules.formatter?d=this.modules.formatter:d=Mf;const c=new rl(this.options);this.store=new nl(this.options.resources,this.options);const u=this.services;u.logger=vi,u.resourceStore=this.store,u.languageUtils=c,u.pluralResolver=new Df(c,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==i.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),d&&(!this.options.interpolation.format||this.options.interpolation.format===i.interpolation.format)&&(u.formatter=n(d),u.formatter.init&&u.formatter.init(u,this.options),this.options.interpolation.format=u.formatter.format.bind(u.formatter)),u.interpolator=new hl(this.options),u.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},u.backendConnector=new Ff(n(this.modules.backend),u.resourceStore,u,this.options),u.backendConnector.on("*",(y,...v)=>{this.emit(y,...v)}),this.modules.languageDetector&&(u.languageDetector=n(this.modules.languageDetector),u.languageDetector.init&&u.languageDetector.init(u,this.options.detection,this.options)),this.modules.i18nFormat&&(u.i18nFormat=n(this.modules.i18nFormat),u.i18nFormat.init&&u.i18nFormat.init(this)),this.translator=new hr(this.services,this.options),this.translator.on("*",(y,...v)=>{this.emit(y,...v)}),this.modules.external.forEach(y=>{y.init&&y.init(this)})}if(this.format=this.options.interpolation.format,e||(e=zs),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const d=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);d.length>0&&d[0]!=="dev"&&(this.options.lng=d[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(d=>{this[d]=(...c)=>this.store[d](...c)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(d=>{this[d]=(...c)=>(this.store[d](...c),this)});const o=Vn(),l=()=>{const d=(c,u)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),o.resolve(u),e(c,u)};if(this.languages&&!this.isInitialized)return d(null,this.t.bind(this));this.changeLanguage(this.options.lng,d)};return this.options.resources||!this.options.initAsync?l():setTimeout(l,0),o}loadResources(t,e=zs){let i=e;const n=ht(t)?t:this.language;if(typeof t=="function"&&(i=t),!this.options.resources||this.options.partialBundledLanguages){if(n?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return i();const s=[],r=o=>{if(!o||o==="cimode")return;this.services.languageUtils.toResolveHierarchy(o).forEach(d=>{d!=="cimode"&&s.indexOf(d)<0&&s.push(d)})};n?r(n):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(l=>r(l)),this.options.preload?.forEach?.(o=>r(o)),this.services.backendConnector.load(s,this.options.ns,o=>{!o&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),i(o)})}else i(null)}reloadResources(t,e,i){const n=Vn();return typeof t=="function"&&(i=t,t=void 0),typeof e=="function"&&(i=e,e=void 0),t||(t=this.languages),e||(e=this.options.ns),i||(i=zs),this.services.backendConnector.reload(t,e,s=>{n.resolve(),i(s)}),n}use(t){if(!t)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!t.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return t.type==="backend"&&(this.modules.backend=t),(t.type==="logger"||t.log&&t.warn&&t.error)&&(this.modules.logger=t),t.type==="languageDetector"&&(this.modules.languageDetector=t),t.type==="i18nFormat"&&(this.modules.i18nFormat=t),t.type==="postProcessor"&&kh.addPostProcessor(t),t.type==="formatter"&&(this.modules.formatter=t),t.type==="3rdParty"&&this.modules.external.push(t),this}setResolvedLanguage(t){if(!(!t||!this.languages)&&!(["cimode","dev"].indexOf(t)>-1)){for(let e=0;e<this.languages.length;e++){const i=this.languages[e];if(!(["cimode","dev"].indexOf(i)>-1)&&this.store.hasLanguageSomeTranslations(i)){this.resolvedLanguage=i;break}}!this.resolvedLanguage&&this.languages.indexOf(t)<0&&this.store.hasLanguageSomeTranslations(t)&&(this.resolvedLanguage=t,this.languages.unshift(t))}}changeLanguage(t,e){this.isLanguageChangingTo=t;const i=Vn();this.emit("languageChanging",t);const n=o=>{this.language=o,this.languages=this.services.languageUtils.toResolveHierarchy(o),this.resolvedLanguage=void 0,this.setResolvedLanguage(o)},s=(o,l)=>{l?this.isLanguageChangingTo===t&&(n(l),this.translator.changeLanguage(l),this.isLanguageChangingTo=void 0,this.emit("languageChanged",l),this.logger.log("languageChanged",l)):this.isLanguageChangingTo=void 0,i.resolve((...d)=>this.t(...d)),e&&e(o,(...d)=>this.t(...d))},r=o=>{!t&&!o&&this.services.languageDetector&&(o=[]);const l=ht(o)?o:o&&o[0],d=this.store.hasLanguageSomeTranslations(l)?l:this.services.languageUtils.getBestMatchFromCodes(ht(o)?[o]:o);d&&(this.language||n(d),this.translator.language||this.translator.changeLanguage(d),this.services.languageDetector?.cacheUserLanguage?.(d)),this.loadResources(d,c=>{s(c,d)})};return!t&&this.services.languageDetector&&!this.services.languageDetector.async?r(this.services.languageDetector.detect()):!t&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(r):this.services.languageDetector.detect(r):r(t),i}getFixedT(t,e,i){const n=(s,r,...o)=>{let l;typeof r!="object"?l=this.options.overloadTranslationOptionHandler([s,r].concat(o)):l={...r},l.lng=l.lng||n.lng,l.lngs=l.lngs||n.lngs,l.ns=l.ns||n.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||i||n.keyPrefix);const d=this.options.keySeparator||".";let c;return l.keyPrefix&&Array.isArray(s)?c=s.map(u=>(typeof u=="function"&&(u=Eo(u,{...this.options,...r})),`${l.keyPrefix}${d}${u}`)):(typeof s=="function"&&(s=Eo(s,{...this.options,...r})),c=l.keyPrefix?`${l.keyPrefix}${d}${s}`:s),this.t(c,l)};return ht(t)?n.lng=t:n.lngs=t,n.ns=e,n.keyPrefix=i,n}t(...t){return this.translator?.translate(...t)}exists(...t){return this.translator?.exists(...t)}setDefaultNamespace(t){this.options.defaultNS=t}hasLoadedNamespace(t,e={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const i=e.lng||this.resolvedLanguage||this.languages[0],n=this.options?this.options.fallbackLng:!1,s=this.languages[this.languages.length-1];if(i.toLowerCase()==="cimode")return!0;const r=(o,l)=>{const d=this.services.backendConnector.state[`${o}|${l}`];return d===-1||d===0||d===2};if(e.precheck){const o=e.precheck(this,r);if(o!==void 0)return o}return!!(this.hasResourceBundle(i,t)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||r(i,t)&&(!n||r(s,t)))}loadNamespaces(t,e){const i=Vn();return this.options.ns?(ht(t)&&(t=[t]),t.forEach(n=>{this.options.ns.indexOf(n)<0&&this.options.ns.push(n)}),this.loadResources(n=>{i.resolve(),e&&e(n)}),i):(e&&e(),Promise.resolve())}loadLanguages(t,e){const i=Vn();ht(t)&&(t=[t]);const n=this.options.preload||[],s=t.filter(r=>n.indexOf(r)<0&&this.services.languageUtils.isSupportedCode(r));return s.length?(this.options.preload=n.concat(s),this.loadResources(r=>{i.resolve(),e&&e(r)}),i):(e&&e(),Promise.resolve())}dir(t){if(t||(t=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!t)return"rtl";try{const n=new Intl.Locale(t);if(n&&n.getTextInfo){const s=n.getTextInfo();if(s&&s.direction)return s.direction}}catch{}const e=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],i=this.services?.languageUtils||new rl(dl());return t.toLowerCase().indexOf("-latn")>1?"ltr":e.indexOf(i.getLanguagePartFromCode(t))>-1||t.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(t={},e){const i=new rs(t,e);return i.createInstance=rs.createInstance,i}cloneInstance(t={},e=zs){const i=t.forkResourceStore;i&&delete t.forkResourceStore;const n={...this.options,...t,isClone:!0},s=new rs(n);if((t.debug!==void 0||t.prefix!==void 0)&&(s.logger=s.logger.clone(t)),["store","services","language"].forEach(o=>{s[o]=this[o]}),s.services={...this.services},s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},i){const o=Object.keys(this.store.data).reduce((l,d)=>(l[d]={...this.store.data[d]},l[d]=Object.keys(l[d]).reduce((c,u)=>(c[u]={...l[d][u]},c),l[d]),l),{});s.store=new nl(o,n),s.services.resourceStore=s.store}return t.interpolation&&(s.services.interpolator=new hl(n)),s.translator=new hr(s.services,n),s.translator.on("*",(o,...l)=>{s.emit(o,...l)}),s.init(n,e),s.translator.options=n,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const ce=rs.createInstance();ce.createInstance;ce.dir;ce.init;ce.loadResources;ce.reloadResources;ce.use;ce.changeLanguage;ce.getFixedT;ce.t;ce.exists;ce.setDefaultNamespace;ce.hasLoadedNamespace;ce.loadNamespaces;ce.loadLanguages;const{slice:Nf,forEach:Bf}=[];function Uf(a){return Bf.call(Nf.call(arguments,1),t=>{if(t)for(const e in t)a[e]===void 0&&(a[e]=t[e])}),a}function $f(a){return typeof a!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(e=>e.test(a))}const fl=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,Hf=function(a,t){const i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},n=encodeURIComponent(t);let s=`${a}=${n}`;if(i.maxAge>0){const r=i.maxAge-0;if(Number.isNaN(r))throw new Error("maxAge should be a Number");s+=`; Max-Age=${Math.floor(r)}`}if(i.domain){if(!fl.test(i.domain))throw new TypeError("option domain is invalid");s+=`; Domain=${i.domain}`}if(i.path){if(!fl.test(i.path))throw new TypeError("option path is invalid");s+=`; Path=${i.path}`}if(i.expires){if(typeof i.expires.toUTCString!="function")throw new TypeError("option expires is invalid");s+=`; Expires=${i.expires.toUTCString()}`}if(i.httpOnly&&(s+="; HttpOnly"),i.secure&&(s+="; Secure"),i.sameSite)switch(typeof i.sameSite=="string"?i.sameSite.toLowerCase():i.sameSite){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return i.partitioned&&(s+="; Partitioned"),s},pl={create(a,t,e,i){let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};e&&(n.expires=new Date,n.expires.setTime(n.expires.getTime()+e*60*1e3)),i&&(n.domain=i),document.cookie=Hf(a,t,n)},read(a){const t=`${a}=`,e=document.cookie.split(";");for(let i=0;i<e.length;i++){let n=e[i];for(;n.charAt(0)===" ";)n=n.substring(1,n.length);if(n.indexOf(t)===0)return n.substring(t.length,n.length)}return null},remove(a,t){this.create(a,"",-1,t)}};var jf={name:"cookie",lookup(a){let{lookupCookie:t}=a;if(t&&typeof document<"u")return pl.read(t)||void 0},cacheUserLanguage(a,t){let{lookupCookie:e,cookieMinutes:i,cookieDomain:n,cookieOptions:s}=t;e&&typeof document<"u"&&pl.create(e,a,i,n,s)}},zf={name:"querystring",lookup(a){let{lookupQuerystring:t}=a,e;if(typeof window<"u"){let{search:i}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(i=window.location.hash.substring(window.location.hash.indexOf("?")));const s=i.substring(1).split("&");for(let r=0;r<s.length;r++){const o=s[r].indexOf("=");o>0&&s[r].substring(0,o)===t&&(e=s[r].substring(o+1))}}return e}},Gf={name:"hash",lookup(a){let{lookupHash:t,lookupFromHashIndex:e}=a,i;if(typeof window<"u"){const{hash:n}=window.location;if(n&&n.length>2){const s=n.substring(1);if(t){const r=s.split("&");for(let o=0;o<r.length;o++){const l=r[o].indexOf("=");l>0&&r[o].substring(0,l)===t&&(i=r[o].substring(l+1))}}if(i)return i;if(!i&&e>-1){const r=n.match(/\/([a-zA-Z-]*)/g);return Array.isArray(r)?r[typeof e=="number"?e:0]?.replace("/",""):void 0}}}return i}};let yn=null;const gl=()=>{if(yn!==null)return yn;try{if(yn=typeof window<"u"&&window.localStorage!==null,!yn)return!1;const a="i18next.translate.boo";window.localStorage.setItem(a,"foo"),window.localStorage.removeItem(a)}catch{yn=!1}return yn};var Vf={name:"localStorage",lookup(a){let{lookupLocalStorage:t}=a;if(t&&gl())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(a,t){let{lookupLocalStorage:e}=t;e&&gl()&&window.localStorage.setItem(e,a)}};let bn=null;const ml=()=>{if(bn!==null)return bn;try{if(bn=typeof window<"u"&&window.sessionStorage!==null,!bn)return!1;const a="i18next.translate.boo";window.sessionStorage.setItem(a,"foo"),window.sessionStorage.removeItem(a)}catch{bn=!1}return bn};var Wf={name:"sessionStorage",lookup(a){let{lookupSessionStorage:t}=a;if(t&&ml())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(a,t){let{lookupSessionStorage:e}=t;e&&ml()&&window.sessionStorage.setItem(e,a)}},qf={name:"navigator",lookup(a){const t=[];if(typeof navigator<"u"){const{languages:e,userLanguage:i,language:n}=navigator;if(e)for(let s=0;s<e.length;s++)t.push(e[s]);i&&t.push(i),n&&t.push(n)}return t.length>0?t:void 0}},Xf={name:"htmlTag",lookup(a){let{htmlTag:t}=a,e;const i=t||(typeof document<"u"?document.documentElement:null);return i&&typeof i.getAttribute=="function"&&(e=i.getAttribute("lang")),e}},Yf={name:"path",lookup(a){let{lookupFromPathIndex:t}=a;if(typeof window>"u")return;const e=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(e)?e[typeof t=="number"?t:0]?.replace("/",""):void 0}},Kf={name:"subdomain",lookup(a){let{lookupFromSubdomainIndex:t}=a;const e=typeof t=="number"?t+1:1,i=typeof window<"u"&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(i)return i[e]}};let Lh=!1;try{document.cookie,Lh=!0}catch{}const Ih=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];Lh||Ih.splice(1,1);const Jf=()=>({order:Ih,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:a=>a});let Mh=class{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(t,e)}init(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=t,this.options=Uf(e,this.options||{},Jf()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=n=>n.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=i,this.addDetector(jf),this.addDetector(zf),this.addDetector(Vf),this.addDetector(Wf),this.addDetector(qf),this.addDetector(Xf),this.addDetector(Yf),this.addDetector(Kf),this.addDetector(Gf)}addDetector(t){return this.detectors[t.name]=t,this}detect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,e=[];return t.forEach(i=>{if(this.detectors[i]){let n=this.detectors[i].lookup(this.options);n&&typeof n=="string"&&(n=[n]),n&&(e=e.concat(n))}}),e=e.filter(i=>i!=null&&!$f(i)).map(i=>this.options.convertDetectedLanguage(i)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?e:e.length>0?e[0]:null}cacheUserLanguage(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;e&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(t)>-1||e.forEach(i=>{this.detectors[i]&&this.detectors[i].cacheUserLanguage(t,this.options)}))}};Mh.type="languageDetector";function So(a){"@babel/helpers - typeof";return So=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},So(a)}function Rh(){return typeof XMLHttpRequest=="function"||(typeof XMLHttpRequest>"u"?"undefined":So(XMLHttpRequest))==="object"}function Qf(a){return!!a&&typeof a.then=="function"}function Zf(a){return Qf(a)?a:Promise.resolve(a)}const tp="modulepreload",ep=function(a){return"/"+a},yl={},ip=function(t,e,i){let n=Promise.resolve();if(e&&e.length>0){let l=function(d){return Promise.all(d.map(c=>Promise.resolve(c).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),o=r?.nonce||r?.getAttribute("nonce");n=l(e.map(d=>{if(d=ep(d),d in yl)return;yl[d]=!0;const c=d.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${u}`))return;const p=document.createElement("link");if(p.rel=c?"stylesheet":tp,c||(p.as="script"),p.crossOrigin="",p.href=d,o&&p.setAttribute("nonce",o),document.head.appendChild(p),c)return new Promise((y,v)=>{p.addEventListener("load",y),p.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${d}`)))})}))}function s(r){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=r,window.dispatchEvent(o),!o.defaultPrevented)throw r}return n.then(r=>{for(const o of r||[])o.status==="rejected"&&s(o.reason);return t().catch(s)})},Ce=globalThis||void 0||self;function bl(a,t){var e=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(a,n).enumerable})),e.push.apply(e,i)}return e}function wl(a){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?bl(Object(e),!0).forEach(function(i){np(a,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(e)):bl(Object(e)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(e,i))})}return a}function np(a,t,e){return(t=sp(t))in a?Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[t]=e,a}function sp(a){var t=rp(a,"string");return on(t)=="symbol"?t:t+""}function rp(a,t){if(on(a)!="object"||!a)return a;var e=a[Symbol.toPrimitive];if(e!==void 0){var i=e.call(a,t);if(on(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(a)}function on(a){"@babel/helpers - typeof";return on=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},on(a)}var Vi=typeof fetch=="function"?fetch:void 0;typeof Ce<"u"&&Ce.fetch?Vi=Ce.fetch:typeof window<"u"&&window.fetch&&(Vi=window.fetch);var us;Rh()&&(typeof Ce<"u"&&Ce.XMLHttpRequest?us=Ce.XMLHttpRequest:typeof window<"u"&&window.XMLHttpRequest&&(us=window.XMLHttpRequest));var cr;typeof ActiveXObject=="function"&&(typeof Ce<"u"&&Ce.ActiveXObject?cr=Ce.ActiveXObject:typeof window<"u"&&window.ActiveXObject&&(cr=window.ActiveXObject));typeof Vi!="function"&&(Vi=void 0);if(!Vi&&!us&&!cr)try{ip(()=>import("./browser-ponyfill-oJt13y2d.js").then(a=>a.b),[]).then(function(a){Vi=a.default}).catch(function(){})}catch{}var xo=function(t,e){if(e&&on(e)==="object"){var i="";for(var n in e)i+="&"+encodeURIComponent(n)+"="+encodeURIComponent(e[n]);if(!i)return t;t=t+(t.indexOf("?")!==-1?"&":"?")+i.slice(1)}return t},vl=function(t,e,i,n){var s=function(l){if(!l.ok)return i(l.statusText||"Error",{status:l.status});l.text().then(function(d){i(null,{status:l.status,data:d})}).catch(i)};if(n){var r=n(t,e);if(r instanceof Promise){r.then(s).catch(i);return}}typeof fetch=="function"?fetch(t,e).then(s).catch(i):Vi(t,e).then(s).catch(i)},Al=!1,op=function(t,e,i,n){t.queryStringParams&&(e=xo(e,t.queryStringParams));var s=wl({},typeof t.customHeaders=="function"?t.customHeaders():t.customHeaders);typeof window>"u"&&typeof Ce<"u"&&typeof Ce.process<"u"&&Ce.process.versions&&Ce.process.versions.node&&(s["User-Agent"]="i18next-http-backend (node/".concat(Ce.process.version,"; ").concat(Ce.process.platform," ").concat(Ce.process.arch,")")),i&&(s["Content-Type"]="application/json");var r=typeof t.requestOptions=="function"?t.requestOptions(i):t.requestOptions,o=wl({method:i?"POST":"GET",body:i?t.stringify(i):void 0,headers:s},Al?{}:r),l=typeof t.alternateFetch=="function"&&t.alternateFetch.length>=1?t.alternateFetch:void 0;try{vl(e,o,n,l)}catch(d){if(!r||Object.keys(r).length===0||!d.message||d.message.indexOf("not implemented")<0)return n(d);try{Object.keys(r).forEach(function(c){delete o[c]}),vl(e,o,n,l),Al=!0}catch(c){n(c)}}},ap=function(t,e,i,n){i&&on(i)==="object"&&(i=xo("",i).slice(1)),t.queryStringParams&&(e=xo(e,t.queryStringParams));try{var s=us?new us:new cr("MSXML2.XMLHTTP.3.0");s.open(i?"POST":"GET",e,1),t.crossDomain||s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.withCredentials=!!t.withCredentials,i&&s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.overrideMimeType&&s.overrideMimeType("application/json");var r=t.customHeaders;if(r=typeof r=="function"?r():r,r)for(var o in r)s.setRequestHeader(o,r[o]);s.onreadystatechange=function(){s.readyState>3&&n(s.status>=400?s.statusText:null,{status:s.status,data:s.responseText})},s.send(i)}catch(l){console&&console.log(l)}},lp=function(t,e,i,n){if(typeof i=="function"&&(n=i,i=void 0),n=n||function(){},Vi&&e.indexOf("file:")!==0)return op(t,e,i,n);if(Rh()||typeof ActiveXObject=="function")return ap(t,e,i,n);n(new Error("No fetch and no xhr implementation found!"))};function Fn(a){"@babel/helpers - typeof";return Fn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fn(a)}function El(a,t){var e=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(a,n).enumerable})),e.push.apply(e,i)}return e}function Zr(a){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?El(Object(e),!0).forEach(function(i){Fh(a,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(e)):El(Object(e)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(e,i))})}return a}function hp(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function cp(a,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(a,Oh(i.key),i)}}function dp(a,t,e){return t&&cp(a.prototype,t),Object.defineProperty(a,"prototype",{writable:!1}),a}function Fh(a,t,e){return(t=Oh(t))in a?Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[t]=e,a}function Oh(a){var t=up(a,"string");return Fn(t)=="symbol"?t:t+""}function up(a,t){if(Fn(a)!="object"||!a)return a;var e=a[Symbol.toPrimitive];if(e!==void 0){var i=e.call(a,t);if(Fn(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}var fp=function(){return{loadPath:"/locales/{{lng}}/{{ns}}.json",addPath:"/locales/add/{{lng}}/{{ns}}",parse:function(e){return JSON.parse(e)},stringify:JSON.stringify,parsePayload:function(e,i,n){return Fh({},i,n||"")},parseLoadPayload:function(e,i){},request:lp,reloadInterval:typeof window<"u"?!1:3600*1e3,customHeaders:{},queryStringParams:{},crossDomain:!1,withCredentials:!1,overrideMimeType:!1,requestOptions:{mode:"cors",credentials:"same-origin",cache:"default"}}},Nh=(function(){function a(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};hp(this,a),this.services=t,this.options=e,this.allOptions=i,this.type="backend",this.init(t,e,i)}return dp(a,[{key:"init",value:function(e){var i=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.services=e,this.options=Zr(Zr(Zr({},fp()),this.options||{}),n),this.allOptions=s,this.services&&this.options.reloadInterval){var r=setInterval(function(){return i.reload()},this.options.reloadInterval);Fn(r)==="object"&&typeof r.unref=="function"&&r.unref()}}},{key:"readMulti",value:function(e,i,n){this._readAny(e,e,i,i,n)}},{key:"read",value:function(e,i,n){this._readAny([e],e,[i],i,n)}},{key:"_readAny",value:function(e,i,n,s,r){var o=this,l=this.options.loadPath;typeof this.options.loadPath=="function"&&(l=this.options.loadPath(e,n)),l=Zf(l),l.then(function(d){if(!d)return r(null,{});var c=o.services.interpolator.interpolate(d,{lng:e.join("+"),ns:n.join("+")});o.loadUrl(c,r,i,s)})}},{key:"loadUrl",value:function(e,i,n,s){var r=this,o=typeof n=="string"?[n]:n,l=typeof s=="string"?[s]:s,d=this.options.parseLoadPayload(o,l);this.options.request(this.options,e,d,function(c,u){if(u&&(u.status>=500&&u.status<600||!u.status))return i("failed loading "+e+"; status code: "+u.status,!0);if(u&&u.status>=400&&u.status<500)return i("failed loading "+e+"; status code: "+u.status,!1);if(!u&&c&&c.message){var p=c.message.toLowerCase(),y=["failed","fetch","network","load"].find(function(x){return p.indexOf(x)>-1});if(y)return i("failed loading "+e+": "+c.message,!0)}if(c)return i(c,!1);var v,w;try{typeof u.data=="string"?v=r.options.parse(u.data,n,s):v=u.data}catch{w="failed parsing "+e+" to json"}if(w)return i(w,!1);i(null,v)})}},{key:"create",value:function(e,i,n,s,r){var o=this;if(this.options.addPath){typeof e=="string"&&(e=[e]);var l=this.options.parsePayload(i,n,s),d=0,c=[],u=[];e.forEach(function(p){var y=o.options.addPath;typeof o.options.addPath=="function"&&(y=o.options.addPath(p,i));var v=o.services.interpolator.interpolate(y,{lng:p,ns:i});o.options.request(o.options,v,l,function(w,x){d+=1,c.push(w),u.push(x),d===e.length&&typeof r=="function"&&r(c,u)})})}}},{key:"reload",value:function(){var e=this,i=this.services,n=i.backendConnector,s=i.languageUtils,r=i.logger,o=n.language;if(!(o&&o.toLowerCase()==="cimode")){var l=[],d=function(u){var p=s.toResolveHierarchy(u);p.forEach(function(y){l.indexOf(y)<0&&l.push(y)})};d(o),this.allOptions.preload&&this.allOptions.preload.forEach(function(c){return d(c)}),l.forEach(function(c){e.allOptions.ns.forEach(function(u){n.read(c,u,"read",null,null,function(p,y){p&&r.warn("loading namespace ".concat(u," for language ").concat(c," failed"),p),!p&&y&&r.log("loaded namespace ".concat(u," for language ").concat(c),y),n.loaded("".concat(c,"|").concat(u),p,y)})})})}}}])})();Nh.type="backend";const fs=["en","de"],Sl={en:"English",de:"Deutsch"},Er=()=>{const t=window.location.pathname.match(/^\/(en|de)(?:\/|$)/);if(t&&fs.includes(t[1]))return t[1];const e=localStorage.getItem("i18nextLng");return e&&fs.includes(e)?e:"en"};let xl=!1;const pp=async()=>{if(xl)return ce;const a=Er();return await ce.use(Nh).use(Mh).init({lng:a,fallbackLng:"en",supportedLngs:fs,ns:["common","tools"],defaultNS:"common",backend:{loadPath:"/locales/{{lng}}/{{ns}}.json"},detection:{order:["path","localStorage","navigator"],lookupFromPathIndex:0,caches:["localStorage"]},interpolation:{escapeValue:!1}}),xl=!0,ce},$t=(a,t)=>ce.t(a,t),gp=a=>{if(!fs.includes(a))return;const t=window.location.pathname;Er();let e;t.match(/^\/(en|de)\//)?e=t.replace(/^\/(en|de)\//,`/${a}/`):t.match(/^\/(en|de)$/)?e=`/${a}`:e=`/${a}${t}`;const i=e+window.location.search+window.location.hash;window.location.href=i},mp=()=>{document.querySelectorAll("[data-i18n]").forEach(a=>{const t=a.getAttribute("data-i18n");if(t){const e=$t(t);e&&e!==t&&(a.textContent=e)}}),document.querySelectorAll("[data-i18n-placeholder]").forEach(a=>{const t=a.getAttribute("data-i18n-placeholder");if(t&&a instanceof HTMLInputElement){const e=$t(t);e&&e!==t&&(a.placeholder=e)}}),document.querySelectorAll("[data-i18n-title]").forEach(a=>{const t=a.getAttribute("data-i18n-title");if(t){const e=$t(t);e&&e!==t&&(a.title=e)}}),document.documentElement.lang=ce.language},yp=()=>{const a=Er();if(a==="en")return;document.querySelectorAll("a[href]").forEach(e=>{const i=e.getAttribute("href");if(!i||i.startsWith("http")||i.startsWith("mailto:")||i.startsWith("tel:")||i.startsWith("#")||i.startsWith("javascript:")||i.match(/^\/(en|de)\//))return;let n;i.startsWith("/")?n=`/${a}${i}`:i.startsWith("./")?n=i.replace("./",`/${a}/`):i==="/"||i===""?n=`/${a}/`:n=`/${a}/${i}`,e.setAttribute("href",n)})},Cl=()=>{const a=Er(),t=document.createElement("div");t.className="relative",t.id="language-switcher";const e=document.createElement("button");e.className=`
    inline-flex items-center gap-1.5 text-sm font-medium
    bg-gray-800 text-gray-200 border border-gray-600
    px-3 py-1.5 rounded-full transition-colors duration-200
    shadow-sm hover:shadow-md hover:bg-gray-700
  `.trim(),e.setAttribute("aria-haspopup","true"),e.setAttribute("aria-expanded","false");const i=document.createElement("span");i.className="font-medium",i.textContent=Sl[a];const n=document.createElement("svg");n.className="w-4 h-4",n.setAttribute("fill","none"),n.setAttribute("stroke","currentColor"),n.setAttribute("viewBox","0 0 24 24"),n.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>',e.appendChild(i),e.appendChild(n);const s=document.createElement("div");return s.className=`
    hidden absolute right-0 mt-2 w-40 rounded-lg
    bg-gray-800 border border-gray-700 shadow-xl
    py-1 z-50
  `.trim(),s.setAttribute("role","menu"),fs.forEach(r=>{const o=document.createElement("button");o.className=`
      w-full px-4 py-2 text-left text-sm text-gray-200
      hover:bg-gray-700 flex items-center gap-2
      ${r===a?"bg-gray-700":""}
    `.trim(),o.setAttribute("role","menuitem");const l=document.createElement("span");l.textContent=Sl[r],o.appendChild(l),o.addEventListener("click",()=>{r!==a&&gp(r)}),s.appendChild(o)}),t.appendChild(e),t.appendChild(s),e.addEventListener("click",r=>{r.stopPropagation();const o=e.getAttribute("aria-expanded")==="true";e.setAttribute("aria-expanded",(!o).toString()),s.classList.toggle("hidden")}),document.addEventListener("click",()=>{e.setAttribute("aria-expanded","false"),s.classList.add("hidden")}),t},bp=()=>{const a=document.querySelector("footer");if(!a)return;const t=a.querySelectorAll("h3");let e=null;if(t.forEach(i=>{(i.textContent?.trim()==="Follow Us"||i.textContent?.trim()==="Folgen Sie uns")&&(e=i.parentElement)}),e){const i=e.querySelector(".space-x-4");if(i){const n=document.createElement("div");n.className="inline-flex flex-col gap-4",i.parentNode?.insertBefore(n,i),n.appendChild(i);const s=Cl();s.className="relative w-full";const r=s.querySelector("button");r&&(r.className=`
                    flex items-center justify-between w-full text-sm font-medium
                    bg-gray-800 text-gray-400 border border-gray-700
                    px-3 py-2 rounded-lg transition-colors duration-200
                    hover:text-white hover:border-gray-600
                `.trim());const o=s.querySelector('div[role="menu"]');o&&(o.classList.remove("mt-2","w-40"),o.classList.add("bottom-full","mb-2","w-full")),n.appendChild(s)}else{const n=document.createElement("div");n.className="mt-4 w-full";const s=Cl();n.appendChild(s),e.appendChild(n)}}},wp=async()=>{await pp(),bp(),mp(),ji.workerSrc=new URL("/assets/pdf.worker.min-qwK7q_zL.mjs",import.meta.url).toString();const a=/Android|iPhone|iPod/i.test(navigator.userAgent),t=document.getElementById("shortcut"),e=document.getElementById("open-shortcuts-btn");a?(t&&(t.style.display="none"),e&&(e.style.display="none")):t&&(t.textContent=navigator.userAgent.toUpperCase().includes("MAC")?" + K":"Ctrl + K");const i={"Popular Tools":"tools:categories.popularTools","Edit & Annotate":"tools:categories.editAnnotate","Convert to PDF":"tools:categories.convertToPdf","Convert from PDF":"tools:categories.convertFromPdf","Organize & Manage":"tools:categories.organizeManage","Optimize & Repair":"tools:categories.optimizeRepair","Secure PDF":"tools:categories.securePdf"},n={"PDF Multi Tool":"tools:pdfMultiTool","Merge PDF":"tools:mergePdf","Split PDF":"tools:splitPdf","Compress PDF":"tools:compressPdf","PDF Editor":"tools:pdfEditor","JPG to PDF":"tools:jpgToPdf","Sign PDF":"tools:signPdf","Crop PDF":"tools:cropPdf","Extract Pages":"tools:extractPages","Duplicate & Organize":"tools:duplicateOrganize","Delete Pages":"tools:deletePages","Edit Bookmarks":"tools:editBookmarks","Table of Contents":"tools:tableOfContents","Page Numbers":"tools:pageNumbers","Add Watermark":"tools:addWatermark","Header & Footer":"tools:headerFooter","Invert Colors":"tools:invertColors","Background Color":"tools:backgroundColor","Change Text Color":"tools:changeTextColor","Add Stamps":"tools:addStamps","Remove Annotations":"tools:removeAnnotations","PDF Form Filler":"tools:pdfFormFiller","Create PDF Form":"tools:createPdfForm","Remove Blank Pages":"tools:removeBlankPages","Image to PDF":"tools:imageToPdf","PNG to PDF":"tools:pngToPdf","WebP to PDF":"tools:webpToPdf","SVG to PDF":"tools:svgToPdf","BMP to PDF":"tools:bmpToPdf","HEIC to PDF":"tools:heicToPdf","TIFF to PDF":"tools:tiffToPdf","Text to PDF":"tools:textToPdf","JSON to PDF":"tools:jsonToPdf","PDF to JPG":"tools:pdfToJpg","PDF to PNG":"tools:pdfToPng","PDF to WebP":"tools:pdfToWebp","PDF to BMP":"tools:pdfToBmp","PDF to TIFF":"tools:pdfToTiff","PDF to Greyscale":"tools:pdfToGreyscale","PDF to JSON":"tools:pdfToJson","OCR PDF":"tools:ocrPdf","Alternate & Mix Pages":"tools:alternateMix","Organize & Duplicate":"tools:duplicateOrganize","Add Attachments":"tools:addAttachments","Extract Attachments":"tools:extractAttachments","Edit Attachments":"tools:editAttachments","Divide Pages":"tools:dividePages","Add Blank Page":"tools:addBlankPage","Reverse Pages":"tools:reversePages","Rotate PDF":"tools:rotatePdf","N-Up PDF":"tools:nUpPdf","Combine to Single Page":"tools:combineToSinglePage","View Metadata":"tools:viewMetadata","Edit Metadata":"tools:editMetadata","PDFs to ZIP":"tools:pdfsToZip","Compare PDFs":"tools:comparePdfs","Posterize PDF":"tools:posterizePdf","Fix Page Size":"tools:fixPageSize","Linearize PDF":"tools:linearizePdf","Page Dimensions":"tools:pageDimensions","Remove Restrictions":"tools:removeRestrictions","Repair PDF":"tools:repairPdf","Encrypt PDF":"tools:encryptPdf","Sanitize PDF":"tools:sanitizePdf","Decrypt PDF":"tools:decryptPdf","Flatten PDF":"tools:flattenPdf","Remove Metadata":"tools:removeMetadata","Change Permissions":"tools:changePermissions"};if(Y.toolGrid){Y.toolGrid.textContent="",_n.forEach(U=>{const K=document.createElement("div");K.className="category-group col-span-full";const z=document.createElement("h2");z.className="text-xl font-bold text-indigo-400 mb-4 mt-8 first:mt-0 text-white";const G=i[U.name];z.textContent=G?$t(G):U.name;const et=document.createElement("div");et.className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-6",U.tools.forEach(V=>{let W;V.href?(W=document.createElement("a"),W.href=V.href,W.className="tool-card block bg-gray-800 rounded-xl p-4 cursor-pointer flex flex-col items-center justify-center text-center no-underline hover:shadow-lg transition duration-200"):(W=document.createElement("div"),W.className="tool-card bg-gray-800 rounded-xl p-4 cursor-pointer flex flex-col items-center justify-center text-center hover:shadow-lg transition duration-200",W.dataset.toolId=M(V));const Q=document.createElement("i");Q.className="w-10 h-10 mb-3 text-indigo-400",Q.setAttribute("data-lucide",V.icon);const Ct=document.createElement("h3");Ct.className="font-semibold text-white";const Mt=n[V.name];if(Ct.textContent=Mt?$t(`${Mt}.name`):V.name,W.append(Q,Ct),V.subtitle){const pt=document.createElement("p");pt.className="text-xs text-gray-400 mt-1 px-2",pt.textContent=Mt?$t(`${Mt}.subtitle`):V.subtitle,W.appendChild(pt)}et.appendChild(W)}),K.append(z,et),Y.toolGrid.appendChild(K)});const F=document.getElementById("search-bar"),O=Y.toolGrid.querySelectorAll(".category-group"),H=(U,K)=>{if(!U)return!0;let z=0,G=0;for(;z<U.length&&G<K.length;)U[z]===K[G]&&z++,G++;return z===U.length};F.addEventListener("input",()=>{const U=F.value.toLowerCase().trim();O.forEach(K=>{const z=K.querySelectorAll(".tool-card");let G=0;z.forEach(et=>{const V=et.querySelector("h3").textContent.toLowerCase(),W=et.querySelector("p")?.textContent.toLowerCase()||"",Q=H(U,V)||H(U,W);et.classList.toggle("hidden",!Q),Q&&G++}),K.classList.toggle("hidden",G===0)})}),window.addEventListener("keydown",function(U){const K=U.key.toLowerCase(),z=navigator.userAgent.toUpperCase().includes("MAC"),G=U.ctrlKey&&K==="k",et=z&&U.metaKey&&K==="k";(G||et)&&(U.preventDefault(),F.focus())}),Y.toolGrid.addEventListener("click",U=>{})}Y.backToGridBtn&&Y.backToGridBtn.addEventListener("click",()=>yf()),Y.alertOkBtn&&Y.alertOkBtn.addEventListener("click",Th);const s=document.getElementById("faq-accordion");s&&s.addEventListener("click",F=>{const O=F.target.closest(".faq-question");if(!O)return;const H=O.parentElement,U=H.querySelector(".faq-answer");H.classList.toggle("open"),H.classList.contains("open")?U.style.maxHeight=U.scrollHeight+"px":U.style.maxHeight="0px"}),fa({icons:pa}),console.log("Please share our tool and share the love!");const r=[document.getElementById("github-stars-desktop"),document.getElementById("github-stars-mobile")];r.some(F=>F)&&fetch("https://api.github.com/repos/alam00000/bentopdf").then(F=>F.json()).then(F=>{if(F.stargazers_count!==void 0){const O=Bu(F.stargazers_count);r.forEach(H=>{H&&(H.textContent=O)})}}).catch(()=>{r.forEach(F=>{F&&(F.textContent="-")})}),Ne.init();const o=document.getElementById("shortcuts-tab-btn"),l=document.getElementById("preferences-tab-btn"),d=document.getElementById("shortcuts-tab-content"),c=document.getElementById("preferences-tab-content"),u=document.getElementById("shortcuts-tab-footer"),p=document.getElementById("preferences-tab-footer"),y=document.getElementById("reset-shortcuts-btn");o&&l&&(o.addEventListener("click",()=>{o.classList.add("bg-indigo-600","text-white"),o.classList.remove("text-gray-300"),l.classList.remove("bg-indigo-600","text-white"),l.classList.add("text-gray-300"),d?.classList.remove("hidden"),c?.classList.add("hidden"),u?.classList.remove("hidden"),p?.classList.add("hidden"),y?.classList.remove("hidden")}),l.addEventListener("click",()=>{l.classList.add("bg-indigo-600","text-white"),l.classList.remove("text-gray-300"),o.classList.remove("bg-indigo-600","text-white"),o.classList.add("text-gray-300"),c?.classList.remove("hidden"),d?.classList.add("hidden"),p?.classList.remove("hidden"),u?.classList.add("hidden"),y?.classList.add("hidden")}));const v=document.getElementById("full-width-toggle"),w=document.getElementById("tool-interface"),x=localStorage.getItem("fullWidthMode")==="true";v&&(v.checked=x,S(x));function S(F){w&&(F?w.classList.remove("max-w-4xl"):w.classList.add("max-w-4xl")),document.querySelectorAll("#tool-uploader").forEach(H=>{F?H.classList.remove("max-w-2xl","max-w-5xl"):!H.classList.contains("max-w-2xl")&&!H.classList.contains("max-w-5xl")&&H.classList.add("max-w-2xl")})}v&&v.addEventListener("change",F=>{const O=F.target.checked;localStorage.setItem("fullWidthMode",O.toString()),S(O)}),Y.openShortcutsBtn&&Y.openShortcutsBtn.addEventListener("click",()=>{R(),Y.shortcutsModal.classList.remove("hidden")}),Y.closeShortcutsModalBtn&&Y.closeShortcutsModalBtn.addEventListener("click",()=>{Y.shortcutsModal.classList.add("hidden")}),Y.shortcutsModal&&Y.shortcutsModal.addEventListener("click",F=>{F.target===Y.shortcutsModal&&Y.shortcutsModal.classList.add("hidden")}),Y.resetShortcutsBtn&&Y.resetShortcutsBtn.addEventListener("click",async()=>{await D($t("settings.warnings.resetTitle"),$t("settings.warnings.resetMessage"),!0)&&(Ne.reset(),R())}),Y.exportShortcutsBtn&&Y.exportShortcutsBtn.addEventListener("click",()=>{Ne.exportSettings()}),Y.importShortcutsBtn&&Y.importShortcutsBtn.addEventListener("click",()=>{const F=document.createElement("input");F.type="file",F.accept=".json",F.onchange=O=>{const H=O.target.files?.[0];if(H){const U=new FileReader;U.onload=async K=>{const z=K.target?.result;Ne.importSettings(z)?(R(),await D($t("settings.warnings.importSuccessTitle"),$t("settings.warnings.importSuccessMessage"),!1)):await D($t("settings.warnings.importFailTitle"),$t("settings.warnings.importFailMessage"),!1)},U.readAsText(H)}},F.click()}),Y.shortcutSearch&&Y.shortcutSearch.addEventListener("input",F=>{const O=F.target.value.toLowerCase();Y.shortcutsList.querySelectorAll(".category-section").forEach(U=>{const K=U.querySelectorAll(".shortcut-item");let z=0;K.forEach(G=>{(G.textContent?.toLowerCase()||"").includes(O)?(G.classList.remove("hidden"),z++):G.classList.add("hidden")}),z===0?U.classList.add("hidden"):U.classList.remove("hidden")})});const P={"mod+w":{mac:"Closes tab",windows:"Closes tab"},"mod+t":{mac:"Opens new tab",windows:"Opens new tab"},"mod+n":{mac:"Opens new window",windows:"Opens new window"},"mod+shift+n":{mac:"Opens incognito window",windows:"Opens incognito window"},"mod+q":{mac:"Quits application (cannot be overridden)"},"mod+m":{mac:"Minimizes window"},"mod+h":{mac:"Hides window"},"mod+r":{mac:"Reloads page",windows:"Reloads page"},"mod+shift+r":{mac:"Hard reloads page",windows:"Hard reloads page"},"mod+l":{mac:"Focuses address bar",windows:"Focuses address bar"},"mod+d":{mac:"Bookmarks page",windows:"Bookmarks page"},"mod+shift+t":{mac:"Reopens closed tab",windows:"Reopens closed tab"},"mod+shift+w":{mac:"Closes window",windows:"Closes window"},"mod+tab":{mac:"Switches tabs",windows:"Switches apps"},"alt+f4":{windows:"Closes window"},"ctrl+tab":{mac:"Switches tabs",windows:"Switches tabs"}};function k(F,O){const H=P[F];if(!H)return null;const U=O?H.mac:H.windows;return U||null}function D(F,O,H=!0){return new Promise(U=>{if(!Y.warningModal||!Y.warningTitle||!Y.warningMessage||!Y.warningCancelBtn||!Y.warningConfirmBtn){U(H?confirm(O):(alert(O),!0));return}Y.warningTitle.textContent=F,Y.warningMessage.innerHTML=O,Y.warningModal.classList.remove("hidden"),Y.warningModal.classList.add("flex"),H?(Y.warningCancelBtn.style.display="",Y.warningConfirmBtn.textContent="Proceed"):(Y.warningCancelBtn.style.display="none",Y.warningConfirmBtn.textContent="OK");const K=()=>{G(),U(!0)},z=()=>{G(),U(!1)},G=()=>{Y.warningModal?.classList.add("hidden"),Y.warningModal?.classList.remove("flex"),Y.warningConfirmBtn?.removeEventListener("click",K),Y.warningCancelBtn?.removeEventListener("click",z)};Y.warningConfirmBtn.addEventListener("click",K),Y.warningCancelBtn.addEventListener("click",z),Y.warningModal.addEventListener("click",et=>{et.target===Y.warningModal&&(H?z():K())},{once:!0})})}function M(F){if(F.id)return F.id;if(F.href){const O=F.href.match(/\/([^/]+)\.html$/);return O?O[1]:F.href}return"unknown"}function R(){if(!Y.shortcutsList)return;Y.shortcutsList.innerHTML="";const F=Ne.getAllShortcuts(),O=navigator.userAgent.toUpperCase().includes("MAC"),H=_n.flatMap(U=>U.tools);_n.forEach(U=>{const K=document.createElement("div");K.className="category-section mb-6 last:mb-0";const z=document.createElement("h3");z.className="text-gray-400 text-xs font-bold uppercase tracking-wider mb-3 pl-1";const G=i[U.name];z.textContent=G?$t(G):U.name,K.appendChild(z);const et=document.createElement("div");et.className="space-y-2",K.appendChild(et);let V=!1;U.tools.forEach(W=>{V=!0;const Q=M(W),Ct=F.get(Q)||"",Mt=document.createElement("div");Mt.className="shortcut-item flex items-center justify-between p-3 bg-gray-900 rounded-lg border border-gray-700 hover:border-gray-600 transition-colors";const pt=document.createElement("div");pt.className="flex items-center gap-3";const gt=document.createElement("i");gt.className="w-5 h-5 text-indigo-400",gt.setAttribute("data-lucide",W.icon);const bt=document.createElement("span");bt.className="text-gray-200 font-medium";const ct=n[W.name];bt.textContent=ct?$t(`${ct}.name`):W.name,pt.append(gt,bt);const _t=document.createElement("div");_t.className="relative";const wt=document.createElement("input");wt.type="text",wt.className="shortcut-input w-32 bg-gray-800 border border-gray-600 text-white text-center text-sm rounded px-2 py-1 focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all",wt.placeholder=$t("settings.clickToSet"),wt.value=Oi(Ct,O),wt.readOnly=!0;const Pt=document.createElement("button");Pt.className="absolute -right-2 -top-2 bg-gray-700 hover:bg-red-600 text-white rounded-full p-0.5 hidden group-hover:block shadow-sm",Pt.innerHTML='<i data-lucide="x" class="w-3 h-3"></i>',Ct&&_t.classList.add("group"),Pt.onclick=Tt=>{Tt.stopPropagation(),Ne.setShortcut(Q,""),R()},wt.onkeydown=async Tt=>{if(Tt.preventDefault(),Tt.stopPropagation(),Tt.key==="Backspace"||Tt.key==="Delete"){Ne.setShortcut(Q,""),R();return}const ie=[];O?(Tt.metaKey&&ie.push("mod"),Tt.ctrlKey&&ie.push("ctrl")):(Tt.ctrlKey||Tt.metaKey)&&ie.push("mod"),Tt.altKey&&ie.push("alt"),Tt.shiftKey&&ie.push("shift");let He=Tt.key.toLowerCase();Tt.altKey&&Tt.code&&(Tt.code.startsWith("Key")?He=Tt.code.slice(3).toLowerCase():Tt.code.startsWith("Digit")&&(He=Tt.code.slice(5)));const Ae=["control","shift","alt","meta"].includes(He);if(He==="dead"||He.startsWith("dead")){wt.value=Oi(Ne.getShortcut(Q)||"",O);return}Ae||ie.push(He);const _e=ie.join("+");if(wt.value=Oi(_e,O),!Ae){const Wt=Ne.findToolByShortcut(_e);if(Wt&&Wt!==Q){const ue=H.find(hn=>M(hn)===Wt),fe=ue?.name||Wt,Wi=Oi(_e,O),Ri=ue?n[ue.name]:null,Te=Ri?$t(`${Ri}.name`):fe;await D($t("settings.warnings.alreadyInUse"),`<strong>${Wi}</strong> ${$t("settings.warnings.assignedTo")}<br><br><em>"${Te}"</em><br><br>`+$t("settings.warnings.chooseDifferent"),!1),wt.value=Oi(Ne.getShortcut(Q)||"",O),wt.classList.remove("border-indigo-500","text-indigo-400"),wt.blur();return}const hi=k(_e,O);if(hi){const ue=Oi(_e,O);if(!await D($t("settings.warnings.reserved"),`<strong>${ue}</strong> ${$t("settings.warnings.commonlyUsed")}<br><br>"<em>${hi}</em>"<br><br>${$t("settings.warnings.unreliable")}<br><br>`+$t("settings.warnings.useAnyway"))){wt.value=Oi(Ne.getShortcut(Q)||"",O),wt.classList.remove("border-indigo-500","text-indigo-400"),wt.blur();return}}Ne.setShortcut(Q,_e),R()}},wt.onkeyup=Tt=>{const ie=Tt.key.toLowerCase();["control","shift","alt","meta"].includes(ie)&&Ne.getShortcut(Q)},wt.onfocus=()=>{wt.value=$t("settings.pressKeys"),wt.classList.add("border-indigo-500","text-indigo-400")},wt.onblur=()=>{wt.value=Oi(Ne.getShortcut(Q)||"",O),wt.classList.remove("border-indigo-500","text-indigo-400")},_t.append(wt),Ct&&_t.append(Pt),Mt.append(pt,_t),et.appendChild(Mt)}),V&&Y.shortcutsList.appendChild(K)}),fa({icons:pa})}const N=document.getElementById("scroll-to-top-btn");if(N){let F=window.scrollY;window.addEventListener("scroll",()=>{const O=window.scrollY;O<F&&O>300?N.classList.add("visible"):N.classList.remove("visible"),F=O}),N.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"instant"})})}yp()};window.addEventListener("load",wp);export{io as B,ji as G,lt as S,ip as _,Rp as a,$u as b,Fp as c,Tp as d,Ne as e,Nu as f,Mp as g,_p as h,Op as i,Lp as j,mf as k,pf as l,gf as m,wc as n,Jt as o,kp as p,Ep as q,Pp as r,$n as s,Ip as t,th as u,Dp as v,Ce as w,xp as x,Cp as y};
